import{a as dt,f as _t,c as p_}from"../chunks/CeDzIp_s.js";import{i as g_}from"../chunks/B6BH3d5F.js";import{w as m_,o as __}from"../chunks/B2DTO6ll.js";import{h as Wt,g as bf,f as y_,u as P,i as v_,H as E_,j as ch,k as uh,l as Ha,e as no,C as I_,az as T_,ak as hh,c as Ns,b as gl,s as w_,aM as C_,aT as Pf,ax as rc,aU as A_,a8 as dh,aV as S_,aW as R_,q as _e,a as fh,aX as pn,r as kf,p as Nf,aY as $a,aZ as b_,aw as P_,d as k_,x as N_,a_ as D_,aQ as O_,J as ft,a6 as x_,a$ as L_,R as M_,b0 as Bt,b1 as V_,S as so,T as an,U as F_,aB as U_,V as te,v as H,al as ph,b2 as B_,X as ue,W as ne,b3 as q_,b4 as gh}from"../chunks/BHtV93Dn.js";import{e as Ne,s as bt}from"../chunks/Dq6o2ZGq.js";import{i as qt,s as W_,a as j_}from"../chunks/Bas3_MVN.js";import{h as H_,r as bs,s as $_}from"../chunks/Dq4WeBzD.js";function z_(n,e,t){for(var s=[],i=e.length,r,o=e.length,l=0;l<i;l++){let p=e[l];Nf(p,()=>{if(r){if(r.pending.delete(p),r.done.add(p),r.pending.size===0){var m=n.outrogroups;ml(rc(r.done)),m.delete(r),m.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=s.length===0&&t!==null;if(c){var h=t,f=h.parentNode;P_(f),f.append(h),n.items.clear()}ml(e,!c)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function ml(n,e=!0){for(var t=0;t<n.length;t++)k_(n[t],e)}var mh;function G_(n,e,t,s,i,r=null){var o=n,l=new Map;Wt&&bf();var c=null,h=C_(()=>{var k=t();return Pf(k)?k:k==null?[]:rc(k)}),f,p=!0;function m(){S.fallback=c,K_(S,f,o,e,s),c!==null&&(f.length===0?(c.f&pn)===0?kf(c):(c.f^=pn,qi(c,null,o)):Nf(c,()=>{c=null}))}var A=y_(()=>{f=P(h);var k=f.length;let x=!1;if(Wt){var W=v_(o)===E_;W!==(k===0)&&(o=ch(),uh(o),Ha(!1),x=!0)}for(var B=new Set,K=Ns,j=w_(),ae=0;ae<k;ae+=1){Wt&&no.nodeType===I_&&no.data===T_&&(o=no,x=!0,Ha(!1));var le=f[ae],E=s(le,ae),_=p?null:l.get(E);_?(_.v&&hh(_.v,le),_.i&&hh(_.i,ae),j&&K.skipped_effects.delete(_.e)):(_=Q_(l,p?o:mh??=fh(),le,E,ae,i,e,t),p||(_.e.f|=pn),l.set(E,_)),B.add(E)}if(k===0&&r&&!c&&(p?c=gl(()=>r(o)):(c=gl(()=>r(mh??=fh())),c.f|=pn)),Wt&&k>0&&uh(ch()),!p)if(j){for(const[v,T]of l)B.has(v)||K.skipped_effects.add(T.e);K.oncommit(m),K.ondiscard(()=>{})}else m();x&&Ha(!0),P(h)}),S={effect:A,items:l,outrogroups:null,fallback:c};p=!1,Wt&&(o=no)}function Oi(n){for(;n!==null&&(n.f&b_)===0;)n=n.next;return n}function K_(n,e,t,s,i){var r=e.length,o=n.items,l=Oi(n.effect.first),c,h=null,f=[],p=[],m,A,S,k;for(k=0;k<r;k+=1){if(m=e[k],A=i(m,k),S=o.get(A).e,n.outrogroups!==null)for(const _ of n.outrogroups)_.pending.delete(S),_.done.delete(S);if((S.f&pn)!==0)if(S.f^=pn,S===l)qi(S,null,t);else{var x=h?h.next:l;S===n.effect.last&&(n.effect.last=S.prev),S.prev&&(S.prev.next=S.next),S.next&&(S.next.prev=S.prev),ln(n,h,S),ln(n,S,x),qi(S,x,t),h=S,f=[],p=[],l=Oi(h.next);continue}if((S.f&$a)!==0&&kf(S),S!==l){if(c!==void 0&&c.has(S)){if(f.length<p.length){var W=p[0],B;h=W.prev;var K=f[0],j=f[f.length-1];for(B=0;B<f.length;B+=1)qi(f[B],W,t);for(B=0;B<p.length;B+=1)c.delete(p[B]);ln(n,K.prev,j.next),ln(n,h,K),ln(n,j,W),l=W,h=j,k-=1,f=[],p=[]}else c.delete(S),qi(S,l,t),ln(n,S.prev,S.next),ln(n,S,h===null?n.effect.first:h.next),ln(n,h,S),h=S;continue}for(f=[],p=[];l!==null&&l!==S;)(c??=new Set).add(l),p.push(l),l=Oi(l.next);if(l===null)continue}(S.f&pn)===0&&f.push(S),h=S,l=Oi(S.next)}if(n.outrogroups!==null){for(const _ of n.outrogroups)_.pending.size===0&&(ml(rc(_.done)),n.outrogroups?.delete(_));n.outrogroups.size===0&&(n.outrogroups=null)}if(l!==null||c!==void 0){var ae=[];if(c!==void 0)for(S of c)(S.f&$a)===0&&ae.push(S);for(;l!==null;)(l.f&$a)===0&&l!==n.fallback&&ae.push(l),l=Oi(l.next);var le=ae.length;if(le>0){var E=null;z_(n,ae,E)}}}function Q_(n,e,t,s,i,r,o,l){var c=(o&S_)!==0?(o&R_)===0?_e(t,!1,!1):dh(t):null,h=(o&A_)!==0?dh(i):null;return{v:c,i:h,e:gl(()=>(r(e,c??t,h??i,l),()=>{n.delete(s)}))}}function qi(n,e,t){if(n.nodes)for(var s=n.nodes.start,i=n.nodes.end,r=e&&(e.f&pn)===0?e.nodes.start:t;s!==null;){var o=N_(s);if(r.before(s),s===i)return;s=o}}function ln(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function Y_(n,e,t,s,i){Wt&&bf();var r=e.$$slots?.[t],o=!1;r===!0&&(r=e.children,o=!0),r===void 0||r(n,o?()=>s:s)}const _h=[...` 	
\r\fÂ \v\uFEFF`];function J_(n,e,t){var s=n==null?"":""+n;if(t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var r=i.length,o=0;(o=s.indexOf(i,o))>=0;){var l=o+r;(o===0||_h.includes(s[o-1]))&&(l===s.length||_h.includes(s[l]))?s=(o===0?"":s.substring(0,o))+s.substring(l+1):o=l}}return s===""?null:s}function za(n,e,t,s,i,r){var o=n.__className;if(Wt||o!==t||o===void 0){var l=J_(t,s,r);(!Wt||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}else if(r&&i!==r)for(var c in r){var h=!!r[c];(i==null||h!==!!i[c])&&n.classList.toggle(c,h)}return r}function Ps(n,e,t=e){var s=new WeakSet;D_(n,"input",async i=>{var r=i?n.defaultValue:n.value;if(r=Ga(n)?Ka(r):r,t(r),Ns!==null&&s.add(Ns),await O_(),r!==(r=e())){var o=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=r??"",l!==null){var h=n.value.length;o===l&&l===c&&h>c?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=o,n.selectionEnd=Math.min(l,h))}}}),(Wt&&n.defaultValue!==n.value||ft(e)==null&&n.value)&&(t(Ga(n)?Ka(n.value):n.value),Ns!==null&&s.add(Ns)),x_(()=>{var i=e();if(n===document.activeElement){var r=L_??Ns;if(s.has(r))return}Ga(n)&&i===Ka(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Ga(n){var e=n.type;return e==="number"||e==="range"}function Ka(n){return n===""?null:+n}function X_(n){return function(...e){var t=e[0];return t.stopPropagation(),n?.apply(this,e)}}function Z_(n,e){var t=n.$$events?.[e.type],s=Pf(t)?t.slice():t==null?[]:[t];for(var i of s)i.call(this,e)}const ey=()=>{};var yh={};const Df={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const N=function(n,e){if(!n)throw ri(e)},ri=function(n){return new Error("Firebase Database ("+Df.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Of=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},ty=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],l=n[t++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},oc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,f=r>>2,p=(r&3)<<4|l>>4;let m=(l&15)<<2|h>>6,A=h&63;c||(A=64,o||(m=64)),s.push(t[f],t[p],t[m],t[A])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Of(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ty(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||l==null||h==null||p==null)throw new ny;const m=r<<2|l>>4;if(s.push(m),h!==64){const A=l<<4&240|h>>2;if(s.push(A),p!==64){const S=h<<6&192|p;s.push(S)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class ny extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xf=function(n){const e=Of(n);return oc.encodeByteArray(e,!0)},Ao=function(n){return xf(n).replace(/\./g,"")},So=function(n){try{return oc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function sy(n){return Lf(void 0,n)}function Lf(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!iy(t)||(n[t]=Lf(n[t],e[t]));return n}function iy(n){return n!=="__proto__"}function ry(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const oy=()=>ry().__FIREBASE_DEFAULTS__,ay=()=>{if(typeof process>"u"||typeof yh>"u")return;const n=yh.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ly=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&So(n[1]);return e&&JSON.parse(e)},ta=()=>{try{return ey()||oy()||ay()||ly()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Mf=n=>ta()?.emulatorHosts?.[n],Vf=n=>{const e=Mf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Ff=()=>ta()?.config,Uf=n=>ta()?.[`_${n}`];class na{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function xn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ac(n){return(await fetch(n,{credentials:"include"})).ok}function Bf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ao(JSON.stringify(t)),Ao(JSON.stringify(o)),""].join(".")}const Qi={};function cy(){const n={prod:[],emulator:[]};for(const e of Object.keys(Qi))Qi[e]?n.emulator.push(e):n.prod.push(e);return n}function uy(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let vh=!1;function lc(n,e){if(typeof window>"u"||typeof document>"u"||!xn(window.location.host)||Qi[n]===e||Qi[n]||vh)return;Qi[n]=e;function t(m){return`__firebase__banner__${m}`}const s="__firebase__banner",r=cy().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,A){m.setAttribute("width","24"),m.setAttribute("id",A),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{vh=!0,o()},m}function f(m,A){m.setAttribute("id",A),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=uy(s),A=t("text"),S=document.getElementById(A)||document.createElement("span"),k=t("learnmore"),x=document.getElementById(k)||document.createElement("a"),W=t("preprendIcon"),B=document.getElementById(W)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const K=m.element;l(K),f(x,k);const j=h();c(B,W),K.append(B,S,x,j),document.body.appendChild(K)}r?(S.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Xe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function cc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xe())}function hy(){const n=ta()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dy(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function fy(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function py(){const n=Xe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function gy(){return Df.NODE_ADMIN===!0}function my(){return!hy()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _y(){try{return typeof indexedDB=="object"}catch{return!1}}function yy(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const vy="FirebaseError";class Xt extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=vy,Object.setPrototypeOf(this,Xt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wr.prototype.create)}}class wr{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?Ey(r,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new Xt(i,l,s)}}function Ey(n,e){return n.replace(Iy,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Iy=/\{\$([^}]+)}/g;function ar(n){return JSON.parse(n)}function Ue(n){return JSON.stringify(n)}const Wf=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=ar(So(r[0])||""),t=ar(So(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},Ty=function(n){const e=Wf(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},wy=function(n){const e=Wf(n).claims;return typeof e=="object"&&e.admin===!0};function Zt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Gs(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function _l(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ro(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function Cn(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(Eh(r)&&Eh(o)){if(!Cn(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function Eh(n){return n!==null&&typeof n=="object"}function oi(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Wi(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function ji(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class Cy{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)s[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)s[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const m=s[p-3]^s[p-8]^s[p-14]^s[p-16];s[p]=(m<<1|m>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],h,f;for(let p=0;p<80;p++){p<40?p<20?(h=l^r&(o^l),f=1518500249):(h=r^o^l,f=1859775393):p<60?(h=r&o|l&(r|o),f=2400959708):(h=r^o^l,f=3395469782);const m=(i<<5|i>>>27)+h+c+f+s[p]&4294967295;c=l,l=o,o=(r<<30|r>>>2)&4294967295,r=i,i=m}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function Ay(n,e){const t=new Sy(n,e);return t.subscribe.bind(t)}class Sy{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");Ry(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=Qa),i.error===void 0&&(i.error=Qa),i.complete===void 0&&(i.complete=Qa);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ry(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Qa(){}function uc(n,e){return`${n} failed: ${e} argument `}const by=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,N(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},sa=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function Ze(n){return n&&n._delegate?n._delegate:n}class An{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Zn="[DEFAULT]";class Py{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new na;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ny(e))try{this.getOrInitializeService({instanceIdentifier:Zn})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Zn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zn){return this.instances.has(e)}getOptions(e=Zn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:ky(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Zn){return this.component?this.component.multipleInstances?e:Zn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ky(n){return n===Zn?void 0:n}function Ny(n){return n.instantiationMode==="EAGER"}class Dy{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Py(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var X;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(X||(X={}));const Oy={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},xy=X.INFO,Ly={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},My=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=Ly[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ia{constructor(e){this.name=e,this._logLevel=xy,this._logHandler=My,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in X))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Oy[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...e),this._logHandler(this,X.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...e),this._logHandler(this,X.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,X.INFO,...e),this._logHandler(this,X.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,X.WARN,...e),this._logHandler(this,X.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...e),this._logHandler(this,X.ERROR,...e)}}const Vy=(n,e)=>e.some(t=>n instanceof t);let Ih,Th;function Fy(){return Ih||(Ih=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Uy(){return Th||(Th=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jf=new WeakMap,yl=new WeakMap,Hf=new WeakMap,Ya=new WeakMap,hc=new WeakMap;function By(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(_n(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&jf.set(t,n)}).catch(()=>{}),hc.set(e,n),e}function qy(n){if(yl.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});yl.set(n,e)}let vl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return yl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Hf.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return _n(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Wy(n){vl=n(vl)}function jy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Ja(this),e,...t);return Hf.set(s,e.sort?e.sort():[e]),_n(s)}:Uy().includes(n)?function(...e){return n.apply(Ja(this),e),_n(jf.get(this))}:function(...e){return _n(n.apply(Ja(this),e))}}function Hy(n){return typeof n=="function"?jy(n):(n instanceof IDBTransaction&&qy(n),Vy(n,Fy())?new Proxy(n,vl):n)}function _n(n){if(n instanceof IDBRequest)return By(n);if(Ya.has(n))return Ya.get(n);const e=Hy(n);return e!==n&&(Ya.set(n,e),hc.set(e,n)),e}const Ja=n=>hc.get(n);function $y(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),l=_n(o);return s&&o.addEventListener("upgradeneeded",c=>{s(_n(o.result),c.oldVersion,c.newVersion,_n(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const zy=["get","getKey","getAll","getAllKeys","count"],Gy=["put","add","delete","clear"],Xa=new Map;function wh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Xa.get(e))return Xa.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=Gy.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||zy.includes(t)))return;const r=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let h=c.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&c.done]))[0]};return Xa.set(e,r),r}Wy(n=>({...n,get:(e,t,s)=>wh(e,t)||n.get(e,t,s),has:(e,t)=>!!wh(e,t)||n.has(e,t)}));class Ky{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Qy(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Qy(n){return n.getComponent()?.type==="VERSION"}const El="@firebase/app",Ch="0.14.7";const Gt=new ia("@firebase/app"),Yy="@firebase/app-compat",Jy="@firebase/analytics-compat",Xy="@firebase/analytics",Zy="@firebase/app-check-compat",ev="@firebase/app-check",tv="@firebase/auth",nv="@firebase/auth-compat",sv="@firebase/database",iv="@firebase/data-connect",rv="@firebase/database-compat",ov="@firebase/functions",av="@firebase/functions-compat",lv="@firebase/installations",cv="@firebase/installations-compat",uv="@firebase/messaging",hv="@firebase/messaging-compat",dv="@firebase/performance",fv="@firebase/performance-compat",pv="@firebase/remote-config",gv="@firebase/remote-config-compat",mv="@firebase/storage",_v="@firebase/storage-compat",yv="@firebase/firestore",vv="@firebase/ai",Ev="@firebase/firestore-compat",Iv="firebase",Tv="12.8.0";const Il="[DEFAULT]",wv={[El]:"fire-core",[Yy]:"fire-core-compat",[Xy]:"fire-analytics",[Jy]:"fire-analytics-compat",[ev]:"fire-app-check",[Zy]:"fire-app-check-compat",[tv]:"fire-auth",[nv]:"fire-auth-compat",[sv]:"fire-rtdb",[iv]:"fire-data-connect",[rv]:"fire-rtdb-compat",[ov]:"fire-fn",[av]:"fire-fn-compat",[lv]:"fire-iid",[cv]:"fire-iid-compat",[uv]:"fire-fcm",[hv]:"fire-fcm-compat",[dv]:"fire-perf",[fv]:"fire-perf-compat",[pv]:"fire-rc",[gv]:"fire-rc-compat",[mv]:"fire-gcs",[_v]:"fire-gcs-compat",[yv]:"fire-fst",[Ev]:"fire-fst-compat",[vv]:"fire-vertex","fire-js":"fire-js",[Iv]:"fire-js-all"};const bo=new Map,Cv=new Map,Tl=new Map;function Ah(n,e){try{n.container.addComponent(e)}catch(t){Gt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function as(n){const e=n.name;if(Tl.has(e))return Gt.debug(`There were multiple attempts to register component ${e}.`),!1;Tl.set(e,n);for(const t of bo.values())Ah(t,n);for(const t of Cv.values())Ah(t,n);return!0}function ra(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function mt(n){return n==null?!1:n.settings!==void 0}const Av={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yn=new wr("app","Firebase",Av);class Sv{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new An("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yn.create("app-deleted",{appName:this._name})}}const ps=Tv;function $f(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Il,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw yn.create("bad-app-name",{appName:String(i)});if(t||(t=Ff()),!t)throw yn.create("no-options");const r=bo.get(i);if(r){if(Cn(t,r.options)&&Cn(s,r.config))return r;throw yn.create("duplicate-app",{appName:i})}const o=new Dy(i);for(const c of Tl.values())o.addComponent(c);const l=new Sv(t,s,o);return bo.set(i,l),l}function dc(n=Il){const e=bo.get(n);if(!e&&n===Il&&Ff())return $f();if(!e)throw yn.create("no-app",{appName:n});return e}function Ot(n,e,t){let s=wv[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Gt.warn(o.join(" "));return}as(new An(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Rv="firebase-heartbeat-database",bv=1,lr="firebase-heartbeat-store";let Za=null;function zf(){return Za||(Za=$y(Rv,bv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(lr)}catch(t){console.warn(t)}}}}).catch(n=>{throw yn.create("idb-open",{originalErrorMessage:n.message})})),Za}async function Pv(n){try{const t=(await zf()).transaction(lr),s=await t.objectStore(lr).get(Gf(n));return await t.done,s}catch(e){if(e instanceof Xt)Gt.warn(e.message);else{const t=yn.create("idb-get",{originalErrorMessage:e?.message});Gt.warn(t.message)}}}async function Sh(n,e){try{const s=(await zf()).transaction(lr,"readwrite");await s.objectStore(lr).put(e,Gf(n)),await s.done}catch(t){if(t instanceof Xt)Gt.warn(t.message);else{const s=yn.create("idb-set",{originalErrorMessage:t?.message});Gt.warn(s.message)}}}function Gf(n){return`${n.name}!${n.options.appId}`}const kv=1024,Nv=30;class Dv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new xv(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Rh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Nv){const i=Lv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Gt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Rh(),{heartbeatsToSend:t,unsentEntries:s}=Ov(this._heartbeatsCache.heartbeats),i=Ao(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Gt.warn(e),""}}}function Rh(){return new Date().toISOString().substring(0,10)}function Ov(n,e=kv){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),bh(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),bh(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class xv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _y()?yy().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Pv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Sh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Sh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function bh(n){return Ao(JSON.stringify({version:2,heartbeats:n})).length}function Lv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Mv(n){as(new An("platform-logger",e=>new Ky(e),"PRIVATE")),as(new An("heartbeat",e=>new Dv(e),"PRIVATE")),Ot(El,Ch,n),Ot(El,Ch,"esm2020"),Ot("fire-js","")}Mv("");var Vv="firebase",Fv="12.8.0";Ot(Vv,Fv,"app");var Ph={};const kh="@firebase/database",Nh="1.1.0";let Kf="";function Uv(n){Kf=n}class Bv{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ue(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ar(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class qv{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Zt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Qf=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Bv(e)}}catch{}return new qv},ts=Qf("localStorage"),Wv=Qf("sessionStorage");const Fs=new ia("@firebase/database"),jv=(function(){let n=1;return function(){return n++}})(),Yf=function(n){const e=by(n),t=new Cy;t.update(e);const s=t.digest();return oc.encodeByteArray(s)},Cr=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Cr.apply(null,s):typeof s=="object"?e+=Ue(s):e+=s,e+=" "}return e};let Yi=null,Dh=!0;const Hv=function(n,e){N(!0,"Can't turn on custom loggers persistently."),Fs.logLevel=X.VERBOSE,Yi=Fs.log.bind(Fs)},Ye=function(...n){if(Dh===!0&&(Dh=!1,Yi===null&&Wv.get("logging_enabled")===!0&&Hv()),Yi){const e=Cr.apply(null,n);Yi(e)}},Ar=function(n){return function(...e){Ye(n,...e)}},wl=function(...n){const e="FIREBASE INTERNAL ERROR: "+Cr(...n);Fs.error(e)},Kt=function(...n){const e=`FIREBASE FATAL ERROR: ${Cr(...n)}`;throw Fs.error(e),new Error(e)},rt=function(...n){const e="FIREBASE WARNING: "+Cr(...n);Fs.warn(e)},$v=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&rt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Jf=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},zv=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ks="[MIN_NAME]",ls="[MAX_NAME]",ai=function(n,e){if(n===e)return 0;if(n===Ks||e===ls)return-1;if(e===Ks||n===ls)return 1;{const t=Oh(n),s=Oh(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Gv=function(n,e){return n===e?0:n<e?-1:1},xi=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ue(e))},fc=function(n){if(typeof n!="object"||n===null)return Ue(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Ue(e[s]),t+=":",t+=fc(n[e[s]]);return t+="}",t},Xf=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function ot(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Zf=function(n){N(!Jf(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,l,c;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(i?1:0),h.reverse();const f=h.join("");let p="";for(c=0;c<64;c+=8){let m=parseInt(f.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},Kv=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Qv=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Yv(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const Jv=new RegExp("^-?(0*)\\d{1,10}$"),Xv=-2147483648,Zv=2147483647,Oh=function(n){if(Jv.test(n)){const e=Number(n);if(e>=Xv&&e<=Zv)return e}return null},li=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw rt("Exception was thrown by user callback.",t),e},Math.floor(0))}},eE=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ji=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class tE{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,mt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){rt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class nE{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ye("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rt(e)}}class fo{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}fo.OWNER="owner";const pc="5",ep="v",tp="s",np="r",sp="f",ip=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,rp="ls",op="p",Cl="ac",ap="websocket",lp="long_polling";class cp{constructor(e,t,s,i,r=!1,o="",l=!1,c=!1,h=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ts.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ts.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function sE(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function up(n,e,t){N(typeof e=="string","typeof type must == string"),N(typeof t=="object","typeof params must == object");let s;if(e===ap)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===lp)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);sE(n)&&(t.ns=n.namespace);const i=[];return ot(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class iE{constructor(){this.counters_={}}incrementCounter(e,t=1){Zt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return sy(this.counters_)}}const el={},tl={};function gc(n){const e=n.toString();return el[e]||(el[e]=new iE),el[e]}function rE(n,e){const t=n.toString();return tl[t]||(tl[t]=e()),tl[t]}class oE{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&li(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const xh="start",aE="close",lE="pLPCommand",cE="pRTLPCB",hp="id",dp="pw",fp="ser",uE="cb",hE="seg",dE="ts",fE="d",pE="dframe",pp=1870,gp=30,gE=pp-gp,mE=25e3,_E=3e4;class Ms{constructor(e,t,s,i,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ar(e),this.stats_=gc(t),this.urlFn=c=>(this.appCheckToken&&(c[Cl]=this.appCheckToken),up(t,lp,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new oE(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(_E)),zv(()=>{if(this.isClosed_)return;this.scriptTagHolder=new mc((...r)=>{const[o,l,c,h,f]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===xh)this.id=l,this.password=c;else if(o===aE)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[xh]="t",s[fp]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[uE]=this.scriptTagHolder.uniqueCallbackIdentifier),s[ep]=pc,this.transportSessionId&&(s[tp]=this.transportSessionId),this.lastSessionId&&(s[rp]=this.lastSessionId),this.applicationId&&(s[op]=this.applicationId),this.appCheckToken&&(s[Cl]=this.appCheckToken),typeof location<"u"&&location.hostname&&ip.test(location.hostname)&&(s[np]=sp);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ms.forceAllow_=!0}static forceDisallow(){Ms.forceDisallow_=!0}static isAvailable(){return Ms.forceAllow_?!0:!Ms.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Kv()&&!Qv()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ue(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=xf(t),i=Xf(s,gE);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[pE]="t",s[hp]=e,s[dp]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ue(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class mc{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=jv(),window[lE+this.uniqueCallbackIdentifier]=e,window[cE+this.uniqueCallbackIdentifier]=t,this.myIFrame=mc.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){Ye("frame writing exception"),l.stack&&Ye(l.stack),Ye(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ye("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[hp]=this.myID,e[dp]=this.myPW,e[fp]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+gp+s.length<=pp;){const o=this.pendingSegs.shift();s=s+"&"+hE+i+"="+o.seg+"&"+dE+i+"="+o.ts+"&"+fE+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(mE)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{Ye("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const yE=16384,vE=45e3;let Po=null;typeof MozWebSocket<"u"?Po=MozWebSocket:typeof WebSocket<"u"&&(Po=WebSocket);class vt{constructor(e,t,s,i,r,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ar(this.connId),this.stats_=gc(t),this.connURL=vt.connectionURL_(t,o,l,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[ep]=pc,typeof location<"u"&&location.hostname&&ip.test(location.hostname)&&(o[np]=sp),t&&(o[tp]=t),s&&(o[rp]=s),i&&(o[Cl]=i),r&&(o[op]=r),up(e,ap,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ts.set("previous_websocket_failure",!0);try{let s;gy(),this.mySock=new Po(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){vt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Po!==null&&!vt.forceDisallow_}static previouslyFailed(){return ts.isInMemoryStorage||ts.get("previous_websocket_failure")===!0}markConnectionHealthy(){ts.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=ar(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(N(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Ue(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Xf(t,yE);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(vE))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}vt.responsesRequiredToBeHealthy=2;vt.healthyTimeout=3e4;class cr{static get ALL_TRANSPORTS(){return[Ms,vt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=vt&&vt.isAvailable();let s=t&&!vt.previouslyFailed();if(e.webSocketOnly&&(t||rt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[vt];else{const i=this.transports_=[];for(const r of cr.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);cr.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cr.globalTransportInitialized_=!1;const EE=6e4,IE=5e3,TE=10*1024,wE=100*1024,nl="t",Lh="d",CE="s",Mh="r",AE="e",Vh="o",Fh="a",Uh="n",Bh="p",SE="h";class RE{constructor(e,t,s,i,r,o,l,c,h,f){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ar("c:"+this.id+":"),this.transportManager_=new cr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ji(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>wE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>TE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(nl in e){const t=e[nl];t===Fh?this.upgradeIfSecondaryHealthy_():t===Mh?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Vh&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=xi("t",e),s=xi("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Bh,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fh,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Uh,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=xi("t",e),s=xi("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=xi(nl,e);if(Lh in e){const s=e[Lh];if(t===SE){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Uh){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===CE?this.onConnectionShutdown_(s):t===Mh?this.onReset_(s):t===AE?wl("Server Error: "+s):t===Vh?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wl("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),pc!==s&&rt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Ji(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(EE))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ji(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(IE))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Bh,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ts.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class mp{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class _p{constructor(e){this.allowedEvents_=e,this.listeners_={},N(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){N(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ko extends _p{static getInstance(){return new ko}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!cc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return N(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const qh=32,Wh=768;class he{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function oe(){return new he("")}function Y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Sn(n){return n.pieces_.length-n.pieceNum_}function pe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new he(n.pieces_,e)}function yp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function bE(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function vp(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Ep(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new he(e,0)}function De(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof he)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new he(t,0)}function Z(n){return n.pieceNum_>=n.pieces_.length}function it(n,e){const t=Y(n),s=Y(e);if(t===null)return e;if(t===s)return it(pe(n),pe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function _c(n,e){if(Sn(n)!==Sn(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Et(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Sn(n)>Sn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class PE{constructor(e,t){this.errorPrefix_=t,this.parts_=vp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=sa(this.parts_[s]);Ip(this)}}function kE(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=sa(e),Ip(n)}function NE(n){const e=n.parts_.pop();n.byteLength_-=sa(e),n.parts_.length>0&&(n.byteLength_-=1)}function Ip(n){if(n.byteLength_>Wh)throw new Error(n.errorPrefix_+"has a key path longer than "+Wh+" bytes ("+n.byteLength_+").");if(n.parts_.length>qh)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+qh+") or object contains a cycle "+es(n))}function es(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class yc extends _p{static getInstance(){return new yc}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return N(e==="visible","Unknown event type: "+e),[this.visible_]}}const Li=1e3,DE=300*1e3,jh=30*1e3,OE=1.3,xE=3e4,LE="server_kill",Hh=3;class zt extends mp{constructor(e,t,s,i,r,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=zt.nextPersistentConnectionId_++,this.log_=Ar("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Li,this.maxReconnectDelay_=DE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");yc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ko.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Ue(r)),N(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new na,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),N(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),N(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,l=>{const c=l.d,h=l.s;zt.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Zt(e,"w")){const s=Gs(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();rt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||wy(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=jh)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Ty(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),N(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ue(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):wl("Unrecognized action received from server: "+Ue(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){N(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Li,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Li,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>xE&&(this.reconnectDelay_=Li),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*OE)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+zt.nextConnectionId_++,r=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},h=function(p){N(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,m]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);o?Ye("getToken() completed but was canceled"):(Ye("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=m&&m.token,l=new RE(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,A=>{rt(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(LE)},r))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&rt(p),c())}}}interrupt(e){Ye("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ye("Resuming connection for reason: "+e),delete this.interruptReasons_[e],_l(this.interruptReasons_)&&(this.reconnectDelay_=Li,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>fc(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new he(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){Ye("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hh&&(this.reconnectDelay_=jh,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ye("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hh&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Kf.replace(/\./g,"-")]=1,cc()?e["framework.cordova"]=1:qf()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ko.getInstance().currentlyOnline();return _l(this.interruptReasons_)&&e}}zt.nextPersistentConnectionId_=0;zt.nextConnectionId_=0;class J{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new J(e,t)}}class oa{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new J(Ks,e),i=new J(Ks,t);return this.compare(s,i)!==0}minPost(){return J.MIN}}let io;class Tp extends oa{static get __EMPTY_NODE(){return io}static set __EMPTY_NODE(e){io=e}compare(e,t){return ai(e.name,t.name)}isDefinedOn(e){throw ri("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return J.MIN}maxPost(){return new J(ls,io)}makePost(e,t){return N(typeof e=="string","KeyIndex indexValue must always be a string."),new J(e,io)}toString(){return".key"}}const Us=new Tp;let ro=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},pt=class Hi{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Hi.RED,this.left=i??Dt.EMPTY_NODE,this.right=r??Dt.EMPTY_NODE}copy(e,t,s,i,r){return new Hi(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Dt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return Dt.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Hi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Hi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};pt.RED=!0;pt.BLACK=!1;class ME{copy(e,t,s,i,r){return this}insert(e,t,s){return new pt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Dt=class po{constructor(e,t=po.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new po(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,pt.BLACK,null,null))}remove(e){return new po(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,pt.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ro(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ro(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ro(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ro(this.root_,null,this.comparator_,!0,e)}};Dt.EMPTY_NODE=new ME;function VE(n,e){return ai(n.name,e.name)}function vc(n,e){return ai(n,e)}let Al;function FE(n){Al=n}const wp=function(n){return typeof n=="number"?"number:"+Zf(n):"string:"+n},Cp=function(n){if(n.isLeafNode()){const e=n.val();N(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Zt(e,".sv"),"Priority must be a string or number.")}else N(n===Al||n.isEmpty(),"priority of unexpected type.");N(n===Al||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let $h;class Ve{static set __childrenNodeConstructor(e){$h=e}static get __childrenNodeConstructor(){return $h}constructor(e,t=Ve.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,N(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Cp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ve(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ve.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Z(e)?this:Y(e)===".priority"?this.priorityNode_:Ve.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ve.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Y(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(N(s!==".priority"||Sn(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Ve.__childrenNodeConstructor.EMPTY_NODE.updateChild(pe(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+wp(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Zf(this.value_):e+=this.value_,this.lazyHash_=Yf(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ve.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ve.__childrenNodeConstructor?-1:(N(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=Ve.VALUE_TYPE_ORDER.indexOf(t),r=Ve.VALUE_TYPE_ORDER.indexOf(s);return N(i>=0,"Unknown leaf type: "+t),N(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ve.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Ap,Sp;function UE(n){Ap=n}function BE(n){Sp=n}class qE extends oa{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?ai(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return J.MIN}maxPost(){return new J(ls,new Ve("[PRIORITY-POST]",Sp))}makePost(e,t){const s=Ap(e);return new J(t,new Ve("[PRIORITY-POST]",s))}toString(){return".priority"}}const Ie=new qE;const WE=Math.log(2);class jE{constructor(e){const t=r=>parseInt(Math.log(r)/WE,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const No=function(n,e,t,s){n.sort(e);const i=function(c,h){const f=h-c;let p,m;if(f===0)return null;if(f===1)return p=n[c],m=t?t(p):p,new pt(m,p.node,pt.BLACK,null,null);{const A=parseInt(f/2,10)+c,S=i(c,A),k=i(A+1,h);return p=n[A],m=t?t(p):p,new pt(m,p.node,pt.BLACK,S,k)}},r=function(c){let h=null,f=null,p=n.length;const m=function(S,k){const x=p-S,W=p;p-=S;const B=i(x+1,W),K=n[x],j=t?t(K):K;A(new pt(j,K.node,k,null,B))},A=function(S){h?(h.left=S,h=S):(f=S,h=S)};for(let S=0;S<c.count;++S){const k=c.nextBitIsOne(),x=Math.pow(2,c.count-(S+1));k?m(x,pt.BLACK):(m(x,pt.BLACK),m(x,pt.RED))}return f},o=new jE(n.length),l=r(o);return new Dt(s||e,l)};let sl;const ks={};class jt{static get Default(){return N(ks&&Ie,"ChildrenNode.ts has not been loaded"),sl=sl||new jt({".priority":ks},{".priority":Ie}),sl}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Gs(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Dt?t:null}hasIndex(e){return Zt(this.indexSet_,e.toString())}addIndex(e,t){N(e!==Us,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(J.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=No(s,e.getCompare()):l=ks;const c=e.toString(),h={...this.indexSet_};h[c]=e;const f={...this.indexes_};return f[c]=l,new jt(f,h)}addToIndexes(e,t){const s=Ro(this.indexes_,(i,r)=>{const o=Gs(this.indexSet_,r);if(N(o,"Missing index implementation for "+r),i===ks)if(o.isDefinedOn(e.node)){const l=[],c=t.getIterator(J.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&l.push(h),h=c.getNext();return l.push(e),No(l,o.getCompare())}else return ks;else{const l=t.get(e.name);let c=i;return l&&(c=c.remove(new J(e.name,l))),c.insert(e,e.node)}});return new jt(s,this.indexSet_)}removeFromIndexes(e,t){const s=Ro(this.indexes_,i=>{if(i===ks)return i;{const r=t.get(e.name);return r?i.remove(new J(e.name,r)):i}});return new jt(s,this.indexSet_)}}let Mi;class q{static get EMPTY_NODE(){return Mi||(Mi=new q(new Dt(vc),null,jt.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Cp(this.priorityNode_),this.children_.isEmpty()&&N(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Mi}updatePriority(e){return this.children_.isEmpty()?this:new q(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Mi:t}}getChild(e){const t=Y(e);return t===null?this:this.getImmediateChild(t).getChild(pe(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(N(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new J(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Mi:this.priorityNode_;return new q(i,o,r)}}updateChild(e,t){const s=Y(e);if(s===null)return t;{N(Y(e)!==".priority"||Sn(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(pe(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(Ie,(o,l)=>{t[o]=l.val(e),s++,r&&q.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const l in t)o[l]=t[l];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+wp(this.getPriority().val())+":"),this.forEachChild(Ie,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Yf(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new J(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new J(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new J(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,J.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,J.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Sr?-1:0}withIndex(e){if(e===Us||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new q(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Us||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Ie),i=t.getIterator(Ie);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Us?null:this.indexMap_.get(e.toString())}}q.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class HE extends q{constructor(){super(new Dt(vc),q.EMPTY_NODE,jt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return q.EMPTY_NODE}isEmpty(){return!1}}const Sr=new HE;Object.defineProperties(J,{MIN:{value:new J(Ks,q.EMPTY_NODE)},MAX:{value:new J(ls,Sr)}});Tp.__EMPTY_NODE=q.EMPTY_NODE;Ve.__childrenNodeConstructor=q;FE(Sr);BE(Sr);const $E=!0;function He(n,e=null){if(n===null)return q.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),N(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ve(t,He(e))}if(!(n instanceof Array)&&$E){const t=[];let s=!1;if(ot(n,(o,l)=>{if(o.substring(0,1)!=="."){const c=He(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new J(o,c)))}}),t.length===0)return q.EMPTY_NODE;const r=No(t,VE,o=>o.name,vc);if(s){const o=No(t,Ie.getCompare());return new q(r,He(e),new jt({".priority":o},{".priority":Ie}))}else return new q(r,He(e),jt.Default)}else{let t=q.EMPTY_NODE;return ot(n,(s,i)=>{if(Zt(n,s)&&s.substring(0,1)!=="."){const r=He(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(He(e))}}UE(He);class zE extends oa{constructor(e){super(),this.indexPath_=e,N(!Z(e)&&Y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?ai(e.name,t.name):r}makePost(e,t){const s=He(e),i=q.EMPTY_NODE.updateChild(this.indexPath_,s);return new J(t,i)}maxPost(){const e=q.EMPTY_NODE.updateChild(this.indexPath_,Sr);return new J(ls,e)}toString(){return vp(this.indexPath_,0).join("/")}}class GE extends oa{compare(e,t){const s=e.node.compareTo(t.node);return s===0?ai(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return J.MIN}maxPost(){return J.MAX}makePost(e,t){const s=He(e);return new J(t,s)}toString(){return".value"}}const KE=new GE;function Rp(n){return{type:"value",snapshotNode:n}}function Qs(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ur(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function hr(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function QE(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Ec{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){N(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(i).equals(s.getChild(i))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(ur(t,l)):N(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Qs(t,s)):o.trackChildChange(hr(t,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Ie,(i,r)=>{t.hasChild(i)||s.trackChildChange(ur(i,r))}),t.isLeafNode()||t.forEachChild(Ie,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(hr(i,r,o))}else s.trackChildChange(Qs(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?q.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class dr{constructor(e){this.indexedFilter_=new Ec(e.getIndex()),this.index_=e.getIndex(),this.startPost_=dr.getStartPost_(e),this.endPost_=dr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new J(t,s))||(s=q.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=q.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(q.EMPTY_NODE);const r=this;return t.forEachChild(Ie,(o,l)=>{r.matches(new J(o,l))||(i=i.updateImmediateChild(o,q.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class YE{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new dr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new J(t,s))||(s=q.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=q.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=q.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(q.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,q.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const p=this.index_.getCompare();o=(m,A)=>p(A,m)}else o=this.index_.getCompare();const l=e;N(l.numChildren()===this.limit_,"");const c=new J(t,s),h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(c);if(l.hasChild(t)){const p=l.getImmediateChild(t);let m=i.getChildAfterChild(this.index_,h,this.reverse_);for(;m!=null&&(m.name===t||l.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);const A=m==null?1:o(m,c);if(f&&!s.isEmpty()&&A>=0)return r?.trackChildChange(hr(t,s,p)),l.updateImmediateChild(t,s);{r?.trackChildChange(ur(t,p));const k=l.updateImmediateChild(t,q.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(r?.trackChildChange(Qs(m.name,m.node)),k.updateImmediateChild(m.name,m.node)):k}}else return s.isEmpty()?e:f&&o(h,c)>=0?(r!=null&&(r.trackChildChange(ur(h.name,h.node)),r.trackChildChange(Qs(t,s))),l.updateImmediateChild(t,s).updateImmediateChild(h.name,q.EMPTY_NODE)):e}}class Ic{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ie}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return N(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return N(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ks}hasEnd(){return this.endSet_}getIndexEndValue(){return N(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return N(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ls}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return N(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ie}copy(){const e=new Ic;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function JE(n){return n.loadsAllData()?new Ec(n.getIndex()):n.hasLimit()?new YE(n):new dr(n)}function zh(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ie?t="$priority":n.index_===KE?t="$value":n.index_===Us?t="$key":(N(n.index_ instanceof zE,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ue(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Ue(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Ue(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Ue(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Ue(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Gh(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ie&&(e.i=n.index_.toString()),e}class Do extends mp{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(N(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Ar("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Do.getListenId_(e,s),l={};this.listens_[o]=l;const c=zh(e._queryParams);this.restRequest_(r+".json",c,(h,f)=>{let p=f;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(r,p,!1,s),Gs(this.listens_,o)===l){let m;h?h===401?m="permission_denied":m="rest_error:"+h:m="ok",i(m,null)}})}unlisten(e,t){const s=Do.getListenId_(e,t);delete this.listens_[s]}get(e){const t=zh(e._queryParams),s=e._path.toString(),i=new na;return this.restRequest_(s+".json",t,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+oi(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=ar(l.responseText)}catch{rt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&rt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}class XE{constructor(){this.rootNode_=q.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Oo(){return{value:null,children:new Map}}function bp(n,e,t){if(Z(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Y(e);n.children.has(s)||n.children.set(s,Oo());const i=n.children.get(s);e=pe(e),bp(i,e,t)}}function Sl(n,e,t){n.value!==null?t(e,n.value):ZE(n,(s,i)=>{const r=new he(e.toString()+"/"+s);Sl(i,r,t)})}function ZE(n,e){n.children.forEach((t,s)=>{e(s,t)})}class eI{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&ot(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const Kh=10*1e3,tI=30*1e3,nI=300*1e3;class sI{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new eI(e);const s=Kh+(tI-Kh)*Math.random();Ji(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;ot(e,(i,r)=>{r>0&&Zt(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Ji(this.reportStats_.bind(this),Math.floor(Math.random()*2*nI))}}var It;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(It||(It={}));function Pp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Tc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wc(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class xo{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=It.ACK_USER_WRITE,this.source=Pp()}operationForChild(e){if(Z(this.path)){if(this.affectedTree.value!=null)return N(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new he(e));return new xo(oe(),t,this.revert)}}else return N(Y(this.path)===e,"operationForChild called for unrelated child."),new xo(pe(this.path),this.affectedTree,this.revert)}}class fr{constructor(e,t){this.source=e,this.path=t,this.type=It.LISTEN_COMPLETE}operationForChild(e){return Z(this.path)?new fr(this.source,oe()):new fr(this.source,pe(this.path))}}class cs{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=It.OVERWRITE}operationForChild(e){return Z(this.path)?new cs(this.source,oe(),this.snap.getImmediateChild(e)):new cs(this.source,pe(this.path),this.snap)}}class pr{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=It.MERGE}operationForChild(e){if(Z(this.path)){const t=this.children.subtree(new he(e));return t.isEmpty()?null:t.value?new cs(this.source,oe(),t.value):new pr(this.source,oe(),t)}else return N(Y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new pr(this.source,pe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class us{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Z(e))return this.isFullyInitialized()&&!this.filtered_;const t=Y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class iI{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function rI(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(QE(o.childName,o.snapshotNode))}),Vi(n,i,"child_removed",e,s,t),Vi(n,i,"child_added",e,s,t),Vi(n,i,"child_moved",r,s,t),Vi(n,i,"child_changed",e,s,t),Vi(n,i,"value",e,s,t),i}function Vi(n,e,t,s,i,r){const o=s.filter(l=>l.type===t);o.sort((l,c)=>aI(n,l,c)),o.forEach(l=>{const c=oI(n,l,r);i.forEach(h=>{h.respondsTo(l.type)&&e.push(h.createEvent(c,n.query_))})})}function oI(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function aI(n,e,t){if(e.childName==null||t.childName==null)throw ri("Should only compare child_ events.");const s=new J(e.childName,e.snapshotNode),i=new J(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function aa(n,e){return{eventCache:n,serverCache:e}}function Xi(n,e,t,s){return aa(new us(e,t,s),n.serverCache)}function kp(n,e,t,s){return aa(n.eventCache,new us(e,t,s))}function Rl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function hs(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let il;const lI=()=>(il||(il=new Dt(Gv)),il);class me{static fromObject(e){let t=new me(null);return ot(e,(s,i)=>{t=t.set(new he(s),i)}),t}constructor(e,t=lI()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:oe(),value:this.value};if(Z(e))return null;{const s=Y(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(pe(e),t);return r!=null?{path:De(new he(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Z(e))return this;{const t=Y(e),s=this.children.get(t);return s!==null?s.subtree(pe(e)):new me(null)}}set(e,t){if(Z(e))return new me(t,this.children);{const s=Y(e),r=(this.children.get(s)||new me(null)).set(pe(e),t),o=this.children.insert(s,r);return new me(this.value,o)}}remove(e){if(Z(e))return this.children.isEmpty()?new me(null):new me(null,this.children);{const t=Y(e),s=this.children.get(t);if(s){const i=s.remove(pe(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new me(null):new me(this.value,r)}else return this}}get(e){if(Z(e))return this.value;{const t=Y(e),s=this.children.get(t);return s?s.get(pe(e)):null}}setTree(e,t){if(Z(e))return t;{const s=Y(e),r=(this.children.get(s)||new me(null)).setTree(pe(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new me(this.value,o)}}fold(e){return this.fold_(oe(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(De(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,oe(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(Z(e))return null;{const r=Y(e),o=this.children.get(r);return o?o.findOnPath_(pe(e),De(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,oe(),t)}foreachOnPath_(e,t,s){if(Z(e))return this;{this.value&&s(t,this.value);const i=Y(e),r=this.children.get(i);return r?r.foreachOnPath_(pe(e),De(t,i),s):new me(null)}}foreach(e){this.foreach_(oe(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(De(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class wt{constructor(e){this.writeTree_=e}static empty(){return new wt(new me(null))}}function Zi(n,e,t){if(Z(e))return new wt(new me(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=it(i,e);return r=r.updateChild(o,t),new wt(n.writeTree_.set(i,r))}else{const i=new me(t),r=n.writeTree_.setTree(e,i);return new wt(r)}}}function Qh(n,e,t){let s=n;return ot(t,(i,r)=>{s=Zi(s,De(e,i),r)}),s}function Yh(n,e){if(Z(e))return wt.empty();{const t=n.writeTree_.setTree(e,new me(null));return new wt(t)}}function bl(n,e){return gs(n,e)!=null}function gs(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(it(t.path,e)):null}function Jh(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ie,(s,i)=>{e.push(new J(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new J(s,i.value))}),e}function vn(n,e){if(Z(e))return n;{const t=gs(n,e);return t!=null?new wt(new me(t)):new wt(n.writeTree_.subtree(e))}}function Pl(n){return n.writeTree_.isEmpty()}function Ys(n,e){return Np(oe(),n.writeTree_,e)}function Np(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(N(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=Np(De(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(De(n,".priority"),s)),t}}function Cc(n,e){return Lp(e,n)}function cI(n,e,t,s,i){N(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=Zi(n.visibleWrites,e,t)),n.lastWriteId=s}function uI(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function hI(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);N(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&dI(l,s.path)?i=!1:Et(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return fI(n),!0;if(s.snap)n.visibleWrites=Yh(n.visibleWrites,s.path);else{const l=s.children;ot(l,c=>{n.visibleWrites=Yh(n.visibleWrites,De(s.path,c))})}return!0}else return!1}function dI(n,e){if(n.snap)return Et(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Et(De(n.path,t),e))return!0;return!1}function fI(n){n.visibleWrites=Dp(n.allWrites,pI,oe()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function pI(n){return n.visible}function Dp(n,e,t){let s=wt.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let l;if(r.snap)Et(t,o)?(l=it(t,o),s=Zi(s,l,r.snap)):Et(o,t)&&(l=it(o,t),s=Zi(s,oe(),r.snap.getChild(l)));else if(r.children){if(Et(t,o))l=it(t,o),s=Qh(s,l,r.children);else if(Et(o,t))if(l=it(o,t),Z(l))s=Qh(s,oe(),r.children);else{const c=Gs(r.children,Y(l));if(c){const h=c.getChild(pe(l));s=Zi(s,oe(),h)}}}else throw ri("WriteRecord should have .snap or .children")}}return s}function Op(n,e,t,s,i){if(!s&&!i){const r=gs(n.visibleWrites,e);if(r!=null)return r;{const o=vn(n.visibleWrites,e);if(Pl(o))return t;if(t==null&&!bl(o,oe()))return null;{const l=t||q.EMPTY_NODE;return Ys(o,l)}}}else{const r=vn(n.visibleWrites,e);if(!i&&Pl(r))return t;if(!i&&t==null&&!bl(r,oe()))return null;{const o=function(h){return(h.visible||i)&&(!s||!~s.indexOf(h.writeId))&&(Et(h.path,e)||Et(e,h.path))},l=Dp(n.allWrites,o,e),c=t||q.EMPTY_NODE;return Ys(l,c)}}}function gI(n,e,t){let s=q.EMPTY_NODE;const i=gs(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Ie,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=vn(n.visibleWrites,e);return t.forEachChild(Ie,(o,l)=>{const c=Ys(vn(r,new he(o)),l);s=s.updateImmediateChild(o,c)}),Jh(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=vn(n.visibleWrites,e);return Jh(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function mI(n,e,t,s,i){N(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=De(e,t);if(bl(n.visibleWrites,r))return null;{const o=vn(n.visibleWrites,r);return Pl(o)?i.getChild(t):Ys(o,i.getChild(t))}}function _I(n,e,t,s){const i=De(e,t),r=gs(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=vn(n.visibleWrites,i);return Ys(o,s.getNode().getImmediateChild(t))}else return null}function yI(n,e){return gs(n.visibleWrites,e)}function vI(n,e,t,s,i,r,o){let l;const c=vn(n.visibleWrites,e),h=gs(c,oe());if(h!=null)l=h;else if(t!=null)l=Ys(c,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const f=[],p=o.getCompare(),m=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let A=m.getNext();for(;A&&f.length<i;)p(A,s)!==0&&f.push(A),A=m.getNext();return f}else return[]}function EI(){return{visibleWrites:wt.empty(),allWrites:[],lastWriteId:-1}}function Lo(n,e,t,s){return Op(n.writeTree,n.treePath,e,t,s)}function Ac(n,e){return gI(n.writeTree,n.treePath,e)}function Xh(n,e,t,s){return mI(n.writeTree,n.treePath,e,t,s)}function Mo(n,e){return yI(n.writeTree,De(n.treePath,e))}function II(n,e,t,s,i,r){return vI(n.writeTree,n.treePath,e,t,s,i,r)}function Sc(n,e,t){return _I(n.writeTree,n.treePath,e,t)}function xp(n,e){return Lp(De(n.treePath,e),n.writeTree)}function Lp(n,e){return{treePath:n,writeTree:e}}class TI{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;N(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),N(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,hr(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,ur(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Qs(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,hr(s,e.snapshotNode,i.oldSnap));else throw ri("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class wI{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const Mp=new wI;class Rc{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new us(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Sc(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:hs(this.viewCache_),r=II(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function CI(n){return{filter:n}}function AI(n,e){N(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),N(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function SI(n,e,t,s,i){const r=new TI;let o,l;if(t.type===It.OVERWRITE){const h=t;h.source.fromUser?o=kl(n,e,h.path,h.snap,s,i,r):(N(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered()&&!Z(h.path),o=Vo(n,e,h.path,h.snap,s,i,l,r))}else if(t.type===It.MERGE){const h=t;h.source.fromUser?o=bI(n,e,h.path,h.children,s,i,r):(N(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered(),o=Nl(n,e,h.path,h.children,s,i,l,r))}else if(t.type===It.ACK_USER_WRITE){const h=t;h.revert?o=NI(n,e,h.path,s,i,r):o=PI(n,e,h.path,h.affectedTree,s,i,r)}else if(t.type===It.LISTEN_COMPLETE)o=kI(n,e,t.path,s,r);else throw ri("Unknown operation type: "+t.type);const c=r.getChanges();return RI(e,o,c),{viewCache:o,changes:c}}function RI(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Rl(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Rp(Rl(e)))}}function Vp(n,e,t,s,i,r){const o=e.eventCache;if(Mo(s,t)!=null)return e;{let l,c;if(Z(t))if(N(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=hs(e),f=h instanceof q?h:q.EMPTY_NODE,p=Ac(s,f);l=n.filter.updateFullNode(e.eventCache.getNode(),p,r)}else{const h=Lo(s,hs(e));l=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const h=Y(t);if(h===".priority"){N(Sn(t)===1,"Can't have a priority with additional path components");const f=o.getNode();c=e.serverCache.getNode();const p=Xh(s,t,f,c);p!=null?l=n.filter.updatePriority(f,p):l=o.getNode()}else{const f=pe(t);let p;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const m=Xh(s,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(h).updateChild(f,m):p=o.getNode().getImmediateChild(h)}else p=Sc(s,h,e.serverCache);p!=null?l=n.filter.updateChild(o.getNode(),h,p,f,i,r):l=o.getNode()}}return Xi(e,l,o.isFullyInitialized()||Z(t),n.filter.filtersNodes())}}function Vo(n,e,t,s,i,r,o,l){const c=e.serverCache;let h;const f=o?n.filter:n.filter.getIndexedFilter();if(Z(t))h=f.updateFullNode(c.getNode(),s,null);else if(f.filtersNodes()&&!c.isFiltered()){const A=c.getNode().updateChild(t,s);h=f.updateFullNode(c.getNode(),A,null)}else{const A=Y(t);if(!c.isCompleteForPath(t)&&Sn(t)>1)return e;const S=pe(t),x=c.getNode().getImmediateChild(A).updateChild(S,s);A===".priority"?h=f.updatePriority(c.getNode(),x):h=f.updateChild(c.getNode(),A,x,S,Mp,null)}const p=kp(e,h,c.isFullyInitialized()||Z(t),f.filtersNodes()),m=new Rc(i,p,r);return Vp(n,p,t,i,m,l)}function kl(n,e,t,s,i,r,o){const l=e.eventCache;let c,h;const f=new Rc(i,e,r);if(Z(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Xi(e,h,!0,n.filter.filtersNodes());else{const p=Y(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),s),c=Xi(e,h,l.isFullyInitialized(),l.isFiltered());else{const m=pe(t),A=l.getNode().getImmediateChild(p);let S;if(Z(m))S=s;else{const k=f.getCompleteChild(p);k!=null?yp(m)===".priority"&&k.getChild(Ep(m)).isEmpty()?S=k:S=k.updateChild(m,s):S=q.EMPTY_NODE}if(A.equals(S))c=e;else{const k=n.filter.updateChild(l.getNode(),p,S,m,f,o);c=Xi(e,k,l.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Zh(n,e){return n.eventCache.isCompleteForChild(e)}function bI(n,e,t,s,i,r,o){let l=e;return s.foreach((c,h)=>{const f=De(t,c);Zh(e,Y(f))&&(l=kl(n,l,f,h,i,r,o))}),s.foreach((c,h)=>{const f=De(t,c);Zh(e,Y(f))||(l=kl(n,l,f,h,i,r,o))}),l}function ed(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Nl(n,e,t,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;Z(t)?h=s:h=new me(null).setTree(t,s);const f=e.serverCache.getNode();return h.children.inorderTraversal((p,m)=>{if(f.hasChild(p)){const A=e.serverCache.getNode().getImmediateChild(p),S=ed(n,A,m);c=Vo(n,c,new he(p),S,i,r,o,l)}}),h.children.inorderTraversal((p,m)=>{const A=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!f.hasChild(p)&&!A){const S=e.serverCache.getNode().getImmediateChild(p),k=ed(n,S,m);c=Vo(n,c,new he(p),k,i,r,o,l)}}),c}function PI(n,e,t,s,i,r,o){if(Mo(i,t)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(Z(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Vo(n,e,t,c.getNode().getChild(t),i,r,l,o);if(Z(t)){let h=new me(null);return c.getNode().forEachChild(Us,(f,p)=>{h=h.set(new he(f),p)}),Nl(n,e,t,h,i,r,l,o)}else return e}else{let h=new me(null);return s.foreach((f,p)=>{const m=De(t,f);c.isCompleteForPath(m)&&(h=h.set(f,c.getNode().getChild(m)))}),Nl(n,e,t,h,i,r,l,o)}}function kI(n,e,t,s,i){const r=e.serverCache,o=kp(e,r.getNode(),r.isFullyInitialized()||Z(t),r.isFiltered());return Vp(n,o,t,s,Mp,i)}function NI(n,e,t,s,i,r){let o;if(Mo(s,t)!=null)return e;{const l=new Rc(s,e,i),c=e.eventCache.getNode();let h;if(Z(t)||Y(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=Lo(s,hs(e));else{const p=e.serverCache.getNode();N(p instanceof q,"serverChildren would be complete if leaf node"),f=Ac(s,p)}f=f,h=n.filter.updateFullNode(c,f,r)}else{const f=Y(t);let p=Sc(s,f,e.serverCache);p==null&&e.serverCache.isCompleteForChild(f)&&(p=c.getImmediateChild(f)),p!=null?h=n.filter.updateChild(c,f,p,pe(t),l,r):e.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(c,f,q.EMPTY_NODE,pe(t),l,r):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Lo(s,hs(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,r)))}return o=e.serverCache.isFullyInitialized()||Mo(s,oe())!=null,Xi(e,h,o,n.filter.filtersNodes())}}class DI{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Ec(s.getIndex()),r=JE(s);this.processor_=CI(r);const o=t.serverCache,l=t.eventCache,c=i.updateFullNode(q.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(q.EMPTY_NODE,l.getNode(),null),f=new us(c,o.isFullyInitialized(),i.filtersNodes()),p=new us(h,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=aa(p,f),this.eventGenerator_=new iI(this.query_)}get query(){return this.query_}}function OI(n){return n.viewCache_.serverCache.getNode()}function xI(n,e){const t=hs(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Z(e)&&!t.getImmediateChild(Y(e)).isEmpty())?t.getChild(e):null}function td(n){return n.eventRegistrations_.length===0}function LI(n,e){n.eventRegistrations_.push(e)}function nd(n,e,t){const s=[];if(t){N(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function sd(n,e,t,s){e.type===It.MERGE&&e.source.queryId!==null&&(N(hs(n.viewCache_),"We should always have a full cache before handling merges"),N(Rl(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=SI(n.processor_,i,e,t,s);return AI(n.processor_,r.viewCache),N(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Fp(n,r.changes,r.viewCache.eventCache.getNode(),null)}function MI(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ie,(r,o)=>{s.push(Qs(r,o))}),t.isFullyInitialized()&&s.push(Rp(t.getNode())),Fp(n,s,t.getNode(),e)}function Fp(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return rI(n.eventGenerator_,e,t,i)}let Fo;class VI{constructor(){this.views=new Map}}function FI(n){N(!Fo,"__referenceConstructor has already been defined"),Fo=n}function UI(){return N(Fo,"Reference.ts has not been loaded"),Fo}function BI(n){return n.views.size===0}function bc(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return N(r!=null,"SyncTree gave us an op for an invalid query."),sd(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(sd(o,e,t,s));return r}}function qI(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let l=Lo(t,i?s:null),c=!1;l?c=!0:s instanceof q?(l=Ac(t,s),c=!1):(l=q.EMPTY_NODE,c=!1);const h=aa(new us(l,c,!1),new us(s,i,!1));return new DI(e,h)}return o}function WI(n,e,t,s,i,r){const o=qI(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),LI(o,t),MI(o,t)}function jI(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const l=Rn(n);if(i==="default")for(const[c,h]of n.views.entries())o=o.concat(nd(h,t,s)),td(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||r.push(h.query));else{const c=n.views.get(i);c&&(o=o.concat(nd(c,t,s)),td(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!Rn(n)&&r.push(new(UI())(e._repo,e._path)),{removed:r,events:o}}function Up(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Bs(n,e){let t=null;for(const s of n.views.values())t=t||xI(s,e);return t}function Bp(n,e){if(e._queryParams.loadsAllData())return la(n);{const s=e._queryIdentifier;return n.views.get(s)}}function qp(n,e){return Bp(n,e)!=null}function Rn(n){return la(n)!=null}function la(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Uo;function HI(n){N(!Uo,"__referenceConstructor has already been defined"),Uo=n}function $I(){return N(Uo,"Reference.ts has not been loaded"),Uo}let zI=1;class id{constructor(e){this.listenProvider_=e,this.syncPointTree_=new me(null),this.pendingWriteTree_=EI(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Wp(n,e,t,s,i){return cI(n.pendingWriteTree_,e,t,s,i),i?Rr(n,new cs(Pp(),e,t)):[]}function ns(n,e,t=!1){const s=uI(n.pendingWriteTree_,e);if(hI(n.pendingWriteTree_,e)){let r=new me(null);return s.snap!=null?r=r.set(oe(),!0):ot(s.children,o=>{r=r.set(new he(o),!0)}),Rr(n,new xo(s.path,r,t))}else return[]}function ca(n,e,t){return Rr(n,new cs(Tc(),e,t))}function GI(n,e,t){const s=me.fromObject(t);return Rr(n,new pr(Tc(),e,s))}function KI(n,e){return Rr(n,new fr(Tc(),e))}function QI(n,e,t){const s=kc(n,t);if(s){const i=Nc(s),r=i.path,o=i.queryId,l=it(r,e),c=new fr(wc(o),l);return Dc(n,r,c)}else return[]}function Dl(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let l=[];if(o&&(e._queryIdentifier==="default"||qp(o,e))){const c=jI(o,e,t,s);BI(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const h=c.removed;if(l=c.events,!i){const f=h.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(r,(m,A)=>Rn(A));if(f&&!p){const m=n.syncPointTree_.subtree(r);if(!m.isEmpty()){const A=XI(m);for(let S=0;S<A.length;++S){const k=A[S],x=k.query,W=$p(n,k);n.listenProvider_.startListening(er(x),Bo(n,x),W.hashFn,W.onComplete)}}}!p&&h.length>0&&!s&&(f?n.listenProvider_.stopListening(er(e),null):h.forEach(m=>{const A=n.queryToTagMap.get(ua(m));n.listenProvider_.stopListening(er(m),A)}))}ZI(n,h)}return l}function YI(n,e,t,s){const i=kc(n,s);if(i!=null){const r=Nc(i),o=r.path,l=r.queryId,c=it(o,e),h=new cs(wc(l),c,t);return Dc(n,o,h)}else return[]}function JI(n,e,t,s){const i=kc(n,s);if(i){const r=Nc(i),o=r.path,l=r.queryId,c=it(o,e),h=me.fromObject(t),f=new pr(wc(l),c,h);return Dc(n,o,f)}else return[]}function rd(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(m,A)=>{const S=it(m,i);r=r||Bs(A,S),o=o||Rn(A)});let l=n.syncPointTree_.get(i);l?(o=o||Rn(l),r=r||Bs(l,oe())):(l=new VI,n.syncPointTree_=n.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=q.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((A,S)=>{const k=Bs(S,oe());k&&(r=r.updateImmediateChild(A,k))}));const h=qp(l,e);if(!h&&!e._queryParams.loadsAllData()){const m=ua(e);N(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const A=eT();n.queryToTagMap.set(m,A),n.tagToQueryMap.set(A,m)}const f=Cc(n.pendingWriteTree_,i);let p=WI(l,e,t,f,r,c);if(!h&&!o&&!s){const m=Bp(l,e);p=p.concat(tT(n,e,m))}return p}function Pc(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=it(o,e),h=Bs(l,c);if(h)return h});return Op(i,e,r,t,!0)}function Rr(n,e){return jp(e,n.syncPointTree_,null,Cc(n.pendingWriteTree_,oe()))}function jp(n,e,t,s){if(Z(n.path))return Hp(n,e,t,s);{const i=e.get(oe());t==null&&i!=null&&(t=Bs(i,oe()));let r=[];const o=Y(n.path),l=n.operationForChild(o),c=e.children.get(o);if(c&&l){const h=t?t.getImmediateChild(o):null,f=xp(s,o);r=r.concat(jp(l,c,h,f))}return i&&(r=r.concat(bc(i,n,s,t))),r}}function Hp(n,e,t,s){const i=e.get(oe());t==null&&i!=null&&(t=Bs(i,oe()));let r=[];return e.children.inorderTraversal((o,l)=>{const c=t?t.getImmediateChild(o):null,h=xp(s,o),f=n.operationForChild(o);f&&(r=r.concat(Hp(f,l,c,h)))}),i&&(r=r.concat(bc(i,n,s,t))),r}function $p(n,e){const t=e.query,s=Bo(n,t);return{hashFn:()=>(OI(e)||q.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?QI(n,t._path,s):KI(n,t._path);{const r=Yv(i,t);return Dl(n,t,null,r)}}}}function Bo(n,e){const t=ua(e);return n.queryToTagMap.get(t)}function ua(n){return n._path.toString()+"$"+n._queryIdentifier}function kc(n,e){return n.tagToQueryMap.get(e)}function Nc(n){const e=n.indexOf("$");return N(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new he(n.substr(0,e))}}function Dc(n,e,t){const s=n.syncPointTree_.get(e);N(s,"Missing sync point for query tag that we're tracking");const i=Cc(n.pendingWriteTree_,e);return bc(s,t,i,null)}function XI(n){return n.fold((e,t,s)=>{if(t&&Rn(t))return[la(t)];{let i=[];return t&&(i=Up(t)),ot(s,(r,o)=>{i=i.concat(o)}),i}})}function er(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new($I())(n._repo,n._path):n}function ZI(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=ua(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function eT(){return zI++}function tT(n,e,t){const s=e._path,i=Bo(n,e),r=$p(n,t),o=n.listenProvider_.startListening(er(e),i,r.hashFn,r.onComplete),l=n.syncPointTree_.subtree(s);if(i)N(!Rn(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((h,f,p)=>{if(!Z(h)&&f&&Rn(f))return[la(f).query];{let m=[];return f&&(m=m.concat(Up(f).map(A=>A.query))),ot(p,(A,S)=>{m=m.concat(S)}),m}});for(let h=0;h<c.length;++h){const f=c[h];n.listenProvider_.stopListening(er(f),Bo(n,f))}}return o}class Oc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Oc(t)}node(){return this.node_}}class xc{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=De(this.path_,e);return new xc(this.syncTree_,t)}node(){return Pc(this.syncTree_,this.path_)}}const nT=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},od=function(n,e,t){if(!n||typeof n!="object")return n;if(N(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return sT(n[".sv"],e,t);if(typeof n[".sv"]=="object")return iT(n[".sv"],e);N(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},sT=function(n,e,t){if(n==="timestamp")return t.timestamp;N(!1,"Unexpected server value: "+n)},iT=function(n,e,t){n.hasOwnProperty("increment")||N(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&N(!1,"Unexpected increment value: "+s);const i=e.node();if(N(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},rT=function(n,e,t,s){return Lc(e,new xc(t,n),s)},zp=function(n,e,t){return Lc(n,new Oc(e),t)};function Lc(n,e,t){const s=n.getPriority().val(),i=od(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,l=od(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new Ve(l,He(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Ve(i))),o.forEachChild(Ie,(l,c)=>{const h=Lc(c,e.getImmediateChild(l),t);h!==c&&(r=r.updateImmediateChild(l,h))}),r}}class Mc{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function Vc(n,e){let t=e instanceof he?e:new he(e),s=n,i=Y(t);for(;i!==null;){const r=Gs(s.node.children,i)||{children:{},childCount:0};s=new Mc(i,s,r),t=pe(t),i=Y(t)}return s}function ci(n){return n.node.value}function Gp(n,e){n.node.value=e,Ol(n)}function Kp(n){return n.node.childCount>0}function oT(n){return ci(n)===void 0&&!Kp(n)}function ha(n,e){ot(n.node.children,(t,s)=>{e(new Mc(t,n,s))})}function Qp(n,e,t,s){t&&e(n),ha(n,i=>{Qp(i,e,!0)})}function aT(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function br(n){return new he(n.parent===null?n.name:br(n.parent)+"/"+n.name)}function Ol(n){n.parent!==null&&lT(n.parent,n.name,n)}function lT(n,e,t){const s=oT(t),i=Zt(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Ol(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Ol(n))}const cT=/[\[\].#$\/\u0000-\u001F\u007F]/,uT=/[\[\].#$\u0000-\u001F\u007F]/,rl=10*1024*1024,Yp=function(n){return typeof n=="string"&&n.length!==0&&!cT.test(n)},Jp=function(n){return typeof n=="string"&&n.length!==0&&!uT.test(n)},hT=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Jp(n)},Xp=function(n,e,t,s){s&&e===void 0||Fc(uc(n,"value"),e,t)},Fc=function(n,e,t){const s=t instanceof he?new PE(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+es(s));if(typeof e=="function")throw new Error(n+"contains a function "+es(s)+" with contents = "+e.toString());if(Jf(e))throw new Error(n+"contains "+e.toString()+" "+es(s));if(typeof e=="string"&&e.length>rl/3&&sa(e)>rl)throw new Error(n+"contains a string greater than "+rl+" utf8 bytes "+es(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(ot(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Yp(o)))throw new Error(n+" contains an invalid key ("+o+") "+es(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);kE(s,o),Fc(n,l,s),NE(s)}),i&&r)throw new Error(n+' contains ".value" child '+es(s)+" in addition to actual children.")}},Zp=function(n,e,t,s){if(!Jp(t))throw new Error(uc(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},dT=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Zp(n,e,t)},Uc=function(n,e){if(Y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},fT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Yp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!hT(t))throw new Error(uc(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class pT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Bc(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!_c(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function eg(n,e,t){Bc(n,t),tg(n,s=>_c(s,e))}function Qt(n,e,t){Bc(n,t),tg(n,s=>Et(s,e)||Et(e,s))}function tg(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(gT(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function gT(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Yi&&Ye("event: "+t.toString()),li(s)}}}const mT="repo_interrupt",_T=25;class yT{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Oo(),this.transactionQueueTree_=new Mc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function vT(n,e,t){if(n.stats_=gc(n.repoInfo_),n.forceRestClient_||eE())n.server_=new Do(n.repoInfo_,(s,i,r,o)=>{ad(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>ld(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ue(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new zt(n.repoInfo_,e,(s,i,r,o)=>{ad(n,s,i,r,o)},s=>{ld(n,s)},s=>{ET(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=rE(n.repoInfo_,()=>new sI(n.stats_,n.server_)),n.infoData_=new XE,n.infoSyncTree_=new id({startListening:(s,i,r,o)=>{let l=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(l=ca(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Wc(n,"connected",!1),n.serverSyncTree_=new id({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(l,c)=>{const h=o(l,c);Qt(n.eventQueue_,s._path,h)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function ng(n){const t=n.infoData_.getNode(new he(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function qc(n){return nT({timestamp:ng(n)})}function ad(n,e,t,s,i){n.dataUpdateCount++;const r=new he(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const c=Ro(t,h=>He(h));o=JI(n.serverSyncTree_,r,c,i)}else{const c=He(t);o=YI(n.serverSyncTree_,r,c,i)}else if(s){const c=Ro(t,h=>He(h));o=GI(n.serverSyncTree_,r,c)}else{const c=He(t);o=ca(n.serverSyncTree_,r,c)}let l=r;o.length>0&&(l=da(n,r)),Qt(n.eventQueue_,l,o)}function ld(n,e){Wc(n,"connected",e),e===!1&&TT(n)}function ET(n,e){ot(e,(t,s)=>{Wc(n,t,s)})}function Wc(n,e,t){const s=new he("/.info/"+e),i=He(t);n.infoData_.updateSnapshot(s,i);const r=ca(n.infoSyncTree_,s,i);Qt(n.eventQueue_,s,r)}function sg(n){return n.nextWriteId_++}function IT(n,e,t,s,i){jc(n,"set",{path:e.toString(),value:t,priority:s});const r=qc(n),o=He(t,s),l=Pc(n.serverSyncTree_,e),c=zp(o,l,r),h=sg(n),f=Wp(n.serverSyncTree_,e,c,h,!0);Bc(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(m,A)=>{const S=m==="ok";S||rt("set at "+e+" failed: "+m);const k=ns(n.serverSyncTree_,h,!S);Qt(n.eventQueue_,e,k),ST(n,i,m,A)});const p=lg(n,e);da(n,p),Qt(n.eventQueue_,p,[])}function TT(n){jc(n,"onDisconnectEvents");const e=qc(n),t=Oo();Sl(n.onDisconnect_,oe(),(i,r)=>{const o=rT(i,r,n.serverSyncTree_,e);bp(t,i,o)});let s=[];Sl(t,oe(),(i,r)=>{s=s.concat(ca(n.serverSyncTree_,i,r));const o=lg(n,i);da(n,o)}),n.onDisconnect_=Oo(),Qt(n.eventQueue_,oe(),s)}function wT(n,e,t){let s;Y(e._path)===".info"?s=rd(n.infoSyncTree_,e,t):s=rd(n.serverSyncTree_,e,t),eg(n.eventQueue_,e._path,s)}function CT(n,e,t){let s;Y(e._path)===".info"?s=Dl(n.infoSyncTree_,e,t):s=Dl(n.serverSyncTree_,e,t),eg(n.eventQueue_,e._path,s)}function AT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(mT)}function jc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ye(t,...e)}function ST(n,e,t,s){e&&li(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function ig(n,e,t){return Pc(n.serverSyncTree_,e,t)||q.EMPTY_NODE}function Hc(n,e=n.transactionQueueTree_){if(e||fa(n,e),ci(e)){const t=og(n,e);N(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&RT(n,br(e),t)}else Kp(e)&&ha(e,t=>{Hc(n,t)})}function RT(n,e,t){const s=t.map(h=>h.currentWriteId),i=ig(n,e,s);let r=i;const o=i.hash();for(let h=0;h<t.length;h++){const f=t[h];N(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const p=it(e,f.path);r=r.updateChild(p,f.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;n.server_.put(c.toString(),l,h=>{jc(n,"transaction put response",{path:c.toString(),status:h});let f=[];if(h==="ok"){const p=[];for(let m=0;m<t.length;m++)t[m].status=2,f=f.concat(ns(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();fa(n,Vc(n.transactionQueueTree_,e)),Hc(n,n.transactionQueueTree_),Qt(n.eventQueue_,e,f);for(let m=0;m<p.length;m++)li(p[m])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{rt("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}da(n,e)}},o)}function da(n,e){const t=rg(n,e),s=br(t),i=og(n,t);return bT(n,i,s),s}function bT(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],h=it(t,c.path);let f=!1,p;if(N(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)f=!0,p=c.abortReason,i=i.concat(ns(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=_T)f=!0,p="maxretry",i=i.concat(ns(n.serverSyncTree_,c.currentWriteId,!0));else{const m=ig(n,c.path,o);c.currentInputSnapshot=m;const A=e[l].update(m.val());if(A!==void 0){Fc("transaction failed: Data returned ",A,c.path);let S=He(A);typeof A=="object"&&A!=null&&Zt(A,".priority")||(S=S.updatePriority(m.getPriority()));const x=c.currentWriteId,W=qc(n),B=zp(S,m,W);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=B,c.currentWriteId=sg(n),o.splice(o.indexOf(x),1),i=i.concat(Wp(n.serverSyncTree_,c.path,B,c.currentWriteId,c.applyLocally)),i=i.concat(ns(n.serverSyncTree_,x,!0))}else f=!0,p="nodata",i=i.concat(ns(n.serverSyncTree_,c.currentWriteId,!0))}Qt(n.eventQueue_,t,i),i=[],f&&(e[l].status=2,(function(m){setTimeout(m,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(p),!1,null))))}fa(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)li(s[l]);Hc(n,n.transactionQueueTree_)}function rg(n,e){let t,s=n.transactionQueueTree_;for(t=Y(e);t!==null&&ci(s)===void 0;)s=Vc(s,t),e=pe(e),t=Y(e);return s}function og(n,e){const t=[];return ag(n,e,t),t.sort((s,i)=>s.order-i.order),t}function ag(n,e,t){const s=ci(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);ha(e,i=>{ag(n,i,t)})}function fa(n,e){const t=ci(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Gp(e,t.length>0?t:void 0)}ha(e,s=>{fa(n,s)})}function lg(n,e){const t=br(rg(n,e)),s=Vc(n.transactionQueueTree_,e);return aT(s,i=>{ol(n,i)}),ol(n,s),Qp(s,i=>{ol(n,i)}),t}function ol(n,e){const t=ci(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(N(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(N(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(ns(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Gp(e,void 0):t.length=r+1,Qt(n.eventQueue_,br(e),i);for(let o=0;o<s.length;o++)li(s[o])}}function PT(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function kT(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):rt(`Invalid query segment '${t}' in query '${n}'`)}return e}const cd=function(n,e){const t=NT(n),s=t.namespace;t.domain==="firebase.com"&&Kt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Kt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||$v();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new cp(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new he(t.pathString)}},NT=function(n){let e="",t="",s="",i="",r="",o=!0,l="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(f,p)),f<p&&(i=PT(n.substring(f,p)));const m=kT(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const A=e.slice(0,h);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const S=e.indexOf(".");s=e.substring(0,S).toLowerCase(),t=e.substring(S+1),r=s}"ns"in m&&(r=m.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};const ud="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",DT=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=ud.charAt(t%64),t=Math.floor(t/64);N(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=ud.charAt(e[i]);return N(o.length===20,"nextPushId: Length should be 20."),o}})();class OT{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ue(this.snapshot.exportVal())}}class xT{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class LT{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return N(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class $c{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return Z(this._path)?null:yp(this._path)}get ref(){return new Ln(this._repo,this._path)}get _queryIdentifier(){const e=Gh(this._queryParams),t=fc(e);return t==="{}"?"default":t}get _queryObject(){return Gh(this._queryParams)}isEqual(e){if(e=Ze(e),!(e instanceof $c))return!1;const t=this._repo===e._repo,s=_c(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+bE(this._path)}}class Ln extends $c{constructor(e,t){super(e,t,new Ic,!1)}get parent(){const e=Ep(this._path);return e===null?null:new Ln(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class qo{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new he(e),s=gr(this.ref,e);return new qo(this._node.getChild(t),s,Ie)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new qo(i,gr(this.ref,s),Ie)))}hasChild(e){const t=new he(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Fi(n,e){return n=Ze(n),n._checkNotDeleted("ref"),e!==void 0?gr(n._root,e):n._root}function gr(n,e){return n=Ze(n),Y(n._path)===null?dT("child","path",e):Zp("child","path",e),new Ln(n._repo,De(n._path,e))}function MT(n,e){n=Ze(n),Uc("push",n._path),Xp("push",e,n._path,!0);const t=ng(n._repo),s=DT(t),i=gr(n,s),r=gr(n,s);let o;return o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function VT(n){return Uc("remove",n._path),go(n,null)}function go(n,e){n=Ze(n),Uc("set",n._path),Xp("set",e,n._path,!1);const t=new na;return IT(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class zc{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new OT("value",this,new qo(e.snapshotNode,new Ln(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new xT(this,e,t):null}matches(e){return e instanceof zc?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function FT(n,e,t,s,i){const r=new LT(t,void 0),o=new zc(r);return wT(n._repo,n,o),()=>CT(n._repo,n,o)}function UT(n,e,t,s){return FT(n,"value",e)}FI(Ln);HI(Ln);const BT="FIREBASE_DATABASE_EMULATOR_HOST",xl={};let qT=!1;function WT(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=xn(r);n.repoInfo_=new cp(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function jT(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Kt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ye("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=cd(r,i),l=o.repoInfo,c;typeof process<"u"&&Ph&&(c=Ph[BT]),c?(r=`http://${c}?ns=${l.namespace}`,o=cd(r,i),l=o.repoInfo):o.repoInfo.secure;const h=new nE(n.name,n.options,e);fT("Invalid Firebase Database URL",o),Z(o.path)||Kt("Database URL must point to the root of a Firebase Database (not including a child path).");const f=$T(l,n,h,new tE(n,t));return new zT(f,n)}function HT(n,e){const t=xl[e];(!t||t[n.key]!==n)&&Kt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),AT(n),delete t[n.key]}function $T(n,e,t,s){let i=xl[e.name];i||(i={},xl[e.name]=i);let r=i[n.toURLString()];return r&&Kt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new yT(n,qT,t,s),i[n.toURLString()]=r,r}class zT{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ln(this._repo,oe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(HT(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Kt("Cannot call "+e+" on a deleted database.")}}function GT(n=dc(),e){const t=ra(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Vf("database");s&&KT(t,...s)}return t}function KT(n,e,t,s={}){n=Ze(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&Cn(s,r.repoInfo_.emulatorOptions))return;Kt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&Kt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new fo(fo.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:Bf(s.mockUserToken,n.app.options.projectId);o=new fo(l)}xn(e)&&(ac(e),lc("Database",!0)),WT(r,i,s,o)}function QT(n){Uv(ps),as(new An("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return jT(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),Ot(kh,Nh,n),Ot(kh,Nh,"esm2020")}zt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};zt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};QT();function cg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const YT=cg,ug=new wr("auth","Firebase",cg());const Wo=new ia("@firebase/auth");function JT(n,...e){Wo.logLevel<=X.WARN&&Wo.warn(`Auth (${ps}): ${n}`,...e)}function mo(n,...e){Wo.logLevel<=X.ERROR&&Wo.error(`Auth (${ps}): ${n}`,...e)}function Ct(n,...e){throw Gc(n,...e)}function xt(n,...e){return Gc(n,...e)}function hg(n,e,t){const s={...YT(),[e]:t};return new wr("auth","Firebase",s).create(e,{appName:n.name})}function En(n){return hg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gc(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return ug.create(n,...e)}function U(n,e,...t){if(!n)throw Gc(e,...t)}function Ht(n){const e="INTERNAL ASSERTION FAILED: "+n;throw mo(e),new Error(e)}function Yt(n,e){n||Ht(e)}function Ll(){return typeof self<"u"&&self.location?.href||""}function XT(){return hd()==="http:"||hd()==="https:"}function hd(){return typeof self<"u"&&self.location?.protocol||null}function ZT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(XT()||fy()||"connection"in navigator)?navigator.onLine:!0}function ew(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Pr{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yt(t>e,"Short delay should be less than long delay!"),this.isMobile=cc()||qf()}get(){return ZT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Kc(n,e){Yt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class dg{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ht("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ht("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ht("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const nw=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],sw=new Pr(3e4,6e4);function ms(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Mn(n,e,t,s,i={}){return fg(n,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const l=oi({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:c,...r};return dy()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&xn(n.emulatorConfig.host)&&(h.credentials="include"),dg.fetch()(await pg(n,n.config.apiHost,t,l),h)})}async function fg(n,e,t){n._canInitEmulator=!1;const s={...tw,...e};try{const i=new rw(n),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw oo(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const l=r.ok?o.errorMessage:o.error.message,[c,h]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw oo(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw oo(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw oo(n,"user-disabled",o);const f=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw hg(n,f,h);Ct(n,f)}}catch(i){if(i instanceof Xt)throw i;Ct(n,"network-request-failed",{message:String(i)})}}async function pa(n,e,t,s,i={}){const r=await Mn(n,e,t,s,i);return"mfaPendingCredential"in r&&Ct(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function pg(n,e,t,s){const i=`${e}${t}?${s}`,r=n,o=r.config.emulator?Kc(n.config,i):`${n.config.apiScheme}://${i}`;return nw.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function iw(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rw{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(xt(this.auth,"network-request-failed")),sw.get())})}}function oo(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const i=xt(n,e,s);return i.customData._tokenResponse=t,i}function dd(n){return n!==void 0&&n.enterprise!==void 0}class ow{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return iw(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function aw(n,e){return Mn(n,"GET","/v2/recaptchaConfig",ms(n,e))}async function lw(n,e){return Mn(n,"POST","/v1/accounts:delete",e)}async function jo(n,e){return Mn(n,"POST","/v1/accounts:lookup",e)}function tr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cw(n,e=!1){const t=Ze(n),s=await t.getIdToken(e),i=Qc(s);U(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r?.sign_in_provider;return{claims:i,token:s,authTime:tr(al(i.auth_time)),issuedAtTime:tr(al(i.iat)),expirationTime:tr(al(i.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}}function al(n){return Number(n)*1e3}function Qc(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return mo("JWT malformed, contained fewer than 3 sections"),null;try{const i=So(t);return i?JSON.parse(i):(mo("Failed to decode base64 JWT payload"),null)}catch(i){return mo("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fd(n){const e=Qc(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function mr(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof Xt&&uw(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function uw({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class hw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Ml{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tr(this.lastLoginAt),this.creationTime=tr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ho(n){const e=n.auth,t=await n.getIdToken(),s=await mr(n,jo(e,{idToken:t}));U(s?.users.length,e,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const r=i.providerUserInfo?.length?gg(i.providerUserInfo):[],o=fw(n.providerData,r),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!o?.length,h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Ml(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function dw(n){const e=Ze(n);await Ho(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function fw(n,e){return[...n.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function gg(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function pw(n,e){const t=await fg(n,{},async()=>{const s=oi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=n.config,o=await pg(n,i,"/v1/token",`key=${r}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:s};return n.emulatorConfig&&xn(n.emulatorConfig.host)&&(c.credentials="include"),dg.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function gw(n,e){return Mn(n,"POST","/v2/accounts:revokeToken",ms(n,e))}class qs{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");const t=fd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:i,expiresIn:r}=await pw(e,t);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:i,expirationTime:r}=t,o=new qs;return s&&(U(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(U(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(U(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new qs,this.toJSON())}_performRefresh(){return Ht("not implemented")}}function cn(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Tt{constructor({uid:e,auth:t,stsTokenManager:s,...i}){this.providerId="firebase",this.proactiveRefresh=new hw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ml(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await mr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return cw(this,e)}reload(){return dw(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Tt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Ho(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(mt(this.auth.app))return Promise.reject(En(this.auth));const e=await this.getIdToken();return await mr(this,lw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,o=t.photoURL??void 0,l=t.tenantId??void 0,c=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:A,providerData:S,stsTokenManager:k}=t;U(p&&k,e,"internal-error");const x=qs.fromJSON(this.name,k);U(typeof p=="string",e,"internal-error"),cn(s,e.name),cn(i,e.name),U(typeof m=="boolean",e,"internal-error"),U(typeof A=="boolean",e,"internal-error"),cn(r,e.name),cn(o,e.name),cn(l,e.name),cn(c,e.name),cn(h,e.name),cn(f,e.name);const W=new Tt({uid:p,auth:e,email:i,emailVerified:m,displayName:s,isAnonymous:A,photoURL:o,phoneNumber:r,tenantId:l,stsTokenManager:x,createdAt:h,lastLoginAt:f});return S&&Array.isArray(S)&&(W.providerData=S.map(B=>({...B}))),c&&(W._redirectEventId=c),W}static async _fromIdTokenResponse(e,t,s=!1){const i=new qs;i.updateFromServerResponse(t);const r=new Tt({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Ho(r),r}static async _fromGetAccountInfoResponse(e,t,s){const i=t.users[0];U(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?gg(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!r?.length,l=new qs;l.updateFromIdToken(s);const c=new Tt({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Ml(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length};return Object.assign(c,h),c}}const pd=new Map;function $t(n){Yt(n instanceof Function,"Expected a class definition");let e=pd.get(n);return e?(Yt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,pd.set(n,e),e)}class mg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}mg.type="NONE";const gd=mg;function _o(n,e,t){return`firebase:${n}:${e}:${t}`}class Ws{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=_o(this.userKey,i.apiKey,r),this.fullPersistenceKey=_o("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await jo(this.auth,{idToken:e}).catch(()=>{});return t?Tt._fromGetAccountInfoResponse(this.auth,t,e):null}return Tt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Ws($t(gd),e,s);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=i[0]||$t(gd);const o=_o(s,e.config.apiKey,e.name);let l=null;for(const h of t)try{const f=await h._get(o);if(f){let p;if(typeof f=="string"){const m=await jo(e,{idToken:f}).catch(()=>{});if(!m)break;p=await Tt._fromGetAccountInfoResponse(e,m,f)}else p=Tt._fromJSON(e,f);h!==r&&(l=p),r=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Ws(r,e,s):(r=c[0],l&&await r._set(o,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==r)try{await h._remove(o)}catch{}})),new Ws(r,e,s))}}function md(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Eg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_g(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Tg(e))return"Blackberry";if(wg(e))return"Webos";if(yg(e))return"Safari";if((e.includes("chrome/")||vg(e))&&!e.includes("edge/"))return"Chrome";if(Ig(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function _g(n=Xe()){return/firefox\//i.test(n)}function yg(n=Xe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function vg(n=Xe()){return/crios\//i.test(n)}function Eg(n=Xe()){return/iemobile/i.test(n)}function Ig(n=Xe()){return/android/i.test(n)}function Tg(n=Xe()){return/blackberry/i.test(n)}function wg(n=Xe()){return/webos/i.test(n)}function Yc(n=Xe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function mw(n=Xe()){return Yc(n)&&!!window.navigator?.standalone}function _w(){return py()&&document.documentMode===10}function Cg(n=Xe()){return Yc(n)||Ig(n)||wg(n)||Tg(n)||/windows phone/i.test(n)||Eg(n)}function Ag(n,e=[]){let t;switch(n){case"Browser":t=md(Xe());break;case"Worker":t=`${md(Xe())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ps}/${s}`}class yw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=r=>new Promise((o,l)=>{try{const c=e(r);o(c)}catch(c){l(c)}});s.onAbort=t,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function vw(n,e={}){return Mn(n,"GET","/v2/passwordPolicy",ms(n,e))}const Ew=6;class Iw{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Ew,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Tw{constructor(e,t,s,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _d(this),this.idTokenSubscription=new _d(this),this.beforeStateQueue=new yw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ug,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$t(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ws.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await jo(this,{idToken:e}),s=await Tt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(mt(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,o=s?._redirectEventId,l=await this.tryRedirectSignIn(e);(!r||r===o)&&l?.user&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ho(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ew()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(mt(this.app))return Promise.reject(En(this));const t=e?Ze(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return mt(this.app)?Promise.reject(En(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return mt(this.app)?Promise.reject(En(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($t(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await vw(this),t=new Iw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new wr("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await gw(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$t(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await Ws.create(this,[$t(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(l,this,"internal-error"),l.then(()=>{o||r(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ag(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(mt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&JT(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ui(n){return Ze(n)}class _d{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ay(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ga={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ww(n){ga=n}function Sg(n){return ga.loadJS(n)}function Cw(){return ga.recaptchaEnterpriseScript}function Aw(){return ga.gapiScript}function Sw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Rw{constructor(){this.enterprise=new bw}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class bw{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Pw="recaptcha-enterprise",Rg="NO_RECAPTCHA";class kw{constructor(e){this.type=Pw,this.auth=ui(e)}async verify(e="verify",t=!1){async function s(r){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,l)=>{aw(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new ow(c);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,o(h.siteKey)}}).catch(c=>{l(c)})})}function i(r,o,l){const c=window.grecaptcha;dd(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(h=>{o(h)}).catch(()=>{o(Rg)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Rw().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(l=>{if(!t&&dd(window.grecaptcha))i(l,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Cw();c.length!==0&&(c+=l),Sg(c).then(()=>{i(l,r,o)}).catch(h=>{o(h)})}}).catch(l=>{o(l)})})}}async function yd(n,e,t,s=!1,i=!1){const r=new kw(n);let o;if(i)o=Rg;else try{o=await r.verify(t)}catch{o=await r.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return s?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function vd(n,e,t,s,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await yd(n,e,t,t==="getOobCode");return s(n,r)}else return s(n,e).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await yd(n,e,t,t==="getOobCode");return s(n,o)}else return Promise.reject(r)})}function Nw(n,e){const t=ra(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),r=t.getOptions();if(Cn(r,e??{}))return i;Ct(i,"already-initialized")}return t.initialize({options:e})}function Dw(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map($t);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Ow(n,e,t){const s=ui(n);U(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=bg(e),{host:o,port:l}=xw(e),c=l===null?"":`:${l}`,h={url:`${r}//${o}${c}/`},f=Object.freeze({host:o,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){U(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),U(Cn(h,s.config.emulator)&&Cn(f,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=h,s.emulatorConfig=f,s.settings.appVerificationDisabledForTesting=!0,xn(o)?(ac(`${r}//${o}${c}`),lc("Auth",!0)):Lw()}function bg(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function xw(n){const e=bg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:Ed(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:Ed(o)}}}function Ed(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Lw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Jc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ht("not implemented")}_getIdTokenResponse(e){return Ht("not implemented")}_linkToIdToken(e,t){return Ht("not implemented")}_getReauthenticationResolver(e){return Ht("not implemented")}}async function Mw(n,e){return Mn(n,"POST","/v1/accounts:signUp",e)}async function Vw(n,e){return pa(n,"POST","/v1/accounts:signInWithPassword",ms(n,e))}async function Fw(n,e){return pa(n,"POST","/v1/accounts:signInWithEmailLink",ms(n,e))}async function Uw(n,e){return pa(n,"POST","/v1/accounts:signInWithEmailLink",ms(n,e))}class _r extends Jc{constructor(e,t,s,i=null){super("password",s),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new _r(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new _r(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vd(e,t,"signInWithPassword",Vw);case"emailLink":return Fw(e,{email:this._email,oobCode:this._password});default:Ct(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vd(e,s,"signUpPassword",Mw);case"emailLink":return Uw(e,{idToken:t,email:this._email,oobCode:this._password});default:Ct(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function js(n,e){return pa(n,"POST","/v1/accounts:signInWithIdp",ms(n,e))}const Bw="http://localhost";class ds extends Jc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ds(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ct("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i,...r}=t;if(!s||!i)return null;const o=new ds(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return js(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,js(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,js(e,t)}buildRequest(){const e={requestUri:Bw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=oi(t)}return e}}function qw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Ww(n){const e=Wi(ji(n)).link,t=e?Wi(ji(e)).deep_link_id:null,s=Wi(ji(n)).deep_link_id;return(s?Wi(ji(s)).link:null)||s||t||e||n}class Xc{constructor(e){const t=Wi(ji(e)),s=t.apiKey??null,i=t.oobCode??null,r=qw(t.mode??null);U(s&&i&&r,"argument-error"),this.apiKey=s,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Ww(e);try{return new Xc(t)}catch{return null}}}class hi{constructor(){this.providerId=hi.PROVIDER_ID}static credential(e,t){return _r._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Xc.parseLink(t);return U(s,"argument-error"),_r._fromEmailAndCode(e,s.code,s.tenantId)}}hi.PROVIDER_ID="password";hi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";hi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Pg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class kr extends Pg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class un extends kr{constructor(){super("facebook.com")}static credential(e){return ds._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return un.credential(e.oauthAccessToken)}catch{return null}}}un.FACEBOOK_SIGN_IN_METHOD="facebook.com";un.PROVIDER_ID="facebook.com";class hn extends kr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ds._fromParams({providerId:hn.PROVIDER_ID,signInMethod:hn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return hn.credentialFromTaggedObject(e)}static credentialFromError(e){return hn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return hn.credential(t,s)}catch{return null}}}hn.GOOGLE_SIGN_IN_METHOD="google.com";hn.PROVIDER_ID="google.com";class dn extends kr{constructor(){super("github.com")}static credential(e){return ds._fromParams({providerId:dn.PROVIDER_ID,signInMethod:dn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dn.credentialFromTaggedObject(e)}static credentialFromError(e){return dn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dn.credential(e.oauthAccessToken)}catch{return null}}}dn.GITHUB_SIGN_IN_METHOD="github.com";dn.PROVIDER_ID="github.com";class fn extends kr{constructor(){super("twitter.com")}static credential(e,t){return ds._fromParams({providerId:fn.PROVIDER_ID,signInMethod:fn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fn.credentialFromTaggedObject(e)}static credentialFromError(e){return fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return fn.credential(t,s)}catch{return null}}}fn.TWITTER_SIGN_IN_METHOD="twitter.com";fn.PROVIDER_ID="twitter.com";class Js{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,i=!1){const r=await Tt._fromIdTokenResponse(e,s,i),o=Id(s);return new Js({user:r,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const i=Id(s);return new Js({user:e,providerId:i,_tokenResponse:s,operationType:t})}}function Id(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class $o extends Xt{constructor(e,t,s,i){super(t.code,t.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,$o.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,i){return new $o(e,t,s,i)}}function kg(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?$o._fromErrorAndOperation(n,r,e,s):r})}async function jw(n,e,t=!1){const s=await mr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Js._forOperation(n,"link",s)}async function Hw(n,e,t=!1){const{auth:s}=n;if(mt(s.app))return Promise.reject(En(s));const i="reauthenticate";try{const r=await mr(n,kg(s,i,e,n),t);U(r.idToken,s,"internal-error");const o=Qc(r.idToken);U(o,s,"internal-error");const{sub:l}=o;return U(n.uid===l,s,"user-mismatch"),Js._forOperation(n,i,r)}catch(r){throw r?.code==="auth/user-not-found"&&Ct(s,"user-mismatch"),r}}async function Ng(n,e,t=!1){if(mt(n.app))return Promise.reject(En(n));const s="signIn",i=await kg(n,s,e),r=await Js._fromIdTokenResponse(n,s,i);return t||await n._updateCurrentUser(r.user),r}async function $w(n,e){return Ng(ui(n),e)}async function zw(n){const e=ui(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Gw(n,e,t){return mt(n.app)?Promise.reject(En(n)):$w(Ze(n),hi.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&zw(n),s})}function Kw(n,e,t,s){return Ze(n).onIdTokenChanged(e,t,s)}function Qw(n,e,t){return Ze(n).beforeAuthStateChanged(e,t)}function Yw(n,e,t,s){return Ze(n).onAuthStateChanged(e,t,s)}const zo="__sak";class Dg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zo,"1"),this.storage.removeItem(zo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Jw=1e3,Xw=10;class Og extends Dg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Cg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),i=this.localCache[t];s!==i&&e(t,i,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);_w()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Xw):i()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},Jw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Og.type="LOCAL";const Zw=Og;class xg extends Dg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xg.type="SESSION";const Lg=xg;function eC(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ma{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const s=new ma(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:i,data:r}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async h=>h(t.origin,r)),c=await eC(l);t.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ma.receivers=[];function Zc(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class tC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((l,c)=>{const h=Zc("",20);i.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(f),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(m.data.response);break;default:clearTimeout(f),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function Lt(){return window}function nC(n){Lt().location.href=n}function Mg(){return typeof Lt().WorkerGlobalScope<"u"&&typeof Lt().importScripts=="function"}async function sC(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function iC(){return navigator?.serviceWorker?.controller||null}function rC(){return Mg()?self:null}const Vg="firebaseLocalStorageDb",oC=1,Go="firebaseLocalStorage",Fg="fbase_key";class Nr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function _a(n,e){return n.transaction([Go],e?"readwrite":"readonly").objectStore(Go)}function aC(){const n=indexedDB.deleteDatabase(Vg);return new Nr(n).toPromise()}function Vl(){const n=indexedDB.open(Vg,oC);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Go,{keyPath:Fg})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Go)?e(s):(s.close(),await aC(),e(await Vl()))})})}async function Td(n,e,t){const s=_a(n,!0).put({[Fg]:e,value:t});return new Nr(s).toPromise()}async function lC(n,e){const t=_a(n,!1).get(e),s=await new Nr(t).toPromise();return s===void 0?null:s.value}function wd(n,e){const t=_a(n,!0).delete(e);return new Nr(t).toPromise()}const cC=800,uC=3;class Ug{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Vl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>uC)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ma._getInstance(rC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await sC(),!this.activeServiceWorker)return;this.sender=new tC(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||iC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Vl();return await Td(e,zo,"1"),await wd(e,zo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>Td(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>lC(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>wd(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=_a(i,!1).getAll();return new Nr(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),cC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ug.type="LOCAL";const hC=Ug;new Pr(3e4,6e4);function dC(n,e){return e?$t(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class eu extends Jc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return js(e,this._buildIdpRequest())}_linkToIdToken(e,t){return js(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return js(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fC(n){return Ng(n.auth,new eu(n),n.bypassAuthState)}function pC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),Hw(t,new eu(n),n.bypassAuthState)}async function gC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),jw(t,new eu(n),n.bypassAuthState)}class Bg{constructor(e,t,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:i,tenantId:r,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fC;case"linkViaPopup":case"linkViaRedirect":return gC;case"reauthViaPopup":case"reauthViaRedirect":return pC;default:Ct(this.auth,"internal-error")}}resolve(e){Yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const mC=new Pr(2e3,1e4);class Vs extends Bg{constructor(e,t,s,i,r){super(e,t,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Vs.currentPopupAction&&Vs.currentPopupAction.cancel(),Vs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){Yt(this.filter.length===1,"Popup operations only handle one event");const e=Zc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(xt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vs.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,mC.get())};e()}}Vs.currentPopupAction=null;const _C="pendingRedirect",yo=new Map;class yC extends Bg{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=yo.get(this.auth._key());if(!e){try{const s=await vC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}yo.set(this.auth._key(),e)}return this.bypassAuthState||yo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function vC(n,e){const t=TC(e),s=IC(n);if(!await s._isAvailable())return!1;const i=await s._get(t)==="true";return await s._remove(t),i}function EC(n,e){yo.set(n._key(),e)}function IC(n){return $t(n._redirectPersistence)}function TC(n){return _o(_C,n.config.apiKey,n.name)}async function wC(n,e,t=!1){if(mt(n.app))return Promise.reject(En(n));const s=ui(n),i=dC(s,e),o=await new yC(s,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const CC=600*1e3;class AC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!SC(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!qg(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(xt(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=CC&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cd(e))}saveEventToCache(e){this.cachedEventUids.add(Cd(e)),this.lastProcessedEventTime=Date.now()}}function Cd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function qg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function SC(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qg(n);default:return!1}}async function RC(n,e={}){return Mn(n,"GET","/v1/projects",e)}const bC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,PC=/^https?/;async function kC(n){if(n.config.emulator)return;const{authorizedDomains:e}=await RC(n);for(const t of e)try{if(NC(t))return}catch{}Ct(n,"unauthorized-domain")}function NC(n){const e=Ll(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!PC.test(t))return!1;if(bC.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}const DC=new Pr(3e4,6e4);function Ad(){const n=Lt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function OC(n){return new Promise((e,t)=>{function s(){Ad(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ad(),t(xt(n,"network-request-failed"))},timeout:DC.get()})}if(Lt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Lt().gapi?.load)s();else{const i=Sw("iframefcb");return Lt()[i]=()=>{gapi.load?s():t(xt(n,"network-request-failed"))},Sg(`${Aw()}?onload=${i}`).catch(r=>t(r))}}).catch(e=>{throw vo=null,e})}let vo=null;function xC(n){return vo=vo||OC(n),vo}const LC=new Pr(5e3,15e3),MC="__/auth/iframe",VC="emulator/auth/iframe",FC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},UC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function BC(n){const e=n.config;U(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Kc(e,VC):`https://${n.config.authDomain}/${MC}`,s={apiKey:e.apiKey,appName:n.name,v:ps},i=UC.get(n.config.apiHost);i&&(s.eid=i);const r=n._getFrameworks();return r.length&&(s.fw=r.join(",")),`${t}?${oi(s).slice(1)}`}async function qC(n){const e=await xC(n),t=Lt().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:BC(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:FC,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=xt(n,"network-request-failed"),l=Lt().setTimeout(()=>{r(o)},LC.get());function c(){Lt().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{r(o)})}))}const WC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jC=500,HC=600,$C="_blank",zC="http://localhost";class Sd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GC(n,e,t,s=jC,i=HC){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c={...WC,width:s.toString(),height:i.toString(),top:r,left:o},h=Xe().toLowerCase();t&&(l=vg(h)?$C:t),_g(h)&&(e=e||zC,c.scrollbars="yes");const f=Object.entries(c).reduce((m,[A,S])=>`${m}${A}=${S},`,"");if(mw(h)&&l!=="_self")return KC(e||"",l),new Sd(null);const p=window.open(e||"",l,f);U(p,n,"popup-blocked");try{p.focus()}catch{}return new Sd(p)}function KC(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const QC="__/auth/handler",YC="emulator/auth/handler",JC=encodeURIComponent("fac");async function Rd(n,e,t,s,i,r){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:ps,eventId:i};if(e instanceof Pg){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",_l(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))o[f]=p}if(e instanceof kr){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await n._getAppCheckToken(),h=c?`#${JC}=${encodeURIComponent(c)}`:"";return`${XC(n)}?${oi(l).slice(1)}${h}`}function XC({config:n}){return n.emulator?Kc(n,YC):`https://${n.authDomain}/${QC}`}const ll="webStorageSupport";class ZC{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Lg,this._completeRedirectFn=wC,this._overrideRedirectResult=EC}async _openPopup(e,t,s,i){Yt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const r=await Rd(e,t,s,Ll(),i);return GC(e,r,Zc())}async _openRedirect(e,t,s,i){await this._originValidation(e);const r=await Rd(e,t,s,Ll(),i);return nC(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:r}=this.eventManagers[t];return i?Promise.resolve(i):(Yt(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await qC(e),s=new AC(e);return t.register("authEvent",i=>(U(i?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ll,{type:ll},i=>{const r=i?.[0]?.[ll];r!==void 0&&t(!!r),Ct(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=kC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Cg()||yg()||Yc()}}const eA=ZC;var bd="@firebase/auth",Pd="1.12.0";class tA{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function nA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function sA(n){as(new An("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;U(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ag(n)},h=new Tw(s,i,r,c);return Dw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),as(new An("auth-internal",e=>{const t=ui(e.getProvider("auth").getImmediate());return(s=>new tA(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ot(bd,Pd,nA(n)),Ot(bd,Pd,"esm2020")}const iA=300,rA=Uf("authIdTokenMaxAge")||iA;let kd=null;const oA=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>rA)return;const i=t?.token;kd!==i&&(kd=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function aA(n=dc()){const e=ra(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Nw(n,{popupRedirectResolver:eA,persistence:[hC,Zw,Lg]}),s=Uf("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=oA(r.toString());Qw(t,o,()=>o(t.currentUser)),Kw(t,l=>o(l))}}const i=Mf("auth");return i&&Ow(t,`http://${i}`),t}function lA(){return document.getElementsByTagName("head")?.[0]??document}ww({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=i=>{const r=xt("internal-error");r.customData=i,t(r)},s.type="text/javascript",s.charset="UTF-8",lA().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});sA("Browser");var Nd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var In,Wg;(function(){var n;function e(E,_){function v(){}v.prototype=_.prototype,E.F=_.prototype,E.prototype=new v,E.prototype.constructor=E,E.D=function(T,I,C){for(var y=Array(arguments.length-2),Be=2;Be<arguments.length;Be++)y[Be-2]=arguments[Be];return _.prototype[I].apply(T,y)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,v){v||(v=0);const T=Array(16);if(typeof _=="string")for(var I=0;I<16;++I)T[I]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(I=0;I<16;++I)T[I]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=E.g[0],v=E.g[1],I=E.g[2];let C=E.g[3],y;y=_+(C^v&(I^C))+T[0]+3614090360&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[1]+3905402710&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[2]+606105819&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[3]+3250441966&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[4]+4118548399&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[5]+1200080426&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[6]+2821735955&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[7]+4249261313&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[8]+1770035416&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[9]+2336552879&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[10]+4294925233&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[11]+2304563134&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[12]+1804603682&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[13]+4254626195&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[14]+2792965006&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[15]+1236535329&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(I^C&(v^I))+T[1]+4129170786&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[6]+3225465664&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[11]+643717713&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[0]+3921069994&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[5]+3593408605&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[10]+38016083&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[15]+3634488961&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[4]+3889429448&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[9]+568446438&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[14]+3275163606&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[3]+4107603335&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[8]+1163531501&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[13]+2850285829&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[2]+4243563512&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[7]+1735328473&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[12]+2368359562&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(v^I^C)+T[5]+4294588738&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[8]+2272392833&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[11]+1839030562&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[14]+4259657740&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[1]+2763975236&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[4]+1272893353&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[7]+4139469664&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[10]+3200236656&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[13]+681279174&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[0]+3936430074&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[3]+3572445317&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[6]+76029189&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[9]+3654602809&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[12]+3873151461&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[15]+530742520&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[2]+3299628645&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(I^(v|~C))+T[0]+4096336452&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[7]+1126891415&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[14]+2878612391&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[5]+4237533241&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[12]+1700485571&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[3]+2399980690&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[10]+4293915773&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[1]+2240044497&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[8]+1873313359&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[15]+4264355552&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[6]+2734768916&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[13]+1309151649&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[4]+4149444226&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[11]+3174756917&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[2]+718787259&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+C&4294967295}s.prototype.v=function(E,_){_===void 0&&(_=E.length);const v=_-this.blockSize,T=this.C;let I=this.h,C=0;for(;C<_;){if(I==0)for(;C<=v;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(T[I++]=E.charCodeAt(C++),I==this.blockSize){i(this,T),I=0;break}}else for(;C<_;)if(T[I++]=E[C++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=_},s.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;_=this.o*8;for(var v=E.length-8;v<E.length;++v)E[v]=_&255,_/=256;for(this.v(E),E=Array(16),_=0,v=0;v<4;++v)for(let T=0;T<32;T+=8)E[_++]=this.g[v]>>>T&255;return E};function r(E,_){var v=l;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=_(E)}function o(E,_){this.h=_;const v=[];let T=!0;for(let I=E.length-1;I>=0;I--){const C=E[I]|0;T&&C==_||(v[I]=C,T=!1)}this.g=v}var l={};function c(E){return-128<=E&&E<128?r(E,function(_){return new o([_|0],_<0?-1:0)}):new o([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return x(h(-E));const _=[];let v=1;for(let T=0;E>=v;T++)_[T]=E/v|0,v*=4294967296;return new o(_,0)}function f(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return x(f(E.substring(1),_));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=h(Math.pow(_,8));let T=p;for(let C=0;C<E.length;C+=8){var I=Math.min(8,E.length-C);const y=parseInt(E.substring(C,C+I),_);I<8?(I=h(Math.pow(_,I)),T=T.j(I).add(h(y))):(T=T.j(v),T=T.add(h(y)))}return T}var p=c(0),m=c(1),A=c(16777216);n=o.prototype,n.m=function(){if(k(this))return-x(this).m();let E=0,_=1;for(let v=0;v<this.g.length;v++){const T=this.i(v);E+=(T>=0?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(k(this))return"-"+x(this).toString(E);const _=h(Math.pow(E,6));var v=this;let T="";for(;;){const I=j(v,_).g;v=W(v,I.j(_));let C=((v.g.length>0?v.g[0]:v.h)>>>0).toString(E);if(v=I,S(v))return C+T;for(;C.length<6;)C="0"+C;T=C+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(let _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=W(this,E),k(E)?-1:S(E)?0:1};function x(E){const _=E.g.length,v=[];for(let T=0;T<_;T++)v[T]=~E.g[T];return new o(v,~E.h).add(m)}n.abs=function(){return k(this)?x(this):this},n.add=function(E){const _=Math.max(this.g.length,E.g.length),v=[];let T=0;for(let I=0;I<=_;I++){let C=T+(this.i(I)&65535)+(E.i(I)&65535),y=(C>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=y>>>16,C&=65535,y&=65535,v[I]=y<<16|C}return new o(v,v[v.length-1]&-2147483648?-1:0)};function W(E,_){return E.add(x(_))}n.j=function(E){if(S(this)||S(E))return p;if(k(this))return k(E)?x(this).j(x(E)):x(x(this).j(E));if(k(E))return x(this.j(x(E)));if(this.l(A)<0&&E.l(A)<0)return h(this.m()*E.m());const _=this.g.length+E.g.length,v=[];for(var T=0;T<2*_;T++)v[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<E.g.length;I++){const C=this.i(T)>>>16,y=this.i(T)&65535,Be=E.i(I)>>>16,Ut=E.i(I)&65535;v[2*T+2*I]+=y*Ut,B(v,2*T+2*I),v[2*T+2*I+1]+=C*Ut,B(v,2*T+2*I+1),v[2*T+2*I+1]+=y*Be,B(v,2*T+2*I+1),v[2*T+2*I+2]+=C*Be,B(v,2*T+2*I+2)}for(E=0;E<_;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=_;E<2*_;E++)v[E]=0;return new o(v,0)};function B(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function K(E,_){this.g=E,this.h=_}function j(E,_){if(S(_))throw Error("division by zero");if(S(E))return new K(p,p);if(k(E))return _=j(x(E),_),new K(x(_.g),x(_.h));if(k(_))return _=j(E,x(_)),new K(x(_.g),_.h);if(E.g.length>30){if(k(E)||k(_))throw Error("slowDivide_ only works with positive integers.");for(var v=m,T=_;T.l(E)<=0;)v=ae(v),T=ae(T);var I=le(v,1),C=le(T,1);for(T=le(T,2),v=le(v,2);!S(T);){var y=C.add(T);y.l(E)<=0&&(I=I.add(v),C=y),T=le(T,1),v=le(v,1)}return _=W(E,I.j(_)),new K(I,_)}for(I=p;E.l(_)>=0;){for(v=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(v)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),C=h(v),y=C.j(_);k(y)||y.l(E)>0;)v-=T,C=h(v),y=C.j(_);S(C)&&(C=m),I=I.add(C),E=W(E,y)}return new K(I,E)}n.B=function(E){return j(this,E).h},n.and=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)&E.i(T);return new o(v,this.h&E.h)},n.or=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)|E.i(T);return new o(v,this.h|E.h)},n.xor=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)^E.i(T);return new o(v,this.h^E.h)};function ae(E){const _=E.g.length+1,v=[];for(let T=0;T<_;T++)v[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(v,E.h)}function le(E,_){const v=_>>5;_%=32;const T=E.g.length-v,I=[];for(let C=0;C<T;C++)I[C]=_>0?E.i(C+v)>>>_|E.i(C+v+1)<<32-_:E.i(C+v);return new o(I,E.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Wg=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,In=o}).apply(typeof Nd<"u"?Nd:typeof self<"u"?self:typeof window<"u"?window:{});var ao=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var jg,$i,Hg,Eo,Fl,$g,zg,Gg;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ao=="object"&&ao];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function i(a,u){if(u)e:{var d=s;a=a.split(".");for(var g=0;g<a.length-1;g++){var w=a[g];if(!(w in d))break e;d=d[w]}a=a[a.length-1],g=d[a],u=u(g),u!=g&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(u){var d=[],g;for(g in u)Object.prototype.hasOwnProperty.call(u,g)&&d.push([g,u[g]]);return d}});var r=r||{},o=this||self;function l(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function c(a,u,d){return a.call.apply(a.bind,arguments)}function h(a,u,d){return h=c,h.apply(null,arguments)}function f(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function p(a,u){function d(){}d.prototype=u.prototype,a.Z=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(g,w,R){for(var O=Array(arguments.length-2),G=2;G<arguments.length;G++)O[G-2]=arguments[G];return u.prototype[w].apply(g,O)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function A(a){const u=a.length;if(u>0){const d=Array(u);for(let g=0;g<u;g++)d[g]=a[g];return d}return[]}function S(a,u){for(let g=1;g<arguments.length;g++){const w=arguments[g];var d=typeof w;if(d=d!="object"?d:w?Array.isArray(w)?"array":d:"null",d=="array"||d=="object"&&typeof w.length=="number"){d=a.length||0;const R=w.length||0;a.length=d+R;for(let O=0;O<R;O++)a[d+O]=w[O]}else a.push(w)}}class k{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function x(a){o.setTimeout(()=>{throw a},0)}function W(){var a=E;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class B{constructor(){this.h=this.g=null}add(u,d){const g=K.get();g.set(u,d),this.h?this.h.next=g:this.g=g,this.h=g}}var K=new k(()=>new j,a=>a.reset());class j{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let ae,le=!1,E=new B,_=()=>{const a=Promise.resolve(void 0);ae=()=>{a.then(v)}};function v(){for(var a;a=W();){try{a.h.call(a.g)}catch(d){x(d)}var u=K;u.j(a),u.h<100&&(u.h++,a.next=u.g,u.g=a)}le=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var C=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,u),o.removeEventListener("test",d,u)}catch{}return a})();function y(a){return/^[\s\xa0]*$/.test(a)}function Be(a,u){I.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,u)}p(Be,I),Be.prototype.init=function(a,u){const d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget,u||(d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement)),this.relatedTarget=u,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&Be.Z.h.call(this)},Be.prototype.h=function(){Be.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ut="closure_listenable_"+(Math.random()*1e6|0),Pa=0;function ka(a,u,d,g,w){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!g,this.ha=w,this.key=++Pa,this.da=this.fa=!1}function ys(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Vn(a,u,d){for(const g in a)u.call(d,a[g],g,a)}function vs(a,u){for(const d in a)u.call(void 0,a[d],d,a)}function gi(a){const u={};for(const d in a)u[d]=a[d];return u}const mi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fn(a,u){let d,g;for(let w=1;w<arguments.length;w++){g=arguments[w];for(d in g)a[d]=g[d];for(let R=0;R<mi.length;R++)d=mi[R],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function Un(a){this.src=a,this.g={},this.h=0}Un.prototype.add=function(a,u,d,g,w){const R=a.toString();a=this.g[R],a||(a=this.g[R]=[],this.h++);const O=Is(a,u,g,w);return O>-1?(u=a[O],d||(u.fa=!1)):(u=new ka(u,this.src,R,!!g,w),u.fa=d,a.push(u)),u};function Es(a,u){const d=u.type;if(d in a.g){var g=a.g[d],w=Array.prototype.indexOf.call(g,u,void 0),R;(R=w>=0)&&Array.prototype.splice.call(g,w,1),R&&(ys(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Is(a,u,d,g){for(let w=0;w<a.length;++w){const R=a[w];if(!R.da&&R.listener==u&&R.capture==!!d&&R.ha==g)return w}return-1}var Bn="closure_lm_"+(Math.random()*1e6|0),qn={};function Ts(a,u,d,g,w){if(Array.isArray(u)){for(let R=0;R<u.length;R++)Ts(a,u[R],d,g,w);return null}return d=Ur(d),a&&a[Ut]?a.J(u,d,l(g)?!!g.capture:!1,w):_i(a,u,d,!1,g,w)}function _i(a,u,d,g,w,R){if(!u)throw Error("Invalid event type");const O=l(w)?!!w.capture:!!w;let G=jn(a);if(G||(a[Bn]=G=new Un(a)),d=G.add(u,d,g,O,R),d.proxy)return d;if(g=Vr(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)C||(w=O),w===void 0&&(w=!1),a.addEventListener(u.toString(),g,w);else if(a.attachEvent)a.attachEvent(yi(u.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Vr(){function a(d){return u.call(a.src,a.listener,d)}const u=vi;return a}function Fr(a,u,d,g,w){if(Array.isArray(u))for(var R=0;R<u.length;R++)Fr(a,u[R],d,g,w);else g=l(g)?!!g.capture:!!g,d=Ur(d),a&&a[Ut]?(a=a.i,R=String(u).toString(),R in a.g&&(u=a.g[R],d=Is(u,d,g,w),d>-1&&(ys(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete a.g[R],a.h--)))):a&&(a=jn(a))&&(u=a.g[u.toString()],a=-1,u&&(a=Is(u,d,g,w)),(d=a>-1?u[a]:null)&&Wn(d))}function Wn(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[Ut])Es(u.i,a);else{var d=a.type,g=a.proxy;u.removeEventListener?u.removeEventListener(d,g,a.capture):u.detachEvent?u.detachEvent(yi(d),g):u.addListener&&u.removeListener&&u.removeListener(g),(d=jn(u))?(Es(d,a),d.h==0&&(d.src=null,u[Bn]=null)):ys(a)}}}function yi(a){return a in qn?qn[a]:qn[a]="on"+a}function vi(a,u){if(a.da)a=!0;else{u=new Be(u,this);const d=a.listener,g=a.ha||a.src;a.fa&&Wn(a),a=d.call(g,u)}return a}function jn(a){return a=a[Bn],a instanceof Un?a:null}var ws="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ur(a){return typeof a=="function"?a:(a[ws]||(a[ws]=function(u){return a.handleEvent(u)}),a[ws])}function Le(){T.call(this),this.i=new Un(this),this.M=this,this.G=null}p(Le,T),Le.prototype[Ut]=!0,Le.prototype.removeEventListener=function(a,u,d,g){Fr(this,a,u,d,g)};function qe(a,u){var d,g=a.G;if(g)for(d=[];g;g=g.G)d.push(g);if(a=a.M,g=u.type||u,typeof u=="string")u=new I(u,a);else if(u instanceof I)u.target=u.target||a;else{var w=u;u=new I(g,a),Fn(u,w)}w=!0;let R,O;if(d)for(O=d.length-1;O>=0;O--)R=u.g=d[O],w=Cs(R,g,!0,u)&&w;if(R=u.g=a,w=Cs(R,g,!0,u)&&w,w=Cs(R,g,!1,u)&&w,d)for(O=0;O<d.length;O++)R=u.g=d[O],w=Cs(R,g,!1,u)&&w}Le.prototype.N=function(){if(Le.Z.N.call(this),this.i){var a=this.i;for(const u in a.g){const d=a.g[u];for(let g=0;g<d.length;g++)ys(d[g]);delete a.g[u],a.h--}}this.G=null},Le.prototype.J=function(a,u,d,g){return this.i.add(String(a),u,!1,d,g)},Le.prototype.K=function(a,u,d,g){return this.i.add(String(a),u,!0,d,g)};function Cs(a,u,d,g){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();let w=!0;for(let R=0;R<u.length;++R){const O=u[R];if(O&&!O.da&&O.capture==d){const G=O.listener,ke=O.ha||O.src;O.fa&&Es(a.i,O),w=G.call(ke,g)!==!1&&w}}return w&&!g.defaultPrevented}function Br(a,u){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:o.setTimeout(a,u||0)}function qr(a){a.g=Br(()=>{a.g=null,a.i&&(a.i=!1,qr(a))},a.l);const u=a.h;a.h=null,a.m.apply(null,u)}class Wr extends T{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:qr(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Hn(a){T.call(this),this.h=a,this.g={}}p(Hn,T);var jr=[];function Hr(a){Vn(a.g,function(u,d){this.g.hasOwnProperty(d)&&Wn(u)},a),a.g={}}Hn.prototype.N=function(){Hn.Z.N.call(this),Hr(this)},Hn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var L=o.JSON.stringify,Q=o.JSON.parse,de=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Te(){}function nt(){}var ze={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ge(){I.call(this,"d")}p(Ge,I);function yt(){I.call(this,"c")}p(yt,I);var Se={},As=null;function At(){return As=As||new Le}Se.Ia="serverreachability";function at(a){I.call(this,Se.Ia,a)}p(at,I);function $n(a){const u=At();qe(u,new at(u))}Se.STAT_EVENT="statevent";function $r(a,u){I.call(this,Se.STAT_EVENT,a),this.stat=u}p($r,I);function We(a){const u=At();qe(u,new $r(u,a))}Se.Ja="timingevent";function zr(a,u){I.call(this,Se.Ja,a),this.size=u}p(zr,I);function zn(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},u)}function fe(){this.g=!0}fe.prototype.ua=function(){this.g=!1};function we(a,u,d,g,w,R){a.info(function(){if(a.g)if(R){var O="",G=R.split("&");for(let ce=0;ce<G.length;ce++){var ke=G[ce].split("=");if(ke.length>1){const Me=ke[0];ke=ke[1];const Rt=Me.split("_");O=Rt.length>=2&&Rt[1]=="type"?O+(Me+"="+ke+"&"):O+(Me+"=redacted&")}}}else O=null;else O=R;return"XMLHTTP REQ ("+g+") [attempt "+w+"]: "+u+`
`+d+`
`+O})}function lt(a,u,d,g,w,R,O){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+w+"]: "+u+`
`+d+`
`+R+" "+O})}function ct(a,u,d,g){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+Gn(a,d)+(g?" "+g:"")})}function ut(a,u){a.info(function(){return"TIMEOUT: "+u})}fe.prototype.info=function(){};function Gn(a,u){if(!a.g)return u;if(!u)return null;try{const R=JSON.parse(u);if(R){for(a=0;a<R.length;a++)if(Array.isArray(R[a])){var d=R[a];if(!(d.length<2)){var g=d[1];if(Array.isArray(g)&&!(g.length<1)){var w=g[0];if(w!="noop"&&w!="stop"&&w!="close")for(let O=1;O<g.length;O++)g[O]=""}}}}return L(R)}catch{return u}}var gt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Kn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ei;function Ii(){}p(Ii,Te),Ii.prototype.g=function(){return new XMLHttpRequest},Ei=new Ii;function Ti(a){return encodeURIComponent(String(a))}function Ym(a){var u=1;a=a.split(":");const d=[];for(;u>0&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function en(a,u,d,g){this.j=a,this.i=u,this.l=d,this.S=g||1,this.V=new Hn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Su}function Su(){this.i=null,this.g="",this.h=!1}var Ru={},Na={};function Da(a,u,d){a.M=1,a.A=Kr(St(u)),a.u=d,a.R=!0,bu(a,null)}function bu(a,u){a.F=Date.now(),Gr(a),a.B=St(a.A);var d=a.B,g=a.S;Array.isArray(g)||(g=[String(g)]),qu(d.i,"t",g),a.C=0,d=a.j.L,a.h=new Su,a.g=rh(a.j,d?u:null,!a.u),a.P>0&&(a.O=new Wr(h(a.Y,a,a.g),a.P)),u=a.V,d=a.g,g=a.ba;var w="readystatechange";Array.isArray(w)||(w&&(jr[0]=w.toString()),w=jr);for(let R=0;R<w.length;R++){const O=Ts(d,w[R],g||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=a.J?gi(a.J):{},a.u?(a.v||(a.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,u)):(a.v="GET",a.g.ea(a.B,a.v,null,u)),$n(),we(a.i,a.v,a.B,a.l,a.S,a.u)}en.prototype.ba=function(a){a=a.target;const u=this.O;u&&sn(a)==3?u.j():this.Y(a)},en.prototype.Y=function(a){try{if(a==this.g)e:{const G=sn(this.g),ke=this.g.ya(),ce=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||Ku(this.g)))){this.K||G!=4||ke==7||(ke==8||ce<=0?$n(3):$n(2)),Oa(this);var u=this.g.ca();this.X=u;var d=Jm(this);if(this.o=u==200,lt(this.i,this.v,this.B,this.l,this.S,G,u),this.o){if(this.U&&!this.L){t:{if(this.g){var g,w=this.g;if((g=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(g)){var R=g;break t}}R=null}if(a=R)ct(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,xa(this,a);else{this.o=!1,this.m=3,We(12),Qn(this),wi(this);break e}}if(this.R){a=!0;let Me;for(;!this.K&&this.C<d.length;)if(Me=Xm(this,d),Me==Na){G==4&&(this.m=4,We(14),a=!1),ct(this.i,this.l,null,"[Incomplete Response]");break}else if(Me==Ru){this.m=4,We(15),ct(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else ct(this.i,this.l,Me,null),xa(this,Me);if(Pu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||d.length!=0||this.h.h||(this.m=1,We(16),a=!1),this.o=this.o&&a,!a)ct(this.i,this.l,d,"[Invalid Chunked Response]"),Qn(this),wi(this);else if(d.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Wa(O),O.P=!0,We(11))}}else ct(this.i,this.l,d,null),xa(this,d);G==4&&Qn(this),this.o&&!this.K&&(G==4?th(this.j,this):(this.o=!1,Gr(this)))}else d_(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,We(12)):(this.m=0,We(13)),Qn(this),wi(this)}}}catch{}};function Jm(a){if(!Pu(a))return a.g.la();const u=Ku(a.g);if(u==="")return"";let d="";const g=u.length,w=sn(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return Qn(a),wi(a),"";a.h.i=new o.TextDecoder}for(let R=0;R<g;R++)a.h.h=!0,d+=a.h.i.decode(u[R],{stream:!(w&&R==g-1)});return u.length=0,a.h.g+=d,a.C=0,a.h.g}function Pu(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function Xm(a,u){var d=a.C,g=u.indexOf(`
`,d);return g==-1?Na:(d=Number(u.substring(d,g)),isNaN(d)?Ru:(g+=1,g+d>u.length?Na:(u=u.slice(g,g+d),a.C=g+d,u)))}en.prototype.cancel=function(){this.K=!0,Qn(this)};function Gr(a){a.T=Date.now()+a.H,ku(a,a.H)}function ku(a,u){if(a.D!=null)throw Error("WatchDog timer not null");a.D=zn(h(a.aa,a),u)}function Oa(a){a.D&&(o.clearTimeout(a.D),a.D=null)}en.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(ut(this.i,this.B),this.M!=2&&($n(),We(17)),Qn(this),this.m=2,wi(this)):ku(this,this.T-a)};function wi(a){a.j.I==0||a.K||th(a.j,a)}function Qn(a){Oa(a);var u=a.O;u&&typeof u.dispose=="function"&&u.dispose(),a.O=null,Hr(a.V),a.g&&(u=a.g,a.g=null,u.abort(),u.dispose())}function xa(a,u){try{var d=a.j;if(d.I!=0&&(d.g==a||La(d.h,a))){if(!a.L&&La(d.h,a)&&d.I==3){try{var g=d.Ba.g.parse(u)}catch{g=null}if(Array.isArray(g)&&g.length==3){var w=g;if(w[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)Zr(d),Jr(d);else break e;qa(d),We(18)}}else d.xa=w[1],0<d.xa-d.K&&w[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=zn(h(d.Va,d),6e3));Ou(d.h)<=1&&d.ta&&(d.ta=void 0)}else Jn(d,11)}else if((a.L||d.g==a)&&Zr(d),!y(u))for(w=d.Ba.g.parse(u),u=0;u<w.length;u++){let ce=w[u];const Me=ce[0];if(!(Me<=d.K))if(d.K=Me,ce=ce[1],d.I==2)if(ce[0]=="c"){d.M=ce[1],d.ba=ce[2];const Rt=ce[3];Rt!=null&&(d.ka=Rt,d.j.info("VER="+d.ka));const Xn=ce[4];Xn!=null&&(d.za=Xn,d.j.info("SVER="+d.za));const rn=ce[5];rn!=null&&typeof rn=="number"&&rn>0&&(g=1.5*rn,d.O=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const on=a.g;if(on){const to=on.g?on.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(to){var R=g.h;R.g||to.indexOf("spdy")==-1&&to.indexOf("quic")==-1&&to.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Ma(R,R.h),R.h=null))}if(g.G){const ja=on.g?on.g.getResponseHeader("X-HTTP-Session-Id"):null;ja&&(g.wa=ja,ge(g.J,g.G,ja))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),g=d;var O=a;if(g.na=ih(g,g.L?g.ba:null,g.W),O.L){xu(g.h,O);var G=O,ke=g.O;ke&&(G.H=ke),G.D&&(Oa(G),Gr(G)),g.g=O}else Zu(g);d.i.length>0&&Xr(d)}else ce[0]!="stop"&&ce[0]!="close"||Jn(d,7);else d.I==3&&(ce[0]=="stop"||ce[0]=="close"?ce[0]=="stop"?Jn(d,7):Ba(d):ce[0]!="noop"&&d.l&&d.l.qa(ce),d.A=0)}}$n(4)}catch{}}var Zm=class{constructor(a,u){this.g=a,this.map=u}};function Nu(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Du(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Ou(a){return a.h?1:a.g?a.g.size:0}function La(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function Ma(a,u){a.g?a.g.add(u):a.h=u}function xu(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}Nu.prototype.cancel=function(){if(this.i=Lu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Lu(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let u=a.i;for(const d of a.g.values())u=u.concat(d.G);return u}return A(a.i)}var Mu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e_(a,u){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const g=a[d].indexOf("=");let w,R=null;g>=0?(w=a[d].substring(0,g),R=a[d].substring(g+1)):w=a[d],u(w,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function tn(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;a instanceof tn?(this.l=a.l,Ci(this,a.j),this.o=a.o,this.g=a.g,Ai(this,a.u),this.h=a.h,Va(this,Wu(a.i)),this.m=a.m):a&&(u=String(a).match(Mu))?(this.l=!1,Ci(this,u[1]||"",!0),this.o=Si(u[2]||""),this.g=Si(u[3]||"",!0),Ai(this,u[4]),this.h=Si(u[5]||"",!0),Va(this,u[6]||"",!0),this.m=Si(u[7]||"")):(this.l=!1,this.i=new bi(null,this.l))}tn.prototype.toString=function(){const a=[];var u=this.j;u&&a.push(Ri(u,Vu,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(Ri(u,Vu,!0),"@"),a.push(Ti(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Ri(d,d.charAt(0)=="/"?s_:n_,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Ri(d,r_)),a.join("")},tn.prototype.resolve=function(a){const u=St(this);let d=!!a.j;d?Ci(u,a.j):d=!!a.o,d?u.o=a.o:d=!!a.g,d?u.g=a.g:d=a.u!=null;var g=a.h;if(d)Ai(u,a.u);else if(d=!!a.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var w=u.h.lastIndexOf("/");w!=-1&&(g=u.h.slice(0,w+1)+g)}if(w=g,w==".."||w==".")g="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){g=w.lastIndexOf("/",0)==0,w=w.split("/");const R=[];for(let O=0;O<w.length;){const G=w[O++];G=="."?g&&O==w.length&&R.push(""):G==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),g&&O==w.length&&R.push("")):(R.push(G),g=!0)}g=R.join("/")}else g=w}return d?u.h=g:d=a.i.toString()!=="",d?Va(u,Wu(a.i)):d=!!a.m,d&&(u.m=a.m),u};function St(a){return new tn(a)}function Ci(a,u,d){a.j=d?Si(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function Ai(a,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);a.u=u}else a.u=null}function Va(a,u,d){u instanceof bi?(a.i=u,o_(a.i,a.l)):(d||(u=Ri(u,i_)),a.i=new bi(u,a.l))}function ge(a,u,d){a.i.set(u,d)}function Kr(a){return ge(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function Si(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ri(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,t_),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function t_(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Vu=/[#\/\?@]/g,n_=/[#\?:]/g,s_=/[#\?]/g,i_=/[#\?@]/g,r_=/#/g;function bi(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function Yn(a){a.g||(a.g=new Map,a.h=0,a.i&&e_(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=bi.prototype,n.add=function(a,u){Yn(this),this.i=null,a=Ss(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function Fu(a,u){Yn(a),u=Ss(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function Uu(a,u){return Yn(a),u=Ss(a,u),a.g.has(u)}n.forEach=function(a,u){Yn(this),this.g.forEach(function(d,g){d.forEach(function(w){a.call(u,w,g,this)},this)},this)};function Bu(a,u){Yn(a);let d=[];if(typeof u=="string")Uu(a,u)&&(d=d.concat(a.g.get(Ss(a,u))));else for(a=Array.from(a.g.values()),u=0;u<a.length;u++)d=d.concat(a[u]);return d}n.set=function(a,u){return Yn(this),this.i=null,a=Ss(this,a),Uu(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},n.get=function(a,u){return a?(a=Bu(this,a),a.length>0?String(a[0]):u):u};function qu(a,u,d){Fu(a,u),d.length>0&&(a.i=null,a.g.set(Ss(a,u),A(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],u=Array.from(this.g.keys());for(let g=0;g<u.length;g++){var d=u[g];const w=Ti(d);d=Bu(this,d);for(let R=0;R<d.length;R++){let O=w;d[R]!==""&&(O+="="+Ti(d[R])),a.push(O)}}return this.i=a.join("&")};function Wu(a){const u=new bi;return u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),u}function Ss(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function o_(a,u){u&&!a.j&&(Yn(a),a.i=null,a.g.forEach(function(d,g){const w=g.toLowerCase();g!=w&&(Fu(this,g),qu(this,w,d))},a)),a.j=u}function a_(a,u){const d=new fe;if(o.Image){const g=new Image;g.onload=f(nn,d,"TestLoadImage: loaded",!0,u,g),g.onerror=f(nn,d,"TestLoadImage: error",!1,u,g),g.onabort=f(nn,d,"TestLoadImage: abort",!1,u,g),g.ontimeout=f(nn,d,"TestLoadImage: timeout",!1,u,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else u(!1)}function l_(a,u){const d=new fe,g=new AbortController,w=setTimeout(()=>{g.abort(),nn(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:g.signal}).then(R=>{clearTimeout(w),R.ok?nn(d,"TestPingServer: ok",!0,u):nn(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(w),nn(d,"TestPingServer: error",!1,u)})}function nn(a,u,d,g,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),g(d)}catch{}}function c_(){this.g=new de}function Fa(a){this.i=a.Sb||null,this.h=a.ab||!1}p(Fa,Te),Fa.prototype.g=function(){return new Qr(this.i,this.h)};function Qr(a,u){Le.call(this),this.H=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Qr,Le),n=Qr.prototype,n.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=u,this.readyState=1,ki(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(u.body=a),(this.H||o).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Pi(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ki(this)),this.g&&(this.readyState=3,ki(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ju(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function ju(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?Pi(this):ki(this),this.readyState==3&&ju(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,Pi(this))},n.Na=function(a){this.g&&(this.response=a,Pi(this))},n.ga=function(){this.g&&Pi(this)};function Pi(a){a.readyState=4,a.l=null,a.j=null,a.B=null,ki(a)}n.setRequestHeader=function(a,u){this.A.append(a,u)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function ki(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Qr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Hu(a){let u="";return Vn(a,function(d,g){u+=g,u+=":",u+=d,u+=`\r
`}),u}function Ua(a,u,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Hu(d),typeof a=="string"?d!=null&&Ti(d):ge(a,u,d))}function Ee(a){Le.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(Ee,Le);var u_=/^https?$/i,h_=["POST","PUT"];n=Ee.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,u,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ei.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(R){$u(this,R);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var w in g)d.set(w,g[w]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const R of g.keys())d.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),w=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(h_,u,void 0)>=0)||g||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,O]of d)this.g.setRequestHeader(R,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(R){$u(this,R)}};function $u(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.o=5,zu(a),Yr(a)}function zu(a){a.A||(a.A=!0,qe(a,"complete"),qe(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,qe(this,"complete"),qe(this,"abort"),Yr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yr(this,!0)),Ee.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Gu(this):this.Xa())},n.Xa=function(){Gu(this)};function Gu(a){if(a.h&&typeof r<"u"){if(a.v&&sn(a)==4)setTimeout(a.Ca.bind(a),0);else if(qe(a,"readystatechange"),sn(a)==4){a.h=!1;try{const R=a.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var g;if(g=R===0){let O=String(a.D).match(Mu)[1]||null;!O&&o.self&&o.self.location&&(O=o.self.location.protocol.slice(0,-1)),g=!u_.test(O?O.toLowerCase():"")}d=g}if(d)qe(a,"complete"),qe(a,"success");else{a.o=6;try{var w=sn(a)>2?a.g.statusText:""}catch{w=""}a.l=w+" ["+a.ca()+"]",zu(a)}}finally{Yr(a)}}}}function Yr(a,u){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,u||qe(a,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function sn(a){return a.g?a.g.readyState:0}n.ca=function(){try{return sn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),Q(u)}};function Ku(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function d_(a){const u={};a=(a.g&&sn(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(y(a[g]))continue;var d=Ym(a[g]);const w=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=u[w]||[];u[w]=R,R.push(d)}vs(u,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ni(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function Qu(a){this.za=0,this.i=[],this.j=new fe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ni("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ni("baseRetryDelayMs",5e3,a),this.Za=Ni("retryDelaySeedMs",1e4,a),this.Ta=Ni("forwardChannelMaxRetries",2,a),this.va=Ni("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Nu(a&&a.concurrentRequestLimit),this.Ba=new c_,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Qu.prototype,n.ka=8,n.I=1,n.connect=function(a,u,d,g){We(0),this.W=a,this.H=u||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.J=ih(this,null,this.W),Xr(this)};function Ba(a){if(Yu(a),a.I==3){var u=a.V++,d=St(a.J);if(ge(d,"SID",a.M),ge(d,"RID",u),ge(d,"TYPE","terminate"),Di(a,d),u=new en(a,a.j,u),u.M=2,u.A=Kr(St(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=u.A,d=!0),d||(u.g=rh(u.j,null),u.g.ea(u.A)),u.F=Date.now(),Gr(u)}sh(a)}function Jr(a){a.g&&(Wa(a),a.g.cancel(),a.g=null)}function Yu(a){Jr(a),a.v&&(o.clearTimeout(a.v),a.v=null),Zr(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function Xr(a){if(!Du(a.h)&&!a.m){a.m=!0;var u=a.Ea;ae||_(),le||(ae(),le=!0),E.add(u,a),a.D=0}}function f_(a,u){return Ou(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=u.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=zn(h(a.Ea,a,u),nh(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const w=new en(this,this.j,a);let R=this.o;if(this.U&&(R?(R=gi(R),Fn(R,this.U)):R=this.U),this.u!==null||this.R||(w.J=R,R=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(u+=g,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Xu(this,w,u),d=St(this.J),ge(d,"RID",a),ge(d,"CVER",22),this.G&&ge(d,"X-HTTP-Session-Id",this.G),Di(this,d),R&&(this.R?u="headers="+Ti(Hu(R))+"&"+u:this.u&&Ua(d,this.u,R)),Ma(this.h,w),this.Ra&&ge(d,"TYPE","init"),this.S?(ge(d,"$req",u),ge(d,"SID","null"),w.U=!0,Da(w,d,null)):Da(w,d,u),this.I=2}}else this.I==3&&(a?Ju(this,a):this.i.length==0||Du(this.h)||Ju(this))};function Ju(a,u){var d;u?d=u.l:d=a.V++;const g=St(a.J);ge(g,"SID",a.M),ge(g,"RID",d),ge(g,"AID",a.K),Di(a,g),a.u&&a.o&&Ua(g,a.u,a.o),d=new en(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),u&&(a.i=u.G.concat(a.i)),u=Xu(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),Ma(a.h,d),Da(d,g,u)}function Di(a,u){a.H&&Vn(a.H,function(d,g){ge(u,g,d)}),a.l&&Vn({},function(d,g){ge(u,g,d)})}function Xu(a,u,d){d=Math.min(a.i.length,d);const g=a.l?h(a.l.Ka,a.l,a):null;e:{var w=a.i;let G=-1;for(;;){const ke=["count="+d];G==-1?d>0?(G=w[0].g,ke.push("ofs="+G)):G=0:ke.push("ofs="+G);let ce=!0;for(let Me=0;Me<d;Me++){var R=w[Me].g;const Rt=w[Me].map;if(R-=G,R<0)G=Math.max(0,w[Me].g-100),ce=!1;else try{R="req"+R+"_"||"";try{var O=Rt instanceof Map?Rt:Object.entries(Rt);for(const[Xn,rn]of O){let on=rn;l(rn)&&(on=L(rn)),ke.push(R+Xn+"="+encodeURIComponent(on))}}catch(Xn){throw ke.push(R+"type="+encodeURIComponent("_badmap")),Xn}}catch{g&&g(Rt)}}if(ce){O=ke.join("&");break e}}O=void 0}return a=a.i.splice(0,d),u.G=a,O}function Zu(a){if(!a.g&&!a.v){a.Y=1;var u=a.Da;ae||_(),le||(ae(),le=!0),E.add(u,a),a.A=0}}function qa(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=zn(h(a.Da,a),nh(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,eh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=zn(h(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,We(10),Jr(this),eh(this))};function Wa(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function eh(a){a.g=new en(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var u=St(a.na);ge(u,"RID","rpc"),ge(u,"SID",a.M),ge(u,"AID",a.K),ge(u,"CI",a.F?"0":"1"),!a.F&&a.ia&&ge(u,"TO",a.ia),ge(u,"TYPE","xmlhttp"),Di(a,u),a.u&&a.o&&Ua(u,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=Kr(St(u)),d.u=null,d.R=!0,bu(d,a)}n.Va=function(){this.C!=null&&(this.C=null,Jr(this),qa(this),We(19))};function Zr(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function th(a,u){var d=null;if(a.g==u){Zr(a),Wa(a),a.g=null;var g=2}else if(La(a.h,u))d=u.G,xu(a.h,u),g=1;else return;if(a.I!=0){if(u.o)if(g==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var w=a.D;g=At(),qe(g,new zr(g,d)),Xr(a)}else Zu(a);else if(w=u.m,w==3||w==0&&u.X>0||!(g==1&&f_(a,u)||g==2&&qa(a)))switch(d&&d.length>0&&(u=a.h,u.i=u.i.concat(d)),w){case 1:Jn(a,5);break;case 4:Jn(a,10);break;case 3:Jn(a,6);break;default:Jn(a,2)}}}function nh(a,u){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*u}function Jn(a,u){if(a.j.info("Error code "+u),u==2){var d=h(a.bb,a),g=a.Ua;const w=!g;g=new tn(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Ci(g,"https"),Kr(g),w?a_(g.toString(),d):l_(g.toString(),d)}else We(2);a.I=0,a.l&&a.l.pa(u),sh(a),Yu(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),We(2)):(this.j.info("Failed to ping google.com"),We(1))};function sh(a){if(a.I=0,a.ja=[],a.l){const u=Lu(a.h);(u.length!=0||a.i.length!=0)&&(S(a.ja,u),S(a.ja,a.i),a.h.i.length=0,A(a.i),a.i.length=0),a.l.oa()}}function ih(a,u,d){var g=d instanceof tn?St(d):new tn(d);if(g.g!="")u&&(g.g=u+"."+g.g),Ai(g,g.u);else{var w=o.location;g=w.protocol,u=u?u+"."+w.hostname:w.hostname,w=+w.port;const R=new tn(null);g&&Ci(R,g),u&&(R.g=u),w&&Ai(R,w),d&&(R.h=d),g=R}return d=a.G,u=a.wa,d&&u&&ge(g,d,u),ge(g,"VER",a.ka),Di(a,g),g}function rh(a,u,d){if(u&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Aa&&!a.ma?new Ee(new Fa({ab:d})):new Ee(a.ma),u.Fa(a.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function oh(){}n=oh.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function eo(){}eo.prototype.g=function(a,u){return new ht(a,u)};function ht(a,u){Le.call(this),this.g=new Qu(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(a?a["X-WebChannel-Client-Profile"]=u.sa:a={"X-WebChannel-Client-Profile":u.sa}),this.g.U=a,(a=u&&u.Qb)&&!y(a)&&(this.g.u=a),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new Rs(this)}p(ht,Le),ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ht.prototype.close=function(){Ba(this.g)},ht.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=L(a),a=d);u.i.push(new Zm(u.Ya++,a)),u.I==3&&Xr(u)},ht.prototype.N=function(){this.g.l=null,delete this.j,Ba(this.g),delete this.g,ht.Z.N.call(this)};function ah(a){Ge.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(const d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}p(ah,Ge);function lh(){yt.call(this),this.status=1}p(lh,yt);function Rs(a){this.g=a}p(Rs,oh),Rs.prototype.ra=function(){qe(this.g,"a")},Rs.prototype.qa=function(a){qe(this.g,new ah(a))},Rs.prototype.pa=function(a){qe(this.g,new lh)},Rs.prototype.oa=function(){qe(this.g,"b")},eo.prototype.createWebChannel=eo.prototype.g,ht.prototype.send=ht.prototype.o,ht.prototype.open=ht.prototype.m,ht.prototype.close=ht.prototype.close,Gg=function(){return new eo},zg=function(){return At()},$g=Se,Fl={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},gt.NO_ERROR=0,gt.TIMEOUT=8,gt.HTTP_ERROR=6,Eo=gt,Kn.COMPLETE="complete",Hg=Kn,nt.EventType=ze,ze.OPEN="a",ze.CLOSE="b",ze.ERROR="c",ze.MESSAGE="d",Le.prototype.listen=Le.prototype.J,$i=nt,Ee.prototype.listenOnce=Ee.prototype.K,Ee.prototype.getLastError=Ee.prototype.Ha,Ee.prototype.getLastErrorCode=Ee.prototype.ya,Ee.prototype.getStatus=Ee.prototype.ca,Ee.prototype.getResponseJson=Ee.prototype.La,Ee.prototype.getResponseText=Ee.prototype.la,Ee.prototype.send=Ee.prototype.ea,Ee.prototype.setWithCredentials=Ee.prototype.Fa,jg=Ee}).apply(typeof ao<"u"?ao:typeof self<"u"?self:typeof window<"u"?window:{});class Qe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");let di="12.8.0";function cA(n){di=n}const fs=new ia("@firebase/firestore");function Ds(){return fs.logLevel}function M(n,...e){if(fs.logLevel<=X.DEBUG){const t=e.map(tu);fs.debug(`Firestore (${di}): ${n}`,...t)}}function Jt(n,...e){if(fs.logLevel<=X.ERROR){const t=e.map(tu);fs.error(`Firestore (${di}): ${n}`,...t)}}function Xs(n,...e){if(fs.logLevel<=X.WARN){const t=e.map(tu);fs.warn(`Firestore (${di}): ${n}`,...t)}}function tu(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function z(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Kg(n,s,t)}function Kg(n,e,t){let s=`FIRESTORE (${di}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw Jt(s),new Error(s)}function ve(n,e,t,s){let i="Unexpected state";typeof t=="string"?i=t:s=t,n||Kg(e,i,s)}function ie(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends Xt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class is{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Qg{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class uA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Qe.UNAUTHENTICATED)))}shutdown(){}}class hA{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class dA{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ve(this.o===void 0,42304);let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let r=new is;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new is,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const c=r;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},l=c=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>l(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new is)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ve(typeof s.accessToken=="string",31837,{l:s}),new Qg(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string",2055,{h:e}),new Qe(e)}}class fA{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class pA{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new fA(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Qe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Dd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gA{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,mt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ve(this.o===void 0,3512);const s=r=>{r.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable((()=>s(r)))};const i=r=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>i(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Dd(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ve(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Dd(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function mA(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class nu{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=mA(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<t&&(s+=e.charAt(i[r]%62))}return s}}function ee(n,e){return n<e?-1:n>e?1:0}function Ul(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const i=n.charAt(s),r=e.charAt(s);if(i!==r)return cl(i)===cl(r)?ee(i,r):cl(i)?1:-1}return ee(n.length,e.length)}const _A=55296,yA=57343;function cl(n){const e=n.charCodeAt(0);return e>=_A&&e<=yA}function Zs(n,e,t){return n.length===e.length&&n.every(((s,i)=>t(s,e[i])))}const Od="__name__";class Pt{constructor(e,t,s){t===void 0?t=0:t>e.length&&z(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&z(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Pt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pt?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let i=0;i<s;i++){const r=Pt.compareSegments(e.get(i),t.get(i));if(r!==0)return r}return ee(e.length,t.length)}static compareSegments(e,t){const s=Pt.isNumericId(e),i=Pt.isNumericId(t);return s&&!i?-1:!s&&i?1:s&&i?Pt.extractNumericId(e).compare(Pt.extractNumericId(t)):Ul(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return In.fromString(e.substring(4,e.length-2))}}class ye extends Pt{construct(e,t,s){return new ye(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new V(D.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((i=>i.length>0)))}return new ye(t)}static emptyPath(){return new ye([])}}const vA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends Pt{construct(e,t,s){return new et(e,t,s)}static isValidIdentifier(e){return vA.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Od}static keyField(){return new et([Od])}static fromServerFormat(e){const t=[];let s="",i=0;const r=()=>{if(s.length===0)throw new V(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new V(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=c,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(s+=l,i++):(r(),i++)}if(r(),o)throw new V(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(t)}static emptyPath(){return new et([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(ye.fromString(e))}static fromName(e){return new F(ye.fromString(e).popFirst(5))}static empty(){return new F(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new ye(e.slice()))}}function EA(n,e,t){if(!t)throw new V(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function IA(n,e,t,s){if(e===!0&&s===!0)throw new V(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xd(n){if(!F.isDocumentKey(n))throw new V(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function TA(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function wA(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":z(12329,{type:typeof n})}function Bl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=wA(n);throw new V(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Pe(n,e){const t={typeString:n};return e&&(t.value=e),t}function Dr(n,e){if(!TA(n))throw new V(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(i&&typeof o!==i){t=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&o!==r.value){t=`Expected '${s}' field to equal '${r.value}'`;break}}if(t)throw new V(D.INVALID_ARGUMENT,t);return!0}const Ld=-62135596800,Md=1e6;class be{static now(){return be.fromMillis(Date.now())}static fromDate(e){return be.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Md);return new be(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ld)throw new V(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Md}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:be._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Dr(e,be._jsonSchema))return new be(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ld;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}be._jsonSchemaVersion="firestore/timestamp/1.0",be._jsonSchema={type:Pe("string",be._jsonSchemaVersion),seconds:Pe("number"),nanoseconds:Pe("number")};class ${static fromTimestamp(e){return new $(e)}static min(){return new $(new be(0,0))}static max(){return new $(new be(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const yr=-1;function CA(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(s===1e9?new be(t+1,0):new be(t,s));return new bn(i,F.empty(),e)}function AA(n){return new bn(n.readTime,n.key,yr)}class bn{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new bn($.min(),F.empty(),yr)}static max(){return new bn($.max(),F.empty(),yr)}}function SA(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:ee(n.largestBatchId,e.largestBatchId))}const RA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bA{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ya(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==RA)throw n;M("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(t,r).next(s,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,s)=>{t(e)}))}static reject(e){return new b(((t,s)=>{s(e)}))}static waitFor(e){return new b(((t,s)=>{let i=0,r=0,o=!1;e.forEach((l=>{++i,l.next((()=>{++r,o&&r===i&&t()}),(c=>s(c)))})),o=!0,r===i&&t()}))}static or(e){let t=b.resolve(!1);for(const s of e)t=t.next((i=>i?b.resolve(i):s()));return t}static forEach(e,t){const s=[];return e.forEach(((i,r)=>{s.push(t.call(this,i,r))})),this.waitFor(s)}static mapArray(e,t){return new b(((s,i)=>{const r=e.length,o=new Array(r);let l=0;for(let c=0;c<r;c++){const h=c;t(e[h]).next((f=>{o[h]=f,++l,l===r&&s(o)}),(f=>i(f)))}}))}static doWhile(e,t){return new b(((s,i)=>{const r=()=>{e()===!0?t().next((()=>{r()}),i):s()};r()}))}}function PA(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function fi(n){return n.name==="IndexedDbTransactionError"}class va{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}va.ce=-1;const kA=-1;function Ea(n){return n==null}function ql(n){return n===0&&1/n==-1/0}const Yg="";function NA(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Vd(e)),e=DA(n.get(t),e);return Vd(e)}function DA(n,e){let t=e;const s=n.length;for(let i=0;i<s;i++){const r=n.charAt(i);switch(r){case"\0":t+="";break;case Yg:t+="";break;default:t+=r}}return t}function Vd(n){return n+Yg+""}function Fd(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Or(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function OA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Ae{constructor(e,t){this.comparator=e,this.root=t||je.EMPTY}insert(e,t){return new Ae(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,je.BLACK,null,null))}remove(e){return new Ae(this.comparator,this.root.remove(e,this.comparator).copy(null,null,je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return t+s.left.size;i<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lo(this.root,e,this.comparator,!1)}getReverseIterator(){return new lo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lo(this.root,e,this.comparator,!0)}}class lo{constructor(e,t,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class je{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??je.RED,this.left=i??je.EMPTY,this.right=r??je.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,i,r){return new je(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return je.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return je.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw z(43730,{key:this.key,value:this.value});if(this.right.isRed())throw z(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw z(27949);return e+(this.isRed()?0:1)}}je.EMPTY=null,je.RED=!0,je.BLACK=!1;je.EMPTY=new class{constructor(){this.size=0}get key(){throw z(57766)}get value(){throw z(16141)}get color(){throw z(16727)}get left(){throw z(29726)}get right(){throw z(36894)}copy(e,t,s,i,r){return this}insert(e,t,s){return new je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class xe{constructor(e){this.comparator=e,this.data=new Ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ud(this.data.getIterator())}getIteratorFrom(e){return new Ud(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof xe)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new xe(this.comparator);return t.data=e,t}}class Ud{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class gn{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new gn([])}unionWith(e){let t=new xe(et.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new gn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zs(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class Jg extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $e{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Jg("Invalid base64 string: "+r):r}})(e);return new $e(t)}static fromUint8Array(e){const t=(function(i){let r="";for(let o=0;o<i.length;++o)r+=String.fromCharCode(i[o]);return r})(e);return new $e(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$e.EMPTY_BYTE_STRING=new $e("");const xA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(n){if(ve(!!n,39018),typeof n=="string"){let e=0;const t=xA.exec(n);if(ve(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ce(n.seconds),nanos:Ce(n.nanos)}}function Ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kn(n){return typeof n=="string"?$e.fromBase64String(n):$e.fromUint8Array(n)}const Xg="server_timestamp",Zg="__type__",em="__previous_value__",tm="__local_write_time__";function su(n){return(n?.mapValue?.fields||{})[Zg]?.stringValue===Xg}function Ia(n){const e=n.mapValue.fields[em];return su(e)?Ia(e):e}function vr(n){const e=Pn(n.mapValue.fields[tm].timestampValue);return new be(e.seconds,e.nanos)}class LA{constructor(e,t,s,i,r,o,l,c,h,f,p){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f,this.apiKey=p}}const Ko="(default)";class Er{constructor(e,t){this.projectId=e,this.database=t||Ko}static empty(){return new Er("","")}get isDefaultDatabase(){return this.database===Ko}isEqual(e){return e instanceof Er&&e.projectId===this.projectId&&e.database===this.database}}function MA(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new V(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Er(n.options.projectId,e)}const VA="__type__",FA="__max__",co={mapValue:{}},UA="__vector__",Wl="value";function Nn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?su(n)?4:qA(n)?9007199254740991:BA(n)?10:11:z(28295,{value:n})}function Vt(n,e){if(n===e)return!0;const t=Nn(n);if(t!==Nn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return vr(n).isEqual(vr(e));case 3:return(function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const o=Pn(i.timestampValue),l=Pn(r.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,r){return kn(i.bytesValue).isEqual(kn(r.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,r){return Ce(i.geoPointValue.latitude)===Ce(r.geoPointValue.latitude)&&Ce(i.geoPointValue.longitude)===Ce(r.geoPointValue.longitude)})(n,e);case 2:return(function(i,r){if("integerValue"in i&&"integerValue"in r)return Ce(i.integerValue)===Ce(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const o=Ce(i.doubleValue),l=Ce(r.doubleValue);return o===l?ql(o)===ql(l):isNaN(o)&&isNaN(l)}return!1})(n,e);case 9:return Zs(n.arrayValue.values||[],e.arrayValue.values||[],Vt);case 10:case 11:return(function(i,r){const o=i.mapValue.fields||{},l=r.mapValue.fields||{};if(Fd(o)!==Fd(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Vt(o[c],l[c])))return!1;return!0})(n,e);default:return z(52216,{left:n})}}function Ir(n,e){return(n.values||[]).find((t=>Vt(t,e)))!==void 0}function ei(n,e){if(n===e)return 0;const t=Nn(n),s=Nn(e);if(t!==s)return ee(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return(function(r,o){const l=Ce(r.integerValue||r.doubleValue),c=Ce(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1})(n,e);case 3:return Bd(n.timestampValue,e.timestampValue);case 4:return Bd(vr(n),vr(e));case 5:return Ul(n.stringValue,e.stringValue);case 6:return(function(r,o){const l=kn(r),c=kn(o);return l.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(r,o){const l=r.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){const f=ee(l[h],c[h]);if(f!==0)return f}return ee(l.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(r,o){const l=ee(Ce(r.latitude),Ce(o.latitude));return l!==0?l:ee(Ce(r.longitude),Ce(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return qd(n.arrayValue,e.arrayValue);case 10:return(function(r,o){const l=r.fields||{},c=o.fields||{},h=l[Wl]?.arrayValue,f=c[Wl]?.arrayValue,p=ee(h?.values?.length||0,f?.values?.length||0);return p!==0?p:qd(h,f)})(n.mapValue,e.mapValue);case 11:return(function(r,o){if(r===co.mapValue&&o===co.mapValue)return 0;if(r===co.mapValue)return 1;if(o===co.mapValue)return-1;const l=r.fields||{},c=Object.keys(l),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const m=Ul(c[p],f[p]);if(m!==0)return m;const A=ei(l[c[p]],h[f[p]]);if(A!==0)return A}return ee(c.length,f.length)})(n.mapValue,e.mapValue);default:throw z(23264,{he:t})}}function Bd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ee(n,e);const t=Pn(n),s=Pn(e),i=ee(t.seconds,s.seconds);return i!==0?i:ee(t.nanos,s.nanos)}function qd(n,e){const t=n.values||[],s=e.values||[];for(let i=0;i<t.length&&i<s.length;++i){const r=ei(t[i],s[i]);if(r)return r}return ee(t.length,s.length)}function ti(n){return jl(n)}function jl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Pn(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return kn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",i=!0;for(const r of t.values||[])i?i=!1:s+=",",s+=jl(r);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const o of s)r?r=!1:i+=",",i+=`${o}:${jl(t.fields[o])}`;return i+"}"})(n.mapValue):z(61005,{value:n})}function Io(n){switch(Nn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ia(n);return e?16+Io(e):16;case 5:return 2*n.stringValue.length;case 6:return kn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((i,r)=>i+Io(r)),0)})(n.arrayValue);case 10:case 11:return(function(s){let i=0;return Or(s.fields,((r,o)=>{i+=r.length+Io(o)})),i})(n.mapValue);default:throw z(13486,{value:n})}}function Hl(n){return!!n&&"integerValue"in n}function iu(n){return!!n&&"arrayValue"in n}function Wd(n){return!!n&&"nullValue"in n}function jd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ul(n){return!!n&&"mapValue"in n}function BA(n){return(n?.mapValue?.fields||{})[VA]?.stringValue===UA}function nr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Or(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=nr(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=nr(n.arrayValue.values[t]);return e}return{...n}}function qA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===FA}class kt{constructor(e){this.value=e}static empty(){return new kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!ul(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nr(t)}setAll(e){let t=et.emptyPath(),s={},i=[];e.forEach(((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,s,i),s={},i=[],t=l.popLast()}o?s[l.lastSegment()]=nr(o):i.push(l.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,s,i)}delete(e){const t=this.field(e.popLast());ul(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=t.mapValue.fields[e.get(s)];ul(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,s){Or(t,((i,r)=>e[i]=r));for(const i of s)delete e[i]}clone(){return new kt(nr(this.value))}}class Je{constructor(e,t,s,i,r,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=i,this.createTime=r,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Je(e,0,$.min(),$.min(),$.min(),kt.empty(),0)}static newFoundDocument(e,t,s,i){return new Je(e,1,t,$.min(),s,i,0)}static newNoDocument(e,t){return new Je(e,2,t,$.min(),$.min(),kt.empty(),0)}static newUnknownDocument(e,t){return new Je(e,3,t,$.min(),$.min(),kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Je&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Je(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Qo{constructor(e,t){this.position=e,this.inclusive=t}}function Hd(n,e,t){let s=0;for(let i=0;i<n.position.length;i++){const r=e[i],o=n.position[i];if(r.field.isKeyField()?s=F.comparator(F.fromName(o.referenceValue),t.key):s=ei(o,t.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function $d(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Vt(n.position[t],e.position[t]))return!1;return!0}class Yo{constructor(e,t="asc"){this.field=e,this.dir=t}}function WA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class nm{}class Oe extends nm{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new HA(e,t,s):t==="array-contains"?new GA(e,s):t==="in"?new KA(e,s):t==="not-in"?new QA(e,s):t==="array-contains-any"?new YA(e,s):new Oe(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new $A(e,s):new zA(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(ei(t,this.value)):t!==null&&Nn(this.value)===Nn(t)&&this.matchesComparison(ei(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ft extends nm{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ft(e,t)}matches(e){return sm(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function sm(n){return n.op==="and"}function im(n){return jA(n)&&sm(n)}function jA(n){for(const e of n.filters)if(e instanceof Ft)return!1;return!0}function $l(n){if(n instanceof Oe)return n.field.canonicalString()+n.op.toString()+ti(n.value);if(im(n))return n.filters.map((e=>$l(e))).join(",");{const e=n.filters.map((t=>$l(t))).join(",");return`${n.op}(${e})`}}function rm(n,e){return n instanceof Oe?(function(s,i){return i instanceof Oe&&s.op===i.op&&s.field.isEqual(i.field)&&Vt(s.value,i.value)})(n,e):n instanceof Ft?(function(s,i){return i instanceof Ft&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce(((r,o,l)=>r&&rm(o,i.filters[l])),!0):!1})(n,e):void z(19439)}function om(n){return n instanceof Oe?(function(t){return`${t.field.canonicalString()} ${t.op} ${ti(t.value)}`})(n):n instanceof Ft?(function(t){return t.op.toString()+" {"+t.getFilters().map(om).join(" ,")+"}"})(n):"Filter"}class HA extends Oe{constructor(e,t,s){super(e,t,s),this.key=F.fromName(s.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class $A extends Oe{constructor(e,t){super(e,"in",t),this.keys=am("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class zA extends Oe{constructor(e,t){super(e,"not-in",t),this.keys=am("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function am(n,e){return(e.arrayValue?.values||[]).map((t=>F.fromName(t.referenceValue)))}class GA extends Oe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return iu(t)&&Ir(t.arrayValue,this.value)}}class KA extends Oe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ir(this.value.arrayValue,t)}}class QA extends Oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ir(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ir(this.value.arrayValue,t)}}class YA extends Oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!iu(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Ir(this.value.arrayValue,s)))}}class JA{constructor(e,t=null,s=[],i=[],r=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=l,this.Te=null}}function zd(n,e=null,t=[],s=[],i=null,r=null,o=null){return new JA(n,e,t,s,i,r,o)}function ru(n){const e=ie(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>$l(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(r){return r.field.canonicalString()+r.dir})(s))).join(","),Ea(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>ti(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>ti(s))).join(",")),e.Te=t}return e.Te}function ou(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!WA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!rm(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$d(n.startAt,e.startAt)&&$d(n.endAt,e.endAt)}function zl(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Ta{constructor(e,t=null,s=[],i=[],r=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function XA(n,e,t,s,i,r,o,l){return new Ta(n,e,t,s,i,r,o,l)}function au(n){return new Ta(n)}function Gd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ZA(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function eS(n){return n.collectionGroup!==null}function sr(n){const e=ie(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new xe(et.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new Yo(r,s))})),t.has(et.keyField().canonicalString())||e.Ie.push(new Yo(et.keyField(),s))}return e.Ie}function Mt(n){const e=ie(n);return e.Ee||(e.Ee=tS(e,sr(n))),e.Ee}function tS(n,e){if(n.limitType==="F")return zd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const r=i.dir==="desc"?"asc":"desc";return new Yo(i.field,r)}));const t=n.endAt?new Qo(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Qo(n.startAt.position,n.startAt.inclusive):null;return zd(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Gl(n,e,t){return new Ta(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function wa(n,e){return ou(Mt(n),Mt(e))&&n.limitType===e.limitType}function lm(n){return`${ru(Mt(n))}|lt:${n.limitType}`}function Os(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((i=>om(i))).join(", ")}]`),Ea(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((i=>ti(i))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((i=>ti(i))).join(",")),`Target(${s})`})(Mt(n))}; limitType=${n.limitType})`}function Ca(n,e){return e.isFoundDocument()&&(function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):F.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)})(n,e)&&(function(s,i){for(const r of sr(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0})(n,e)&&(function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0})(n,e)&&(function(s,i){return!(s.startAt&&!(function(o,l,c){const h=Hd(o,l,c);return o.inclusive?h<=0:h<0})(s.startAt,sr(s),i)||s.endAt&&!(function(o,l,c){const h=Hd(o,l,c);return o.inclusive?h>=0:h>0})(s.endAt,sr(s),i))})(n,e)}function nS(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function cm(n){return(e,t)=>{let s=!1;for(const i of sr(n)){const r=sS(i,e,t);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function sS(n,e,t){const s=n.field.isKeyField()?F.comparator(e.key,t.key):(function(r,o,l){const c=o.data.field(r),h=l.data.field(r);return c!==null&&h!==null?ei(c,h):z(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return z(19790,{direction:n.dir})}}class _s{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[t]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Or(this.inner,((t,s)=>{for(const[i,r]of s)e(i,r)}))}isEmpty(){return OA(this.inner)}size(){return this.innerSize}}const iS=new Ae(F.comparator);function Dn(){return iS}const um=new Ae(F.comparator);function zi(...n){let e=um;for(const t of n)e=e.insert(t.key,t);return e}function rS(n){let e=um;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function ss(){return ir()}function hm(){return ir()}function ir(){return new _s((n=>n.toString()),((n,e)=>n.isEqual(e)))}const oS=new xe(F.comparator);function re(...n){let e=oS;for(const t of n)e=e.add(t);return e}const aS=new xe(ee);function lS(){return aS}function cS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ql(e)?"-0":e}}function uS(n){return{integerValue:""+n}}class Aa{constructor(){this._=void 0}}function hS(n,e,t){return n instanceof Kl?(function(i,r){const o={fields:{[Zg]:{stringValue:Xg},[tm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&su(r)&&(r=Ia(r)),r&&(o.fields[em]=r),{mapValue:o}})(t,e):n instanceof Jo?dm(n,e):n instanceof Xo?fm(n,e):(function(i,r){const o=fS(i,r),l=Kd(o)+Kd(i.Ae);return Hl(o)&&Hl(i.Ae)?uS(l):cS(i.serializer,l)})(n,e)}function dS(n,e,t){return n instanceof Jo?dm(n,e):n instanceof Xo?fm(n,e):t}function fS(n,e){return n instanceof Ql?(function(s){return Hl(s)||(function(r){return!!r&&"doubleValue"in r})(s)})(e)?e:{integerValue:0}:null}class Kl extends Aa{}class Jo extends Aa{constructor(e){super(),this.elements=e}}function dm(n,e){const t=pm(e);for(const s of n.elements)t.some((i=>Vt(i,s)))||t.push(s);return{arrayValue:{values:t}}}class Xo extends Aa{constructor(e){super(),this.elements=e}}function fm(n,e){let t=pm(e);for(const s of n.elements)t=t.filter((i=>!Vt(i,s)));return{arrayValue:{values:t}}}class Ql extends Aa{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Kd(n){return Ce(n.integerValue||n.doubleValue)}function pm(n){return iu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function pS(n,e){return n.field.isEqual(e.field)&&(function(s,i){return s instanceof Jo&&i instanceof Jo||s instanceof Xo&&i instanceof Xo?Zs(s.elements,i.elements,Vt):s instanceof Ql&&i instanceof Ql?Vt(s.Ae,i.Ae):s instanceof Kl&&i instanceof Kl})(n.transform,e.transform)}class rs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rs}static exists(e){return new rs(void 0,e)}static updateTime(e){return new rs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function To(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class lu{}function gm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new mS(n.key,rs.none()):new cu(n.key,n.data,rs.none());{const t=n.data,s=kt.empty();let i=new xe(et.comparator);for(let r of e.fields)if(!i.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?s.delete(r):s.set(r,o),i=i.add(r)}return new Sa(n.key,s,new gn(i.toArray()),rs.none())}}function gS(n,e,t){n instanceof cu?(function(i,r,o){const l=i.value.clone(),c=Yd(i.fieldTransforms,r,o.transformResults);l.setAll(c),r.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Sa?(function(i,r,o){if(!To(i.precondition,r))return void r.convertToUnknownDocument(o.version);const l=Yd(i.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(mm(i)),c.setAll(l),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(i,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function rr(n,e,t,s){return n instanceof cu?(function(r,o,l,c){if(!To(r.precondition,o))return l;const h=r.value.clone(),f=Jd(r.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,s):n instanceof Sa?(function(r,o,l,c){if(!To(r.precondition,o))return l;const h=Jd(r.fieldTransforms,c,o),f=o.data;return f.setAll(mm(r)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((p=>p.field)))})(n,e,t,s):(function(r,o,l){return To(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l})(n,e,t)}function Qd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Zs(s,i,((r,o)=>pS(r,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class cu extends lu{constructor(e,t,s,i=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Sa extends lu{constructor(e,t,s,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function mm(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Yd(n,e,t){const s=new Map;ve(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){const r=n[i],o=r.transform,l=e.data.field(r.field);s.set(r.field,dS(o,l,t[i]))}return s}function Jd(n,e,t){const s=new Map;for(const i of n){const r=i.transform,o=t.data.field(i.field);s.set(i.field,hS(r,o,e))}return s}class mS extends lu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _S{constructor(e,t,s,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&gS(r,e,s[i])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=rr(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=rr(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=hm();return this.mutations.forEach((i=>{const r=e.get(i.key),o=r.overlayedDocument;let l=this.applyToLocalView(o,r.mutatedFields);l=t.has(i.key)?null:l;const c=gm(o,l);c!==null&&s.set(i.key,c),o.isValidDocument()||o.convertToNoDocument($.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),re())}isEqual(e){return this.batchId===e.batchId&&Zs(this.mutations,e.mutations,((t,s)=>Qd(t,s)))&&Zs(this.baseMutations,e.baseMutations,((t,s)=>Qd(t,s)))}}class yS{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class vS{constructor(e,t){this.count=e,this.unchangedNames=t}}var Re,se;function _m(n){if(n===void 0)return Jt("GRPC error has no .code"),D.UNKNOWN;switch(n){case Re.OK:return D.OK;case Re.CANCELLED:return D.CANCELLED;case Re.UNKNOWN:return D.UNKNOWN;case Re.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case Re.INTERNAL:return D.INTERNAL;case Re.UNAVAILABLE:return D.UNAVAILABLE;case Re.UNAUTHENTICATED:return D.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case Re.NOT_FOUND:return D.NOT_FOUND;case Re.ALREADY_EXISTS:return D.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return D.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case Re.ABORTED:return D.ABORTED;case Re.OUT_OF_RANGE:return D.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return D.UNIMPLEMENTED;case Re.DATA_LOSS:return D.DATA_LOSS;default:return z(39323,{code:n})}}(se=Re||(Re={}))[se.OK=0]="OK",se[se.CANCELLED=1]="CANCELLED",se[se.UNKNOWN=2]="UNKNOWN",se[se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",se[se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",se[se.NOT_FOUND=5]="NOT_FOUND",se[se.ALREADY_EXISTS=6]="ALREADY_EXISTS",se[se.PERMISSION_DENIED=7]="PERMISSION_DENIED",se[se.UNAUTHENTICATED=16]="UNAUTHENTICATED",se[se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",se[se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",se[se.ABORTED=10]="ABORTED",se[se.OUT_OF_RANGE=11]="OUT_OF_RANGE",se[se.UNIMPLEMENTED=12]="UNIMPLEMENTED",se[se.INTERNAL=13]="INTERNAL",se[se.UNAVAILABLE=14]="UNAVAILABLE",se[se.DATA_LOSS=15]="DATA_LOSS";function ES(){return new TextEncoder}const IS=new In([4294967295,4294967295],0);function Xd(n){const e=ES().encode(n),t=new Wg;return t.update(e),new Uint8Array(t.digest())}function Zd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new In([t,s],0),new In([i,r],0)]}class uu{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Gi(`Invalid padding: ${t}`);if(s<0)throw new Gi(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Gi(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Gi(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=In.fromNumber(this.ge)}ye(e,t,s){let i=e.add(t.multiply(In.fromNumber(s)));return i.compare(IS)===1&&(i=new In([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Xd(e),[s,i]=Zd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);if(!this.we(o))return!1}return!0}static create(e,t,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new uu(r,i,t);return s.forEach((l=>o.insert(l))),o}insert(e){if(this.ge===0)return;const t=Xd(e),[s,i]=Zd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);this.be(o)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Gi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ra{constructor(e,t,s,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const i=new Map;return i.set(e,xr.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ra($.min(),i,new Ae(ee),Dn(),re())}}class xr{constructor(e,t,s,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new xr(s,t,re(),re(),re())}}class wo{constructor(e,t,s,i){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=i}}class ym{constructor(e,t){this.targetId=e,this.Ce=t}}class vm{constructor(e,t,s=$e.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=i}}class ef{constructor(){this.ve=0,this.Fe=tf(),this.Me=$e.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=re(),t=re(),s=re();return this.Fe.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:s=s.add(i);break;default:z(38017,{changeType:r})}})),new xr(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=tf()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ve(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class TS{constructor(e){this.Ge=e,this.ze=new Map,this.je=Dn(),this.He=uo(),this.Je=uo(),this.Ze=new Ae(ee)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:z(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,s=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(zl(r))if(s===0){const o=new F(r.path);this.et(t,o,Je.newNoDocument(o,$.min()))}else ve(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=t;let o,l;try{o=kn(s).toUint8Array()}catch(c){if(c instanceof Jg)return Xs("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new uu(o,i,r)}catch(c){return Xs(c instanceof Gi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let i=0;return s.forEach((r=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(l)||(this.et(t,r,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((r,o)=>{const l=this.ot(o);if(l){if(r.current&&zl(l.target)){const c=new F(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Je.newNoDocument(c,e))}r.Be&&(t.set(o,r.ke()),r.Ke())}}));let s=re();this.Je.forEach(((r,o)=>{let l=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(s=s.add(r))})),this.je.forEach(((r,o)=>o.setReadTime(e)));const i=new Ra(e,t,this.Ze,this.je,s);return this.je=Dn(),this.He=uo(),this.Je=uo(),this.Ze=new Ae(ee),i}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new ef,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new xe(ee),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new xe(ee),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ef),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function uo(){return new Ae(F.comparator)}function tf(){return new Ae(F.comparator)}const wS={asc:"ASCENDING",desc:"DESCENDING"},CS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},AS={and:"AND",or:"OR"};class SS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Yl(n,e){return n.useProto3Json||Ea(e)?e:{value:e}}function RS(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function bS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Hs(n){return ve(!!n,49232),$.fromTimestamp((function(t){const s=Pn(t);return new be(s.seconds,s.nanos)})(n))}function PS(n,e){return Jl(n,e).canonicalString()}function Jl(n,e){const t=(function(i){return new ye(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Em(n){const e=ye.fromString(n);return ve(Am(e),10190,{key:e.toString()}),e}function hl(n,e){const t=Em(e);if(t.get(1)!==n.databaseId.projectId)throw new V(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(Tm(t))}function Im(n,e){return PS(n.databaseId,e)}function kS(n){const e=Em(n);return e.length===4?ye.emptyPath():Tm(e)}function nf(n){return new ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Tm(n){return ve(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function NS(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:z(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=(function(h,f){return h.useProto3Json?(ve(f===void 0||typeof f=="string",58123),$e.fromBase64String(f||"")):(ve(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),$e.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&(function(h){const f=h.code===void 0?D.UNKNOWN:_m(h.code);return new V(f,h.message||"")})(o);t=new vm(s,i,r,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=hl(n,s.document.name),r=Hs(s.document.updateTime),o=s.document.createTime?Hs(s.document.createTime):$.min(),l=new kt({mapValue:{fields:s.document.fields}}),c=Je.newFoundDocument(i,r,o,l),h=s.targetIds||[],f=s.removedTargetIds||[];t=new wo(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=hl(n,s.document),r=s.readTime?Hs(s.readTime):$.min(),o=Je.newNoDocument(i,r),l=s.removedTargetIds||[];t=new wo([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=hl(n,s.document),r=s.removedTargetIds||[];t=new wo([],r,i,null)}else{if(!("filter"in e))return z(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,o=new vS(i,r),l=s.targetId;t=new ym(l,o)}}return t}function DS(n,e){return{documents:[Im(n,e.path)]}}function OS(n,e){const t={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Im(n,i);const r=(function(h){if(h.length!==0)return Cm(Ft.create(h,"and"))})(e.filters);r&&(t.structuredQuery.where=r);const o=(function(h){if(h.length!==0)return h.map((f=>(function(m){return{field:xs(m.field),direction:MS(m.dir)}})(f)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=Yl(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function xS(n){let e=kS(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let i=null;if(s>0){ve(s===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let r=[];t.where&&(r=(function(p){const m=wm(p);return m instanceof Ft&&im(m)?m.getFilters():[m]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map((m=>(function(S){return new Yo(Ls(S.field),(function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(m)))})(t.orderBy));let l=null;t.limit&&(l=(function(p){let m;return m=typeof p=="object"?p.value:p,Ea(m)?null:m})(t.limit));let c=null;t.startAt&&(c=(function(p){const m=!!p.before,A=p.values||[];return new Qo(A,m)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const m=!p.before,A=p.values||[];return new Qo(A,m)})(t.endAt)),XA(e,i,o,r,l,"F",c,h)}function LS(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wm(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Ls(t.unaryFilter.field);return Oe.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=Ls(t.unaryFilter.field);return Oe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ls(t.unaryFilter.field);return Oe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ls(t.unaryFilter.field);return Oe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return z(61313);default:return z(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Oe.create(Ls(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return z(58110);default:return z(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ft.create(t.compositeFilter.filters.map((s=>wm(s))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return z(1026)}})(t.compositeFilter.op))})(n):z(30097,{filter:n})}function MS(n){return wS[n]}function VS(n){return CS[n]}function FS(n){return AS[n]}function xs(n){return{fieldPath:n.canonicalString()}}function Ls(n){return et.fromServerFormat(n.fieldPath)}function Cm(n){return n instanceof Oe?(function(t){if(t.op==="=="){if(jd(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NAN"}};if(Wd(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jd(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NAN"}};if(Wd(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xs(t.field),op:VS(t.op),value:t.value}}})(n):n instanceof Ft?(function(t){const s=t.getFilters().map((i=>Cm(i)));return s.length===1?s[0]:{compositeFilter:{op:FS(t.op),filters:s}}})(n):z(54877,{filter:n})}function Am(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class mn{constructor(e,t,s,i,r=$.min(),o=$.min(),l=$e.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new mn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class US{constructor(e){this.yt=e}}function BS(n){const e=xS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Gl(e,e.limit,"L"):e}class qS{constructor(){this.Sn=new WS}addToCollectionParentIndex(e,t){return this.Sn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(bn.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(bn.min())}updateCollectionGroup(e,t,s){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class WS{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t]||new xe(ye.comparator),r=!i.has(s);return this.index[t]=i.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t];return i&&i.has(s)}getEntries(e){return(this.index[e]||new xe(ye.comparator)).toArray()}}const sf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sm=41943040;class st{static withCacheSize(e){return new st(e,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}st.DEFAULT_COLLECTION_PERCENTILE=10,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,st.DEFAULT=new st(Sm,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),st.DISABLED=new st(-1,0,0);class ni{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new ni(0)}static ar(){return new ni(-1)}}const rf="LruGarbageCollector",jS=1048576;function of([n,e],[t,s]){const i=ee(n,t);return i===0?ee(e,s):i}class HS{constructor(e){this.Pr=e,this.buffer=new xe(of),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();of(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $S{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){M(rf,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fi(t)?M(rf,"Ignoring IndexedDB error during garbage collection: ",t):await ya(t)}await this.Ar(3e5)}))}}class zS{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(va.ce);const s=new HS(t);return this.Vr.forEachTarget(e,(i=>s.Er(i.sequenceNumber))).next((()=>this.Vr.mr(e,(i=>s.Er(i))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(sf)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sf):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,i,r,o,l,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i)))).next((p=>(s=p,l=Date.now(),this.removeTargets(e,s,t)))).next((p=>(r=p,c=Date.now(),this.removeOrphanedDocuments(e,s)))).next((p=>(h=Date.now(),Ds()<=X.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${r} targets in `+(c-l)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p}))))}}function GS(n,e){return new zS(n,e)}class KS{constructor(){this.changes=new _s((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?b.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class QS{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class YS{constructor(e,t,s,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(s=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(s!==null&&rr(s.mutation,i,gn.empty(),be.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,re()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=re()){const i=ss();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,s).next((r=>{let o=zi();return r.forEach(((l,c)=>{o=o.insert(l,c.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=ss();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,re())))}populateOverlays(e,t,s){const i=[];return s.forEach((r=>{t.has(r)||i.push(r)})),this.documentOverlayCache.getOverlays(e,i).next((r=>{r.forEach(((o,l)=>{t.set(o,l)}))}))}computeViews(e,t,s,i){let r=Dn();const o=ir(),l=(function(){return ir()})();return t.forEach(((c,h)=>{const f=s.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Sa)?r=r.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),rr(f.mutation,h,f.mutation.getFieldMask(),be.now())):o.set(h.key,gn.empty())})),this.recalculateAndSaveOverlays(e,r).next((c=>(c.forEach(((h,f)=>o.set(h,f))),t.forEach(((h,f)=>l.set(h,new QS(f,o.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const s=ir();let i=new Ae(((o,l)=>o-l)),r=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const l of o)l.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let f=s.get(c)||gn.empty();f=l.applyToLocalView(h,f),s.set(c,f);const p=(i.get(l.batchId)||re()).add(c);i=i.insert(l.batchId,p)}))})).next((()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),h=c.key,f=c.value,p=hm();f.forEach((m=>{if(!r.has(m)){const A=gm(t.get(m),s.get(m));A!==null&&p.set(m,A),r=r.add(m)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return b.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,i){return ZA(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):eS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,i):this.getDocumentsMatchingCollectionQuery(e,t,s,i)}getNextDocuments(e,t,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,i).next((r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,i-r.size):b.resolve(ss());let l=yr,c=r;return o.next((h=>b.forEach(h,((f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),r.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next((m=>{c=c.insert(f,m)}))))).next((()=>this.populateOverlays(e,h,r))).next((()=>this.computeViews(e,c,h,re()))).next((f=>({batchId:l,changes:rS(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next((s=>{let i=zi();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,i){const r=t.collectionGroup;let o=zi();return this.indexManager.getCollectionParents(e,r).next((l=>b.forEach(l,(c=>{const h=(function(p,m){return new Ta(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next((f=>{f.forEach(((p,m)=>{o=o.insert(p,m)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,i)))).next((o=>{r.forEach(((c,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,Je.newInvalidDocument(f)))}));let l=zi();return o.forEach(((c,h)=>{const f=r.get(c);f!==void 0&&rr(f.mutation,h,gn.empty(),be.now()),Ca(t,h)&&(l=l.insert(c,h))})),l}))}}class JS{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return b.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Hs(i.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:BS(i.bundledQuery),readTime:Hs(i.readTime)}})(t)),b.resolve()}}class XS{constructor(){this.overlays=new Ae(F.comparator),this.Lr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const s=ss();return b.forEach(t,(i=>this.getOverlay(e,i).next((r=>{r!==null&&s.set(i,r)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((i,r)=>{this.bt(e,t,r)})),b.resolve()}removeOverlaysForBatchId(e,t,s){const i=this.Lr.get(s);return i!==void 0&&(i.forEach((r=>this.overlays=this.overlays.remove(r))),this.Lr.delete(s)),b.resolve()}getOverlaysForCollection(e,t,s){const i=ss(),r=t.length+1,o=new F(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===r&&c.largestBatchId>s&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,s,i){let r=new Ae(((h,f)=>h-f));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=r.get(h.largestBatchId);f===null&&(f=ss(),r=r.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=ss(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=i)););return b.resolve(l)}bt(e,t,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.Lr.get(i.largestBatchId).delete(s.key);this.Lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new yS(t,s));let r=this.Lr.get(t);r===void 0&&(r=re(),this.Lr.set(t,r)),this.Lr.set(t,r.add(s.key))}}class ZS{constructor(){this.sessionToken=$e.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class hu{constructor(){this.kr=new xe(Fe.Kr),this.qr=new xe(Fe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new Fe(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new Fe(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new F(new ye([])),s=new Fe(t,e),i=new Fe(t,e+1),r=[];return this.qr.forEachInRange([s,i],(o=>{this.Wr(o),r.push(o.key)})),r}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new F(new ye([])),s=new Fe(t,e),i=new Fe(t,e+1);let r=re();return this.qr.forEachInRange([s,i],(o=>{r=r.add(o.key)})),r}containsKey(e){const t=new Fe(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Fe{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return F.comparator(e.key,t.key)||ee(e.Hr,t.Hr)}static Ur(e,t){return ee(e.Hr,t.Hr)||F.comparator(e.key,t.key)}}class eR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new xe(Fe.Kr)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,i){const r=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new _S(r,t,s,i);this.mutationQueue.push(o);for(const l of i)this.Jr=this.Jr.add(new Fe(l.key,r)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=this.Xr(s),r=i<0?0:i;return b.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?kA:this.Yn-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Fe(t,0),i=new Fe(t,Number.POSITIVE_INFINITY),r=[];return this.Jr.forEachInRange([s,i],(o=>{const l=this.Zr(o.Hr);r.push(l)})),b.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new xe(ee);return t.forEach((i=>{const r=new Fe(i,0),o=new Fe(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([r,o],(l=>{s=s.add(l.Hr)}))})),b.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1;let r=s;F.isDocumentKey(r)||(r=r.child(""));const o=new Fe(new F(r),0);let l=new xe(ee);return this.Jr.forEachWhile((c=>{const h=c.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(l=l.add(c.Hr)),!0)}),o),b.resolve(this.Yr(l))}Yr(e){const t=[];return e.forEach((s=>{const i=this.Zr(s);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){ve(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return b.forEach(t.mutations,(i=>{const r=new Fe(i.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new Fe(t,0),i=this.Jr.firstAfterOrEqual(s);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class tR{constructor(e){this.ti=e,this.docs=(function(){return new Ae(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,i=this.docs.get(s),r=i?i.size:0,o=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return b.resolve(s?s.document.mutableCopy():Je.newInvalidDocument(t))}getEntries(e,t){let s=Dn();return t.forEach((i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():Je.newInvalidDocument(i))})),b.resolve(s)}getDocumentsMatchingQuery(e,t,s,i){let r=Dn();const o=t.path,l=new F(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||SA(AA(f),s)<=0||(i.has(f.key)||Ca(t,f))&&(r=r.insert(f.key,f.mutableCopy()))}return b.resolve(r)}getAllFromCollectionGroup(e,t,s,i){z(9500)}ni(e,t){return b.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new nR(this)}getSize(e){return b.resolve(this.size)}}class nR extends KS{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(s)})),b.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class sR{constructor(e){this.persistence=e,this.ri=new _s((t=>ru(t)),ou),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.ii=0,this.si=new hu,this.targetCount=0,this.oi=ni._r()}forEachTarget(e,t){return this.ri.forEach(((s,i)=>t(i))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),b.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new ni(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.lr(t),b.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,s){let i=0;const r=[];return this.ri.forEach(((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.ri.delete(o),r.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),b.waitFor(r).next((()=>i))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return b.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),b.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((o=>{r.push(i.markPotentiallyOrphaned(e,o))})),b.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return b.resolve(s)}containsKey(e,t){return b.resolve(this.si.containsKey(t))}}class Rm{constructor(e,t){this._i={},this.overlays={},this.ai=new va(0),this.ui=!1,this.ui=!0,this.ci=new ZS,this.referenceDelegate=e(this),this.li=new sR(this),this.indexManager=new qS,this.remoteDocumentCache=(function(i){return new tR(i)})((s=>this.referenceDelegate.hi(s))),this.serializer=new US(t),this.Pi=new JS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new XS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new eR(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){M("MemoryPersistence","Starting transaction:",e);const i=new iR(this.ai.next());return this.referenceDelegate.Ti(),s(i).next((r=>this.referenceDelegate.Ii(i).next((()=>r)))).toPromise().then((r=>(i.raiseOnCommittedEvent(),r)))}Ei(e,t){return b.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class iR extends bA{constructor(e){super(),this.currentSequenceNumber=e}}class du{constructor(e){this.persistence=e,this.Ri=new hu,this.Ai=null}static Vi(e){return new du(e)}get di(){if(this.Ai)return this.Ai;throw z(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),b.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((i=>this.di.add(i.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((r=>this.di.add(r.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.di,(s=>{const i=F.fromPath(s);return this.mi(e,i).next((r=>{r||t.removeEntry(i,$.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Zo{constructor(e,t){this.persistence=e,this.fi=new _s((s=>NA(s.path)),((s,i)=>s.isEqual(i))),this.garbageCollector=GS(this,t)}static Vi(e,t){return new Zo(e,t)}Ti(){}Ii(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((i=>s+i))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return b.forEach(this.fi,((s,i)=>this.wr(e,s,i).next((r=>r?b.resolve():t(i)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ni(e,(o=>this.wr(e,o,t).next((l=>{l||(s++,r.removeEntry(o,$.min()))})))).next((()=>r.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Io(e.data.value)),t}wr(e,t,s){return b.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.fi.get(t);return b.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fu{constructor(e,t,s,i){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=i}static Es(e,t){let s=re(),i=re();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new fu(e,t.fromCache,s,i)}}class rR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class oR{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return my()?8:PA(Xe())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,i){const r={result:null};return this.gs(e,t).next((o=>{r.result=o})).next((()=>{if(!r.result)return this.ps(e,t,i,s).next((o=>{r.result=o}))})).next((()=>{if(r.result)return;const o=new rR;return this.ys(e,t,o).next((l=>{if(r.result=l,this.As)return this.ws(e,t,o,l.size)}))})).next((()=>r.result))}ws(e,t,s,i){return s.documentReadCount<this.Vs?(Ds()<=X.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Os(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(Ds()<=X.DEBUG&&M("QueryEngine","Query:",Os(t),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.ds*i?(Ds()<=X.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Os(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mt(t))):b.resolve())}gs(e,t){if(Gd(t))return b.resolve(null);let s=Mt(t);return this.indexManager.getIndexType(e,s).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Gl(t,null,"F"),s=Mt(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((r=>{const o=re(...r);return this.fs.getDocuments(e,o).next((l=>this.indexManager.getMinOffset(e,s).next((c=>{const h=this.bs(t,l);return this.Ss(t,h,o,c.readTime)?this.gs(e,Gl(t,null,"F")):this.Ds(e,h,t,c)}))))})))))}ps(e,t,s,i){return Gd(t)||i.isEqual($.min())?b.resolve(null):this.fs.getDocuments(e,s).next((r=>{const o=this.bs(t,r);return this.Ss(t,o,s,i)?b.resolve(null):(Ds()<=X.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Os(t)),this.Ds(e,o,t,CA(i,yr)).next((l=>l)))}))}bs(e,t){let s=new xe(cm(e));return t.forEach(((i,r)=>{Ca(e,r)&&(s=s.add(r))})),s}Ss(e,t,s,i){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}ys(e,t,s){return Ds()<=X.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Os(t)),this.fs.getDocumentsMatchingQuery(e,t,bn.min(),s)}Ds(e,t,s,i){return this.fs.getDocumentsMatchingQuery(e,s,i).next((r=>(t.forEach((o=>{r=r.insert(o.key,o)})),r)))}}const pu="LocalStore",aR=3e8;class lR{constructor(e,t,s,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new Ae(ee),this.Fs=new _s((r=>ru(r)),ou),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new YS(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function cR(n,e,t,s){return new lR(n,e,t,s)}async function bm(n,e){const t=ie(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let i;return t.mutationQueue.getAllMutationBatches(s).next((r=>(i=r,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((r=>{const o=[],l=[];let c=re();for(const h of i){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of r){l.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(s,c).next((h=>({Ns:h,removedBatchIds:o,addedBatchIds:l})))}))}))}function Pm(n){const e=ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function uR(n,e){const t=ie(n),s=e.snapshotVersion;let i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const o=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;const l=[];e.targetChanges.forEach(((f,p)=>{const m=i.get(p);if(!m)return;l.push(t.li.removeMatchingKeys(r,f.removedDocuments,p).next((()=>t.li.addMatchingKeys(r,f.addedDocuments,p))));let A=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken($e.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,s)),i=i.insert(p,A),(function(k,x,W){return k.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=aR?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0})(m,A,f)&&l.push(t.li.updateTargetData(r,A))}));let c=Dn(),h=re();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(r,f))})),l.push(hR(r,o,e.documentUpdates).next((f=>{c=f.Bs,h=f.Ls}))),!s.isEqual($.min())){const f=t.li.getLastRemoteSnapshotVersion(r).next((p=>t.li.setTargetsMetadata(r,r.currentSequenceNumber,s)));l.push(f)}return b.waitFor(l).next((()=>o.apply(r))).next((()=>t.localDocuments.getLocalViewOfDocuments(r,c,h))).next((()=>c))})).then((r=>(t.vs=i,r)))}function hR(n,e,t){let s=re(),i=re();return t.forEach((r=>s=s.add(r))),e.getEntries(n,s).next((r=>{let o=Dn();return t.forEach(((l,c)=>{const h=r.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),c.isNoDocument()&&c.version.isEqual($.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):M(pu,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)})),{Bs:o,Ls:i}}))}function dR(n,e){const t=ie(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let i;return t.li.getTargetData(s,e).next((r=>r?(i=r,b.resolve(i)):t.li.allocateTargetId(s).next((o=>(i=new mn(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,i).next((()=>i)))))))})).then((s=>{const i=t.vs.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function Xl(n,e,t){const s=ie(n),i=s.vs.get(e),r=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",r,(o=>s.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!fi(o))throw o;M(pu,`Failed to update sequence numbers for target ${e}: ${o}`)}s.vs=s.vs.remove(e),s.Fs.delete(i.target)}function af(n,e,t){const s=ie(n);let i=$.min(),r=re();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,f){const p=ie(c),m=p.Fs.get(f);return m!==void 0?b.resolve(p.vs.get(m)):p.li.getTargetData(h,f)})(s,o,Mt(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(o,l.targetId).next((c=>{r=c}))})).next((()=>s.Cs.getDocumentsMatchingQuery(o,e,t?i:$.min(),t?r:re()))).next((l=>(fR(s,nS(e),l),{documents:l,ks:r})))))}function fR(n,e,t){let s=n.Ms.get(e)||$.min();t.forEach(((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)})),n.Ms.set(e,s)}class lf{constructor(){this.activeTargetIds=lS()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pR{constructor(){this.vo=new lf,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new lf,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gR{Mo(e){}shutdown(){}}const cf="ConnectivityMonitor";class uf{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){M(cf,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){M(cf,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ho=null;function Zl(){return ho===null?ho=(function(){return 268435456+Math.round(2147483648*Math.random())})():ho++,"0x"+ho.toString(16)}const dl="RestConnection",mR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class _R{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${i}`,this.$o=this.databaseId.database===Ko?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Wo(e,t,s,i,r){const o=Zl(),l=this.Qo(e,t.toUriEncodedString());M(dl,`Sending RPC '${e}' ${o}:`,l,s);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(c,i,r);const{host:h}=new URL(l),f=xn(h);return this.zo(e,l,c,s,f).then((p=>(M(dl,`Received RPC '${e}' ${o}: `,p),p)),(p=>{throw Xs(dl,`RPC '${e}' ${o} failed with error: `,p,"url: ",l,"request:",s),p}))}jo(e,t,s,i,r,o){return this.Wo(e,t,s,i,r)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+di})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,r)=>e[r]=i)),s&&s.headers.forEach(((i,r)=>e[r]=i))}Qo(e,t){const s=mR[e];let i=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class yR{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Ke="WebChannelConnection",Ui=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(i){setTimeout((()=>{throw i}),0)}}))};class $s extends _R{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!$s.c_){const e=zg();Ui(e,$g.STAT_EVENT,(t=>{t.stat===Fl.PROXY?M(Ke,"STAT_EVENT: detected buffering proxy"):t.stat===Fl.NOPROXY&&M(Ke,"STAT_EVENT: detected no buffering proxy")})),$s.c_=!0}}zo(e,t,s,i,r){const o=Zl();return new Promise(((l,c)=>{const h=new jg;h.setWithCredentials(!0),h.listenOnce(Hg.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Eo.NO_ERROR:const p=h.getResponseJson();M(Ke,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),l(p);break;case Eo.TIMEOUT:M(Ke,`RPC '${e}' ${o} timed out`),c(new V(D.DEADLINE_EXCEEDED,"Request time out"));break;case Eo.HTTP_ERROR:const m=h.getStatus();if(M(Ke,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);const S=A?.error;if(S&&S.status&&S.message){const k=(function(W){const B=W.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(B)>=0?B:D.UNKNOWN})(S.status);c(new V(k,S.message))}else c(new V(D.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new V(D.UNAVAILABLE,"Connection failed."));break;default:z(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{M(Ke,`RPC '${e}' ${o} completed.`)}}));const f=JSON.stringify(i);M(Ke,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,s,15)}))}T_(e,t,s){const i=Zl(),r=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=r.join("");M(Ke,`Creating RPC '${e}' stream ${i}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,m=!1;const A=new yR({Ho:S=>{m?M(Ke,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(p||(M(Ke,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),M(Ke,`RPC '${e}' stream ${i} sending:`,S),f.send(S))},Jo:()=>f.close()});return Ui(f,$i.EventType.OPEN,(()=>{m||(M(Ke,`RPC '${e}' stream ${i} transport opened.`),A.i_())})),Ui(f,$i.EventType.CLOSE,(()=>{m||(m=!0,M(Ke,`RPC '${e}' stream ${i} transport closed`),A.o_(),this.E_(f))})),Ui(f,$i.EventType.ERROR,(S=>{m||(m=!0,Xs(Ke,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),A.o_(new V(D.UNAVAILABLE,"The operation could not be completed")))})),Ui(f,$i.EventType.MESSAGE,(S=>{if(!m){const k=S.data[0];ve(!!k,16349);const x=k,W=x?.error||x[0]?.error;if(W){M(Ke,`RPC '${e}' stream ${i} received error:`,W);const B=W.status;let K=(function(le){const E=Re[le];if(E!==void 0)return _m(E)})(B),j=W.message;K===void 0&&(K=D.INTERNAL,j="Unknown error status: "+B+" with message "+W.message),m=!0,A.o_(new V(K,j)),f.close()}else M(Ke,`RPC '${e}' stream ${i} received:`,k),A.__(k)}})),$s.u_(),setTimeout((()=>{A.s_()}),0),A}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Gg()}}function vR(n){return new $s(n)}function fl(){return typeof document<"u"?document:null}function km(n){return new SS(n,!0)}$s.c_=!1;class Nm{constructor(e,t,s=1e3,i=1.5,r=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=i,this.V_=r,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-s);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const hf="PersistentStream";class ER{constructor(e,t,s,i,r,o,l,c){this.Ci=e,this.b_=s,this.S_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Nm(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Jt(t.toString()),Jt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,i])=>{this.D_===t&&this.G_(s,i)}),(s=>{e((()=>{const i=new V(D.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(i)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((i=>{s((()=>this.z_(i)))})),this.stream.onMessage((i=>{s((()=>++this.F_==1?this.H_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(hf,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(M(hf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class IR extends ER{constructor(e,t,s,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,i,o),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=NS(this.serializer,e),s=(function(r){if(!("targetChange"in r))return $.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?$.min():o.readTime?Hs(o.readTime):$.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=nf(this.serializer),t.addTarget=(function(r,o){let l;const c=o.target;if(l=zl(c)?{documents:DS(r,c)}:{query:OS(r,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=bS(r,o.resumeToken);const h=Yl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo($.min())>0){l.readTime=RS(r,o.snapshotVersion.toTimestamp());const h=Yl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const s=LS(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=nf(this.serializer),t.removeTarget=e,this.K_(t)}}class TR{}class wR extends TR{constructor(e,t,s,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(D.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Wo(e,Jl(t,s),i,r,o))).catch((r=>{throw r.name==="FirebaseError"?(r.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new V(D.UNKNOWN,r.toString())}))}jo(e,t,s,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.jo(e,Jl(t,s),i,o,l,r))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(D.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function CR(n,e,t,s){return new wR(n,e,t,s)}class AR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Jt(t),this.aa=!1):M("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const si="RemoteStore";class SR{constructor(e,t,s,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=r,this.Aa.Mo((o=>{s.enqueueAndForget((async()=>{Mr(this)&&(M(si,"Restarting streams for network reachability change."),await(async function(c){const h=ie(c);h.Ea.add(4),await Lr(h),h.Va.set("Unknown"),h.Ea.delete(4),await ba(h)})(this))}))})),this.Va=new AR(s,i)}}async function ba(n){if(Mr(n))for(const e of n.Ra)await e(!0)}async function Lr(n){for(const e of n.Ra)await e(!1)}function Dm(n,e){const t=ie(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),yu(t)?_u(t):pi(t).O_()&&mu(t,e))}function gu(n,e){const t=ie(n),s=pi(t);t.Ia.delete(e),s.O_()&&Om(t,e),t.Ia.size===0&&(s.O_()?s.L_():Mr(t)&&t.Va.set("Unknown"))}function mu(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pi(n).Z_(e)}function Om(n,e){n.da.$e(e),pi(n).X_(e)}function _u(n){n.da=new TS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),pi(n).start(),n.Va.ua()}function yu(n){return Mr(n)&&!pi(n).x_()&&n.Ia.size>0}function Mr(n){return ie(n).Ea.size===0}function xm(n){n.da=void 0}async function RR(n){n.Va.set("Online")}async function bR(n){n.Ia.forEach(((e,t)=>{mu(n,e)}))}async function PR(n,e){xm(n),yu(n)?(n.Va.ha(e),_u(n)):n.Va.set("Unknown")}async function kR(n,e,t){if(n.Va.set("Online"),e instanceof vm&&e.state===2&&e.cause)try{await(async function(i,r){const o=r.cause;for(const l of r.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.da.removeTarget(l))})(n,e)}catch(s){M(si,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await df(n,s)}else if(e instanceof wo?n.da.Xe(e):e instanceof ym?n.da.st(e):n.da.tt(e),!t.isEqual($.min()))try{const s=await Pm(n.localStore);t.compareTo(s)>=0&&await(function(r,o){const l=r.da.Tt(o);return l.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=r.Ia.get(h);f&&r.Ia.set(h,f.withResumeToken(c.resumeToken,o))}})),l.targetMismatches.forEach(((c,h)=>{const f=r.Ia.get(c);if(!f)return;r.Ia.set(c,f.withResumeToken($e.EMPTY_BYTE_STRING,f.snapshotVersion)),Om(r,c);const p=new mn(f.target,c,h,f.sequenceNumber);mu(r,p)})),r.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(s){M(si,"Failed to raise snapshot:",s),await df(n,s)}}async function df(n,e,t){if(!fi(e))throw e;n.Ea.add(1),await Lr(n),n.Va.set("Offline"),t||(t=()=>Pm(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(si,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ba(n)}))}async function ff(n,e){const t=ie(n);t.asyncQueue.verifyOperationInProgress(),M(si,"RemoteStore received new credentials");const s=Mr(t);t.Ea.add(3),await Lr(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ba(t)}async function NR(n,e){const t=ie(n);e?(t.Ea.delete(2),await ba(t)):e||(t.Ea.add(2),await Lr(t),t.Va.set("Unknown"))}function pi(n){return n.ma||(n.ma=(function(t,s,i){const r=ie(t);return r.sa(),new IR(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)})(n.datastore,n.asyncQueue,{Zo:RR.bind(null,n),Yo:bR.bind(null,n),t_:PR.bind(null,n),J_:kR.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),yu(n)?_u(n):n.Va.set("Unknown")):(await n.ma.stop(),xm(n))}))),n.ma}class vu{constructor(e,t,s,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new is,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,i,r){const o=Date.now()+s,l=new vu(e,t,o,i,r);return l.start(s),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lm(n,e){if(Jt("AsyncQueue",`${e}: ${n}`),fi(n))return new V(D.UNAVAILABLE,`${e}: ${n}`);throw n}class zs{static emptySet(e){return new zs(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||F.comparator(t.key,s.key):(t,s)=>F.comparator(t.key,s.key),this.keyedMap=zi(),this.sortedSet=new Ae(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zs)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new zs;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class pf{constructor(){this.ga=new Ae(F.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):z(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class ii{constructor(e,t,s,i,r,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,i,r){const o=[];return t.forEach((l=>{o.push({type:0,doc:l})})),new ii(e,t,zs.emptySet(t),o,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==s[i].type||!t[i].doc.isEqual(s[i].doc))return!1;return!0}}class DR{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class OR{constructor(){this.queries=gf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const i=ie(t),r=i.queries;i.queries=gf(),r.forEach(((o,l)=>{for(const c of l.ba)c.onError(s)}))})(this,new V(D.ABORTED,"Firestore shutting down"))}}function gf(){return new _s((n=>lm(n)),wa)}async function xR(n,e){const t=ie(n);let s=3;const i=e.query;let r=t.queries.get(i);r?!r.Sa()&&e.Da()&&(s=2):(r=new DR,s=e.Da()?0:1);try{switch(s){case 0:r.wa=await t.onListen(i,!0);break;case 1:r.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const l=Lm(o,`Initialization of query '${Os(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,r),r.ba.push(e),e.va(t.onlineState),r.wa&&e.Fa(r.wa)&&Eu(t)}async function LR(n,e){const t=ie(n),s=e.query;let i=3;const r=t.queries.get(s);if(r){const o=r.ba.indexOf(e);o>=0&&(r.ba.splice(o,1),r.ba.length===0?i=e.Da()?0:1:!r.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function MR(n,e){const t=ie(n);let s=!1;for(const i of e){const r=i.query,o=t.queries.get(r);if(o){for(const l of o.ba)l.Fa(i)&&(s=!0);o.wa=i}}s&&Eu(t)}function VR(n,e,t){const s=ie(n),i=s.queries.get(e);if(i)for(const r of i.ba)r.onError(t);s.queries.delete(e)}function Eu(n){n.Ca.forEach((e=>{e.next()}))}var ec,mf;(mf=ec||(ec={})).Ma="default",mf.Cache="cache";class FR{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new ii(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ii.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ec.Cache}}class Mm{constructor(e){this.key=e}}class Vm{constructor(e){this.key=e}}class UR{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=re(),this.mutatedKeys=re(),this.eu=cm(e),this.tu=new zs(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new pf,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,p)=>{const m=i.get(f),A=Ca(this.query,p)?p:null,S=!!m&&this.mutatedKeys.has(m.key),k=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let x=!1;m&&A?m.data.isEqual(A.data)?S!==k&&(s.track({type:3,doc:A}),x=!0):this.su(m,A)||(s.track({type:2,doc:A}),x=!0,(c&&this.eu(A,c)>0||h&&this.eu(A,h)<0)&&(l=!0)):!m&&A?(s.track({type:0,doc:A}),x=!0):m&&!A&&(s.track({type:1,doc:m}),x=!0,(c||h)&&(l=!0)),x&&(A?(o=o.add(A),r=k?r.add(f):r.delete(f)):(o=o.delete(f),r=r.delete(f)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),r=r.delete(f.key),s.track({type:1,doc:f})}return{tu:o,iu:s,Ss:l,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((f,p)=>(function(A,S){const k=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z(20277,{Vt:x})}};return k(A)-k(S)})(f.type,p.type)||this.eu(f.doc,p.doc))),this.ou(s),i=i??!1;const l=t&&!i?this._u():[],c=this.Ya.size===0&&this.current&&!i?1:0,h=c!==this.Xa;return this.Xa=c,o.length!==0||h?{snapshot:new ii(this.query,e.tu,r,o,e.mutatedKeys,c===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new pf,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=re(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Vm(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new Mm(s))})),t}cu(e){this.Za=e.ks,this.Ya=re();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ii.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const Iu="SyncEngine";class BR{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class qR{constructor(e){this.key=e,this.hu=!1}}class WR{constructor(e,t,s,i,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new _s((l=>lm(l)),wa),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ae(F.comparator),this.Au=new Map,this.Vu=new hu,this.du={},this.mu=new Map,this.fu=ni.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function jR(n,e,t=!0){const s=Wm(n);let i;const r=s.Tu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.lu()):i=await Fm(s,e,t,!0),i}async function HR(n,e){const t=Wm(n);await Fm(t,e,!0,!1)}async function Fm(n,e,t,s){const i=await dR(n.localStore,Mt(e)),r=i.targetId,o=n.sharedClientState.addLocalQueryTarget(r,t);let l;return s&&(l=await $R(n,e,r,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Dm(n.remoteStore,i),l}async function $R(n,e,t,s,i){n.pu=(p,m,A)=>(async function(k,x,W,B){let K=x.view.ru(W);K.Ss&&(K=await af(k.localStore,x.query,!1).then((({documents:E})=>x.view.ru(E,K))));const j=B&&B.targetChanges.get(x.targetId),ae=B&&B.targetMismatches.get(x.targetId)!=null,le=x.view.applyChanges(K,k.isPrimaryClient,j,ae);return yf(k,x.targetId,le.au),le.snapshot})(n,p,m,A);const r=await af(n.localStore,e,!0),o=new UR(e,r.ks),l=o.ru(r.documents),c=xr.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",i),h=o.applyChanges(l,n.isPrimaryClient,c);yf(n,t,h.au);const f=new BR(e,t,o);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function zR(n,e,t){const s=ie(n),i=s.Tu.get(e),r=s.Iu.get(i.targetId);if(r.length>1)return s.Iu.set(i.targetId,r.filter((o=>!wa(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Xl(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),t&&gu(s.remoteStore,i.targetId),tc(s,i.targetId)})).catch(ya)):(tc(s,i.targetId),await Xl(s.localStore,i.targetId,!0))}async function GR(n,e){const t=ie(n),s=t.Tu.get(e),i=t.Iu.get(s.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),gu(t.remoteStore,s.targetId))}async function Um(n,e){const t=ie(n);try{const s=await uR(t.localStore,e);e.targetChanges.forEach(((i,r)=>{const o=t.Au.get(r);o&&(ve(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?ve(o.hu,14607):i.removedDocuments.size>0&&(ve(o.hu,42227),o.hu=!1))})),await qm(t,s,e)}catch(s){await ya(s)}}function _f(n,e,t){const s=ie(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const i=[];s.Tu.forEach(((r,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(o,l){const c=ie(o);c.onlineState=l;let h=!1;c.queries.forEach(((f,p)=>{for(const m of p.ba)m.va(l)&&(h=!0)})),h&&Eu(c)})(s.eventManager,e),i.length&&s.Pu.J_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function KR(n,e,t){const s=ie(n);s.sharedClientState.updateQueryState(e,"rejected",t);const i=s.Au.get(e),r=i&&i.key;if(r){let o=new Ae(F.comparator);o=o.insert(r,Je.newNoDocument(r,$.min()));const l=re().add(r),c=new Ra($.min(),new Map,new Ae(ee),o,l);await Um(s,c),s.Ru=s.Ru.remove(r),s.Au.delete(e),Tu(s)}else await Xl(s.localStore,e,!1).then((()=>tc(s,e,t))).catch(ya)}function tc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||Bm(n,s)}))}function Bm(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(gu(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),Tu(n))}function yf(n,e,t){for(const s of t)s instanceof Mm?(n.Vu.addReference(s.key,e),QR(n,s)):s instanceof Vm?(M(Iu,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||Bm(n,s.key)):z(19791,{wu:s})}function QR(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||(M(Iu,"New document in limbo: "+t),n.Eu.add(s),Tu(n))}function Tu(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new F(ye.fromString(e)),s=n.fu.next();n.Au.set(s,new qR(t)),n.Ru=n.Ru.insert(t,s),Dm(n.remoteStore,new mn(Mt(au(t.path)),s,"TargetPurposeLimboResolution",va.ce))}}async function qm(n,e,t){const s=ie(n),i=[],r=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((l,c)=>{o.push(s.pu(c,e,t).then((h=>{if((h||t)&&s.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;s.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){i.push(h);const f=fu.Es(c.targetId,h);r.push(f)}})))})),await Promise.all(o),s.Pu.J_(i),await(async function(c,h){const f=ie(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>b.forEach(h,(m=>b.forEach(m.Ts,(A=>f.persistence.referenceDelegate.addReference(p,m.targetId,A))).next((()=>b.forEach(m.Is,(A=>f.persistence.referenceDelegate.removeReference(p,m.targetId,A)))))))))}catch(p){if(!fi(p))throw p;M(pu,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const A=f.vs.get(m),S=A.snapshotVersion,k=A.withLastLimboFreeSnapshotVersion(S);f.vs=f.vs.insert(m,k)}}})(s.localStore,r))}async function YR(n,e){const t=ie(n);if(!t.currentUser.isEqual(e)){M(Iu,"User change. New user:",e.toKey());const s=await bm(t.localStore,e);t.currentUser=e,(function(r,o){r.mu.forEach((l=>{l.forEach((c=>{c.reject(new V(D.CANCELLED,o))}))})),r.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await qm(t,s.Ns)}}function JR(n,e){const t=ie(n),s=t.Au.get(e);if(s&&s.hu)return re().add(s.key);{let i=re();const r=t.Iu.get(e);if(!r)return i;for(const o of r){const l=t.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}function Wm(n){const e=ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Um.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=JR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KR.bind(null,e),e.Pu.J_=MR.bind(null,e.eventManager),e.Pu.yu=VR.bind(null,e.eventManager),e}class ea{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=km(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return cR(this.persistence,new oR,e.initialUser,this.serializer)}Cu(e){return new Rm(du.Vi,this.serializer)}Du(e){return new pR}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ea.provider={build:()=>new ea};class XR extends ea{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ve(this.persistence.referenceDelegate instanceof Zo,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new $S(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?st.withCacheSize(this.cacheSizeBytes):st.DEFAULT;return new Rm((s=>Zo.Vi(s,t)),this.serializer)}}class nc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>_f(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=YR.bind(null,this.syncEngine),await NR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new OR})()}createDatastore(e){const t=km(e.databaseInfo.databaseId),s=vR(e.databaseInfo);return CR(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,i,r,o,l){return new SR(s,i,r,o,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>_f(this.syncEngine,t,0)),(function(){return uf.v()?new uf:new gR})())}createSyncEngine(e,t){return(function(i,r,o,l,c,h,f){const p=new WR(i,r,o,l,c,h);return f&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=ie(t);M(si,"RemoteStore shutting down."),s.Ea.add(5),await Lr(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}nc.provider={build:()=>new nc};class ZR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Jt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const On="FirestoreClient";class eb{constructor(e,t,s,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=i,this.user=Qe.UNAUTHENTICATED,this.clientId=nu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,(async o=>{M(On,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(M(On,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new is;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Lm(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function pl(n,e){n.asyncQueue.verifyOperationInProgress(),M(On,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async i=>{s.isEqual(i)||(await bm(e.localStore,i),s=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function vf(n,e){n.asyncQueue.verifyOperationInProgress();const t=await tb(n);M(On,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>ff(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,i)=>ff(e.remoteStore,i))),n._onlineComponents=e}async function tb(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(On,"Using user provided OfflineComponentProvider");try{await pl(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===D.FAILED_PRECONDITION||i.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Xs("Error using user provided cache. Falling back to memory cache: "+t),await pl(n,new ea)}}else M(On,"Using default OfflineComponentProvider"),await pl(n,new XR(void 0));return n._offlineComponents}async function nb(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(On,"Using user provided OnlineComponentProvider"),await vf(n,n._uninitializedComponentsProvider._online)):(M(On,"Using default OnlineComponentProvider"),await vf(n,new nc))),n._onlineComponents}async function sb(n){const e=await nb(n),t=e.eventManager;return t.onListen=jR.bind(null,e.syncEngine),t.onUnlisten=zR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=HR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=GR.bind(null,e.syncEngine),t}function ib(n,e,t={}){const s=new is;return n.asyncQueue.enqueueAndForget((async()=>(function(r,o,l,c,h){const f=new ZR({next:m=>{f.Nu(),o.enqueueAndForget((()=>LR(r,p)));const A=m.docs.has(l);!A&&m.fromCache?h.reject(new V(D.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&m.fromCache&&c&&c.source==="server"?h.reject(new V(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new FR(au(l.path),f,{includeMetadataChanges:!0,Ka:!0});return xR(r,p)})(await sb(n),n.asyncQueue,e,t,s))),s.promise}function jm(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const rb="ComponentProvider",Ef=new Map;function ob(n,e,t,s,i){return new LA(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,jm(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,s)}const Hm="firestore.googleapis.com",If=!0;class Tf{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Hm,this.ssl=If}else this.host=e.host,this.ssl=e.ssl??If;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Sm;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<jS)throw new V(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}IA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jm(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,i){return s.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wu{constructor(e,t,s,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Tf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Tf(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new uA;switch(s.type){case"firstParty":return new pA(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new V(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=Ef.get(t);s&&(M(rb,"Removing Datastore"),Ef.delete(t),s.terminate())})(this),Promise.resolve()}}function ab(n,e,t,s={}){n=Bl(n,wu);const i=xn(e),r=n._getSettings(),o={...r,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(ac(`https://${l}`),lc("Firestore",!0)),r.host!==Hm&&r.host!==l&&Xs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...r,host:l,ssl:i,emulatorOptions:s};if(!Cn(c,o)&&(n._setSettings(c),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=Qe.MOCK_USER;else{h=Bf(s.mockUserToken,n._app?.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new V(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Qe(p)}n._authCredentials=new hA(new Qg(h,f))}}class Cu{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Cu(this.firestore,e,this._query)}}class tt{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tt(this.firestore,e,this._key)}toJSON(){return{type:tt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Dr(t,tt._jsonSchema))return new tt(e,s||null,new F(ye.fromString(t.referencePath)))}}tt._jsonSchemaVersion="firestore/documentReference/1.0",tt._jsonSchema={type:Pe("string",tt._jsonSchemaVersion),referencePath:Pe("string")};class Tr extends Cu{constructor(e,t,s){super(e,t,au(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tt(this.firestore,null,new F(e))}withConverter(e){return new Tr(this.firestore,e,this._path)}}function lb(n,e,...t){if(n=Ze(n),arguments.length===1&&(e=nu.newId()),EA("doc","path",e),n instanceof wu){const s=ye.fromString(e,...t);return xd(s),new tt(n,null,new F(s))}{if(!(n instanceof tt||n instanceof Tr))throw new V(D.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ye.fromString(e,...t));return xd(s),new tt(n.firestore,n instanceof Tr?n.converter:null,new F(s))}}const wf="AsyncQueue";class Cf{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Nm(this,"async_queue_retry"),this._c=()=>{const s=fl();s&&M(wf,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=fl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=fl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new is;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!fi(e))throw e;M(wf,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,Jt("INTERNAL UNHANDLED ERROR: ",Af(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=vu.createAndSchedule(this,e,t,s,(r=>this.hc(r)));return this.tc.push(i),i}uc(){this.nc&&z(47125,{Pc:Af(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Af(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class $m extends wu{constructor(e,t,s,i){super(e,t,s,i),this.type="firestore",this._queue=new Cf,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Cf(e),this._firestoreClient=void 0,await e}}}function cb(n,e){const t=typeof n=="object"?n:dc(),s=typeof n=="string"?n:Ko,i=ra(t,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=Vf("firestore");r&&ab(i,...r)}return i}function ub(n){if(n._terminated)throw new V(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||hb(n),n._firestoreClient}function hb(n){const e=n._freezeSettings(),t=ob(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new eb(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const r=i?._online.build();return{_offline:i?._offline.build(r),_online:r}})(n._componentsProvider))}class Nt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Nt($e.fromBase64String(e))}catch(t){throw new V(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Nt($e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Nt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Dr(e,Nt._jsonSchema))return Nt.fromBase64String(e.bytes)}}Nt._jsonSchemaVersion="firestore/bytes/1.0",Nt._jsonSchema={type:Pe("string",Nt._jsonSchemaVersion),bytes:Pe("string")};class zm{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Tn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Tn._jsonSchemaVersion}}static fromJSON(e){if(Dr(e,Tn._jsonSchema))return new Tn(e.latitude,e.longitude)}}Tn._jsonSchemaVersion="firestore/geoPoint/1.0",Tn._jsonSchema={type:Pe("string",Tn._jsonSchemaVersion),latitude:Pe("number"),longitude:Pe("number")};class wn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:wn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Dr(e,wn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new wn(e.vectorValues);throw new V(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}wn._jsonSchemaVersion="firestore/vectorValue/1.0",wn._jsonSchema={type:Pe("string",wn._jsonSchemaVersion),vectorValues:Pe("object")};function Gm(n,e,t){if((e=Ze(e))instanceof zm)return e._internalPath;if(typeof e=="string")return fb(n,e);throw sc("Field path arguments must be of type string or ",n)}const db=new RegExp("[~\\*/\\[\\]]");function fb(n,e,t){if(e.search(db)>=0)throw sc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new zm(...e.split("."))._internalPath}catch{throw sc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function sc(n,e,t,s,i){let r=`Function ${e}() called with invalid data`;r+=". ";let o="";return new V(D.INVALID_ARGUMENT,r+n+o)}class pb{convertValue(e,t="none"){switch(Nn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw z(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Or(e,((i,r)=>{s[i]=this.convertValue(r,t)})),s}convertVectorValue(e){const t=e.fields?.[Wl].arrayValue?.values?.map((s=>Ce(s.doubleValue)));return new wn(t)}convertGeoPoint(e){return new Tn(Ce(e.latitude),Ce(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Ia(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(vr(e));default:return null}}convertTimestamp(e){const t=Pn(e);return new be(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=ye.fromString(e);ve(Am(s),9688,{name:e});const i=new Er(s.get(1),s.get(3)),r=new F(s.popFirst(5));return i.isEqual(t)||Jt(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class gb extends pb{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tt(this.firestore,null,t)}}const Sf="@firebase/firestore",Rf="4.10.0";class Km{constructor(e,t,s,i,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new mb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Gm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class mb extends Km{data(){return super.data()}}class Ki{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class os extends Km{constructor(e,t,s,i,r,o){super(e,t,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Co(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Gm("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=os._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}os._jsonSchemaVersion="firestore/documentSnapshot/1.0",os._jsonSchema={type:Pe("string",os._jsonSchemaVersion),bundleSource:Pe("string","DocumentSnapshot"),bundleName:Pe("string"),bundle:Pe("string")};class Co extends os{data(e={}){return super.data(e)}}class or{constructor(e,t,s,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ki(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Co(this._firestore,this._userDataWriter,s.key,s,new Ki(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,r){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((l=>{const c=new Co(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Ki(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>r||l.type!==3)).map((l=>{const c=new Co(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Ki(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:_b(l.type),doc:c,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=or._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=nu.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],i=[];return this.docs.forEach((r=>{r._document!==null&&(t.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function _b(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z(61501,{type:n})}}or._jsonSchemaVersion="firestore/querySnapshot/1.0",or._jsonSchema={type:Pe("string",or._jsonSchemaVersion),bundleSource:Pe("string","QuerySnapshot"),bundleName:Pe("string"),bundle:Pe("string")};function yb(n){n=Bl(n,tt);const e=Bl(n.firestore,$m),t=ub(e);return ib(t,n._key).then((s=>vb(e,n,s)))}function vb(n,e,t){const s=t.docs.get(e._key),i=new gb(n);return new os(n,i,e._key,s,new Ki(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){cA(ps),as(new An("firestore",((s,{instanceIdentifier:i,options:r})=>{const o=s.getProvider("app").getImmediate(),l=new $m(new dA(s.getProvider("auth-internal")),new gA(o,s.getProvider("app-check-internal")),MA(o,i),o);return r={useFetchStreams:t,...r},l._setSettings(r),l}),"PUBLIC").setMultipleInstances(!0)),Ot(Sf,Rf,e),Ot(Sf,Rf,"esm2020")})();const Eb={apiKey:"AIzaSyBpKsDGhucKO_QbNgjXG3vX1vuduYl8xy4",authDomain:"shopping-list-e939f.firebaseapp.com",databaseURL:"https://shopping-list-e939f-default-rtdb.firebaseio.com/",projectId:"shopping-list-e939f",storageBucket:"shopping-list-e939f.appspot.com"},Au=$f(Eb),Bi=GT(Au),ic=aA(Au),Ib=cb(Au),Qm=m_(void 0);Yw(ic,n=>{Qm.set(n)});var Tb=_t('<link rel="preconnect" href="https://fonts.googleapis.com" class="svelte-1uha8ag"/> <link rel="preconnect" href="https://fonts.gstatic.com" class="svelte-1uha8ag"/> <link href="https://fonts.googleapis.com/css2?family=Playwrite+US+Modern:wght@100&amp;display=swap" rel="stylesheet" class="svelte-1uha8ag"/>',1),wb=_t('<p class="user-name show svelte-1uha8ag"> </p> <p class="logout-link show svelte-1uha8ag">Logout</p>',1),Cb=_t('<li><span class="item svelte-1uha8ag"> </span> <span class="quantity svelte-1uha8ag"> </span> <span class="user svelte-1uha8ag"> </span></li>'),Ab=_t('<p class="empty-list svelte-1uha8ag">Loading shopping list...</p>'),Sb=_t('<p class="empty-list svelte-1uha8ag">Shopping List is Empty</p>'),Rb=_t('<button class="edit-btn svelte-1uha8ag">Edit selected item</button>'),bb=_t('<div class="delete-all-container svelte-1uha8ag"><!> <button class="delete-all-btn svelte-1uha8ag"> </button></div>'),Pb=_t('<div class="row svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="item-input" type="text" placeholder="Item to buy" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="quantity-input" type="text" placeholder="Quantity to buy" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-add-button svelte-1uha8ag"> </button></div></div> <ul class="list-container svelte-1uha8ag"><!> <!></ul> <!>',1),kb=_t('<div class="confirm-delete-overlay svelte-1uha8ag"><div class="confirm-delete-modal svelte-1uha8ag"><h3 class="svelte-1uha8ag">Delete selected items?</h3> <p class="svelte-1uha8ag"> </p> <div class="confirm-buttons svelte-1uha8ag"><button class="confirm-yes svelte-1uha8ag"> </button> <button class="confirm-no svelte-1uha8ag">Cancel</button></div></div></div>'),Nb=_t('<div class="edit-overlay svelte-1uha8ag"><div class="edit-modal svelte-1uha8ag"><h3 class="svelte-1uha8ag">Edit Item</h3> <div class="input-container svelte-1uha8ag"><input type="text" placeholder="Item name" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input type="text" placeholder="Quantity" class="svelte-1uha8ag"/></div> <div class="confirm-buttons svelte-1uha8ag"><button class="confirm-yes svelte-1uha8ag"> </button> <button class="confirm-no svelte-1uha8ag">Cancel</button></div></div></div>'),Db=_t('<div class="error-banner svelte-1uha8ag"> <button class="error-close svelte-1uha8ag">x</button></div>'),Ob=_t('<!> <div><div class="modal svelte-1uha8ag"><h3 class="login-title svelte-1uha8ag">Login</h3> <div class="modal-input-container svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="email-input" type="email" placeholder="Email Address" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="password-input" type="password" placeholder="Password" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-login-button svelte-1uha8ag">Login</button></div></div></div></div> <div class="container svelte-1uha8ag"><div class="shopping-app svelte-1uha8ag"><div class="user-login-container svelte-1uha8ag"><p>Login</p> <!></div> <h2 class="svelte-1uha8ag">Shopping List <img src="/icons/shopping-list.png" alt="" class="svelte-1uha8ag"/></h2> <!></div></div> <!> <!> <!> <footer class="svelte-1uha8ag"><a href="https://www.flaticon.com/free-icons/checklist" title="checklist icons" class="svelte-1uha8ag">Icons created by Freepik - Flaticon</a></footer>',1);function jb(n,e){M_(e,!1);const t=()=>j_(Qm,"$authUser",s),[s,i]=W_(),r=_e(),o=_e(),l=_e();let c=_e(!1),h=_e({}),f=_e([]),p=_e(!1),m=_e(!1),A=_e(!1),S=_e(!1),k=_e(!0),x=_e(""),W=_e(null),B=_e(!1),K=_e(!1),j=_e(null);__(()=>{const L=Fi(Bi,"items"),Q=UT(L,de=>{H(h,{...de.val()||{}}),H(k,!1)});return()=>Q()});let ae=_e(""),le=_e(""),E=_e(""),_=_e(""),v=_e(""),T=_e("");const I=async L=>{const Q=P(h)[L];if(!Q)return;const de=Fi(Bi,`items/${L}`);await go(de,{...Q,checked:!Q.checked})},C=async()=>{if(!P(_).trim()||!P(v).trim()){alert("Item name and quantity cannot be empty.");return}H(c,!0),H(x,"");try{const L=MT(Fi(Bi,"items"));await go(L,{itemId:L.key,item:P(_).trim(),quantity:P(v).trim(),user:P(E),checked:!1}),H(_,""),H(v,""),document.querySelector('input[type="text"]:first-of-type')?.focus()}catch(L){console.error("Add failed:",L)}finally{H(c,!1)}},y=async L=>{const Q=lb(Ib,"users",L),de=await yb(Q);if(!de.exists())throw new Error("User document does not exist");const Te=de.data();if(!Te.user)throw new Error("User name missing in user document");return Te.user},Be=async()=>{if(!(!P(ae)||!P(le))){H(c,!0);try{const L=await Gw(ic,P(ae),P(le));H(A,!1)}catch(L){alert("Login failed: "+L.message)}finally{H(c,!1)}}},Ut=async()=>{await ic.signOut(),H(E,"")},Pa=async()=>{H(S,!0);try{await Promise.all(P(f).map(L=>VT(Fi(Bi,`items/${L}`)))),H(f,[]),H(m,!1)}catch(L){console.error("Delete failed:",L)}finally{H(S,!1)}},ka=()=>{P(o)&&(H(j,P(o)),H(K,!0))},ys=async()=>{if(!P(j)||!P(j).itemId)return;if(!P(j).item||!P(j).quantity){alert("Item name and quantity cannot be empty.");return}const L=Fi(Bi,`items/${P(j).itemId}`);H(x,"");try{await go(L,{itemId:P(j).itemId,item:P(j).item.trim(),quantity:P(j).quantity.trim(),user:P(j).user,checked:!1})}catch(Q){console.error("Edit failed:",Q)}finally{H(K,!1),H(j,null)}},Vn=()=>{H(K,!1),H(j,null)};function vs(L){const Q=L.currentTarget;!P(r)&&Q.id==="email-input"&&L.key==="Enter"&&(L.preventDefault(),document.getElementById("password-input")?.focus()),!P(r)&&Q.id==="password-input"&&P(ae)&&P(le)&&L.key==="Enter"&&(L.preventDefault(),Be()),P(r)&&Q.id==="item-input"&&L.key==="Enter"&&(L.preventDefault(),document.getElementById("quantity-input")?.focus()),P(r)&&Q.id==="quantity-input"&&P(_)&&P(v)&&L.key==="Enter"&&!P(c)&&(L.preventDefault(),C())}Bt(()=>t(),()=>{H(r,!!t())}),Bt(()=>t(),()=>{H(T,t()?t().displayName||t().email||"User":"")}),Bt(()=>t(),()=>{t()!==void 0&&H(B,!0)}),Bt(()=>(P(B),t(),P(W)),()=>{P(B)&&t()?(t().uid!==P(W)&&H(W,t().uid),y(t().uid).then(L=>{H(E,L)}).catch(()=>{H(E,t().displayName||t().email||"User")})):H(E,"")}),Bt(()=>(P(B),t()),()=>{P(B)&&t()===null&&(H(W,null),H(E,""))}),Bt(()=>P(h),()=>{H(f,Object.values(P(h)).filter(L=>L.checked).map(L=>L.itemId))}),Bt(()=>(P(f),P(h)),()=>{H(o,P(f).length===1?Object.values(P(h)).find(L=>L.itemId===P(f)[0])??null:null)}),Bt(()=>P(o),()=>{H(l,P(o)!==null)}),Bt(()=>P(f),()=>{H(p,P(f).length>0)}),V_(),g_();var gi=Ob();H_("1uha8ag",L=>{var Q=Tb();ph(4),U_(()=>{B_.title="Shopping List"}),dt(L,Q)});var mi=so(gi);Y_(mi,e,"default",{});var Fn=ue(mi,2);let Un;var Es=te(Fn),Is=ue(te(Es),2),Bn=te(Is),qn=te(Bn);bs(qn),ne(Bn);var Ts=ue(Bn,2),_i=te(Ts);bs(_i),ne(Ts);var Vr=ue(Ts,2),Fr=te(Vr);ne(Vr),ne(Is),ne(Es),ne(Fn);var Wn=ue(Fn,2),yi=te(Wn),vi=te(yi),jn=te(vi);let ws;var Ur=ue(jn,2);{var Le=L=>{var Q=wb(),de=so(Q),Te=te(de,!0);ne(de);var nt=ue(de,2);an(()=>bt(Te,P(E))),Ne("click",nt,Ut),dt(L,Q)};qt(Ur,L=>{P(r)&&L(Le)})}ne(vi);var qe=ue(vi,4);{var Cs=L=>{var Q=Pb(),de=so(Q),Te=te(de),nt=te(Te);bs(nt),ne(Te);var ze=ue(Te,2),Ge=te(ze);bs(Ge),ne(ze);var yt=ue(ze,2),Se=te(yt),As=te(Se,!0);ne(Se),ne(yt),ne(de);var At=ue(de,2),at=te(At);G_(at,1,()=>(P(h),ft(()=>Object.values(P(h)))),fe=>fe.itemId,(fe,we)=>{var lt=Cb();let ct;var ut=te(lt),Gn=te(ut,!0);ne(ut);var gt=ue(ut,2),Kn=te(gt,!0);ne(gt);var Ei=ue(gt,2),Ii=te(Ei,!0);ne(Ei),ne(lt),an(()=>{$_(lt,"data-item-id",(P(we),ft(()=>P(we).itemId))),ct=za(lt,1,"svelte-1uha8ag",null,ct,{checked:P(we).checked}),bt(Gn,(P(we),ft(()=>P(we).item))),bt(Kn,(P(we),ft(()=>P(we).quantity))),bt(Ii,(P(we),ft(()=>P(we).user)))}),Ne("click",lt,()=>I(P(we).itemId)),dt(fe,lt)});var $n=ue(at,2);{var $r=fe=>{var we=Ab();dt(fe,we)},We=fe=>{var we=p_(),lt=so(we);{var ct=ut=>{var Gn=Sb();dt(ut,Gn)};qt(lt,ut=>{P(h),ft(()=>Object.keys(P(h)).length===0)&&ut(ct)},!0)}dt(fe,we)};qt($n,fe=>{P(k)?fe($r):fe(We,!1)})}ne(At);var zr=ue(At,2);{var zn=fe=>{var we=bb(),lt=te(we);{var ct=gt=>{var Kn=Rb();Ne("click",Kn,ka),dt(gt,Kn)};qt(lt,gt=>{P(l)&&gt(ct)})}var ut=ue(lt,2),Gn=te(ut);ne(ut),ne(we),an(()=>bt(Gn,`Delete ${P(f),ft(()=>P(f).length)??""} selected item${P(f),ft(()=>P(f).length===1?"":"s")??""}`)),Ne("click",ut,()=>H(m,!0)),dt(fe,we)};qt(zr,fe=>{P(p)&&!P(k)&&fe(zn)})}an(fe=>{Se.disabled=fe,bt(As,P(c)?"Adding...":"Add")},[()=>(P(c),P(_),P(v),ft(()=>P(c)||!P(_).trim()||!P(v).trim()))]),Ps(nt,()=>P(_),fe=>H(_,fe)),Ne("keydown",nt,vs),Ps(Ge,()=>P(v),fe=>H(v,fe)),Ne("keydown",Ge,vs),Ne("click",Se,C),dt(L,Q)};qt(qe,L=>{P(r)&&L(Cs)})}ne(yi),ne(Wn);var Br=ue(Wn,2);{var qr=L=>{var Q=kb(),de=te(Q),Te=ue(te(de),2),nt=te(Te);ne(Te);var ze=ue(Te,2),Ge=te(ze),yt=te(Ge,!0);ne(Ge);var Se=ue(Ge,2);ne(ze),ne(de),ne(Q),an(()=>{bt(nt,`This will delete ${P(f),ft(()=>P(f).length)??""} item${P(f),ft(()=>P(f).length===1?"":"s")??""}`),Ge.disabled=P(S),bt(yt,P(S)?"Deleting...":"Yes, Delete")}),Ne("click",Ge,Pa),Ne("click",Se,()=>H(m,!1)),Ne("click",Q,()=>H(m,!1)),dt(L,Q)};qt(Br,L=>{P(m)&&L(qr)})}var Wr=ue(Br,2);{var Hn=L=>{var Q=Nb(),de=te(Q),Te=ue(te(de),2),nt=te(Te);bs(nt),q_(nt),ne(Te);var ze=ue(Te,2),Ge=te(ze);bs(Ge),ne(ze);var yt=ue(ze,2),Se=te(yt),As=te(Se,!0);ne(Se);var At=ue(Se,2);ne(yt),ne(de),ne(Q),an(at=>{Se.disabled=at,bt(As,P(c)?"Saving...":"Save")},[()=>(P(c),P(j),ft(()=>P(c)||!P(j)?.item?.trim()||!P(j)?.quantity?.trim()))]),Ps(nt,()=>P(j).item,at=>gh(j,P(j).item=at)),Ps(Ge,()=>P(j).quantity,at=>gh(j,P(j).quantity=at)),Ne("click",Se,ys),Ne("click",At,Vn),Ne("click",de,X_(function(at){Z_.call(this,e,at)})),Ne("click",Q,Vn),dt(L,Q)};qt(Wr,L=>{P(K)&&P(j)&&L(Hn)})}var jr=ue(Wr,2);{var Hr=L=>{var Q=Db(),de=te(Q),Te=ue(de);ne(Q),an(()=>bt(de,`Something went wrong: ${P(x)??""} `)),Ne("click",Te,()=>H(x,"")),dt(L,Q)};qt(jr,L=>{P(x)&&L(Hr)})}ph(2),an(()=>{Un=za(Fn,1,"login-box svelte-1uha8ag",null,Un,{show:P(A)}),ws=za(jn,1,"login-link svelte-1uha8ag",null,ws,{hidden:P(r)})}),Ps(qn,()=>P(ae),L=>H(ae,L)),Ne("keydown",qn,vs),Ps(_i,()=>P(le),L=>H(le,L)),Ne("keydown",_i,vs),Ne("click",Fr,Be),Ne("click",jn,()=>H(A,!0)),dt(n,gi),F_(),i()}export{jb as component};
