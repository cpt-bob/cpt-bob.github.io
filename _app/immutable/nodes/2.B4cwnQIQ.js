import{a as ht,f as Dt,c as h_}from"../chunks/D7QdLEZZ.js";import{i as d_}from"../chunks/ClAqUbnV.js";import{o as f_}from"../chunks/BANdTC2R.js";import{h as Lt,a as wf,b as p_,F as x,r as g_,H as m_,s as ih,c as rh,d as La,k as qr,C as __,av as y_,ae as oh,e as gs,j as ol,l as v_,aJ as E_,aR as I_,at as Yl,aS as T_,a2 as ah,aT as w_,aU as C_,aN as Qe,i as lh,aV as an,f as Cf,p as Af,aW as xa,aX as A_,as as S_,g as R_,o as b_,aY as P_,aO as k_,A as dt,a0 as N_,aZ as D_,M as O_,a_ as Ma,a$ as L_,O as Wr,P as Bn,Q as x_,ax as M_,R as re,aD as le,af as ch,b0 as V_,T as Te,S as oe}from"../chunks/CCY3sXXW.js";import{e as ot,s as Zt}from"../chunks/Dw9oiAbd.js";import{i as qn}from"../chunks/fodITZ5v.js";import{h as F_,r as jr,s as U_}from"../chunks/RVHQM7mL.js";function B_(n,e,t){for(var s=[],i=e.length,r,o=e.length,l=0;l<i;l++){let p=e[l];Af(p,()=>{if(r){if(r.pending.delete(p),r.done.add(p),r.pending.size===0){var m=n.outrogroups;al(Yl(r.done)),m.delete(r),m.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=s.length===0&&t!==null;if(c){var h=t,f=h.parentNode;S_(f),f.append(h),n.items.clear()}al(e,!c)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function al(n,e=!0){for(var t=0;t<n.length;t++)R_(n[t],e)}var uh;function q_(n,e,t,s,i,r=null){var o=n,l=new Map;Lt&&wf();var c=null,h=E_(()=>{var P=t();return I_(P)?P:P==null?[]:Yl(P)}),f,p=!0;function m(){S.fallback=c,W_(S,f,o,e,s),c!==null&&(f.length===0?(c.f&an)===0?Cf(c):(c.f^=an,Si(c,null,o)):Af(c,()=>{c=null}))}var A=p_(()=>{f=x(h);var P=f.length;let O=!1;if(Lt){var B=g_(o)===m_;B!==(P===0)&&(o=ih(),rh(o),La(!1),O=!0)}for(var W=new Set,K=gs,ge=v_(),ue=0;ue<P;ue+=1){Lt&&qr.nodeType===__&&qr.data===y_&&(o=qr,O=!0,La(!1));var he=f[ue],I=s(he,ue),_=p?null:l.get(I);_?(_.v&&oh(_.v,he),_.i&&oh(_.i,ue),ge&&K.skipped_effects.delete(_.e)):(_=j_(l,p?o:uh??=lh(),he,I,ue,i,e,t),p||(_.e.f|=an),l.set(I,_)),W.add(I)}if(P===0&&r&&!c&&(p?c=ol(()=>r(o)):(c=ol(()=>r(uh??=lh())),c.f|=an)),Lt&&P>0&&rh(ih()),!p)if(ge){for(const[v,T]of l)W.has(v)||K.skipped_effects.add(T.e);K.oncommit(m),K.ondiscard(()=>{})}else m();O&&La(!0),x(h)}),S={effect:A,items:l,outrogroups:null,fallback:c};p=!1,Lt&&(o=qr)}function Ei(n){for(;n!==null&&(n.f&A_)===0;)n=n.next;return n}function W_(n,e,t,s,i){var r=e.length,o=n.items,l=Ei(n.effect.first),c,h=null,f=[],p=[],m,A,S,P;for(P=0;P<r;P+=1){if(m=e[P],A=i(m,P),S=o.get(A).e,n.outrogroups!==null)for(const _ of n.outrogroups)_.pending.delete(S),_.done.delete(S);if((S.f&an)!==0)if(S.f^=an,S===l)Si(S,null,t);else{var O=h?h.next:l;S===n.effect.last&&(n.effect.last=S.prev),S.prev&&(S.prev.next=S.next),S.next&&(S.next.prev=S.prev),en(n,h,S),en(n,S,O),Si(S,O,t),h=S,f=[],p=[],l=Ei(h.next);continue}if((S.f&xa)!==0&&Cf(S),S!==l){if(c!==void 0&&c.has(S)){if(f.length<p.length){var B=p[0],W;h=B.prev;var K=f[0],ge=f[f.length-1];for(W=0;W<f.length;W+=1)Si(f[W],B,t);for(W=0;W<p.length;W+=1)c.delete(p[W]);en(n,K.prev,ge.next),en(n,h,K),en(n,ge,B),l=B,h=ge,P-=1,f=[],p=[]}else c.delete(S),Si(S,l,t),en(n,S.prev,S.next),en(n,S,h===null?n.effect.first:h.next),en(n,h,S),h=S;continue}for(f=[],p=[];l!==null&&l!==S;)(c??=new Set).add(l),p.push(l),l=Ei(l.next);if(l===null)continue}(S.f&an)===0&&f.push(S),h=S,l=Ei(S.next)}if(n.outrogroups!==null){for(const _ of n.outrogroups)_.pending.size===0&&(al(Yl(_.done)),n.outrogroups?.delete(_));n.outrogroups.size===0&&(n.outrogroups=null)}if(l!==null||c!==void 0){var ue=[];if(c!==void 0)for(S of c)(S.f&xa)===0&&ue.push(S);for(;l!==null;)(l.f&xa)===0&&l!==n.fallback&&ue.push(l),l=Ei(l.next);var he=ue.length;if(he>0){var I=null;B_(n,ue,I)}}}function j_(n,e,t,s,i,r,o,l){var c=(o&w_)!==0?(o&C_)===0?Qe(t,!1,!1):ah(t):null,h=(o&T_)!==0?ah(i):null;return{v:c,i:h,e:ol(()=>(r(e,c??t,h??i,l),()=>{n.delete(s)}))}}function Si(n,e,t){if(n.nodes)for(var s=n.nodes.start,i=n.nodes.end,r=e&&(e.f&an)===0?e.nodes.start:t;s!==null;){var o=b_(s);if(r.before(s),s===i)return;s=o}}function en(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function H_(n,e,t,s,i){Lt&&wf();var r=e.$$slots?.[t],o=!1;r===!0&&(r=e.children,o=!0),r===void 0||r(n,o?()=>s:s)}const hh=[...` 	
\r\fÂ \v\uFEFF`];function $_(n,e,t){var s=n==null?"":""+n;if(t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var r=i.length,o=0;(o=s.indexOf(i,o))>=0;){var l=o+r;(o===0||hh.includes(s[o-1]))&&(l===s.length||hh.includes(s[l]))?s=(o===0?"":s.substring(0,o))+s.substring(l+1):o=l}}return s===""?null:s}function Va(n,e,t,s,i,r){var o=n.__className;if(Lt||o!==t||o===void 0){var l=$_(t,s,r);(!Lt||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}else if(r&&i!==r)for(var c in r){var h=!!r[c];(i==null||h!==!!i[c])&&n.classList.toggle(c,h)}return r}function Hr(n,e,t=e){var s=new WeakSet;P_(n,"input",async i=>{var r=i?n.defaultValue:n.value;if(r=Fa(n)?Ua(r):r,t(r),gs!==null&&s.add(gs),await k_(),r!==(r=e())){var o=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=r??"",l!==null){var h=n.value.length;o===l&&l===c&&h>c?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=o,n.selectionEnd=Math.min(l,h))}}}),(Lt&&n.defaultValue!==n.value||dt(e)==null&&n.value)&&(t(Fa(n)?Ua(n.value):n.value),gs!==null&&s.add(gs)),N_(()=>{var i=e();if(n===document.activeElement){var r=D_??gs;if(s.has(r))return}Fa(n)&&i===Ua(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Fa(n){var e=n.type;return e==="number"||e==="range"}function Ua(n){return n===""?null:+n}const z_=()=>{};var dh={};const Sf={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const k=function(n,e){if(!n)throw js(e)},js=function(n){return new Error("Firebase Database ("+Sf.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Rf=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},G_=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],l=n[t++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Jl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,f=r>>2,p=(r&3)<<4|l>>4;let m=(l&15)<<2|h>>6,A=h&63;c||(A=64,o||(m=64)),s.push(t[f],t[p],t[m],t[A])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Rf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):G_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||l==null||h==null||p==null)throw new K_;const m=r<<2|l>>4;if(s.push(m),h!==64){const A=l<<4&240|h>>2;if(s.push(A),p!==64){const S=h<<6&192|p;s.push(S)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class K_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bf=function(n){const e=Rf(n);return Jl.encodeByteArray(e,!0)},fo=function(n){return bf(n).replace(/\./g,"")},po=function(n){try{return Jl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Q_(n){return Pf(void 0,n)}function Pf(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Y_(t)||(n[t]=Pf(n[t],e[t]));return n}function Y_(n){return n!=="__proto__"}function J_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const X_=()=>J_().__FIREBASE_DEFAULTS__,Z_=()=>{if(typeof process>"u"||typeof dh>"u")return;const n=dh.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ey=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&po(n[1]);return e&&JSON.parse(e)},jo=()=>{try{return z_()||X_()||Z_()||ey()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},kf=n=>jo()?.emulatorHosts?.[n],Nf=n=>{const e=kf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Df=()=>jo()?.config,Of=n=>jo()?.[`_${n}`];class Ho{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Rn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Xl(n){return(await fetch(n,{credentials:"include"})).ok}function Lf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[fo(JSON.stringify(t)),fo(JSON.stringify(o)),""].join(".")}const Li={};function ty(){const n={prod:[],emulator:[]};for(const e of Object.keys(Li))Li[e]?n.emulator.push(e):n.prod.push(e);return n}function ny(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let fh=!1;function Zl(n,e){if(typeof window>"u"||typeof document>"u"||!Rn(window.location.host)||Li[n]===e||Li[n]||fh)return;Li[n]=e;function t(m){return`__firebase__banner__${m}`}const s="__firebase__banner",r=ty().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,A){m.setAttribute("width","24"),m.setAttribute("id",A),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{fh=!0,o()},m}function f(m,A){m.setAttribute("id",A),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=ny(s),A=t("text"),S=document.getElementById(A)||document.createElement("span"),P=t("learnmore"),O=document.getElementById(P)||document.createElement("a"),B=t("preprendIcon"),W=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const K=m.element;l(K),f(O,P);const ge=h();c(W,B),K.append(W,S,O,ge),document.body.appendChild(K)}r?(S.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function ze(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ec(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ze())}function sy(){const n=jo()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function iy(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ry(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function xf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function oy(){const n=ze();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ay(){return Sf.NODE_ADMIN===!0}function ly(){return!sy()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cy(){try{return typeof indexedDB=="object"}catch{return!1}}function uy(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const hy="FirebaseError";class Ht extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=hy,Object.setPrototypeOf(this,Ht.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lr.prototype.create)}}class lr{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?dy(r,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new Ht(i,l,s)}}function dy(n,e){return n.replace(fy,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const fy=/\{\$([^}]+)}/g;function zi(n){return JSON.parse(n)}function Ve(n){return JSON.stringify(n)}const Mf=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=zi(po(r[0])||""),t=zi(po(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},py=function(n){const e=Mf(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},gy=function(n){const e=Mf(n).claims;return typeof e=="object"&&e.admin===!0};function $t(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ns(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ll(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function go(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function _n(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(ph(r)&&ph(o)){if(!_n(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function ph(n){return n!==null&&typeof n=="object"}function Hs(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Ri(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function bi(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class my{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)s[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)s[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const m=s[p-3]^s[p-8]^s[p-14]^s[p-16];s[p]=(m<<1|m>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],h,f;for(let p=0;p<80;p++){p<40?p<20?(h=l^r&(o^l),f=1518500249):(h=r^o^l,f=1859775393):p<60?(h=r&o|l&(r|o),f=2400959708):(h=r^o^l,f=3395469782);const m=(i<<5|i>>>27)+h+c+f+s[p]&4294967295;c=l,l=o,o=(r<<30|r>>>2)&4294967295,r=i,i=m}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function _y(n,e){const t=new yy(n,e);return t.subscribe.bind(t)}class yy{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");vy(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=Ba),i.error===void 0&&(i.error=Ba),i.complete===void 0&&(i.complete=Ba);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vy(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ba(){}function tc(n,e){return`${n} failed: ${e} argument `}const Ey=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,k(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},$o=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function Xe(n){return n&&n._delegate?n._delegate:n}class yn{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Wn="[DEFAULT]";class Iy{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Ho;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wy(e))try{this.getOrInitializeService({instanceIdentifier:Wn})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Wn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Wn){return this.instances.has(e)}getOptions(e=Wn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Ty(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Wn){return this.component?this.component.multipleInstances?e:Wn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ty(n){return n===Wn?void 0:n}function wy(n){return n.instantiationMode==="EAGER"}class Cy{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Iy(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Q;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Q||(Q={}));const Ay={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Sy=Q.INFO,Ry={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},by=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=Ry[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class zo{constructor(e){this.name=e,this._logLevel=Sy,this._logHandler=by,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ay[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}}const Py=(n,e)=>e.some(t=>n instanceof t);let gh,mh;function ky(){return gh||(gh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ny(){return mh||(mh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vf=new WeakMap,cl=new WeakMap,Ff=new WeakMap,qa=new WeakMap,nc=new WeakMap;function Dy(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(un(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Vf.set(t,n)}).catch(()=>{}),nc.set(e,n),e}function Oy(n){if(cl.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});cl.set(n,e)}let ul={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return cl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ff.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return un(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ly(n){ul=n(ul)}function xy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Wa(this),e,...t);return Ff.set(s,e.sort?e.sort():[e]),un(s)}:Ny().includes(n)?function(...e){return n.apply(Wa(this),e),un(Vf.get(this))}:function(...e){return un(n.apply(Wa(this),e))}}function My(n){return typeof n=="function"?xy(n):(n instanceof IDBTransaction&&Oy(n),Py(n,ky())?new Proxy(n,ul):n)}function un(n){if(n instanceof IDBRequest)return Dy(n);if(qa.has(n))return qa.get(n);const e=My(n);return e!==n&&(qa.set(n,e),nc.set(e,n)),e}const Wa=n=>nc.get(n);function Vy(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),l=un(o);return s&&o.addEventListener("upgradeneeded",c=>{s(un(o.result),c.oldVersion,c.newVersion,un(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const Fy=["get","getKey","getAll","getAllKeys","count"],Uy=["put","add","delete","clear"],ja=new Map;function _h(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ja.get(e))return ja.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=Uy.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Fy.includes(t)))return;const r=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let h=c.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&c.done]))[0]};return ja.set(e,r),r}Ly(n=>({...n,get:(e,t,s)=>_h(e,t)||n.get(e,t,s),has:(e,t)=>!!_h(e,t)||n.has(e,t)}));class By{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(qy(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function qy(n){return n.getComponent()?.type==="VERSION"}const hl="@firebase/app",yh="0.14.7";const Ut=new zo("@firebase/app"),Wy="@firebase/app-compat",jy="@firebase/analytics-compat",Hy="@firebase/analytics",$y="@firebase/app-check-compat",zy="@firebase/app-check",Gy="@firebase/auth",Ky="@firebase/auth-compat",Qy="@firebase/database",Yy="@firebase/data-connect",Jy="@firebase/database-compat",Xy="@firebase/functions",Zy="@firebase/functions-compat",ev="@firebase/installations",tv="@firebase/installations-compat",nv="@firebase/messaging",sv="@firebase/messaging-compat",iv="@firebase/performance",rv="@firebase/performance-compat",ov="@firebase/remote-config",av="@firebase/remote-config-compat",lv="@firebase/storage",cv="@firebase/storage-compat",uv="@firebase/firestore",hv="@firebase/ai",dv="@firebase/firestore-compat",fv="firebase",pv="12.8.0";const dl="[DEFAULT]",gv={[hl]:"fire-core",[Wy]:"fire-core-compat",[Hy]:"fire-analytics",[jy]:"fire-analytics-compat",[zy]:"fire-app-check",[$y]:"fire-app-check-compat",[Gy]:"fire-auth",[Ky]:"fire-auth-compat",[Qy]:"fire-rtdb",[Yy]:"fire-data-connect",[Jy]:"fire-rtdb-compat",[Xy]:"fire-fn",[Zy]:"fire-fn-compat",[ev]:"fire-iid",[tv]:"fire-iid-compat",[nv]:"fire-fcm",[sv]:"fire-fcm-compat",[iv]:"fire-perf",[rv]:"fire-perf-compat",[ov]:"fire-rc",[av]:"fire-rc-compat",[lv]:"fire-gcs",[cv]:"fire-gcs-compat",[uv]:"fire-fst",[dv]:"fire-fst-compat",[hv]:"fire-vertex","fire-js":"fire-js",[fv]:"fire-js-all"};const mo=new Map,mv=new Map,fl=new Map;function vh(n,e){try{n.container.addComponent(e)}catch(t){Ut.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Yn(n){const e=n.name;if(fl.has(e))return Ut.debug(`There were multiple attempts to register component ${e}.`),!1;fl.set(e,n);for(const t of mo.values())vh(t,n);for(const t of mv.values())vh(t,n);return!0}function Go(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function at(n){return n==null?!1:n.settings!==void 0}const _v={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new lr("app","Firebase",_v);class yv{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new yn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const ss=pv;function Uf(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:dl,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw hn.create("bad-app-name",{appName:String(i)});if(t||(t=Df()),!t)throw hn.create("no-options");const r=mo.get(i);if(r){if(_n(t,r.options)&&_n(s,r.config))return r;throw hn.create("duplicate-app",{appName:i})}const o=new Cy(i);for(const c of fl.values())o.addComponent(c);const l=new yv(t,s,o);return mo.set(i,l),l}function sc(n=dl){const e=mo.get(n);if(!e&&n===dl&&Df())return Uf();if(!e)throw hn.create("no-app",{appName:n});return e}function St(n,e,t){let s=gv[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ut.warn(o.join(" "));return}Yn(new yn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const vv="firebase-heartbeat-database",Ev=1,Gi="firebase-heartbeat-store";let Ha=null;function Bf(){return Ha||(Ha=Vy(vv,Ev,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Gi)}catch(t){console.warn(t)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),Ha}async function Iv(n){try{const t=(await Bf()).transaction(Gi),s=await t.objectStore(Gi).get(qf(n));return await t.done,s}catch(e){if(e instanceof Ht)Ut.warn(e.message);else{const t=hn.create("idb-get",{originalErrorMessage:e?.message});Ut.warn(t.message)}}}async function Eh(n,e){try{const s=(await Bf()).transaction(Gi,"readwrite");await s.objectStore(Gi).put(e,qf(n)),await s.done}catch(t){if(t instanceof Ht)Ut.warn(t.message);else{const s=hn.create("idb-set",{originalErrorMessage:t?.message});Ut.warn(s.message)}}}function qf(n){return`${n.name}!${n.options.appId}`}const Tv=1024,wv=30;class Cv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Sv(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ih();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>wv){const i=Rv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ut.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ih(),{heartbeatsToSend:t,unsentEntries:s}=Av(this._heartbeatsCache.heartbeats),i=fo(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ut.warn(e),""}}}function Ih(){return new Date().toISOString().substring(0,10)}function Av(n,e=Tv){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),Th(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Th(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Sv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return cy()?uy().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Iv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Eh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Eh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Th(n){return fo(JSON.stringify({version:2,heartbeats:n})).length}function Rv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function bv(n){Yn(new yn("platform-logger",e=>new By(e),"PRIVATE")),Yn(new yn("heartbeat",e=>new Cv(e),"PRIVATE")),St(hl,yh,n),St(hl,yh,"esm2020"),St("fire-js","")}bv("");var Pv="firebase",kv="12.8.0";St(Pv,kv,"app");var wh={};const Ch="@firebase/database",Ah="1.1.0";let Wf="";function Nv(n){Wf=n}class Dv{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ve(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:zi(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Ov{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return $t(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const jf=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Dv(e)}}catch{}return new Ov},Hn=jf("localStorage"),Lv=jf("sessionStorage");const Ts=new zo("@firebase/database"),xv=(function(){let n=1;return function(){return n++}})(),Hf=function(n){const e=Ey(n),t=new my;t.update(e);const s=t.digest();return Jl.encodeByteArray(s)},cr=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=cr.apply(null,s):typeof s=="object"?e+=Ve(s):e+=s,e+=" "}return e};let xi=null,Sh=!0;const Mv=function(n,e){k(!0,"Can't turn on custom loggers persistently."),Ts.logLevel=Q.VERBOSE,xi=Ts.log.bind(Ts)},He=function(...n){if(Sh===!0&&(Sh=!1,xi===null&&Lv.get("logging_enabled")===!0&&Mv()),xi){const e=cr.apply(null,n);xi(e)}},ur=function(n){return function(...e){He(n,...e)}},pl=function(...n){const e="FIREBASE INTERNAL ERROR: "+cr(...n);Ts.error(e)},Bt=function(...n){const e=`FIREBASE FATAL ERROR: ${cr(...n)}`;throw Ts.error(e),new Error(e)},tt=function(...n){const e="FIREBASE WARNING: "+cr(...n);Ts.warn(e)},Vv=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$f=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Fv=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ds="[MIN_NAME]",Jn="[MAX_NAME]",$s=function(n,e){if(n===e)return 0;if(n===Ds||e===Jn)return-1;if(e===Ds||n===Jn)return 1;{const t=Rh(n),s=Rh(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Uv=function(n,e){return n===e?0:n<e?-1:1},Ii=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ve(e))},ic=function(n){if(typeof n!="object"||n===null)return Ve(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Ve(e[s]),t+=":",t+=ic(n[e[s]]);return t+="}",t},zf=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function nt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Gf=function(n){k(!$f(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,l,c;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(i?1:0),h.reverse();const f=h.join("");let p="";for(c=0;c<64;c+=8){let m=parseInt(f.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},Bv=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},qv=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Wv(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const jv=new RegExp("^-?(0*)\\d{1,10}$"),Hv=-2147483648,$v=2147483647,Rh=function(n){if(jv.test(n)){const e=Number(n);if(e>=Hv&&e<=$v)return e}return null},zs=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},zv=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Mi=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Gv{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,at(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Kv{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(He("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tt(e)}}class to{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}to.OWNER="owner";const rc="5",Kf="v",Qf="s",Yf="r",Jf="f",Xf=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Zf="ls",ep="p",gl="ac",tp="websocket",np="long_polling";class sp{constructor(e,t,s,i,r=!1,o="",l=!1,c=!1,h=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Hn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Hn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Qv(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ip(n,e,t){k(typeof e=="string","typeof type must == string"),k(typeof t=="object","typeof params must == object");let s;if(e===tp)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===np)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Qv(n)&&(t.ns=n.namespace);const i=[];return nt(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class Yv{constructor(){this.counters_={}}incrementCounter(e,t=1){$t(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Q_(this.counters_)}}const $a={},za={};function oc(n){const e=n.toString();return $a[e]||($a[e]=new Yv),$a[e]}function Jv(n,e){const t=n.toString();return za[t]||(za[t]=e()),za[t]}class Xv{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&zs(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const bh="start",Zv="close",eE="pLPCommand",tE="pRTLPCB",rp="id",op="pw",ap="ser",nE="cb",sE="seg",iE="ts",rE="d",oE="dframe",lp=1870,cp=30,aE=lp-cp,lE=25e3,cE=3e4;class Es{constructor(e,t,s,i,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ur(e),this.stats_=oc(t),this.urlFn=c=>(this.appCheckToken&&(c[gl]=this.appCheckToken),ip(t,np,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Xv(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(cE)),Fv(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ac((...r)=>{const[o,l,c,h,f]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===bh)this.id=l,this.password=c;else if(o===Zv)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[bh]="t",s[ap]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[nE]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Kf]=rc,this.transportSessionId&&(s[Qf]=this.transportSessionId),this.lastSessionId&&(s[Zf]=this.lastSessionId),this.applicationId&&(s[ep]=this.applicationId),this.appCheckToken&&(s[gl]=this.appCheckToken),typeof location<"u"&&location.hostname&&Xf.test(location.hostname)&&(s[Yf]=Jf);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Es.forceAllow_=!0}static forceDisallow(){Es.forceDisallow_=!0}static isAvailable(){return Es.forceAllow_?!0:!Es.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Bv()&&!qv()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=bf(t),i=zf(s,aE);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[oE]="t",s[rp]=e,s[op]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ac{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=xv(),window[eE+this.uniqueCallbackIdentifier]=e,window[tE+this.uniqueCallbackIdentifier]=t,this.myIFrame=ac.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){He("frame writing exception"),l.stack&&He(l.stack),He(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||He("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[rp]=this.myID,e[op]=this.myPW,e[ap]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+cp+s.length<=lp;){const o=this.pendingSegs.shift();s=s+"&"+sE+i+"="+o.seg+"&"+iE+i+"="+o.ts+"&"+rE+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(lE)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{He("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const uE=16384,hE=45e3;let _o=null;typeof MozWebSocket<"u"?_o=MozWebSocket:typeof WebSocket<"u"&&(_o=WebSocket);class ft{constructor(e,t,s,i,r,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ur(this.connId),this.stats_=oc(t),this.connURL=ft.connectionURL_(t,o,l,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[Kf]=rc,typeof location<"u"&&location.hostname&&Xf.test(location.hostname)&&(o[Yf]=Jf),t&&(o[Qf]=t),s&&(o[Zf]=s),i&&(o[gl]=i),r&&(o[ep]=r),ip(e,tp,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Hn.set("previous_websocket_failure",!0);try{let s;ay(),this.mySock=new _o(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){ft.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&_o!==null&&!ft.forceDisallow_}static previouslyFailed(){return Hn.isInMemoryStorage||Hn.get("previous_websocket_failure")===!0}markConnectionHealthy(){Hn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=zi(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(k(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=zf(t,uE);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(hE))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ft.responsesRequiredToBeHealthy=2;ft.healthyTimeout=3e4;class Ki{static get ALL_TRANSPORTS(){return[Es,ft]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ft&&ft.isAvailable();let s=t&&!ft.previouslyFailed();if(e.webSocketOnly&&(t||tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ft];else{const i=this.transports_=[];for(const r of Ki.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Ki.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ki.globalTransportInitialized_=!1;const dE=6e4,fE=5e3,pE=10*1024,gE=100*1024,Ga="t",Ph="d",mE="s",kh="r",_E="e",Nh="o",Dh="a",Oh="n",Lh="p",yE="h";class vE{constructor(e,t,s,i,r,o,l,c,h,f){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ur("c:"+this.id+":"),this.transportManager_=new Ki(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Mi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>gE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>pE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ga in e){const t=e[Ga];t===Dh?this.upgradeIfSecondaryHealthy_():t===kh?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Nh&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ii("t",e),s=Ii("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Lh,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Dh,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Oh,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ii("t",e),s=Ii("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ii(Ga,e);if(Ph in e){const s=e[Ph];if(t===yE){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Oh){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===mE?this.onConnectionShutdown_(s):t===kh?this.onReset_(s):t===_E?pl("Server Error: "+s):t===Nh?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):pl("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),rc!==s&&tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Mi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dE))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Mi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(fE))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Lh,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Hn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class up{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class hp{constructor(e){this.allowedEvents_=e,this.listeners_={},k(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){k(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class yo extends hp{static getInstance(){return new yo}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ec()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return k(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const xh=32,Mh=768;class ae{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function te(){return new ae("")}function z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function vn(n){return n.pieces_.length-n.pieceNum_}function ce(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ae(n.pieces_,e)}function dp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function EE(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function fp(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pp(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ae(e,0)}function ke(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof ae)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new ae(t,0)}function Y(n){return n.pieceNum_>=n.pieces_.length}function et(n,e){const t=z(n),s=z(e);if(t===null)return e;if(t===s)return et(ce(n),ce(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function lc(n,e){if(vn(n)!==vn(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function pt(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(vn(n)>vn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class IE{constructor(e,t){this.errorPrefix_=t,this.parts_=fp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=$o(this.parts_[s]);gp(this)}}function TE(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=$o(e),gp(n)}function wE(n){const e=n.parts_.pop();n.byteLength_-=$o(e),n.parts_.length>0&&(n.byteLength_-=1)}function gp(n){if(n.byteLength_>Mh)throw new Error(n.errorPrefix_+"has a key path longer than "+Mh+" bytes ("+n.byteLength_+").");if(n.parts_.length>xh)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xh+") or object contains a cycle "+jn(n))}function jn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class cc extends hp{static getInstance(){return new cc}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return k(e==="visible","Unknown event type: "+e),[this.visible_]}}const Ti=1e3,CE=300*1e3,Vh=30*1e3,AE=1.3,SE=3e4,RE="server_kill",Fh=3;class Ft extends up{constructor(e,t,s,i,r,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Ft.nextPersistentConnectionId_++,this.log_=ur("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ti,this.maxReconnectDelay_=CE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");cc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&yo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Ve(r)),k(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new Ho,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),k(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,l=>{const c=l.d,h=l.s;Ft.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&$t(e,"w")){const s=Ns(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||gy(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Vh)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=py(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ve(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):pl("Unrecognized action received from server: "+Ve(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){k(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ti,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ti,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>SE&&(this.reconnectDelay_=Ti),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*AE)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ft.nextConnectionId_++,r=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},h=function(p){k(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,m]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);o?He("getToken() completed but was canceled"):(He("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=m&&m.token,l=new vE(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,A=>{tt(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(RE)},r))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&tt(p),c())}}}interrupt(e){He("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){He("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ll(this.interruptReasons_)&&(this.reconnectDelay_=Ti,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>ic(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new ae(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){He("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Fh&&(this.reconnectDelay_=Vh,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){He("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Fh&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Wf.replace(/\./g,"-")]=1,ec()?e["framework.cordova"]=1:xf()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=yo.getInstance().currentlyOnline();return ll(this.interruptReasons_)&&e}}Ft.nextPersistentConnectionId_=0;Ft.nextConnectionId_=0;class G{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new G(e,t)}}class Ko{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new G(Ds,e),i=new G(Ds,t);return this.compare(s,i)!==0}minPost(){return G.MIN}}let $r;class mp extends Ko{static get __EMPTY_NODE(){return $r}static set __EMPTY_NODE(e){$r=e}compare(e,t){return $s(e.name,t.name)}isDefinedOn(e){throw js("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return G.MIN}maxPost(){return new G(Jn,$r)}makePost(e,t){return k(typeof e=="string","KeyIndex indexValue must always be a string."),new G(e,$r)}toString(){return".key"}}const ws=new mp;let zr=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},it=class Pi{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Pi.RED,this.left=i??At.EMPTY_NODE,this.right=r??At.EMPTY_NODE}copy(e,t,s,i,r){return new Pi(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return At.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return At.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Pi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Pi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};it.RED=!0;it.BLACK=!1;class bE{copy(e,t,s,i,r){return this}insert(e,t,s){return new it(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let At=class no{constructor(e,t=no.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new no(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,it.BLACK,null,null))}remove(e){return new no(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,it.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zr(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zr(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zr(this.root_,null,this.comparator_,!0,e)}};At.EMPTY_NODE=new bE;function PE(n,e){return $s(n.name,e.name)}function uc(n,e){return $s(n,e)}let ml;function kE(n){ml=n}const _p=function(n){return typeof n=="number"?"number:"+Gf(n):"string:"+n},yp=function(n){if(n.isLeafNode()){const e=n.val();k(typeof e=="string"||typeof e=="number"||typeof e=="object"&&$t(e,".sv"),"Priority must be a string or number.")}else k(n===ml||n.isEmpty(),"priority of unexpected type.");k(n===ml||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Uh;class xe{static set __childrenNodeConstructor(e){Uh=e}static get __childrenNodeConstructor(){return Uh}constructor(e,t=xe.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,k(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),yp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xe(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:xe.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Y(e)?this:z(e)===".priority"?this.priorityNode_:xe.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:xe.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=z(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(k(s!==".priority"||vn(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,xe.__childrenNodeConstructor.EMPTY_NODE.updateChild(ce(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+_p(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Gf(this.value_):e+=this.value_,this.lazyHash_=Hf(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===xe.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof xe.__childrenNodeConstructor?-1:(k(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=xe.VALUE_TYPE_ORDER.indexOf(t),r=xe.VALUE_TYPE_ORDER.indexOf(s);return k(i>=0,"Unknown leaf type: "+t),k(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}xe.VALUE_TYPE_ORDER=["object","boolean","number","string"];let vp,Ep;function NE(n){vp=n}function DE(n){Ep=n}class OE extends Ko{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?$s(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return G.MIN}maxPost(){return new G(Jn,new xe("[PRIORITY-POST]",Ep))}makePost(e,t){const s=vp(e);return new G(t,new xe("[PRIORITY-POST]",s))}toString(){return".priority"}}const Ie=new OE;const LE=Math.log(2);class xE{constructor(e){const t=r=>parseInt(Math.log(r)/LE,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const vo=function(n,e,t,s){n.sort(e);const i=function(c,h){const f=h-c;let p,m;if(f===0)return null;if(f===1)return p=n[c],m=t?t(p):p,new it(m,p.node,it.BLACK,null,null);{const A=parseInt(f/2,10)+c,S=i(c,A),P=i(A+1,h);return p=n[A],m=t?t(p):p,new it(m,p.node,it.BLACK,S,P)}},r=function(c){let h=null,f=null,p=n.length;const m=function(S,P){const O=p-S,B=p;p-=S;const W=i(O+1,B),K=n[O],ge=t?t(K):K;A(new it(ge,K.node,P,null,W))},A=function(S){h?(h.left=S,h=S):(f=S,h=S)};for(let S=0;S<c.count;++S){const P=c.nextBitIsOne(),O=Math.pow(2,c.count-(S+1));P?m(O,it.BLACK):(m(O,it.BLACK),m(O,it.RED))}return f},o=new xE(n.length),l=r(o);return new At(s||e,l)};let Ka;const ps={};class xt{static get Default(){return k(ps&&Ie,"ChildrenNode.ts has not been loaded"),Ka=Ka||new xt({".priority":ps},{".priority":Ie}),Ka}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ns(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof At?t:null}hasIndex(e){return $t(this.indexSet_,e.toString())}addIndex(e,t){k(e!==ws,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(G.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=vo(s,e.getCompare()):l=ps;const c=e.toString(),h={...this.indexSet_};h[c]=e;const f={...this.indexes_};return f[c]=l,new xt(f,h)}addToIndexes(e,t){const s=go(this.indexes_,(i,r)=>{const o=Ns(this.indexSet_,r);if(k(o,"Missing index implementation for "+r),i===ps)if(o.isDefinedOn(e.node)){const l=[],c=t.getIterator(G.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&l.push(h),h=c.getNext();return l.push(e),vo(l,o.getCompare())}else return ps;else{const l=t.get(e.name);let c=i;return l&&(c=c.remove(new G(e.name,l))),c.insert(e,e.node)}});return new xt(s,this.indexSet_)}removeFromIndexes(e,t){const s=go(this.indexes_,i=>{if(i===ps)return i;{const r=t.get(e.name);return r?i.remove(new G(e.name,r)):i}});return new xt(s,this.indexSet_)}}let wi;class q{static get EMPTY_NODE(){return wi||(wi=new q(new At(uc),null,xt.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&yp(this.priorityNode_),this.children_.isEmpty()&&k(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||wi}updatePriority(e){return this.children_.isEmpty()?this:new q(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?wi:t}}getChild(e){const t=z(e);return t===null?this:this.getImmediateChild(t).getChild(ce(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(k(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new G(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?wi:this.priorityNode_;return new q(i,o,r)}}updateChild(e,t){const s=z(e);if(s===null)return t;{k(z(e)!==".priority"||vn(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(ce(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(Ie,(o,l)=>{t[o]=l.val(e),s++,r&&q.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const l in t)o[l]=t[l];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+_p(this.getPriority().val())+":"),this.forEachChild(Ie,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Hf(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new G(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new G(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new G(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,G.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,G.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===hr?-1:0}withIndex(e){if(e===ws||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new q(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ws||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Ie),i=t.getIterator(Ie);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ws?null:this.indexMap_.get(e.toString())}}q.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class ME extends q{constructor(){super(new At(uc),q.EMPTY_NODE,xt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return q.EMPTY_NODE}isEmpty(){return!1}}const hr=new ME;Object.defineProperties(G,{MIN:{value:new G(Ds,q.EMPTY_NODE)},MAX:{value:new G(Jn,hr)}});mp.__EMPTY_NODE=q.EMPTY_NODE;xe.__childrenNodeConstructor=q;kE(hr);DE(hr);const VE=!0;function Be(n,e=null){if(n===null)return q.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),k(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new xe(t,Be(e))}if(!(n instanceof Array)&&VE){const t=[];let s=!1;if(nt(n,(o,l)=>{if(o.substring(0,1)!=="."){const c=Be(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new G(o,c)))}}),t.length===0)return q.EMPTY_NODE;const r=vo(t,PE,o=>o.name,uc);if(s){const o=vo(t,Ie.getCompare());return new q(r,Be(e),new xt({".priority":o},{".priority":Ie}))}else return new q(r,Be(e),xt.Default)}else{let t=q.EMPTY_NODE;return nt(n,(s,i)=>{if($t(n,s)&&s.substring(0,1)!=="."){const r=Be(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(Be(e))}}NE(Be);class FE extends Ko{constructor(e){super(),this.indexPath_=e,k(!Y(e)&&z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?$s(e.name,t.name):r}makePost(e,t){const s=Be(e),i=q.EMPTY_NODE.updateChild(this.indexPath_,s);return new G(t,i)}maxPost(){const e=q.EMPTY_NODE.updateChild(this.indexPath_,hr);return new G(Jn,e)}toString(){return fp(this.indexPath_,0).join("/")}}class UE extends Ko{compare(e,t){const s=e.node.compareTo(t.node);return s===0?$s(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return G.MIN}maxPost(){return G.MAX}makePost(e,t){const s=Be(e);return new G(t,s)}toString(){return".value"}}const BE=new UE;function Ip(n){return{type:"value",snapshotNode:n}}function Os(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Qi(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Yi(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function qE(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class hc{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){k(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(i).equals(s.getChild(i))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Qi(t,l)):k(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Os(t,s)):o.trackChildChange(Yi(t,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Ie,(i,r)=>{t.hasChild(i)||s.trackChildChange(Qi(i,r))}),t.isLeafNode()||t.forEachChild(Ie,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Yi(i,r,o))}else s.trackChildChange(Os(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?q.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ji{constructor(e){this.indexedFilter_=new hc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ji.getStartPost_(e),this.endPost_=Ji.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new G(t,s))||(s=q.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=q.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(q.EMPTY_NODE);const r=this;return t.forEachChild(Ie,(o,l)=>{r.matches(new G(o,l))||(i=i.updateImmediateChild(o,q.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class WE{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Ji(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new G(t,s))||(s=q.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=q.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=q.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(q.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,q.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const p=this.index_.getCompare();o=(m,A)=>p(A,m)}else o=this.index_.getCompare();const l=e;k(l.numChildren()===this.limit_,"");const c=new G(t,s),h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(c);if(l.hasChild(t)){const p=l.getImmediateChild(t);let m=i.getChildAfterChild(this.index_,h,this.reverse_);for(;m!=null&&(m.name===t||l.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);const A=m==null?1:o(m,c);if(f&&!s.isEmpty()&&A>=0)return r?.trackChildChange(Yi(t,s,p)),l.updateImmediateChild(t,s);{r?.trackChildChange(Qi(t,p));const P=l.updateImmediateChild(t,q.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(r?.trackChildChange(Os(m.name,m.node)),P.updateImmediateChild(m.name,m.node)):P}}else return s.isEmpty()?e:f&&o(h,c)>=0?(r!=null&&(r.trackChildChange(Qi(h.name,h.node)),r.trackChildChange(Os(t,s))),l.updateImmediateChild(t,s).updateImmediateChild(h.name,q.EMPTY_NODE)):e}}class dc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ie}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return k(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return k(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ds}hasEnd(){return this.endSet_}getIndexEndValue(){return k(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return k(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Jn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return k(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ie}copy(){const e=new dc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function jE(n){return n.loadsAllData()?new hc(n.getIndex()):n.hasLimit()?new WE(n):new Ji(n)}function Bh(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ie?t="$priority":n.index_===BE?t="$value":n.index_===ws?t="$key":(k(n.index_ instanceof FE,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ve(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Ve(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Ve(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Ve(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Ve(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function qh(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ie&&(e.i=n.index_.toString()),e}class Eo extends up{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(k(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=ur("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Eo.getListenId_(e,s),l={};this.listens_[o]=l;const c=Bh(e._queryParams);this.restRequest_(r+".json",c,(h,f)=>{let p=f;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(r,p,!1,s),Ns(this.listens_,o)===l){let m;h?h===401?m="permission_denied":m="rest_error:"+h:m="ok",i(m,null)}})}unlisten(e,t){const s=Eo.getListenId_(e,t);delete this.listens_[s]}get(e){const t=Bh(e._queryParams),s=e._path.toString(),i=new Ho;return this.restRequest_(s+".json",t,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Hs(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=zi(l.responseText)}catch{tt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&tt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}class HE{constructor(){this.rootNode_=q.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Io(){return{value:null,children:new Map}}function Tp(n,e,t){if(Y(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=z(e);n.children.has(s)||n.children.set(s,Io());const i=n.children.get(s);e=ce(e),Tp(i,e,t)}}function _l(n,e,t){n.value!==null?t(e,n.value):$E(n,(s,i)=>{const r=new ae(e.toString()+"/"+s);_l(i,r,t)})}function $E(n,e){n.children.forEach((t,s)=>{e(s,t)})}class zE{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&nt(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const Wh=10*1e3,GE=30*1e3,KE=300*1e3;class QE{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new zE(e);const s=Wh+(GE-Wh)*Math.random();Mi(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;nt(e,(i,r)=>{r>0&&$t(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Mi(this.reportStats_.bind(this),Math.floor(Math.random()*2*KE))}}var gt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(gt||(gt={}));function wp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function fc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function pc(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class To{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=gt.ACK_USER_WRITE,this.source=wp()}operationForChild(e){if(Y(this.path)){if(this.affectedTree.value!=null)return k(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ae(e));return new To(te(),t,this.revert)}}else return k(z(this.path)===e,"operationForChild called for unrelated child."),new To(ce(this.path),this.affectedTree,this.revert)}}class Xi{constructor(e,t){this.source=e,this.path=t,this.type=gt.LISTEN_COMPLETE}operationForChild(e){return Y(this.path)?new Xi(this.source,te()):new Xi(this.source,ce(this.path))}}class Xn{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=gt.OVERWRITE}operationForChild(e){return Y(this.path)?new Xn(this.source,te(),this.snap.getImmediateChild(e)):new Xn(this.source,ce(this.path),this.snap)}}class Zi{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=gt.MERGE}operationForChild(e){if(Y(this.path)){const t=this.children.subtree(new ae(e));return t.isEmpty()?null:t.value?new Xn(this.source,te(),t.value):new Zi(this.source,te(),t)}else return k(z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zi(this.source,ce(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Zn{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Y(e))return this.isFullyInitialized()&&!this.filtered_;const t=z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class YE{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function JE(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(qE(o.childName,o.snapshotNode))}),Ci(n,i,"child_removed",e,s,t),Ci(n,i,"child_added",e,s,t),Ci(n,i,"child_moved",r,s,t),Ci(n,i,"child_changed",e,s,t),Ci(n,i,"value",e,s,t),i}function Ci(n,e,t,s,i,r){const o=s.filter(l=>l.type===t);o.sort((l,c)=>ZE(n,l,c)),o.forEach(l=>{const c=XE(n,l,r);i.forEach(h=>{h.respondsTo(l.type)&&e.push(h.createEvent(c,n.query_))})})}function XE(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function ZE(n,e,t){if(e.childName==null||t.childName==null)throw js("Should only compare child_ events.");const s=new G(e.childName,e.snapshotNode),i=new G(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function Qo(n,e){return{eventCache:n,serverCache:e}}function Vi(n,e,t,s){return Qo(new Zn(e,t,s),n.serverCache)}function Cp(n,e,t,s){return Qo(n.eventCache,new Zn(e,t,s))}function yl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function es(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Qa;const eI=()=>(Qa||(Qa=new At(Uv)),Qa);class pe{static fromObject(e){let t=new pe(null);return nt(e,(s,i)=>{t=t.set(new ae(s),i)}),t}constructor(e,t=eI()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:te(),value:this.value};if(Y(e))return null;{const s=z(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(ce(e),t);return r!=null?{path:ke(new ae(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Y(e))return this;{const t=z(e),s=this.children.get(t);return s!==null?s.subtree(ce(e)):new pe(null)}}set(e,t){if(Y(e))return new pe(t,this.children);{const s=z(e),r=(this.children.get(s)||new pe(null)).set(ce(e),t),o=this.children.insert(s,r);return new pe(this.value,o)}}remove(e){if(Y(e))return this.children.isEmpty()?new pe(null):new pe(null,this.children);{const t=z(e),s=this.children.get(t);if(s){const i=s.remove(ce(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new pe(null):new pe(this.value,r)}else return this}}get(e){if(Y(e))return this.value;{const t=z(e),s=this.children.get(t);return s?s.get(ce(e)):null}}setTree(e,t){if(Y(e))return t;{const s=z(e),r=(this.children.get(s)||new pe(null)).setTree(ce(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new pe(this.value,o)}}fold(e){return this.fold_(te(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(ke(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,te(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(Y(e))return null;{const r=z(e),o=this.children.get(r);return o?o.findOnPath_(ce(e),ke(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,te(),t)}foreachOnPath_(e,t,s){if(Y(e))return this;{this.value&&s(t,this.value);const i=z(e),r=this.children.get(i);return r?r.foreachOnPath_(ce(e),ke(t,i),s):new pe(null)}}foreach(e){this.foreach_(te(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(ke(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class _t{constructor(e){this.writeTree_=e}static empty(){return new _t(new pe(null))}}function Fi(n,e,t){if(Y(e))return new _t(new pe(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=et(i,e);return r=r.updateChild(o,t),new _t(n.writeTree_.set(i,r))}else{const i=new pe(t),r=n.writeTree_.setTree(e,i);return new _t(r)}}}function jh(n,e,t){let s=n;return nt(t,(i,r)=>{s=Fi(s,ke(e,i),r)}),s}function Hh(n,e){if(Y(e))return _t.empty();{const t=n.writeTree_.setTree(e,new pe(null));return new _t(t)}}function vl(n,e){return is(n,e)!=null}function is(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(et(t.path,e)):null}function $h(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ie,(s,i)=>{e.push(new G(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new G(s,i.value))}),e}function dn(n,e){if(Y(e))return n;{const t=is(n,e);return t!=null?new _t(new pe(t)):new _t(n.writeTree_.subtree(e))}}function El(n){return n.writeTree_.isEmpty()}function Ls(n,e){return Ap(te(),n.writeTree_,e)}function Ap(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(k(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=Ap(ke(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(ke(n,".priority"),s)),t}}function gc(n,e){return Pp(e,n)}function tI(n,e,t,s,i){k(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=Fi(n.visibleWrites,e,t)),n.lastWriteId=s}function nI(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function sI(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);k(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&iI(l,s.path)?i=!1:pt(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return rI(n),!0;if(s.snap)n.visibleWrites=Hh(n.visibleWrites,s.path);else{const l=s.children;nt(l,c=>{n.visibleWrites=Hh(n.visibleWrites,ke(s.path,c))})}return!0}else return!1}function iI(n,e){if(n.snap)return pt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&pt(ke(n.path,t),e))return!0;return!1}function rI(n){n.visibleWrites=Sp(n.allWrites,oI,te()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function oI(n){return n.visible}function Sp(n,e,t){let s=_t.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let l;if(r.snap)pt(t,o)?(l=et(t,o),s=Fi(s,l,r.snap)):pt(o,t)&&(l=et(o,t),s=Fi(s,te(),r.snap.getChild(l)));else if(r.children){if(pt(t,o))l=et(t,o),s=jh(s,l,r.children);else if(pt(o,t))if(l=et(o,t),Y(l))s=jh(s,te(),r.children);else{const c=Ns(r.children,z(l));if(c){const h=c.getChild(ce(l));s=Fi(s,te(),h)}}}else throw js("WriteRecord should have .snap or .children")}}return s}function Rp(n,e,t,s,i){if(!s&&!i){const r=is(n.visibleWrites,e);if(r!=null)return r;{const o=dn(n.visibleWrites,e);if(El(o))return t;if(t==null&&!vl(o,te()))return null;{const l=t||q.EMPTY_NODE;return Ls(o,l)}}}else{const r=dn(n.visibleWrites,e);if(!i&&El(r))return t;if(!i&&t==null&&!vl(r,te()))return null;{const o=function(h){return(h.visible||i)&&(!s||!~s.indexOf(h.writeId))&&(pt(h.path,e)||pt(e,h.path))},l=Sp(n.allWrites,o,e),c=t||q.EMPTY_NODE;return Ls(l,c)}}}function aI(n,e,t){let s=q.EMPTY_NODE;const i=is(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Ie,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=dn(n.visibleWrites,e);return t.forEachChild(Ie,(o,l)=>{const c=Ls(dn(r,new ae(o)),l);s=s.updateImmediateChild(o,c)}),$h(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=dn(n.visibleWrites,e);return $h(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function lI(n,e,t,s,i){k(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=ke(e,t);if(vl(n.visibleWrites,r))return null;{const o=dn(n.visibleWrites,r);return El(o)?i.getChild(t):Ls(o,i.getChild(t))}}function cI(n,e,t,s){const i=ke(e,t),r=is(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=dn(n.visibleWrites,i);return Ls(o,s.getNode().getImmediateChild(t))}else return null}function uI(n,e){return is(n.visibleWrites,e)}function hI(n,e,t,s,i,r,o){let l;const c=dn(n.visibleWrites,e),h=is(c,te());if(h!=null)l=h;else if(t!=null)l=Ls(c,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const f=[],p=o.getCompare(),m=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let A=m.getNext();for(;A&&f.length<i;)p(A,s)!==0&&f.push(A),A=m.getNext();return f}else return[]}function dI(){return{visibleWrites:_t.empty(),allWrites:[],lastWriteId:-1}}function wo(n,e,t,s){return Rp(n.writeTree,n.treePath,e,t,s)}function mc(n,e){return aI(n.writeTree,n.treePath,e)}function zh(n,e,t,s){return lI(n.writeTree,n.treePath,e,t,s)}function Co(n,e){return uI(n.writeTree,ke(n.treePath,e))}function fI(n,e,t,s,i,r){return hI(n.writeTree,n.treePath,e,t,s,i,r)}function _c(n,e,t){return cI(n.writeTree,n.treePath,e,t)}function bp(n,e){return Pp(ke(n.treePath,e),n.writeTree)}function Pp(n,e){return{treePath:n,writeTree:e}}class pI{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;k(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),k(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,Yi(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Qi(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Os(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,Yi(s,e.snapshotNode,i.oldSnap));else throw js("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class gI{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const kp=new gI;class yc{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Zn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _c(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:es(this.viewCache_),r=fI(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function mI(n){return{filter:n}}function _I(n,e){k(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),k(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function yI(n,e,t,s,i){const r=new pI;let o,l;if(t.type===gt.OVERWRITE){const h=t;h.source.fromUser?o=Il(n,e,h.path,h.snap,s,i,r):(k(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered()&&!Y(h.path),o=Ao(n,e,h.path,h.snap,s,i,l,r))}else if(t.type===gt.MERGE){const h=t;h.source.fromUser?o=EI(n,e,h.path,h.children,s,i,r):(k(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered(),o=Tl(n,e,h.path,h.children,s,i,l,r))}else if(t.type===gt.ACK_USER_WRITE){const h=t;h.revert?o=wI(n,e,h.path,s,i,r):o=II(n,e,h.path,h.affectedTree,s,i,r)}else if(t.type===gt.LISTEN_COMPLETE)o=TI(n,e,t.path,s,r);else throw js("Unknown operation type: "+t.type);const c=r.getChanges();return vI(e,o,c),{viewCache:o,changes:c}}function vI(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=yl(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Ip(yl(e)))}}function Np(n,e,t,s,i,r){const o=e.eventCache;if(Co(s,t)!=null)return e;{let l,c;if(Y(t))if(k(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=es(e),f=h instanceof q?h:q.EMPTY_NODE,p=mc(s,f);l=n.filter.updateFullNode(e.eventCache.getNode(),p,r)}else{const h=wo(s,es(e));l=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const h=z(t);if(h===".priority"){k(vn(t)===1,"Can't have a priority with additional path components");const f=o.getNode();c=e.serverCache.getNode();const p=zh(s,t,f,c);p!=null?l=n.filter.updatePriority(f,p):l=o.getNode()}else{const f=ce(t);let p;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const m=zh(s,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(h).updateChild(f,m):p=o.getNode().getImmediateChild(h)}else p=_c(s,h,e.serverCache);p!=null?l=n.filter.updateChild(o.getNode(),h,p,f,i,r):l=o.getNode()}}return Vi(e,l,o.isFullyInitialized()||Y(t),n.filter.filtersNodes())}}function Ao(n,e,t,s,i,r,o,l){const c=e.serverCache;let h;const f=o?n.filter:n.filter.getIndexedFilter();if(Y(t))h=f.updateFullNode(c.getNode(),s,null);else if(f.filtersNodes()&&!c.isFiltered()){const A=c.getNode().updateChild(t,s);h=f.updateFullNode(c.getNode(),A,null)}else{const A=z(t);if(!c.isCompleteForPath(t)&&vn(t)>1)return e;const S=ce(t),O=c.getNode().getImmediateChild(A).updateChild(S,s);A===".priority"?h=f.updatePriority(c.getNode(),O):h=f.updateChild(c.getNode(),A,O,S,kp,null)}const p=Cp(e,h,c.isFullyInitialized()||Y(t),f.filtersNodes()),m=new yc(i,p,r);return Np(n,p,t,i,m,l)}function Il(n,e,t,s,i,r,o){const l=e.eventCache;let c,h;const f=new yc(i,e,r);if(Y(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Vi(e,h,!0,n.filter.filtersNodes());else{const p=z(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),s),c=Vi(e,h,l.isFullyInitialized(),l.isFiltered());else{const m=ce(t),A=l.getNode().getImmediateChild(p);let S;if(Y(m))S=s;else{const P=f.getCompleteChild(p);P!=null?dp(m)===".priority"&&P.getChild(pp(m)).isEmpty()?S=P:S=P.updateChild(m,s):S=q.EMPTY_NODE}if(A.equals(S))c=e;else{const P=n.filter.updateChild(l.getNode(),p,S,m,f,o);c=Vi(e,P,l.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Gh(n,e){return n.eventCache.isCompleteForChild(e)}function EI(n,e,t,s,i,r,o){let l=e;return s.foreach((c,h)=>{const f=ke(t,c);Gh(e,z(f))&&(l=Il(n,l,f,h,i,r,o))}),s.foreach((c,h)=>{const f=ke(t,c);Gh(e,z(f))||(l=Il(n,l,f,h,i,r,o))}),l}function Kh(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Tl(n,e,t,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;Y(t)?h=s:h=new pe(null).setTree(t,s);const f=e.serverCache.getNode();return h.children.inorderTraversal((p,m)=>{if(f.hasChild(p)){const A=e.serverCache.getNode().getImmediateChild(p),S=Kh(n,A,m);c=Ao(n,c,new ae(p),S,i,r,o,l)}}),h.children.inorderTraversal((p,m)=>{const A=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!f.hasChild(p)&&!A){const S=e.serverCache.getNode().getImmediateChild(p),P=Kh(n,S,m);c=Ao(n,c,new ae(p),P,i,r,o,l)}}),c}function II(n,e,t,s,i,r,o){if(Co(i,t)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(Y(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Ao(n,e,t,c.getNode().getChild(t),i,r,l,o);if(Y(t)){let h=new pe(null);return c.getNode().forEachChild(ws,(f,p)=>{h=h.set(new ae(f),p)}),Tl(n,e,t,h,i,r,l,o)}else return e}else{let h=new pe(null);return s.foreach((f,p)=>{const m=ke(t,f);c.isCompleteForPath(m)&&(h=h.set(f,c.getNode().getChild(m)))}),Tl(n,e,t,h,i,r,l,o)}}function TI(n,e,t,s,i){const r=e.serverCache,o=Cp(e,r.getNode(),r.isFullyInitialized()||Y(t),r.isFiltered());return Np(n,o,t,s,kp,i)}function wI(n,e,t,s,i,r){let o;if(Co(s,t)!=null)return e;{const l=new yc(s,e,i),c=e.eventCache.getNode();let h;if(Y(t)||z(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=wo(s,es(e));else{const p=e.serverCache.getNode();k(p instanceof q,"serverChildren would be complete if leaf node"),f=mc(s,p)}f=f,h=n.filter.updateFullNode(c,f,r)}else{const f=z(t);let p=_c(s,f,e.serverCache);p==null&&e.serverCache.isCompleteForChild(f)&&(p=c.getImmediateChild(f)),p!=null?h=n.filter.updateChild(c,f,p,ce(t),l,r):e.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(c,f,q.EMPTY_NODE,ce(t),l,r):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=wo(s,es(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,r)))}return o=e.serverCache.isFullyInitialized()||Co(s,te())!=null,Vi(e,h,o,n.filter.filtersNodes())}}class CI{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new hc(s.getIndex()),r=jE(s);this.processor_=mI(r);const o=t.serverCache,l=t.eventCache,c=i.updateFullNode(q.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(q.EMPTY_NODE,l.getNode(),null),f=new Zn(c,o.isFullyInitialized(),i.filtersNodes()),p=new Zn(h,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=Qo(p,f),this.eventGenerator_=new YE(this.query_)}get query(){return this.query_}}function AI(n){return n.viewCache_.serverCache.getNode()}function SI(n,e){const t=es(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Y(e)&&!t.getImmediateChild(z(e)).isEmpty())?t.getChild(e):null}function Qh(n){return n.eventRegistrations_.length===0}function RI(n,e){n.eventRegistrations_.push(e)}function Yh(n,e,t){const s=[];if(t){k(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function Jh(n,e,t,s){e.type===gt.MERGE&&e.source.queryId!==null&&(k(es(n.viewCache_),"We should always have a full cache before handling merges"),k(yl(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=yI(n.processor_,i,e,t,s);return _I(n.processor_,r.viewCache),k(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Dp(n,r.changes,r.viewCache.eventCache.getNode(),null)}function bI(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ie,(r,o)=>{s.push(Os(r,o))}),t.isFullyInitialized()&&s.push(Ip(t.getNode())),Dp(n,s,t.getNode(),e)}function Dp(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return JE(n.eventGenerator_,e,t,i)}let So;class PI{constructor(){this.views=new Map}}function kI(n){k(!So,"__referenceConstructor has already been defined"),So=n}function NI(){return k(So,"Reference.ts has not been loaded"),So}function DI(n){return n.views.size===0}function vc(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return k(r!=null,"SyncTree gave us an op for an invalid query."),Jh(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(Jh(o,e,t,s));return r}}function OI(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let l=wo(t,i?s:null),c=!1;l?c=!0:s instanceof q?(l=mc(t,s),c=!1):(l=q.EMPTY_NODE,c=!1);const h=Qo(new Zn(l,c,!1),new Zn(s,i,!1));return new CI(e,h)}return o}function LI(n,e,t,s,i,r){const o=OI(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),RI(o,t),bI(o,t)}function xI(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const l=En(n);if(i==="default")for(const[c,h]of n.views.entries())o=o.concat(Yh(h,t,s)),Qh(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||r.push(h.query));else{const c=n.views.get(i);c&&(o=o.concat(Yh(c,t,s)),Qh(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!En(n)&&r.push(new(NI())(e._repo,e._path)),{removed:r,events:o}}function Op(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Cs(n,e){let t=null;for(const s of n.views.values())t=t||SI(s,e);return t}function Lp(n,e){if(e._queryParams.loadsAllData())return Yo(n);{const s=e._queryIdentifier;return n.views.get(s)}}function xp(n,e){return Lp(n,e)!=null}function En(n){return Yo(n)!=null}function Yo(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Ro;function MI(n){k(!Ro,"__referenceConstructor has already been defined"),Ro=n}function VI(){return k(Ro,"Reference.ts has not been loaded"),Ro}let FI=1;class Xh{constructor(e){this.listenProvider_=e,this.syncPointTree_=new pe(null),this.pendingWriteTree_=dI(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Mp(n,e,t,s,i){return tI(n.pendingWriteTree_,e,t,s,i),i?dr(n,new Xn(wp(),e,t)):[]}function $n(n,e,t=!1){const s=nI(n.pendingWriteTree_,e);if(sI(n.pendingWriteTree_,e)){let r=new pe(null);return s.snap!=null?r=r.set(te(),!0):nt(s.children,o=>{r=r.set(new ae(o),!0)}),dr(n,new To(s.path,r,t))}else return[]}function Jo(n,e,t){return dr(n,new Xn(fc(),e,t))}function UI(n,e,t){const s=pe.fromObject(t);return dr(n,new Zi(fc(),e,s))}function BI(n,e){return dr(n,new Xi(fc(),e))}function qI(n,e,t){const s=Ic(n,t);if(s){const i=Tc(s),r=i.path,o=i.queryId,l=et(r,e),c=new Xi(pc(o),l);return wc(n,r,c)}else return[]}function wl(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let l=[];if(o&&(e._queryIdentifier==="default"||xp(o,e))){const c=xI(o,e,t,s);DI(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const h=c.removed;if(l=c.events,!i){const f=h.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(r,(m,A)=>En(A));if(f&&!p){const m=n.syncPointTree_.subtree(r);if(!m.isEmpty()){const A=HI(m);for(let S=0;S<A.length;++S){const P=A[S],O=P.query,B=Up(n,P);n.listenProvider_.startListening(Ui(O),bo(n,O),B.hashFn,B.onComplete)}}}!p&&h.length>0&&!s&&(f?n.listenProvider_.stopListening(Ui(e),null):h.forEach(m=>{const A=n.queryToTagMap.get(Xo(m));n.listenProvider_.stopListening(Ui(m),A)}))}$I(n,h)}return l}function WI(n,e,t,s){const i=Ic(n,s);if(i!=null){const r=Tc(i),o=r.path,l=r.queryId,c=et(o,e),h=new Xn(pc(l),c,t);return wc(n,o,h)}else return[]}function jI(n,e,t,s){const i=Ic(n,s);if(i){const r=Tc(i),o=r.path,l=r.queryId,c=et(o,e),h=pe.fromObject(t),f=new Zi(pc(l),c,h);return wc(n,o,f)}else return[]}function Zh(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(m,A)=>{const S=et(m,i);r=r||Cs(A,S),o=o||En(A)});let l=n.syncPointTree_.get(i);l?(o=o||En(l),r=r||Cs(l,te())):(l=new PI,n.syncPointTree_=n.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=q.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((A,S)=>{const P=Cs(S,te());P&&(r=r.updateImmediateChild(A,P))}));const h=xp(l,e);if(!h&&!e._queryParams.loadsAllData()){const m=Xo(e);k(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const A=zI();n.queryToTagMap.set(m,A),n.tagToQueryMap.set(A,m)}const f=gc(n.pendingWriteTree_,i);let p=LI(l,e,t,f,r,c);if(!h&&!o&&!s){const m=Lp(l,e);p=p.concat(GI(n,e,m))}return p}function Ec(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=et(o,e),h=Cs(l,c);if(h)return h});return Rp(i,e,r,t,!0)}function dr(n,e){return Vp(e,n.syncPointTree_,null,gc(n.pendingWriteTree_,te()))}function Vp(n,e,t,s){if(Y(n.path))return Fp(n,e,t,s);{const i=e.get(te());t==null&&i!=null&&(t=Cs(i,te()));let r=[];const o=z(n.path),l=n.operationForChild(o),c=e.children.get(o);if(c&&l){const h=t?t.getImmediateChild(o):null,f=bp(s,o);r=r.concat(Vp(l,c,h,f))}return i&&(r=r.concat(vc(i,n,s,t))),r}}function Fp(n,e,t,s){const i=e.get(te());t==null&&i!=null&&(t=Cs(i,te()));let r=[];return e.children.inorderTraversal((o,l)=>{const c=t?t.getImmediateChild(o):null,h=bp(s,o),f=n.operationForChild(o);f&&(r=r.concat(Fp(f,l,c,h)))}),i&&(r=r.concat(vc(i,n,s,t))),r}function Up(n,e){const t=e.query,s=bo(n,t);return{hashFn:()=>(AI(e)||q.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?qI(n,t._path,s):BI(n,t._path);{const r=Wv(i,t);return wl(n,t,null,r)}}}}function bo(n,e){const t=Xo(e);return n.queryToTagMap.get(t)}function Xo(n){return n._path.toString()+"$"+n._queryIdentifier}function Ic(n,e){return n.tagToQueryMap.get(e)}function Tc(n){const e=n.indexOf("$");return k(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ae(n.substr(0,e))}}function wc(n,e,t){const s=n.syncPointTree_.get(e);k(s,"Missing sync point for query tag that we're tracking");const i=gc(n.pendingWriteTree_,e);return vc(s,t,i,null)}function HI(n){return n.fold((e,t,s)=>{if(t&&En(t))return[Yo(t)];{let i=[];return t&&(i=Op(t)),nt(s,(r,o)=>{i=i.concat(o)}),i}})}function Ui(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(VI())(n._repo,n._path):n}function $I(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=Xo(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function zI(){return FI++}function GI(n,e,t){const s=e._path,i=bo(n,e),r=Up(n,t),o=n.listenProvider_.startListening(Ui(e),i,r.hashFn,r.onComplete),l=n.syncPointTree_.subtree(s);if(i)k(!En(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((h,f,p)=>{if(!Y(h)&&f&&En(f))return[Yo(f).query];{let m=[];return f&&(m=m.concat(Op(f).map(A=>A.query))),nt(p,(A,S)=>{m=m.concat(S)}),m}});for(let h=0;h<c.length;++h){const f=c[h];n.listenProvider_.stopListening(Ui(f),bo(n,f))}}return o}class Cc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Cc(t)}node(){return this.node_}}class Ac{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ke(this.path_,e);return new Ac(this.syncTree_,t)}node(){return Ec(this.syncTree_,this.path_)}}const KI=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ed=function(n,e,t){if(!n||typeof n!="object")return n;if(k(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return QI(n[".sv"],e,t);if(typeof n[".sv"]=="object")return YI(n[".sv"],e);k(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},QI=function(n,e,t){if(n==="timestamp")return t.timestamp;k(!1,"Unexpected server value: "+n)},YI=function(n,e,t){n.hasOwnProperty("increment")||k(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&k(!1,"Unexpected increment value: "+s);const i=e.node();if(k(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},JI=function(n,e,t,s){return Sc(e,new Ac(t,n),s)},Bp=function(n,e,t){return Sc(n,new Cc(e),t)};function Sc(n,e,t){const s=n.getPriority().val(),i=ed(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,l=ed(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new xe(l,Be(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new xe(i))),o.forEachChild(Ie,(l,c)=>{const h=Sc(c,e.getImmediateChild(l),t);h!==c&&(r=r.updateImmediateChild(l,h))}),r}}class Rc{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function bc(n,e){let t=e instanceof ae?e:new ae(e),s=n,i=z(t);for(;i!==null;){const r=Ns(s.node.children,i)||{children:{},childCount:0};s=new Rc(i,s,r),t=ce(t),i=z(t)}return s}function Gs(n){return n.node.value}function qp(n,e){n.node.value=e,Cl(n)}function Wp(n){return n.node.childCount>0}function XI(n){return Gs(n)===void 0&&!Wp(n)}function Zo(n,e){nt(n.node.children,(t,s)=>{e(new Rc(t,n,s))})}function jp(n,e,t,s){t&&e(n),Zo(n,i=>{jp(i,e,!0)})}function ZI(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function fr(n){return new ae(n.parent===null?n.name:fr(n.parent)+"/"+n.name)}function Cl(n){n.parent!==null&&eT(n.parent,n.name,n)}function eT(n,e,t){const s=XI(t),i=$t(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Cl(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Cl(n))}const tT=/[\[\].#$\/\u0000-\u001F\u007F]/,nT=/[\[\].#$\u0000-\u001F\u007F]/,Ya=10*1024*1024,Hp=function(n){return typeof n=="string"&&n.length!==0&&!tT.test(n)},$p=function(n){return typeof n=="string"&&n.length!==0&&!nT.test(n)},sT=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),$p(n)},zp=function(n,e,t,s){s&&e===void 0||Pc(tc(n,"value"),e,t)},Pc=function(n,e,t){const s=t instanceof ae?new IE(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+jn(s));if(typeof e=="function")throw new Error(n+"contains a function "+jn(s)+" with contents = "+e.toString());if($f(e))throw new Error(n+"contains "+e.toString()+" "+jn(s));if(typeof e=="string"&&e.length>Ya/3&&$o(e)>Ya)throw new Error(n+"contains a string greater than "+Ya+" utf8 bytes "+jn(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(nt(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Hp(o)))throw new Error(n+" contains an invalid key ("+o+") "+jn(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);TE(s,o),Pc(n,l,s),wE(s)}),i&&r)throw new Error(n+' contains ".value" child '+jn(s)+" in addition to actual children.")}},Gp=function(n,e,t,s){if(!$p(t))throw new Error(tc(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},iT=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gp(n,e,t)},kc=function(n,e){if(z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},rT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!sT(t))throw new Error(tc(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class oT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Nc(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!lc(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Kp(n,e,t){Nc(n,t),Qp(n,s=>lc(s,e))}function qt(n,e,t){Nc(n,t),Qp(n,s=>pt(s,e)||pt(e,s))}function Qp(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(aT(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function aT(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();xi&&He("event: "+t.toString()),zs(s)}}}const lT="repo_interrupt",cT=25;class uT{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Io(),this.transactionQueueTree_=new Rc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function hT(n,e,t){if(n.stats_=oc(n.repoInfo_),n.forceRestClient_||zv())n.server_=new Eo(n.repoInfo_,(s,i,r,o)=>{td(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>nd(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ve(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Ft(n.repoInfo_,e,(s,i,r,o)=>{td(n,s,i,r,o)},s=>{nd(n,s)},s=>{dT(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=Jv(n.repoInfo_,()=>new QE(n.stats_,n.server_)),n.infoData_=new HE,n.infoSyncTree_=new Xh({startListening:(s,i,r,o)=>{let l=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(l=Jo(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Oc(n,"connected",!1),n.serverSyncTree_=new Xh({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(l,c)=>{const h=o(l,c);qt(n.eventQueue_,s._path,h)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Yp(n){const t=n.infoData_.getNode(new ae(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Dc(n){return KI({timestamp:Yp(n)})}function td(n,e,t,s,i){n.dataUpdateCount++;const r=new ae(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const c=go(t,h=>Be(h));o=jI(n.serverSyncTree_,r,c,i)}else{const c=Be(t);o=WI(n.serverSyncTree_,r,c,i)}else if(s){const c=go(t,h=>Be(h));o=UI(n.serverSyncTree_,r,c)}else{const c=Be(t);o=Jo(n.serverSyncTree_,r,c)}let l=r;o.length>0&&(l=ea(n,r)),qt(n.eventQueue_,l,o)}function nd(n,e){Oc(n,"connected",e),e===!1&&pT(n)}function dT(n,e){nt(e,(t,s)=>{Oc(n,t,s)})}function Oc(n,e,t){const s=new ae("/.info/"+e),i=Be(t);n.infoData_.updateSnapshot(s,i);const r=Jo(n.infoSyncTree_,s,i);qt(n.eventQueue_,s,r)}function Jp(n){return n.nextWriteId_++}function fT(n,e,t,s,i){Lc(n,"set",{path:e.toString(),value:t,priority:s});const r=Dc(n),o=Be(t,s),l=Ec(n.serverSyncTree_,e),c=Bp(o,l,r),h=Jp(n),f=Mp(n.serverSyncTree_,e,c,h,!0);Nc(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(m,A)=>{const S=m==="ok";S||tt("set at "+e+" failed: "+m);const P=$n(n.serverSyncTree_,h,!S);qt(n.eventQueue_,e,P),yT(n,i,m,A)});const p=ng(n,e);ea(n,p),qt(n.eventQueue_,p,[])}function pT(n){Lc(n,"onDisconnectEvents");const e=Dc(n),t=Io();_l(n.onDisconnect_,te(),(i,r)=>{const o=JI(i,r,n.serverSyncTree_,e);Tp(t,i,o)});let s=[];_l(t,te(),(i,r)=>{s=s.concat(Jo(n.serverSyncTree_,i,r));const o=ng(n,i);ea(n,o)}),n.onDisconnect_=Io(),qt(n.eventQueue_,te(),s)}function gT(n,e,t){let s;z(e._path)===".info"?s=Zh(n.infoSyncTree_,e,t):s=Zh(n.serverSyncTree_,e,t),Kp(n.eventQueue_,e._path,s)}function mT(n,e,t){let s;z(e._path)===".info"?s=wl(n.infoSyncTree_,e,t):s=wl(n.serverSyncTree_,e,t),Kp(n.eventQueue_,e._path,s)}function _T(n){n.persistentConnection_&&n.persistentConnection_.interrupt(lT)}function Lc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),He(t,...e)}function yT(n,e,t,s){e&&zs(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Xp(n,e,t){return Ec(n.serverSyncTree_,e,t)||q.EMPTY_NODE}function xc(n,e=n.transactionQueueTree_){if(e||ta(n,e),Gs(e)){const t=eg(n,e);k(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&vT(n,fr(e),t)}else Wp(e)&&Zo(e,t=>{xc(n,t)})}function vT(n,e,t){const s=t.map(h=>h.currentWriteId),i=Xp(n,e,s);let r=i;const o=i.hash();for(let h=0;h<t.length;h++){const f=t[h];k(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const p=et(e,f.path);r=r.updateChild(p,f.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;n.server_.put(c.toString(),l,h=>{Lc(n,"transaction put response",{path:c.toString(),status:h});let f=[];if(h==="ok"){const p=[];for(let m=0;m<t.length;m++)t[m].status=2,f=f.concat($n(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();ta(n,bc(n.transactionQueueTree_,e)),xc(n,n.transactionQueueTree_),qt(n.eventQueue_,e,f);for(let m=0;m<p.length;m++)zs(p[m])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{tt("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}ea(n,e)}},o)}function ea(n,e){const t=Zp(n,e),s=fr(t),i=eg(n,t);return ET(n,i,s),s}function ET(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],h=et(t,c.path);let f=!1,p;if(k(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)f=!0,p=c.abortReason,i=i.concat($n(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=cT)f=!0,p="maxretry",i=i.concat($n(n.serverSyncTree_,c.currentWriteId,!0));else{const m=Xp(n,c.path,o);c.currentInputSnapshot=m;const A=e[l].update(m.val());if(A!==void 0){Pc("transaction failed: Data returned ",A,c.path);let S=Be(A);typeof A=="object"&&A!=null&&$t(A,".priority")||(S=S.updatePriority(m.getPriority()));const O=c.currentWriteId,B=Dc(n),W=Bp(S,m,B);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=W,c.currentWriteId=Jp(n),o.splice(o.indexOf(O),1),i=i.concat(Mp(n.serverSyncTree_,c.path,W,c.currentWriteId,c.applyLocally)),i=i.concat($n(n.serverSyncTree_,O,!0))}else f=!0,p="nodata",i=i.concat($n(n.serverSyncTree_,c.currentWriteId,!0))}qt(n.eventQueue_,t,i),i=[],f&&(e[l].status=2,(function(m){setTimeout(m,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(p),!1,null))))}ta(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)zs(s[l]);xc(n,n.transactionQueueTree_)}function Zp(n,e){let t,s=n.transactionQueueTree_;for(t=z(e);t!==null&&Gs(s)===void 0;)s=bc(s,t),e=ce(e),t=z(e);return s}function eg(n,e){const t=[];return tg(n,e,t),t.sort((s,i)=>s.order-i.order),t}function tg(n,e,t){const s=Gs(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Zo(e,i=>{tg(n,i,t)})}function ta(n,e){const t=Gs(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,qp(e,t.length>0?t:void 0)}Zo(e,s=>{ta(n,s)})}function ng(n,e){const t=fr(Zp(n,e)),s=bc(n.transactionQueueTree_,e);return ZI(s,i=>{Ja(n,i)}),Ja(n,s),jp(s,i=>{Ja(n,i)}),t}function Ja(n,e){const t=Gs(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(k(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(k(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat($n(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?qp(e,void 0):t.length=r+1,qt(n.eventQueue_,fr(e),i);for(let o=0;o<s.length;o++)zs(s[o])}}function IT(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function TT(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):tt(`Invalid query segment '${t}' in query '${n}'`)}return e}const sd=function(n,e){const t=wT(n),s=t.namespace;t.domain==="firebase.com"&&Bt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Bt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Vv();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new sp(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new ae(t.pathString)}},wT=function(n){let e="",t="",s="",i="",r="",o=!0,l="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(f,p)),f<p&&(i=IT(n.substring(f,p)));const m=TT(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const A=e.slice(0,h);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const S=e.indexOf(".");s=e.substring(0,S).toLowerCase(),t=e.substring(S+1),r=s}"ns"in m&&(r=m.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};const id="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",CT=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=id.charAt(t%64),t=Math.floor(t/64);k(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=id.charAt(e[i]);return k(o.length===20,"nextPushId: Length should be 20."),o}})();class AT{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ve(this.snapshot.exportVal())}}class ST{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class RT{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return k(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Mc{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return Y(this._path)?null:dp(this._path)}get ref(){return new bn(this._repo,this._path)}get _queryIdentifier(){const e=qh(this._queryParams),t=ic(e);return t==="{}"?"default":t}get _queryObject(){return qh(this._queryParams)}isEqual(e){if(e=Xe(e),!(e instanceof Mc))return!1;const t=this._repo===e._repo,s=lc(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+EE(this._path)}}class bn extends Mc{constructor(e,t){super(e,t,new dc,!1)}get parent(){const e=pp(this._path);return e===null?null:new bn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Po{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ae(e),s=er(this.ref,e);return new Po(this._node.getChild(t),s,Ie)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new Po(i,er(this.ref,s),Ie)))}hasChild(e){const t=new ae(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Gr(n,e){return n=Xe(n),n._checkNotDeleted("ref"),e!==void 0?er(n._root,e):n._root}function er(n,e){return n=Xe(n),z(n._path)===null?iT("child","path",e):Gp("child","path",e),new bn(n._repo,ke(n._path,e))}function bT(n,e){n=Xe(n),kc("push",n._path),zp("push",e,n._path,!0);const t=Yp(n._repo),s=CT(t),i=er(n,s),r=er(n,s);let o;return o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function PT(n){return kc("remove",n._path),Al(n,null)}function Al(n,e){n=Xe(n),kc("set",n._path),zp("set",e,n._path,!1);const t=new Ho;return fT(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Vc{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new AT("value",this,new Po(e.snapshotNode,new bn(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ST(this,e,t):null}matches(e){return e instanceof Vc?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function kT(n,e,t,s,i){const r=new RT(t,void 0),o=new Vc(r);return gT(n._repo,n,o),()=>mT(n._repo,n,o)}function NT(n,e,t,s){return kT(n,"value",e)}kI(bn);MI(bn);const DT="FIREBASE_DATABASE_EMULATOR_HOST",Sl={};let OT=!1;function LT(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=Rn(r);n.repoInfo_=new sp(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function xT(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Bt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),He("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=sd(r,i),l=o.repoInfo,c;typeof process<"u"&&wh&&(c=wh[DT]),c?(r=`http://${c}?ns=${l.namespace}`,o=sd(r,i),l=o.repoInfo):o.repoInfo.secure;const h=new Kv(n.name,n.options,e);rT("Invalid Firebase Database URL",o),Y(o.path)||Bt("Database URL must point to the root of a Firebase Database (not including a child path).");const f=VT(l,n,h,new Gv(n,t));return new FT(f,n)}function MT(n,e){const t=Sl[e];(!t||t[n.key]!==n)&&Bt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),_T(n),delete t[n.key]}function VT(n,e,t,s){let i=Sl[e.name];i||(i={},Sl[e.name]=i);let r=i[n.toURLString()];return r&&Bt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new uT(n,OT,t,s),i[n.toURLString()]=r,r}class FT{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(hT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new bn(this._repo,te())),this._rootInternal}_delete(){return this._rootInternal!==null&&(MT(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bt("Cannot call "+e+" on a deleted database.")}}function UT(n=sc(),e){const t=Go(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Nf("database");s&&BT(t,...s)}return t}function BT(n,e,t,s={}){n=Xe(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&_n(s,r.repoInfo_.emulatorOptions))return;Bt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&Bt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new to(to.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:Lf(s.mockUserToken,n.app.options.projectId);o=new to(l)}Rn(e)&&(Xl(e),Zl("Database",!0)),LT(r,i,s,o)}function qT(n){Nv(ss),Yn(new yn("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return xT(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),St(Ch,Ah,n),St(Ch,Ah,"esm2020")}Ft.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ft.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};qT();function sg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WT=sg,ig=new lr("auth","Firebase",sg());const ko=new zo("@firebase/auth");function jT(n,...e){ko.logLevel<=Q.WARN&&ko.warn(`Auth (${ss}): ${n}`,...e)}function so(n,...e){ko.logLevel<=Q.ERROR&&ko.error(`Auth (${ss}): ${n}`,...e)}function yt(n,...e){throw Fc(n,...e)}function Rt(n,...e){return Fc(n,...e)}function rg(n,e,t){const s={...WT(),[e]:t};return new lr("auth","Firebase",s).create(e,{appName:n.name})}function fn(n){return rg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fc(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return ig.create(n,...e)}function U(n,e,...t){if(!n)throw Fc(e,...t)}function Mt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw so(e),new Error(e)}function Wt(n,e){n||Mt(e)}function Rl(){return typeof self<"u"&&self.location?.href||""}function HT(){return rd()==="http:"||rd()==="https:"}function rd(){return typeof self<"u"&&self.location?.protocol||null}function $T(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(HT()||ry()||"connection"in navigator)?navigator.onLine:!0}function zT(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class pr{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wt(t>e,"Short delay should be less than long delay!"),this.isMobile=ec()||xf()}get(){return $T()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Uc(n,e){Wt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class og{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Mt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Mt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Mt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const GT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const KT=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],QT=new pr(3e4,6e4);function rs(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Pn(n,e,t,s,i={}){return ag(n,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const l=Hs({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:c,...r};return iy()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Rn(n.emulatorConfig.host)&&(h.credentials="include"),og.fetch()(await lg(n,n.config.apiHost,t,l),h)})}async function ag(n,e,t){n._canInitEmulator=!1;const s={...GT,...e};try{const i=new JT(n),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Kr(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const l=r.ok?o.errorMessage:o.error.message,[c,h]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Kr(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Kr(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Kr(n,"user-disabled",o);const f=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw rg(n,f,h);yt(n,f)}}catch(i){if(i instanceof Ht)throw i;yt(n,"network-request-failed",{message:String(i)})}}async function na(n,e,t,s,i={}){const r=await Pn(n,e,t,s,i);return"mfaPendingCredential"in r&&yt(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function lg(n,e,t,s){const i=`${e}${t}?${s}`,r=n,o=r.config.emulator?Uc(n.config,i):`${n.config.apiScheme}://${i}`;return KT.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function YT(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class JT{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Rt(this.auth,"network-request-failed")),QT.get())})}}function Kr(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const i=Rt(n,e,s);return i.customData._tokenResponse=t,i}function od(n){return n!==void 0&&n.enterprise!==void 0}class XT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return YT(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ZT(n,e){return Pn(n,"GET","/v2/recaptchaConfig",rs(n,e))}async function ew(n,e){return Pn(n,"POST","/v1/accounts:delete",e)}async function No(n,e){return Pn(n,"POST","/v1/accounts:lookup",e)}function Bi(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function tw(n,e=!1){const t=Xe(n),s=await t.getIdToken(e),i=Bc(s);U(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r?.sign_in_provider;return{claims:i,token:s,authTime:Bi(Xa(i.auth_time)),issuedAtTime:Bi(Xa(i.iat)),expirationTime:Bi(Xa(i.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}}function Xa(n){return Number(n)*1e3}function Bc(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return so("JWT malformed, contained fewer than 3 sections"),null;try{const i=po(t);return i?JSON.parse(i):(so("Failed to decode base64 JWT payload"),null)}catch(i){return so("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ad(n){const e=Bc(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function tr(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof Ht&&nw(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function nw({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class sw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class bl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Bi(this.lastLoginAt),this.creationTime=Bi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Do(n){const e=n.auth,t=await n.getIdToken(),s=await tr(n,No(e,{idToken:t}));U(s?.users.length,e,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const r=i.providerUserInfo?.length?cg(i.providerUserInfo):[],o=rw(n.providerData,r),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!o?.length,h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new bl(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function iw(n){const e=Xe(n);await Do(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rw(n,e){return[...n.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function cg(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function ow(n,e){const t=await ag(n,{},async()=>{const s=Hs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=n.config,o=await lg(n,i,"/v1/token",`key=${r}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:s};return n.emulatorConfig&&Rn(n.emulatorConfig.host)&&(c.credentials="include"),og.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function aw(n,e){return Pn(n,"POST","/v2/accounts:revokeToken",rs(n,e))}class As{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ad(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");const t=ad(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:i,expiresIn:r}=await ow(e,t);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:i,expirationTime:r}=t,o=new As;return s&&(U(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(U(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(U(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new As,this.toJSON())}_performRefresh(){return Mt("not implemented")}}function tn(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class mt{constructor({uid:e,auth:t,stsTokenManager:s,...i}){this.providerId="firebase",this.proactiveRefresh=new sw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new bl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await tr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tw(this,e)}reload(){return iw(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new mt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Do(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(at(this.auth.app))return Promise.reject(fn(this.auth));const e=await this.getIdToken();return await tr(this,ew(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,o=t.photoURL??void 0,l=t.tenantId??void 0,c=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:A,providerData:S,stsTokenManager:P}=t;U(p&&P,e,"internal-error");const O=As.fromJSON(this.name,P);U(typeof p=="string",e,"internal-error"),tn(s,e.name),tn(i,e.name),U(typeof m=="boolean",e,"internal-error"),U(typeof A=="boolean",e,"internal-error"),tn(r,e.name),tn(o,e.name),tn(l,e.name),tn(c,e.name),tn(h,e.name),tn(f,e.name);const B=new mt({uid:p,auth:e,email:i,emailVerified:m,displayName:s,isAnonymous:A,photoURL:o,phoneNumber:r,tenantId:l,stsTokenManager:O,createdAt:h,lastLoginAt:f});return S&&Array.isArray(S)&&(B.providerData=S.map(W=>({...W}))),c&&(B._redirectEventId=c),B}static async _fromIdTokenResponse(e,t,s=!1){const i=new As;i.updateFromServerResponse(t);const r=new mt({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Do(r),r}static async _fromGetAccountInfoResponse(e,t,s){const i=t.users[0];U(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?cg(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!r?.length,l=new As;l.updateFromIdToken(s);const c=new mt({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new bl(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length};return Object.assign(c,h),c}}const ld=new Map;function Vt(n){Wt(n instanceof Function,"Expected a class definition");let e=ld.get(n);return e?(Wt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ld.set(n,e),e)}class ug{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ug.type="NONE";const cd=ug;function io(n,e,t){return`firebase:${n}:${e}:${t}`}class Ss{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=io(this.userKey,i.apiKey,r),this.fullPersistenceKey=io("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await No(this.auth,{idToken:e}).catch(()=>{});return t?mt._fromGetAccountInfoResponse(this.auth,t,e):null}return mt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Ss(Vt(cd),e,s);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=i[0]||Vt(cd);const o=io(s,e.config.apiKey,e.name);let l=null;for(const h of t)try{const f=await h._get(o);if(f){let p;if(typeof f=="string"){const m=await No(e,{idToken:f}).catch(()=>{});if(!m)break;p=await mt._fromGetAccountInfoResponse(e,m,f)}else p=mt._fromJSON(e,f);h!==r&&(l=p),r=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Ss(r,e,s):(r=c[0],l&&await r._set(o,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==r)try{await h._remove(o)}catch{}})),new Ss(r,e,s))}}function ud(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mg(e))return"Blackberry";if(_g(e))return"Webos";if(dg(e))return"Safari";if((e.includes("chrome/")||fg(e))&&!e.includes("edge/"))return"Chrome";if(gg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function hg(n=ze()){return/firefox\//i.test(n)}function dg(n=ze()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fg(n=ze()){return/crios\//i.test(n)}function pg(n=ze()){return/iemobile/i.test(n)}function gg(n=ze()){return/android/i.test(n)}function mg(n=ze()){return/blackberry/i.test(n)}function _g(n=ze()){return/webos/i.test(n)}function qc(n=ze()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function lw(n=ze()){return qc(n)&&!!window.navigator?.standalone}function cw(){return oy()&&document.documentMode===10}function yg(n=ze()){return qc(n)||gg(n)||_g(n)||mg(n)||/windows phone/i.test(n)||pg(n)}function vg(n,e=[]){let t;switch(n){case"Browser":t=ud(ze());break;case"Worker":t=`${ud(ze())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ss}/${s}`}class uw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=r=>new Promise((o,l)=>{try{const c=e(r);o(c)}catch(c){l(c)}});s.onAbort=t,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function hw(n,e={}){return Pn(n,"GET","/v2/passwordPolicy",rs(n,e))}const dw=6;class fw{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??dw,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class pw{constructor(e,t,s,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hd(this),this.idTokenSubscription=new hd(this),this.beforeStateQueue=new uw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ig,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Vt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ss.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await No(this,{idToken:e}),s=await mt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(at(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,o=s?._redirectEventId,l=await this.tryRedirectSignIn(e);(!r||r===o)&&l?.user&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Do(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=zT()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(at(this.app))return Promise.reject(fn(this));const t=e?Xe(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return at(this.app)?Promise.reject(fn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return at(this.app)?Promise.reject(fn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await hw(this),t=new fw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new lr("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await aw(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Vt(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await Ss.create(this,[Vt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(l,this,"internal-error"),l.then(()=>{o||r(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(at(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&jT(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Ks(n){return Xe(n)}class hd{constructor(e){this.auth=e,this.observer=null,this.addObserver=_y(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let sa={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gw(n){sa=n}function Eg(n){return sa.loadJS(n)}function mw(){return sa.recaptchaEnterpriseScript}function _w(){return sa.gapiScript}function yw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class vw{constructor(){this.enterprise=new Ew}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Ew{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Iw="recaptcha-enterprise",Ig="NO_RECAPTCHA";class Tw{constructor(e){this.type=Iw,this.auth=Ks(e)}async verify(e="verify",t=!1){async function s(r){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,l)=>{ZT(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new XT(c);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,o(h.siteKey)}}).catch(c=>{l(c)})})}function i(r,o,l){const c=window.grecaptcha;od(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(h=>{o(h)}).catch(()=>{o(Ig)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new vw().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(l=>{if(!t&&od(window.grecaptcha))i(l,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=mw();c.length!==0&&(c+=l),Eg(c).then(()=>{i(l,r,o)}).catch(h=>{o(h)})}}).catch(l=>{o(l)})})}}async function dd(n,e,t,s=!1,i=!1){const r=new Tw(n);let o;if(i)o=Ig;else try{o=await r.verify(t)}catch{o=await r.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return s?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function fd(n,e,t,s,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await dd(n,e,t,t==="getOobCode");return s(n,r)}else return s(n,e).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await dd(n,e,t,t==="getOobCode");return s(n,o)}else return Promise.reject(r)})}function ww(n,e){const t=Go(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),r=t.getOptions();if(_n(r,e??{}))return i;yt(i,"already-initialized")}return t.initialize({options:e})}function Cw(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Vt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Aw(n,e,t){const s=Ks(n);U(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=Tg(e),{host:o,port:l}=Sw(e),c=l===null?"":`:${l}`,h={url:`${r}//${o}${c}/`},f=Object.freeze({host:o,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){U(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),U(_n(h,s.config.emulator)&&_n(f,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=h,s.emulatorConfig=f,s.settings.appVerificationDisabledForTesting=!0,Rn(o)?(Xl(`${r}//${o}${c}`),Zl("Auth",!0)):Rw()}function Tg(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Sw(n){const e=Tg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:pd(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:pd(o)}}}function pd(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Rw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Wc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Mt("not implemented")}_getIdTokenResponse(e){return Mt("not implemented")}_linkToIdToken(e,t){return Mt("not implemented")}_getReauthenticationResolver(e){return Mt("not implemented")}}async function bw(n,e){return Pn(n,"POST","/v1/accounts:signUp",e)}async function Pw(n,e){return na(n,"POST","/v1/accounts:signInWithPassword",rs(n,e))}async function kw(n,e){return na(n,"POST","/v1/accounts:signInWithEmailLink",rs(n,e))}async function Nw(n,e){return na(n,"POST","/v1/accounts:signInWithEmailLink",rs(n,e))}class nr extends Wc{constructor(e,t,s,i=null){super("password",s),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new nr(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new nr(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fd(e,t,"signInWithPassword",Pw);case"emailLink":return kw(e,{email:this._email,oobCode:this._password});default:yt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fd(e,s,"signUpPassword",bw);case"emailLink":return Nw(e,{idToken:t,email:this._email,oobCode:this._password});default:yt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Rs(n,e){return na(n,"POST","/v1/accounts:signInWithIdp",rs(n,e))}const Dw="http://localhost";class ts extends Wc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ts(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):yt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i,...r}=t;if(!s||!i)return null;const o=new ts(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Rs(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Rs(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rs(e,t)}buildRequest(){const e={requestUri:Dw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Hs(t)}return e}}function Ow(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Lw(n){const e=Ri(bi(n)).link,t=e?Ri(bi(e)).deep_link_id:null,s=Ri(bi(n)).deep_link_id;return(s?Ri(bi(s)).link:null)||s||t||e||n}class jc{constructor(e){const t=Ri(bi(e)),s=t.apiKey??null,i=t.oobCode??null,r=Ow(t.mode??null);U(s&&i&&r,"argument-error"),this.apiKey=s,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Lw(e);try{return new jc(t)}catch{return null}}}class Qs{constructor(){this.providerId=Qs.PROVIDER_ID}static credential(e,t){return nr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=jc.parseLink(t);return U(s,"argument-error"),nr._fromEmailAndCode(e,s.code,s.tenantId)}}Qs.PROVIDER_ID="password";Qs.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class gr extends wg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nn extends gr{constructor(){super("facebook.com")}static credential(e){return ts._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nn.credential(e.oauthAccessToken)}catch{return null}}}nn.FACEBOOK_SIGN_IN_METHOD="facebook.com";nn.PROVIDER_ID="facebook.com";class sn extends gr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ts._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return sn.credentialFromTaggedObject(e)}static credentialFromError(e){return sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return sn.credential(t,s)}catch{return null}}}sn.GOOGLE_SIGN_IN_METHOD="google.com";sn.PROVIDER_ID="google.com";class rn extends gr{constructor(){super("github.com")}static credential(e){return ts._fromParams({providerId:rn.PROVIDER_ID,signInMethod:rn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rn.credentialFromTaggedObject(e)}static credentialFromError(e){return rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rn.credential(e.oauthAccessToken)}catch{return null}}}rn.GITHUB_SIGN_IN_METHOD="github.com";rn.PROVIDER_ID="github.com";class on extends gr{constructor(){super("twitter.com")}static credential(e,t){return ts._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return on.credential(t,s)}catch{return null}}}on.TWITTER_SIGN_IN_METHOD="twitter.com";on.PROVIDER_ID="twitter.com";class xs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,i=!1){const r=await mt._fromIdTokenResponse(e,s,i),o=gd(s);return new xs({user:r,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const i=gd(s);return new xs({user:e,providerId:i,_tokenResponse:s,operationType:t})}}function gd(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Oo extends Ht{constructor(e,t,s,i){super(t.code,t.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Oo.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,i){return new Oo(e,t,s,i)}}function Cg(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Oo._fromErrorAndOperation(n,r,e,s):r})}async function xw(n,e,t=!1){const s=await tr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return xs._forOperation(n,"link",s)}async function Mw(n,e,t=!1){const{auth:s}=n;if(at(s.app))return Promise.reject(fn(s));const i="reauthenticate";try{const r=await tr(n,Cg(s,i,e,n),t);U(r.idToken,s,"internal-error");const o=Bc(r.idToken);U(o,s,"internal-error");const{sub:l}=o;return U(n.uid===l,s,"user-mismatch"),xs._forOperation(n,i,r)}catch(r){throw r?.code==="auth/user-not-found"&&yt(s,"user-mismatch"),r}}async function Ag(n,e,t=!1){if(at(n.app))return Promise.reject(fn(n));const s="signIn",i=await Cg(n,s,e),r=await xs._fromIdTokenResponse(n,s,i);return t||await n._updateCurrentUser(r.user),r}async function Vw(n,e){return Ag(Ks(n),e)}async function Fw(n){const e=Ks(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Uw(n,e,t){return at(n.app)?Promise.reject(fn(n)):Vw(Xe(n),Qs.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&Fw(n),s})}function Bw(n,e,t,s){return Xe(n).onIdTokenChanged(e,t,s)}function qw(n,e,t){return Xe(n).beforeAuthStateChanged(e,t)}const Lo="__sak";class Sg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Lo,"1"),this.storage.removeItem(Lo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ww=1e3,jw=10;class Rg extends Sg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),i=this.localCache[t];s!==i&&e(t,i,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);cw()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,jw):i()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},Ww)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rg.type="LOCAL";const Hw=Rg;class bg extends Sg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bg.type="SESSION";const Pg=bg;function $w(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ia{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const s=new ia(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:i,data:r}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async h=>h(t.origin,r)),c=await $w(l);t.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ia.receivers=[];function Hc(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class zw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((l,c)=>{const h=Hc("",20);i.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(f),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(m.data.response);break;default:clearTimeout(f),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function bt(){return window}function Gw(n){bt().location.href=n}function kg(){return typeof bt().WorkerGlobalScope<"u"&&typeof bt().importScripts=="function"}async function Kw(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Qw(){return navigator?.serviceWorker?.controller||null}function Yw(){return kg()?self:null}const Ng="firebaseLocalStorageDb",Jw=1,xo="firebaseLocalStorage",Dg="fbase_key";class mr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ra(n,e){return n.transaction([xo],e?"readwrite":"readonly").objectStore(xo)}function Xw(){const n=indexedDB.deleteDatabase(Ng);return new mr(n).toPromise()}function Pl(){const n=indexedDB.open(Ng,Jw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(xo,{keyPath:Dg})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(xo)?e(s):(s.close(),await Xw(),e(await Pl()))})})}async function md(n,e,t){const s=ra(n,!0).put({[Dg]:e,value:t});return new mr(s).toPromise()}async function Zw(n,e){const t=ra(n,!1).get(e),s=await new mr(t).toPromise();return s===void 0?null:s.value}function _d(n,e){const t=ra(n,!0).delete(e);return new mr(t).toPromise()}const eC=800,tC=3;class Og{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Pl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>tC)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ia._getInstance(Yw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Kw(),!this.activeServiceWorker)return;this.sender=new zw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Qw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Pl();return await md(e,Lo,"1"),await _d(e,Lo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>md(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>Zw(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_d(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=ra(i,!1).getAll();return new mr(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),eC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Og.type="LOCAL";const nC=Og;new pr(3e4,6e4);function sC(n,e){return e?Vt(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class $c extends Wc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Rs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Rs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function iC(n){return Ag(n.auth,new $c(n),n.bypassAuthState)}function rC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),Mw(t,new $c(n),n.bypassAuthState)}async function oC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),xw(t,new $c(n),n.bypassAuthState)}class Lg{constructor(e,t,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:i,tenantId:r,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return iC;case"linkViaPopup":case"linkViaRedirect":return oC;case"reauthViaPopup":case"reauthViaRedirect":return rC;default:yt(this.auth,"internal-error")}}resolve(e){Wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const aC=new pr(2e3,1e4);class Is extends Lg{constructor(e,t,s,i,r){super(e,t,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Is.currentPopupAction&&Is.currentPopupAction.cancel(),Is.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){Wt(this.filter.length===1,"Popup operations only handle one event");const e=Hc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Rt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Rt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Is.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,aC.get())};e()}}Is.currentPopupAction=null;const lC="pendingRedirect",ro=new Map;class cC extends Lg{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=ro.get(this.auth._key());if(!e){try{const s=await uC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}ro.set(this.auth._key(),e)}return this.bypassAuthState||ro.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function uC(n,e){const t=fC(e),s=dC(n);if(!await s._isAvailable())return!1;const i=await s._get(t)==="true";return await s._remove(t),i}function hC(n,e){ro.set(n._key(),e)}function dC(n){return Vt(n._redirectPersistence)}function fC(n){return io(lC,n.config.apiKey,n.name)}async function pC(n,e,t=!1){if(at(n.app))return Promise.reject(fn(n));const s=Ks(n),i=sC(s,e),o=await new cC(s,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const gC=600*1e3;class mC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_C(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!xg(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Rt(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=gC&&this.cachedEventUids.clear(),this.cachedEventUids.has(yd(e))}saveEventToCache(e){this.cachedEventUids.add(yd(e)),this.lastProcessedEventTime=Date.now()}}function yd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function xg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function _C(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return xg(n);default:return!1}}async function yC(n,e={}){return Pn(n,"GET","/v1/projects",e)}const vC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,EC=/^https?/;async function IC(n){if(n.config.emulator)return;const{authorizedDomains:e}=await yC(n);for(const t of e)try{if(TC(t))return}catch{}yt(n,"unauthorized-domain")}function TC(n){const e=Rl(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!EC.test(t))return!1;if(vC.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}const wC=new pr(3e4,6e4);function vd(){const n=bt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function CC(n){return new Promise((e,t)=>{function s(){vd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vd(),t(Rt(n,"network-request-failed"))},timeout:wC.get()})}if(bt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(bt().gapi?.load)s();else{const i=yw("iframefcb");return bt()[i]=()=>{gapi.load?s():t(Rt(n,"network-request-failed"))},Eg(`${_w()}?onload=${i}`).catch(r=>t(r))}}).catch(e=>{throw oo=null,e})}let oo=null;function AC(n){return oo=oo||CC(n),oo}const SC=new pr(5e3,15e3),RC="__/auth/iframe",bC="emulator/auth/iframe",PC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function NC(n){const e=n.config;U(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Uc(e,bC):`https://${n.config.authDomain}/${RC}`,s={apiKey:e.apiKey,appName:n.name,v:ss},i=kC.get(n.config.apiHost);i&&(s.eid=i);const r=n._getFrameworks();return r.length&&(s.fw=r.join(",")),`${t}?${Hs(s).slice(1)}`}async function DC(n){const e=await AC(n),t=bt().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:NC(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:PC,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=Rt(n,"network-request-failed"),l=bt().setTimeout(()=>{r(o)},SC.get());function c(){bt().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{r(o)})}))}const OC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},LC=500,xC=600,MC="_blank",VC="http://localhost";class Ed{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function FC(n,e,t,s=LC,i=xC){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c={...OC,width:s.toString(),height:i.toString(),top:r,left:o},h=ze().toLowerCase();t&&(l=fg(h)?MC:t),hg(h)&&(e=e||VC,c.scrollbars="yes");const f=Object.entries(c).reduce((m,[A,S])=>`${m}${A}=${S},`,"");if(lw(h)&&l!=="_self")return UC(e||"",l),new Ed(null);const p=window.open(e||"",l,f);U(p,n,"popup-blocked");try{p.focus()}catch{}return new Ed(p)}function UC(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const BC="__/auth/handler",qC="emulator/auth/handler",WC=encodeURIComponent("fac");async function Id(n,e,t,s,i,r){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:ss,eventId:i};if(e instanceof wg){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ll(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))o[f]=p}if(e instanceof gr){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await n._getAppCheckToken(),h=c?`#${WC}=${encodeURIComponent(c)}`:"";return`${jC(n)}?${Hs(l).slice(1)}${h}`}function jC({config:n}){return n.emulator?Uc(n,qC):`https://${n.authDomain}/${BC}`}const Za="webStorageSupport";class HC{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pg,this._completeRedirectFn=pC,this._overrideRedirectResult=hC}async _openPopup(e,t,s,i){Wt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const r=await Id(e,t,s,Rl(),i);return FC(e,r,Hc())}async _openRedirect(e,t,s,i){await this._originValidation(e);const r=await Id(e,t,s,Rl(),i);return Gw(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:r}=this.eventManagers[t];return i?Promise.resolve(i):(Wt(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await DC(e),s=new mC(e);return t.register("authEvent",i=>(U(i?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Za,{type:Za},i=>{const r=i?.[0]?.[Za];r!==void 0&&t(!!r),yt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=IC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return yg()||dg()||qc()}}const $C=HC;var Td="@firebase/auth",wd="1.12.0";class zC{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function GC(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function KC(n){Yn(new yn("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;U(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vg(n)},h=new pw(s,i,r,c);return Cw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Yn(new yn("auth-internal",e=>{const t=Ks(e.getProvider("auth").getImmediate());return(s=>new zC(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),St(Td,wd,GC(n)),St(Td,wd,"esm2020")}const QC=300,YC=Of("authIdTokenMaxAge")||QC;let Cd=null;const JC=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>YC)return;const i=t?.token;Cd!==i&&(Cd=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function XC(n=sc()){const e=Go(n,"auth");if(e.isInitialized())return e.getImmediate();const t=ww(n,{popupRedirectResolver:$C,persistence:[nC,Hw,Pg]}),s=Of("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=JC(r.toString());qw(t,o,()=>o(t.currentUser)),Bw(t,l=>o(l))}}const i=kf("auth");return i&&Aw(t,`http://${i}`),t}function ZC(){return document.getElementsByTagName("head")?.[0]??document}gw({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=i=>{const r=Rt("internal-error");r.customData=i,t(r)},s.type="text/javascript",s.charset="UTF-8",ZC().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});KC("Browser");var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var pn,Mg;(function(){var n;function e(I,_){function v(){}v.prototype=_.prototype,I.F=_.prototype,I.prototype=new v,I.prototype.constructor=I,I.D=function(T,E,C){for(var y=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)y[Fe-2]=arguments[Fe];return _.prototype[E].apply(T,y)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,_,v){v||(v=0);const T=Array(16);if(typeof _=="string")for(var E=0;E<16;++E)T[E]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(E=0;E<16;++E)T[E]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=I.g[0],v=I.g[1],E=I.g[2];let C=I.g[3],y;y=_+(C^v&(E^C))+T[0]+3614090360&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+T[1]+3905402710&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+T[2]+606105819&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+T[3]+3250441966&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+T[4]+4118548399&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+T[5]+1200080426&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+T[6]+2821735955&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+T[7]+4249261313&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+T[8]+1770035416&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+T[9]+2336552879&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+T[10]+4294925233&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+T[11]+2304563134&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+T[12]+1804603682&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+T[13]+4254626195&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+T[14]+2792965006&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+T[15]+1236535329&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(E^C&(v^E))+T[1]+4129170786&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+T[6]+3225465664&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+T[11]+643717713&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+T[0]+3921069994&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+T[5]+3593408605&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+T[10]+38016083&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+T[15]+3634488961&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+T[4]+3889429448&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+T[9]+568446438&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+T[14]+3275163606&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+T[3]+4107603335&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+T[8]+1163531501&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+T[13]+2850285829&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+T[2]+4243563512&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+T[7]+1735328473&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+T[12]+2368359562&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(v^E^C)+T[5]+4294588738&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+T[8]+2272392833&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+T[11]+1839030562&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+T[14]+4259657740&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+T[1]+2763975236&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+T[4]+1272893353&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+T[7]+4139469664&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+T[10]+3200236656&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+T[13]+681279174&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+T[0]+3936430074&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+T[3]+3572445317&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+T[6]+76029189&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+T[9]+3654602809&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+T[12]+3873151461&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+T[15]+530742520&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+T[2]+3299628645&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(E^(v|~C))+T[0]+4096336452&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+T[7]+1126891415&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+T[14]+2878612391&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+T[5]+4237533241&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+T[12]+1700485571&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+T[3]+2399980690&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+T[10]+4293915773&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+T[1]+2240044497&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+T[8]+1873313359&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+T[15]+4264355552&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+T[6]+2734768916&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+T[13]+1309151649&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+T[4]+4149444226&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+T[11]+3174756917&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+T[2]+718787259&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+T[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(E+(y<<21&4294967295|y>>>11))&4294967295,I.g[2]=I.g[2]+E&4294967295,I.g[3]=I.g[3]+C&4294967295}s.prototype.v=function(I,_){_===void 0&&(_=I.length);const v=_-this.blockSize,T=this.C;let E=this.h,C=0;for(;C<_;){if(E==0)for(;C<=v;)i(this,I,C),C+=this.blockSize;if(typeof I=="string"){for(;C<_;)if(T[E++]=I.charCodeAt(C++),E==this.blockSize){i(this,T),E=0;break}}else for(;C<_;)if(T[E++]=I[C++],E==this.blockSize){i(this,T),E=0;break}}this.h=E,this.o+=_},s.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;_=this.o*8;for(var v=I.length-8;v<I.length;++v)I[v]=_&255,_/=256;for(this.v(I),I=Array(16),_=0,v=0;v<4;++v)for(let T=0;T<32;T+=8)I[_++]=this.g[v]>>>T&255;return I};function r(I,_){var v=l;return Object.prototype.hasOwnProperty.call(v,I)?v[I]:v[I]=_(I)}function o(I,_){this.h=_;const v=[];let T=!0;for(let E=I.length-1;E>=0;E--){const C=I[E]|0;T&&C==_||(v[E]=C,T=!1)}this.g=v}var l={};function c(I){return-128<=I&&I<128?r(I,function(_){return new o([_|0],_<0?-1:0)}):new o([I|0],I<0?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return p;if(I<0)return O(h(-I));const _=[];let v=1;for(let T=0;I>=v;T++)_[T]=I/v|0,v*=4294967296;return new o(_,0)}function f(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return O(f(I.substring(1),_));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=h(Math.pow(_,8));let T=p;for(let C=0;C<I.length;C+=8){var E=Math.min(8,I.length-C);const y=parseInt(I.substring(C,C+E),_);E<8?(E=h(Math.pow(_,E)),T=T.j(E).add(h(y))):(T=T.j(v),T=T.add(h(y)))}return T}var p=c(0),m=c(1),A=c(16777216);n=o.prototype,n.m=function(){if(P(this))return-O(this).m();let I=0,_=1;for(let v=0;v<this.g.length;v++){const T=this.i(v);I+=(T>=0?T:4294967296+T)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(S(this))return"0";if(P(this))return"-"+O(this).toString(I);const _=h(Math.pow(I,6));var v=this;let T="";for(;;){const E=ge(v,_).g;v=B(v,E.j(_));let C=((v.g.length>0?v.g[0]:v.h)>>>0).toString(I);if(v=E,S(v))return C+T;for(;C.length<6;)C="0"+C;T=C+T}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function S(I){if(I.h!=0)return!1;for(let _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function P(I){return I.h==-1}n.l=function(I){return I=B(this,I),P(I)?-1:S(I)?0:1};function O(I){const _=I.g.length,v=[];for(let T=0;T<_;T++)v[T]=~I.g[T];return new o(v,~I.h).add(m)}n.abs=function(){return P(this)?O(this):this},n.add=function(I){const _=Math.max(this.g.length,I.g.length),v=[];let T=0;for(let E=0;E<=_;E++){let C=T+(this.i(E)&65535)+(I.i(E)&65535),y=(C>>>16)+(this.i(E)>>>16)+(I.i(E)>>>16);T=y>>>16,C&=65535,y&=65535,v[E]=y<<16|C}return new o(v,v[v.length-1]&-2147483648?-1:0)};function B(I,_){return I.add(O(_))}n.j=function(I){if(S(this)||S(I))return p;if(P(this))return P(I)?O(this).j(O(I)):O(O(this).j(I));if(P(I))return O(this.j(O(I)));if(this.l(A)<0&&I.l(A)<0)return h(this.m()*I.m());const _=this.g.length+I.g.length,v=[];for(var T=0;T<2*_;T++)v[T]=0;for(T=0;T<this.g.length;T++)for(let E=0;E<I.g.length;E++){const C=this.i(T)>>>16,y=this.i(T)&65535,Fe=I.i(E)>>>16,lt=I.i(E)&65535;v[2*T+2*E]+=y*lt,W(v,2*T+2*E),v[2*T+2*E+1]+=C*lt,W(v,2*T+2*E+1),v[2*T+2*E+1]+=y*Fe,W(v,2*T+2*E+1),v[2*T+2*E+2]+=C*Fe,W(v,2*T+2*E+2)}for(I=0;I<_;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=_;I<2*_;I++)v[I]=0;return new o(v,0)};function W(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function K(I,_){this.g=I,this.h=_}function ge(I,_){if(S(_))throw Error("division by zero");if(S(I))return new K(p,p);if(P(I))return _=ge(O(I),_),new K(O(_.g),O(_.h));if(P(_))return _=ge(I,O(_)),new K(O(_.g),_.h);if(I.g.length>30){if(P(I)||P(_))throw Error("slowDivide_ only works with positive integers.");for(var v=m,T=_;T.l(I)<=0;)v=ue(v),T=ue(T);var E=he(v,1),C=he(T,1);for(T=he(T,2),v=he(v,2);!S(T);){var y=C.add(T);y.l(I)<=0&&(E=E.add(v),C=y),T=he(T,1),v=he(v,1)}return _=B(I,E.j(_)),new K(E,_)}for(E=p;I.l(_)>=0;){for(v=Math.max(1,Math.floor(I.m()/_.m())),T=Math.ceil(Math.log(v)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),C=h(v),y=C.j(_);P(y)||y.l(I)>0;)v-=T,C=h(v),y=C.j(_);S(C)&&(C=m),E=E.add(C),I=B(I,y)}return new K(E,I)}n.B=function(I){return ge(this,I).h},n.and=function(I){const _=Math.max(this.g.length,I.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)&I.i(T);return new o(v,this.h&I.h)},n.or=function(I){const _=Math.max(this.g.length,I.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)|I.i(T);return new o(v,this.h|I.h)},n.xor=function(I){const _=Math.max(this.g.length,I.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)^I.i(T);return new o(v,this.h^I.h)};function ue(I){const _=I.g.length+1,v=[];for(let T=0;T<_;T++)v[T]=I.i(T)<<1|I.i(T-1)>>>31;return new o(v,I.h)}function he(I,_){const v=_>>5;_%=32;const T=I.g.length-v,E=[];for(let C=0;C<T;C++)E[C]=_>0?I.i(C+v)>>>_|I.i(C+v+1)<<32-_:I.i(C+v);return new o(E,I.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Mg=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,pn=o}).apply(typeof Ad<"u"?Ad:typeof self<"u"?self:typeof window<"u"?window:{});var Qr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vg,ki,Fg,ao,kl,Ug,Bg,qg;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qr=="object"&&Qr];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function i(a,u){if(u)e:{var d=s;a=a.split(".");for(var g=0;g<a.length-1;g++){var w=a[g];if(!(w in d))break e;d=d[w]}a=a[a.length-1],g=d[a],u=u(g),u!=g&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(u){var d=[],g;for(g in u)Object.prototype.hasOwnProperty.call(u,g)&&d.push([g,u[g]]);return d}});var r=r||{},o=this||self;function l(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function c(a,u,d){return a.call.apply(a.bind,arguments)}function h(a,u,d){return h=c,h.apply(null,arguments)}function f(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function p(a,u){function d(){}d.prototype=u.prototype,a.Z=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(g,w,R){for(var D=Array(arguments.length-2),$=2;$<arguments.length;$++)D[$-2]=arguments[$];return u.prototype[w].apply(g,D)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function A(a){const u=a.length;if(u>0){const d=Array(u);for(let g=0;g<u;g++)d[g]=a[g];return d}return[]}function S(a,u){for(let g=1;g<arguments.length;g++){const w=arguments[g];var d=typeof w;if(d=d!="object"?d:w?Array.isArray(w)?"array":d:"null",d=="array"||d=="object"&&typeof w.length=="number"){d=a.length||0;const R=w.length||0;a.length=d+R;for(let D=0;D<R;D++)a[d+D]=w[D]}else a.push(w)}}class P{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function O(a){o.setTimeout(()=>{throw a},0)}function B(){var a=I;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class W{constructor(){this.h=this.g=null}add(u,d){const g=K.get();g.set(u,d),this.h?this.h.next=g:this.g=g,this.h=g}}var K=new P(()=>new ge,a=>a.reset());class ge{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let ue,he=!1,I=new W,_=()=>{const a=Promise.resolve(void 0);ue=()=>{a.then(v)}};function v(){for(var a;a=B();){try{a.h.call(a.g)}catch(d){O(d)}var u=K;u.j(a),u.h<100&&(u.h++,a.next=u.g,u.g=a)}he=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var C=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,u),o.removeEventListener("test",d,u)}catch{}return a})();function y(a){return/^[\s\xa0]*$/.test(a)}function Fe(a,u){E.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,u)}p(Fe,E),Fe.prototype.init=function(a,u){const d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget,u||(d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement)),this.relatedTarget=u,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&Fe.Z.h.call(this)},Fe.prototype.h=function(){Fe.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var lt="closure_listenable_"+(Math.random()*1e6|0),Tr=0;function Zs(a,u,d,g,w){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!g,this.ha=w,this.key=++Tr,this.da=this.fa=!1}function kn(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Nn(a,u,d){for(const g in a)u.call(d,a[g],g,a)}function _a(a,u){for(const d in a)u.call(void 0,a[d],d,a)}function as(a){const u={};for(const d in a)u[d]=a[d];return u}const ei="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ls(a,u){let d,g;for(let w=1;w<arguments.length;w++){g=arguments[w];for(d in g)a[d]=g[d];for(let R=0;R<ei.length;R++)d=ei[R],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function zt(a){this.src=a,this.g={},this.h=0}zt.prototype.add=function(a,u,d,g,w){const R=a.toString();a=this.g[R],a||(a=this.g[R]=[],this.h++);const D=ti(a,u,g,w);return D>-1?(u=a[D],d||(u.fa=!1)):(u=new Zs(u,this.src,R,!!g,w),u.fa=d,a.push(u)),u};function cs(a,u){const d=u.type;if(d in a.g){var g=a.g[d],w=Array.prototype.indexOf.call(g,u,void 0),R;(R=w>=0)&&Array.prototype.splice.call(g,w,1),R&&(kn(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function ti(a,u,d,g){for(let w=0;w<a.length;++w){const R=a[w];if(!R.da&&R.listener==u&&R.capture==!!d&&R.ha==g)return w}return-1}var ni="closure_lm_"+(Math.random()*1e6|0),si={};function wr(a,u,d,g,w){if(Array.isArray(u)){for(let R=0;R<u.length;R++)wr(a,u[R],d,g,w);return null}return d=vt(d),a&&a[lt]?a.J(u,d,l(g)?!!g.capture:!1,w):Cr(a,u,d,!1,g,w)}function Cr(a,u,d,g,w,R){if(!u)throw Error("Invalid event type");const D=l(w)?!!w.capture:!!w;let $=se(a);if($||(a[ni]=$=new zt(a)),d=$.add(u,d,g,D,R),d.proxy)return d;if(g=ya(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)C||(w=D),w===void 0&&(w=!1),a.addEventListener(u.toString(),g,w);else if(a.attachEvent)a.attachEvent(V(u.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ya(){function a(d){return u.call(a.src,a.listener,d)}const u=ne;return a}function Ar(a,u,d,g,w){if(Array.isArray(u))for(var R=0;R<u.length;R++)Ar(a,u[R],d,g,w);else g=l(g)?!!g.capture:!!g,d=vt(d),a&&a[lt]?(a=a.i,R=String(u).toString(),R in a.g&&(u=a.g[R],d=ti(u,d,g,w),d>-1&&(kn(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete a.g[R],a.h--)))):a&&(a=se(a))&&(u=a.g[u.toString()],a=-1,u&&(a=ti(u,d,g,w)),(d=a>-1?u[a]:null)&&ii(d))}function ii(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[lt])cs(u.i,a);else{var d=a.type,g=a.proxy;u.removeEventListener?u.removeEventListener(d,g,a.capture):u.detachEvent?u.detachEvent(V(d),g):u.addListener&&u.removeListener&&u.removeListener(g),(d=se(u))?(cs(d,a),d.h==0&&(d.src=null,u[ni]=null)):kn(a)}}}function V(a){return a in si?si[a]:si[a]="on"+a}function ne(a,u){if(a.da)a=!0;else{u=new Fe(u,this);const d=a.listener,g=a.ha||a.src;a.fa&&ii(a),a=d.call(g,u)}return a}function se(a){return a=a[ni],a instanceof zt?a:null}var Oe="__closure_events_fn_"+(Math.random()*1e9>>>0);function vt(a){return typeof a=="function"?a:(a[Oe]||(a[Oe]=function(u){return a.handleEvent(u)}),a[Oe])}function me(){T.call(this),this.i=new zt(this),this.M=this,this.G=null}p(me,T),me.prototype[lt]=!0,me.prototype.removeEventListener=function(a,u,d,g){Ar(this,a,u,d,g)};function de(a,u){var d,g=a.G;if(g)for(d=[];g;g=g.G)d.push(g);if(a=a.M,g=u.type||u,typeof u=="string")u=new E(u,a);else if(u instanceof E)u.target=u.target||a;else{var w=u;u=new E(g,a),ls(u,w)}w=!0;let R,D;if(d)for(D=d.length-1;D>=0;D--)R=u.g=d[D],w=Ot(R,g,!0,u)&&w;if(R=u.g=a,w=Ot(R,g,!0,u)&&w,w=Ot(R,g,!1,u)&&w,d)for(D=0;D<d.length;D++)R=u.g=d[D],w=Ot(R,g,!1,u)&&w}me.prototype.N=function(){if(me.Z.N.call(this),this.i){var a=this.i;for(const u in a.g){const d=a.g[u];for(let g=0;g<d.length;g++)kn(d[g]);delete a.g[u],a.h--}}this.G=null},me.prototype.J=function(a,u,d,g){return this.i.add(String(a),u,!1,d,g)},me.prototype.K=function(a,u,d,g){return this.i.add(String(a),u,!0,d,g)};function Ot(a,u,d,g){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();let w=!0;for(let R=0;R<u.length;++R){const D=u[R];if(D&&!D.da&&D.capture==d){const $=D.listener,Pe=D.ha||D.src;D.fa&&cs(a.i,D),w=$.call(Pe,g)!==!1&&w}}return w&&!g.defaultPrevented}function Dn(a,u){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:o.setTimeout(a,u||0)}function us(a){a.g=Dn(()=>{a.g=null,a.i&&(a.i=!1,us(a))},a.l);const u=a.h;a.h=null,a.m.apply(null,u)}class Sr extends T{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:us(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function On(a){T.call(this),this.h=a,this.g={}}p(On,T);var Rr=[];function br(a){Nn(a.g,function(u,d){this.g.hasOwnProperty(d)&&ii(u)},a),a.g={}}On.prototype.N=function(){On.Z.N.call(this),br(this)},On.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ri=o.JSON.stringify,va=o.JSON.parse,Ae=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function ve(){}function Ge(){}var rt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ct(){E.call(this,"d")}p(ct,E);function Ln(){E.call(this,"c")}p(Ln,E);var ut={},Pr=null;function xn(){return Pr=Pr||new me}ut.Ia="serverreachability";function kr(a){E.call(this,ut.Ia,a)}p(kr,E);function oi(a){const u=xn();de(u,new kr(u))}ut.STAT_EVENT="statevent";function _u(a,u){E.call(this,ut.STAT_EVENT,a),this.stat=u}p(_u,E);function Ke(a){const u=xn();de(u,new _u(u,a))}ut.Ja="timingevent";function yu(a,u){E.call(this,ut.Ja,a),this.size=u}p(yu,E);function ai(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},u)}function li(){this.g=!0}li.prototype.ua=function(){this.g=!1};function jm(a,u,d,g,w,R){a.info(function(){if(a.g)if(R){var D="",$=R.split("&");for(let ie=0;ie<$.length;ie++){var Pe=$[ie].split("=");if(Pe.length>1){const Le=Pe[0];Pe=Pe[1];const It=Le.split("_");D=It.length>=2&&It[1]=="type"?D+(Le+"="+Pe+"&"):D+(Le+"=redacted&")}}}else D=null;else D=R;return"XMLHTTP REQ ("+g+") [attempt "+w+"]: "+u+`
`+d+`
`+D})}function Hm(a,u,d,g,w,R,D){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+w+"]: "+u+`
`+d+`
`+R+" "+D})}function hs(a,u,d,g){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+zm(a,d)+(g?" "+g:"")})}function $m(a,u){a.info(function(){return"TIMEOUT: "+u})}li.prototype.info=function(){};function zm(a,u){if(!a.g)return u;if(!u)return null;try{const R=JSON.parse(u);if(R){for(a=0;a<R.length;a++)if(Array.isArray(R[a])){var d=R[a];if(!(d.length<2)){var g=d[1];if(Array.isArray(g)&&!(g.length<1)){var w=g[0];if(w!="noop"&&w!="stop"&&w!="close")for(let D=1;D<g.length;D++)g[D]=""}}}}return ri(R)}catch{return u}}var Nr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Eu;function Ea(){}p(Ea,ve),Ea.prototype.g=function(){return new XMLHttpRequest},Eu=new Ea;function ci(a){return encodeURIComponent(String(a))}function Gm(a){var u=1;a=a.split(":");const d=[];for(;u>0&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function Gt(a,u,d,g){this.j=a,this.i=u,this.l=d,this.S=g||1,this.V=new On(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Iu}function Iu(){this.i=null,this.g="",this.h=!1}var Tu={},Ia={};function Ta(a,u,d){a.M=1,a.A=Or(Et(u)),a.u=d,a.R=!0,wu(a,null)}function wu(a,u){a.F=Date.now(),Dr(a),a.B=Et(a.A);var d=a.B,g=a.S;Array.isArray(g)||(g=[String(g)]),Mu(d.i,"t",g),a.C=0,d=a.j.L,a.h=new Iu,a.g=eh(a.j,d?u:null,!a.u),a.P>0&&(a.O=new Sr(h(a.Y,a,a.g),a.P)),u=a.V,d=a.g,g=a.ba;var w="readystatechange";Array.isArray(w)||(w&&(Rr[0]=w.toString()),w=Rr);for(let R=0;R<w.length;R++){const D=wr(d,w[R],g||u.handleEvent,!1,u.h||u);if(!D)break;u.g[D.key]=D}u=a.J?as(a.J):{},a.u?(a.v||(a.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,u)):(a.v="GET",a.g.ea(a.B,a.v,null,u)),oi(),jm(a.i,a.v,a.B,a.l,a.S,a.u)}Gt.prototype.ba=function(a){a=a.target;const u=this.O;u&&Yt(a)==3?u.j():this.Y(a)},Gt.prototype.Y=function(a){try{if(a==this.g)e:{const $=Yt(this.g),Pe=this.g.ya(),ie=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||ju(this.g)))){this.K||$!=4||Pe==7||(Pe==8||ie<=0?oi(3):oi(2)),wa(this);var u=this.g.ca();this.X=u;var d=Km(this);if(this.o=u==200,Hm(this.i,this.v,this.B,this.l,this.S,$,u),this.o){if(this.U&&!this.L){t:{if(this.g){var g,w=this.g;if((g=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(g)){var R=g;break t}}R=null}if(a=R)hs(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ca(this,a);else{this.o=!1,this.m=3,Ke(12),Mn(this),ui(this);break e}}if(this.R){a=!0;let Le;for(;!this.K&&this.C<d.length;)if(Le=Qm(this,d),Le==Ia){$==4&&(this.m=4,Ke(14),a=!1),hs(this.i,this.l,null,"[Incomplete Response]");break}else if(Le==Tu){this.m=4,Ke(15),hs(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else hs(this.i,this.l,Le,null),Ca(this,Le);if(Cu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||d.length!=0||this.h.h||(this.m=1,Ke(16),a=!1),this.o=this.o&&a,!a)hs(this.i,this.l,d,"[Invalid Chunked Response]"),Mn(this),ui(this);else if(d.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Da(D),D.P=!0,Ke(11))}}else hs(this.i,this.l,d,null),Ca(this,d);$==4&&Mn(this),this.o&&!this.K&&($==4?Yu(this.j,this):(this.o=!1,Dr(this)))}else c_(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,Ke(12)):(this.m=0,Ke(13)),Mn(this),ui(this)}}}catch{}};function Km(a){if(!Cu(a))return a.g.la();const u=ju(a.g);if(u==="")return"";let d="";const g=u.length,w=Yt(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return Mn(a),ui(a),"";a.h.i=new o.TextDecoder}for(let R=0;R<g;R++)a.h.h=!0,d+=a.h.i.decode(u[R],{stream:!(w&&R==g-1)});return u.length=0,a.h.g+=d,a.C=0,a.h.g}function Cu(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function Qm(a,u){var d=a.C,g=u.indexOf(`
`,d);return g==-1?Ia:(d=Number(u.substring(d,g)),isNaN(d)?Tu:(g+=1,g+d>u.length?Ia:(u=u.slice(g,g+d),a.C=g+d,u)))}Gt.prototype.cancel=function(){this.K=!0,Mn(this)};function Dr(a){a.T=Date.now()+a.H,Au(a,a.H)}function Au(a,u){if(a.D!=null)throw Error("WatchDog timer not null");a.D=ai(h(a.aa,a),u)}function wa(a){a.D&&(o.clearTimeout(a.D),a.D=null)}Gt.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?($m(this.i,this.B),this.M!=2&&(oi(),Ke(17)),Mn(this),this.m=2,ui(this)):Au(this,this.T-a)};function ui(a){a.j.I==0||a.K||Yu(a.j,a)}function Mn(a){wa(a);var u=a.O;u&&typeof u.dispose=="function"&&u.dispose(),a.O=null,br(a.V),a.g&&(u=a.g,a.g=null,u.abort(),u.dispose())}function Ca(a,u){try{var d=a.j;if(d.I!=0&&(d.g==a||Aa(d.h,a))){if(!a.L&&Aa(d.h,a)&&d.I==3){try{var g=d.Ba.g.parse(u)}catch{g=null}if(Array.isArray(g)&&g.length==3){var w=g;if(w[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)Fr(d),Mr(d);else break e;Na(d),Ke(18)}}else d.xa=w[1],0<d.xa-d.K&&w[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=ai(h(d.Va,d),6e3));bu(d.h)<=1&&d.ta&&(d.ta=void 0)}else Fn(d,11)}else if((a.L||d.g==a)&&Fr(d),!y(u))for(w=d.Ba.g.parse(u),u=0;u<w.length;u++){let ie=w[u];const Le=ie[0];if(!(Le<=d.K))if(d.K=Le,ie=ie[1],d.I==2)if(ie[0]=="c"){d.M=ie[1],d.ba=ie[2];const It=ie[3];It!=null&&(d.ka=It,d.j.info("VER="+d.ka));const Un=ie[4];Un!=null&&(d.za=Un,d.j.info("SVER="+d.za));const Jt=ie[5];Jt!=null&&typeof Jt=="number"&&Jt>0&&(g=1.5*Jt,d.O=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const Xt=a.g;if(Xt){const Br=Xt.g?Xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Br){var R=g.h;R.g||Br.indexOf("spdy")==-1&&Br.indexOf("quic")==-1&&Br.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Sa(R,R.h),R.h=null))}if(g.G){const Oa=Xt.g?Xt.g.getResponseHeader("X-HTTP-Session-Id"):null;Oa&&(g.wa=Oa,fe(g.J,g.G,Oa))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),g=d;var D=a;if(g.na=Zu(g,g.L?g.ba:null,g.W),D.L){Pu(g.h,D);var $=D,Pe=g.O;Pe&&($.H=Pe),$.D&&(wa($),Dr($)),g.g=D}else Ku(g);d.i.length>0&&Vr(d)}else ie[0]!="stop"&&ie[0]!="close"||Fn(d,7);else d.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?Fn(d,7):ka(d):ie[0]!="noop"&&d.l&&d.l.qa(ie),d.A=0)}}oi(4)}catch{}}var Ym=class{constructor(a,u){this.g=a,this.map=u}};function Su(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ru(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function bu(a){return a.h?1:a.g?a.g.size:0}function Aa(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function Sa(a,u){a.g?a.g.add(u):a.h=u}function Pu(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}Su.prototype.cancel=function(){if(this.i=ku(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function ku(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let u=a.i;for(const d of a.g.values())u=u.concat(d.G);return u}return A(a.i)}var Nu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jm(a,u){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const g=a[d].indexOf("=");let w,R=null;g>=0?(w=a[d].substring(0,g),R=a[d].substring(g+1)):w=a[d],u(w,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Kt(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;a instanceof Kt?(this.l=a.l,hi(this,a.j),this.o=a.o,this.g=a.g,di(this,a.u),this.h=a.h,Ra(this,Vu(a.i)),this.m=a.m):a&&(u=String(a).match(Nu))?(this.l=!1,hi(this,u[1]||"",!0),this.o=fi(u[2]||""),this.g=fi(u[3]||"",!0),di(this,u[4]),this.h=fi(u[5]||"",!0),Ra(this,u[6]||"",!0),this.m=fi(u[7]||"")):(this.l=!1,this.i=new gi(null,this.l))}Kt.prototype.toString=function(){const a=[];var u=this.j;u&&a.push(pi(u,Du,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(pi(u,Du,!0),"@"),a.push(ci(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(pi(d,d.charAt(0)=="/"?e_:Zm,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",pi(d,n_)),a.join("")},Kt.prototype.resolve=function(a){const u=Et(this);let d=!!a.j;d?hi(u,a.j):d=!!a.o,d?u.o=a.o:d=!!a.g,d?u.g=a.g:d=a.u!=null;var g=a.h;if(d)di(u,a.u);else if(d=!!a.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var w=u.h.lastIndexOf("/");w!=-1&&(g=u.h.slice(0,w+1)+g)}if(w=g,w==".."||w==".")g="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){g=w.lastIndexOf("/",0)==0,w=w.split("/");const R=[];for(let D=0;D<w.length;){const $=w[D++];$=="."?g&&D==w.length&&R.push(""):$==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),g&&D==w.length&&R.push("")):(R.push($),g=!0)}g=R.join("/")}else g=w}return d?u.h=g:d=a.i.toString()!=="",d?Ra(u,Vu(a.i)):d=!!a.m,d&&(u.m=a.m),u};function Et(a){return new Kt(a)}function hi(a,u,d){a.j=d?fi(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function di(a,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);a.u=u}else a.u=null}function Ra(a,u,d){u instanceof gi?(a.i=u,s_(a.i,a.l)):(d||(u=pi(u,t_)),a.i=new gi(u,a.l))}function fe(a,u,d){a.i.set(u,d)}function Or(a){return fe(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function fi(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function pi(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,Xm),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Xm(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Du=/[#\/\?@]/g,Zm=/[#\?:]/g,e_=/[#\?]/g,t_=/[#\?@]/g,n_=/#/g;function gi(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function Vn(a){a.g||(a.g=new Map,a.h=0,a.i&&Jm(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=gi.prototype,n.add=function(a,u){Vn(this),this.i=null,a=ds(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function Ou(a,u){Vn(a),u=ds(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function Lu(a,u){return Vn(a),u=ds(a,u),a.g.has(u)}n.forEach=function(a,u){Vn(this),this.g.forEach(function(d,g){d.forEach(function(w){a.call(u,w,g,this)},this)},this)};function xu(a,u){Vn(a);let d=[];if(typeof u=="string")Lu(a,u)&&(d=d.concat(a.g.get(ds(a,u))));else for(a=Array.from(a.g.values()),u=0;u<a.length;u++)d=d.concat(a[u]);return d}n.set=function(a,u){return Vn(this),this.i=null,a=ds(this,a),Lu(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},n.get=function(a,u){return a?(a=xu(this,a),a.length>0?String(a[0]):u):u};function Mu(a,u,d){Ou(a,u),d.length>0&&(a.i=null,a.g.set(ds(a,u),A(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],u=Array.from(this.g.keys());for(let g=0;g<u.length;g++){var d=u[g];const w=ci(d);d=xu(this,d);for(let R=0;R<d.length;R++){let D=w;d[R]!==""&&(D+="="+ci(d[R])),a.push(D)}}return this.i=a.join("&")};function Vu(a){const u=new gi;return u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),u}function ds(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function s_(a,u){u&&!a.j&&(Vn(a),a.i=null,a.g.forEach(function(d,g){const w=g.toLowerCase();g!=w&&(Ou(this,g),Mu(this,w,d))},a)),a.j=u}function i_(a,u){const d=new li;if(o.Image){const g=new Image;g.onload=f(Qt,d,"TestLoadImage: loaded",!0,u,g),g.onerror=f(Qt,d,"TestLoadImage: error",!1,u,g),g.onabort=f(Qt,d,"TestLoadImage: abort",!1,u,g),g.ontimeout=f(Qt,d,"TestLoadImage: timeout",!1,u,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else u(!1)}function r_(a,u){const d=new li,g=new AbortController,w=setTimeout(()=>{g.abort(),Qt(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:g.signal}).then(R=>{clearTimeout(w),R.ok?Qt(d,"TestPingServer: ok",!0,u):Qt(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(w),Qt(d,"TestPingServer: error",!1,u)})}function Qt(a,u,d,g,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),g(d)}catch{}}function o_(){this.g=new Ae}function ba(a){this.i=a.Sb||null,this.h=a.ab||!1}p(ba,ve),ba.prototype.g=function(){return new Lr(this.i,this.h)};function Lr(a,u){me.call(this),this.H=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Lr,me),n=Lr.prototype,n.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=u,this.readyState=1,_i(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(u.body=a),(this.H||o).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,mi(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,_i(this)),this.g&&(this.readyState=3,_i(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Fu(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function Fu(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?mi(this):_i(this),this.readyState==3&&Fu(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,mi(this))},n.Na=function(a){this.g&&(this.response=a,mi(this))},n.ga=function(){this.g&&mi(this)};function mi(a){a.readyState=4,a.l=null,a.j=null,a.B=null,_i(a)}n.setRequestHeader=function(a,u){this.A.append(a,u)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function _i(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Lr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Uu(a){let u="";return Nn(a,function(d,g){u+=g,u+=":",u+=d,u+=`\r
`}),u}function Pa(a,u,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Uu(d),typeof a=="string"?d!=null&&ci(d):fe(a,u,d))}function Ee(a){me.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(Ee,me);var a_=/^https?$/i,l_=["POST","PUT"];n=Ee.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,u,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Eu.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(R){Bu(this,R);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var w in g)d.set(w,g[w]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const R of g.keys())d.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),w=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(l_,u,void 0)>=0)||g||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,D]of d)this.g.setRequestHeader(R,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(R){Bu(this,R)}};function Bu(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.o=5,qu(a),xr(a)}function qu(a){a.A||(a.A=!0,de(a,"complete"),de(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,de(this,"complete"),de(this,"abort"),xr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xr(this,!0)),Ee.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Wu(this):this.Xa())},n.Xa=function(){Wu(this)};function Wu(a){if(a.h&&typeof r<"u"){if(a.v&&Yt(a)==4)setTimeout(a.Ca.bind(a),0);else if(de(a,"readystatechange"),Yt(a)==4){a.h=!1;try{const R=a.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var g;if(g=R===0){let D=String(a.D).match(Nu)[1]||null;!D&&o.self&&o.self.location&&(D=o.self.location.protocol.slice(0,-1)),g=!a_.test(D?D.toLowerCase():"")}d=g}if(d)de(a,"complete"),de(a,"success");else{a.o=6;try{var w=Yt(a)>2?a.g.statusText:""}catch{w=""}a.l=w+" ["+a.ca()+"]",qu(a)}}finally{xr(a)}}}}function xr(a,u){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,u||de(a,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yt(a){return a.g?a.g.readyState:0}n.ca=function(){try{return Yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),va(u)}};function ju(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function c_(a){const u={};a=(a.g&&Yt(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(y(a[g]))continue;var d=Gm(a[g]);const w=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=u[w]||[];u[w]=R,R.push(d)}_a(u,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function yi(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function Hu(a){this.za=0,this.i=[],this.j=new li,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=yi("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=yi("baseRetryDelayMs",5e3,a),this.Za=yi("retryDelaySeedMs",1e4,a),this.Ta=yi("forwardChannelMaxRetries",2,a),this.va=yi("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Su(a&&a.concurrentRequestLimit),this.Ba=new o_,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Hu.prototype,n.ka=8,n.I=1,n.connect=function(a,u,d,g){Ke(0),this.W=a,this.H=u||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.J=Zu(this,null,this.W),Vr(this)};function ka(a){if($u(a),a.I==3){var u=a.V++,d=Et(a.J);if(fe(d,"SID",a.M),fe(d,"RID",u),fe(d,"TYPE","terminate"),vi(a,d),u=new Gt(a,a.j,u),u.M=2,u.A=Or(Et(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=u.A,d=!0),d||(u.g=eh(u.j,null),u.g.ea(u.A)),u.F=Date.now(),Dr(u)}Xu(a)}function Mr(a){a.g&&(Da(a),a.g.cancel(),a.g=null)}function $u(a){Mr(a),a.v&&(o.clearTimeout(a.v),a.v=null),Fr(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function Vr(a){if(!Ru(a.h)&&!a.m){a.m=!0;var u=a.Ea;ue||_(),he||(ue(),he=!0),I.add(u,a),a.D=0}}function u_(a,u){return bu(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=u.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=ai(h(a.Ea,a,u),Ju(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const w=new Gt(this,this.j,a);let R=this.o;if(this.U&&(R?(R=as(R),ls(R,this.U)):R=this.U),this.u!==null||this.R||(w.J=R,R=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(u+=g,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Gu(this,w,u),d=Et(this.J),fe(d,"RID",a),fe(d,"CVER",22),this.G&&fe(d,"X-HTTP-Session-Id",this.G),vi(this,d),R&&(this.R?u="headers="+ci(Uu(R))+"&"+u:this.u&&Pa(d,this.u,R)),Sa(this.h,w),this.Ra&&fe(d,"TYPE","init"),this.S?(fe(d,"$req",u),fe(d,"SID","null"),w.U=!0,Ta(w,d,null)):Ta(w,d,u),this.I=2}}else this.I==3&&(a?zu(this,a):this.i.length==0||Ru(this.h)||zu(this))};function zu(a,u){var d;u?d=u.l:d=a.V++;const g=Et(a.J);fe(g,"SID",a.M),fe(g,"RID",d),fe(g,"AID",a.K),vi(a,g),a.u&&a.o&&Pa(g,a.u,a.o),d=new Gt(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),u&&(a.i=u.G.concat(a.i)),u=Gu(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),Sa(a.h,d),Ta(d,g,u)}function vi(a,u){a.H&&Nn(a.H,function(d,g){fe(u,g,d)}),a.l&&Nn({},function(d,g){fe(u,g,d)})}function Gu(a,u,d){d=Math.min(a.i.length,d);const g=a.l?h(a.l.Ka,a.l,a):null;e:{var w=a.i;let $=-1;for(;;){const Pe=["count="+d];$==-1?d>0?($=w[0].g,Pe.push("ofs="+$)):$=0:Pe.push("ofs="+$);let ie=!0;for(let Le=0;Le<d;Le++){var R=w[Le].g;const It=w[Le].map;if(R-=$,R<0)$=Math.max(0,w[Le].g-100),ie=!1;else try{R="req"+R+"_"||"";try{var D=It instanceof Map?It:Object.entries(It);for(const[Un,Jt]of D){let Xt=Jt;l(Jt)&&(Xt=ri(Jt)),Pe.push(R+Un+"="+encodeURIComponent(Xt))}}catch(Un){throw Pe.push(R+"type="+encodeURIComponent("_badmap")),Un}}catch{g&&g(It)}}if(ie){D=Pe.join("&");break e}}D=void 0}return a=a.i.splice(0,d),u.G=a,D}function Ku(a){if(!a.g&&!a.v){a.Y=1;var u=a.Da;ue||_(),he||(ue(),he=!0),I.add(u,a),a.A=0}}function Na(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=ai(h(a.Da,a),Ju(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,Qu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=ai(h(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ke(10),Mr(this),Qu(this))};function Da(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function Qu(a){a.g=new Gt(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var u=Et(a.na);fe(u,"RID","rpc"),fe(u,"SID",a.M),fe(u,"AID",a.K),fe(u,"CI",a.F?"0":"1"),!a.F&&a.ia&&fe(u,"TO",a.ia),fe(u,"TYPE","xmlhttp"),vi(a,u),a.u&&a.o&&Pa(u,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=Or(Et(u)),d.u=null,d.R=!0,wu(d,a)}n.Va=function(){this.C!=null&&(this.C=null,Mr(this),Na(this),Ke(19))};function Fr(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function Yu(a,u){var d=null;if(a.g==u){Fr(a),Da(a),a.g=null;var g=2}else if(Aa(a.h,u))d=u.G,Pu(a.h,u),g=1;else return;if(a.I!=0){if(u.o)if(g==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var w=a.D;g=xn(),de(g,new yu(g,d)),Vr(a)}else Ku(a);else if(w=u.m,w==3||w==0&&u.X>0||!(g==1&&u_(a,u)||g==2&&Na(a)))switch(d&&d.length>0&&(u=a.h,u.i=u.i.concat(d)),w){case 1:Fn(a,5);break;case 4:Fn(a,10);break;case 3:Fn(a,6);break;default:Fn(a,2)}}}function Ju(a,u){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*u}function Fn(a,u){if(a.j.info("Error code "+u),u==2){var d=h(a.bb,a),g=a.Ua;const w=!g;g=new Kt(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||hi(g,"https"),Or(g),w?i_(g.toString(),d):r_(g.toString(),d)}else Ke(2);a.I=0,a.l&&a.l.pa(u),Xu(a),$u(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),Ke(2)):(this.j.info("Failed to ping google.com"),Ke(1))};function Xu(a){if(a.I=0,a.ja=[],a.l){const u=ku(a.h);(u.length!=0||a.i.length!=0)&&(S(a.ja,u),S(a.ja,a.i),a.h.i.length=0,A(a.i),a.i.length=0),a.l.oa()}}function Zu(a,u,d){var g=d instanceof Kt?Et(d):new Kt(d);if(g.g!="")u&&(g.g=u+"."+g.g),di(g,g.u);else{var w=o.location;g=w.protocol,u=u?u+"."+w.hostname:w.hostname,w=+w.port;const R=new Kt(null);g&&hi(R,g),u&&(R.g=u),w&&di(R,w),d&&(R.h=d),g=R}return d=a.G,u=a.wa,d&&u&&fe(g,d,u),fe(g,"VER",a.ka),vi(a,g),g}function eh(a,u,d){if(u&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Aa&&!a.ma?new Ee(new ba({ab:d})):new Ee(a.ma),u.Fa(a.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function th(){}n=th.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ur(){}Ur.prototype.g=function(a,u){return new st(a,u)};function st(a,u){me.call(this),this.g=new Hu(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(a?a["X-WebChannel-Client-Profile"]=u.sa:a={"X-WebChannel-Client-Profile":u.sa}),this.g.U=a,(a=u&&u.Qb)&&!y(a)&&(this.g.u=a),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new fs(this)}p(st,me),st.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},st.prototype.close=function(){ka(this.g)},st.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=ri(a),a=d);u.i.push(new Ym(u.Ya++,a)),u.I==3&&Vr(u)},st.prototype.N=function(){this.g.l=null,delete this.j,ka(this.g),delete this.g,st.Z.N.call(this)};function nh(a){ct.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(const d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}p(nh,ct);function sh(){Ln.call(this),this.status=1}p(sh,Ln);function fs(a){this.g=a}p(fs,th),fs.prototype.ra=function(){de(this.g,"a")},fs.prototype.qa=function(a){de(this.g,new nh(a))},fs.prototype.pa=function(a){de(this.g,new sh)},fs.prototype.oa=function(){de(this.g,"b")},Ur.prototype.createWebChannel=Ur.prototype.g,st.prototype.send=st.prototype.o,st.prototype.open=st.prototype.m,st.prototype.close=st.prototype.close,qg=function(){return new Ur},Bg=function(){return xn()},Ug=ut,kl={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Nr.NO_ERROR=0,Nr.TIMEOUT=8,Nr.HTTP_ERROR=6,ao=Nr,vu.COMPLETE="complete",Fg=vu,Ge.EventType=rt,rt.OPEN="a",rt.CLOSE="b",rt.ERROR="c",rt.MESSAGE="d",me.prototype.listen=me.prototype.J,ki=Ge,Ee.prototype.listenOnce=Ee.prototype.K,Ee.prototype.getLastError=Ee.prototype.Ha,Ee.prototype.getLastErrorCode=Ee.prototype.ya,Ee.prototype.getStatus=Ee.prototype.ca,Ee.prototype.getResponseJson=Ee.prototype.La,Ee.prototype.getResponseText=Ee.prototype.la,Ee.prototype.send=Ee.prototype.ea,Ee.prototype.setWithCredentials=Ee.prototype.Fa,Vg=Ee}).apply(typeof Qr<"u"?Qr:typeof self<"u"?self:typeof window<"u"?window:{});class je{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}je.UNAUTHENTICATED=new je(null),je.GOOGLE_CREDENTIALS=new je("google-credentials-uid"),je.FIRST_PARTY=new je("first-party-uid"),je.MOCK_USER=new je("mock-user");let Ys="12.8.0";function eA(n){Ys=n}const ns=new zo("@firebase/firestore");function ms(){return ns.logLevel}function L(n,...e){if(ns.logLevel<=Q.DEBUG){const t=e.map(zc);ns.debug(`Firestore (${Ys}): ${n}`,...t)}}function jt(n,...e){if(ns.logLevel<=Q.ERROR){const t=e.map(zc);ns.error(`Firestore (${Ys}): ${n}`,...t)}}function Ms(n,...e){if(ns.logLevel<=Q.WARN){const t=e.map(zc);ns.warn(`Firestore (${Ys}): ${n}`,...t)}}function zc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function H(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Wg(n,s,t)}function Wg(n,e,t){let s=`FIRESTORE (${Ys}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw jt(s),new Error(s)}function ye(n,e,t,s){let i="Unexpected state";typeof t=="string"?i=t:s=t,n||Wg(e,i,s)}function Z(n,e){return n}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class M extends Ht{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Gn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class jg{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(je.UNAUTHENTICATED)))}shutdown(){}}class nA{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class sA{constructor(e){this.t=e,this.currentUser=je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ye(this.o===void 0,42304);let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let r=new Gn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Gn,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const c=r;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},l=c=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>l(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Gn)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ye(typeof s.accessToken=="string",31837,{l:s}),new jg(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string",2055,{h:e}),new je(e)}}class iA{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=je.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class rA{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new iA(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(je.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Sd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oA{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,at(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ye(this.o===void 0,3512);const s=r=>{r.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable((()=>s(r)))};const i=r=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>i(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Sd(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ye(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Sd(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function aA(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Gc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=aA(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<t&&(s+=e.charAt(i[r]%62))}return s}}function J(n,e){return n<e?-1:n>e?1:0}function Nl(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const i=n.charAt(s),r=e.charAt(s);if(i!==r)return el(i)===el(r)?J(i,r):el(i)?1:-1}return J(n.length,e.length)}const lA=55296,cA=57343;function el(n){const e=n.charCodeAt(0);return e>=lA&&e<=cA}function Vs(n,e,t){return n.length===e.length&&n.every(((s,i)=>t(s,e[i])))}const Rd="__name__";class Tt{constructor(e,t,s){t===void 0?t=0:t>e.length&&H(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&H(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Tt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Tt?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let i=0;i<s;i++){const r=Tt.compareSegments(e.get(i),t.get(i));if(r!==0)return r}return J(e.length,t.length)}static compareSegments(e,t){const s=Tt.isNumericId(e),i=Tt.isNumericId(t);return s&&!i?-1:!s&&i?1:s&&i?Tt.extractNumericId(e).compare(Tt.extractNumericId(t)):Nl(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return pn.fromString(e.substring(4,e.length-2))}}class _e extends Tt{construct(e,t,s){return new _e(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new M(N.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((i=>i.length>0)))}return new _e(t)}static emptyPath(){return new _e([])}}const uA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ye extends Tt{construct(e,t,s){return new Ye(e,t,s)}static isValidIdentifier(e){return uA.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Rd}static keyField(){return new Ye([Rd])}static fromServerFormat(e){const t=[];let s="",i=0;const r=()=>{if(s.length===0)throw new M(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new M(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new M(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=c,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(s+=l,i++):(r(),i++)}if(r(),o)throw new M(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ye(t)}static emptyPath(){return new Ye([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(_e.fromString(e))}static fromName(e){return new F(_e.fromString(e).popFirst(5))}static empty(){return new F(_e.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_e.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _e.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new _e(e.slice()))}}function hA(n,e,t){if(!t)throw new M(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dA(n,e,t,s){if(e===!0&&s===!0)throw new M(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bd(n){if(!F.isDocumentKey(n))throw new M(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function fA(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function pA(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":H(12329,{type:typeof n})}function Dl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new M(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=pA(n);throw new M(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function be(n,e){const t={typeString:n};return e&&(t.value=e),t}function _r(n,e){if(!fA(n))throw new M(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(i&&typeof o!==i){t=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&o!==r.value){t=`Expected '${s}' field to equal '${r.value}'`;break}}if(t)throw new M(N.INVALID_ARGUMENT,t);return!0}const Pd=-62135596800,kd=1e6;class Re{static now(){return Re.fromMillis(Date.now())}static fromDate(e){return Re.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*kd);return new Re(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Pd)throw new M(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kd}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Re._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(_r(e,Re._jsonSchema))return new Re(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Pd;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Re._jsonSchemaVersion="firestore/timestamp/1.0",Re._jsonSchema={type:be("string",Re._jsonSchemaVersion),seconds:be("number"),nanoseconds:be("number")};class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new Re(0,0))}static max(){return new j(new Re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const sr=-1;function gA(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(s===1e9?new Re(t+1,0):new Re(t,s));return new In(i,F.empty(),e)}function mA(n){return new In(n.readTime,n.key,sr)}class In{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new In(j.min(),F.empty(),sr)}static max(){return new In(j.max(),F.empty(),sr)}}function _A(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}const yA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vA{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function oa(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==yA)throw n;L("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&H(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(t,r).next(s,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,s)=>{t(e)}))}static reject(e){return new b(((t,s)=>{s(e)}))}static waitFor(e){return new b(((t,s)=>{let i=0,r=0,o=!1;e.forEach((l=>{++i,l.next((()=>{++r,o&&r===i&&t()}),(c=>s(c)))})),o=!0,r===i&&t()}))}static or(e){let t=b.resolve(!1);for(const s of e)t=t.next((i=>i?b.resolve(i):s()));return t}static forEach(e,t){const s=[];return e.forEach(((i,r)=>{s.push(t.call(this,i,r))})),this.waitFor(s)}static mapArray(e,t){return new b(((s,i)=>{const r=e.length,o=new Array(r);let l=0;for(let c=0;c<r;c++){const h=c;t(e[h]).next((f=>{o[h]=f,++l,l===r&&s(o)}),(f=>i(f)))}}))}static doWhile(e,t){return new b(((s,i)=>{const r=()=>{e()===!0?t().next((()=>{r()}),i):s()};r()}))}}function EA(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Js(n){return n.name==="IndexedDbTransactionError"}class aa{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}aa.ce=-1;const IA=-1;function la(n){return n==null}function Ol(n){return n===0&&1/n==-1/0}const Hg="";function TA(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Nd(e)),e=wA(n.get(t),e);return Nd(e)}function wA(n,e){let t=e;const s=n.length;for(let i=0;i<s;i++){const r=n.charAt(i);switch(r){case"\0":t+="";break;case Hg:t+="";break;default:t+=r}}return t}function Nd(n){return n+Hg+""}function Dd(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function CA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Ce{constructor(e,t){this.comparator=e,this.root=t||Ue.EMPTY}insert(e,t){return new Ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ue.BLACK,null,null))}remove(e){return new Ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ue.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return t+s.left.size;i<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yr(this.root,e,this.comparator,!0)}}class Yr{constructor(e,t,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ue{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Ue.RED,this.left=i??Ue.EMPTY,this.right=r??Ue.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,i,r){return new Ue(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ue.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ue.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw H(43730,{key:this.key,value:this.value});if(this.right.isRed())throw H(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw H(27949);return e+(this.isRed()?0:1)}}Ue.EMPTY=null,Ue.RED=!0,Ue.BLACK=!1;Ue.EMPTY=new class{constructor(){this.size=0}get key(){throw H(57766)}get value(){throw H(16141)}get color(){throw H(16727)}get left(){throw H(29726)}get right(){throw H(36894)}copy(e,t,s,i,r){return this}insert(e,t,s){return new Ue(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class De{constructor(e){this.comparator=e,this.data=new Ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Od(this.data.getIterator())}getIteratorFrom(e){return new Od(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof De)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new De(this.comparator);return t.data=e,t}}class Od{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ln{constructor(e){this.fields=e,e.sort(Ye.comparator)}static empty(){return new ln([])}unionWith(e){let t=new De(Ye.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new ln(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Vs(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class $g extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new $g("Invalid base64 string: "+r):r}})(e);return new qe(t)}static fromUint8Array(e){const t=(function(i){let r="";for(let o=0;o<i.length;++o)r+=String.fromCharCode(i[o]);return r})(e);return new qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qe.EMPTY_BYTE_STRING=new qe("");const AA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tn(n){if(ye(!!n,39018),typeof n=="string"){let e=0;const t=AA.exec(n);if(ye(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function wn(n){return typeof n=="string"?qe.fromBase64String(n):qe.fromUint8Array(n)}const zg="server_timestamp",Gg="__type__",Kg="__previous_value__",Qg="__local_write_time__";function Kc(n){return(n?.mapValue?.fields||{})[Gg]?.stringValue===zg}function ca(n){const e=n.mapValue.fields[Kg];return Kc(e)?ca(e):e}function ir(n){const e=Tn(n.mapValue.fields[Qg].timestampValue);return new Re(e.seconds,e.nanos)}class SA{constructor(e,t,s,i,r,o,l,c,h,f,p){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f,this.apiKey=p}}const Mo="(default)";class rr{constructor(e,t){this.projectId=e,this.database=t||Mo}static empty(){return new rr("","")}get isDefaultDatabase(){return this.database===Mo}isEqual(e){return e instanceof rr&&e.projectId===this.projectId&&e.database===this.database}}function RA(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new M(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rr(n.options.projectId,e)}const bA="__type__",PA="__max__",Jr={mapValue:{}},kA="__vector__",Ll="value";function Cn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Kc(n)?4:DA(n)?9007199254740991:NA(n)?10:11:H(28295,{value:n})}function kt(n,e){if(n===e)return!0;const t=Cn(n);if(t!==Cn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ir(n).isEqual(ir(e));case 3:return(function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const o=Tn(i.timestampValue),l=Tn(r.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,r){return wn(i.bytesValue).isEqual(wn(r.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,r){return we(i.geoPointValue.latitude)===we(r.geoPointValue.latitude)&&we(i.geoPointValue.longitude)===we(r.geoPointValue.longitude)})(n,e);case 2:return(function(i,r){if("integerValue"in i&&"integerValue"in r)return we(i.integerValue)===we(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const o=we(i.doubleValue),l=we(r.doubleValue);return o===l?Ol(o)===Ol(l):isNaN(o)&&isNaN(l)}return!1})(n,e);case 9:return Vs(n.arrayValue.values||[],e.arrayValue.values||[],kt);case 10:case 11:return(function(i,r){const o=i.mapValue.fields||{},l=r.mapValue.fields||{};if(Dd(o)!==Dd(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!kt(o[c],l[c])))return!1;return!0})(n,e);default:return H(52216,{left:n})}}function or(n,e){return(n.values||[]).find((t=>kt(t,e)))!==void 0}function Fs(n,e){if(n===e)return 0;const t=Cn(n),s=Cn(e);if(t!==s)return J(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return(function(r,o){const l=we(r.integerValue||r.doubleValue),c=we(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1})(n,e);case 3:return Ld(n.timestampValue,e.timestampValue);case 4:return Ld(ir(n),ir(e));case 5:return Nl(n.stringValue,e.stringValue);case 6:return(function(r,o){const l=wn(r),c=wn(o);return l.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(r,o){const l=r.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){const f=J(l[h],c[h]);if(f!==0)return f}return J(l.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(r,o){const l=J(we(r.latitude),we(o.latitude));return l!==0?l:J(we(r.longitude),we(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return xd(n.arrayValue,e.arrayValue);case 10:return(function(r,o){const l=r.fields||{},c=o.fields||{},h=l[Ll]?.arrayValue,f=c[Ll]?.arrayValue,p=J(h?.values?.length||0,f?.values?.length||0);return p!==0?p:xd(h,f)})(n.mapValue,e.mapValue);case 11:return(function(r,o){if(r===Jr.mapValue&&o===Jr.mapValue)return 0;if(r===Jr.mapValue)return 1;if(o===Jr.mapValue)return-1;const l=r.fields||{},c=Object.keys(l),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const m=Nl(c[p],f[p]);if(m!==0)return m;const A=Fs(l[c[p]],h[f[p]]);if(A!==0)return A}return J(c.length,f.length)})(n.mapValue,e.mapValue);default:throw H(23264,{he:t})}}function Ld(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);const t=Tn(n),s=Tn(e),i=J(t.seconds,s.seconds);return i!==0?i:J(t.nanos,s.nanos)}function xd(n,e){const t=n.values||[],s=e.values||[];for(let i=0;i<t.length&&i<s.length;++i){const r=Fs(t[i],s[i]);if(r)return r}return J(t.length,s.length)}function Us(n){return xl(n)}function xl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Tn(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return wn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",i=!0;for(const r of t.values||[])i?i=!1:s+=",",s+=xl(r);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const o of s)r?r=!1:i+=",",i+=`${o}:${xl(t.fields[o])}`;return i+"}"})(n.mapValue):H(61005,{value:n})}function lo(n){switch(Cn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ca(n);return e?16+lo(e):16;case 5:return 2*n.stringValue.length;case 6:return wn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((i,r)=>i+lo(r)),0)})(n.arrayValue);case 10:case 11:return(function(s){let i=0;return yr(s.fields,((r,o)=>{i+=r.length+lo(o)})),i})(n.mapValue);default:throw H(13486,{value:n})}}function Ml(n){return!!n&&"integerValue"in n}function Qc(n){return!!n&&"arrayValue"in n}function Md(n){return!!n&&"nullValue"in n}function Vd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tl(n){return!!n&&"mapValue"in n}function NA(n){return(n?.mapValue?.fields||{})[bA]?.stringValue===kA}function qi(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return yr(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=qi(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qi(n.arrayValue.values[t]);return e}return{...n}}function DA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===PA}class wt{constructor(e){this.value=e}static empty(){return new wt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!tl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qi(t)}setAll(e){let t=Ye.emptyPath(),s={},i=[];e.forEach(((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,s,i),s={},i=[],t=l.popLast()}o?s[l.lastSegment()]=qi(o):i.push(l.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,s,i)}delete(e){const t=this.field(e.popLast());tl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=t.mapValue.fields[e.get(s)];tl(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,s){yr(t,((i,r)=>e[i]=r));for(const i of s)delete e[i]}clone(){return new wt(qi(this.value))}}class $e{constructor(e,t,s,i,r,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=i,this.createTime=r,this.data=o,this.documentState=l}static newInvalidDocument(e){return new $e(e,0,j.min(),j.min(),j.min(),wt.empty(),0)}static newFoundDocument(e,t,s,i){return new $e(e,1,t,j.min(),s,i,0)}static newNoDocument(e,t){return new $e(e,2,t,j.min(),j.min(),wt.empty(),0)}static newUnknownDocument(e,t){return new $e(e,3,t,j.min(),j.min(),wt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vo{constructor(e,t){this.position=e,this.inclusive=t}}function Fd(n,e,t){let s=0;for(let i=0;i<n.position.length;i++){const r=e[i],o=n.position[i];if(r.field.isKeyField()?s=F.comparator(F.fromName(o.referenceValue),t.key):s=Fs(o,t.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function Ud(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!kt(n.position[t],e.position[t]))return!1;return!0}class Fo{constructor(e,t="asc"){this.field=e,this.dir=t}}function OA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Yg{}class Ne extends Yg{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new xA(e,t,s):t==="array-contains"?new FA(e,s):t==="in"?new UA(e,s):t==="not-in"?new BA(e,s):t==="array-contains-any"?new qA(e,s):new Ne(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new MA(e,s):new VA(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Fs(t,this.value)):t!==null&&Cn(this.value)===Cn(t)&&this.matchesComparison(Fs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return H(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nt extends Yg{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Nt(e,t)}matches(e){return Jg(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Jg(n){return n.op==="and"}function Xg(n){return LA(n)&&Jg(n)}function LA(n){for(const e of n.filters)if(e instanceof Nt)return!1;return!0}function Vl(n){if(n instanceof Ne)return n.field.canonicalString()+n.op.toString()+Us(n.value);if(Xg(n))return n.filters.map((e=>Vl(e))).join(",");{const e=n.filters.map((t=>Vl(t))).join(",");return`${n.op}(${e})`}}function Zg(n,e){return n instanceof Ne?(function(s,i){return i instanceof Ne&&s.op===i.op&&s.field.isEqual(i.field)&&kt(s.value,i.value)})(n,e):n instanceof Nt?(function(s,i){return i instanceof Nt&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce(((r,o,l)=>r&&Zg(o,i.filters[l])),!0):!1})(n,e):void H(19439)}function em(n){return n instanceof Ne?(function(t){return`${t.field.canonicalString()} ${t.op} ${Us(t.value)}`})(n):n instanceof Nt?(function(t){return t.op.toString()+" {"+t.getFilters().map(em).join(" ,")+"}"})(n):"Filter"}class xA extends Ne{constructor(e,t,s){super(e,t,s),this.key=F.fromName(s.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class MA extends Ne{constructor(e,t){super(e,"in",t),this.keys=tm("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class VA extends Ne{constructor(e,t){super(e,"not-in",t),this.keys=tm("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function tm(n,e){return(e.arrayValue?.values||[]).map((t=>F.fromName(t.referenceValue)))}class FA extends Ne{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qc(t)&&or(t.arrayValue,this.value)}}class UA extends Ne{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&or(this.value.arrayValue,t)}}class BA extends Ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(or(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!or(this.value.arrayValue,t)}}class qA extends Ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>or(this.value.arrayValue,s)))}}class WA{constructor(e,t=null,s=[],i=[],r=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=l,this.Te=null}}function Bd(n,e=null,t=[],s=[],i=null,r=null,o=null){return new WA(n,e,t,s,i,r,o)}function Yc(n){const e=Z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Vl(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(r){return r.field.canonicalString()+r.dir})(s))).join(","),la(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Us(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Us(s))).join(",")),e.Te=t}return e.Te}function Jc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!OA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Zg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ud(n.startAt,e.startAt)&&Ud(n.endAt,e.endAt)}function Fl(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ua{constructor(e,t=null,s=[],i=[],r=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function jA(n,e,t,s,i,r,o,l){return new ua(n,e,t,s,i,r,o,l)}function Xc(n){return new ua(n)}function qd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function HA(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $A(n){return n.collectionGroup!==null}function Wi(n){const e=Z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new De(Ye.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new Fo(r,s))})),t.has(Ye.keyField().canonicalString())||e.Ie.push(new Fo(Ye.keyField(),s))}return e.Ie}function Pt(n){const e=Z(n);return e.Ee||(e.Ee=zA(e,Wi(n))),e.Ee}function zA(n,e){if(n.limitType==="F")return Bd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const r=i.dir==="desc"?"asc":"desc";return new Fo(i.field,r)}));const t=n.endAt?new Vo(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Vo(n.startAt.position,n.startAt.inclusive):null;return Bd(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Ul(n,e,t){return new ua(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ha(n,e){return Jc(Pt(n),Pt(e))&&n.limitType===e.limitType}function nm(n){return`${Yc(Pt(n))}|lt:${n.limitType}`}function _s(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((i=>em(i))).join(", ")}]`),la(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((i=>Us(i))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((i=>Us(i))).join(",")),`Target(${s})`})(Pt(n))}; limitType=${n.limitType})`}function da(n,e){return e.isFoundDocument()&&(function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):F.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)})(n,e)&&(function(s,i){for(const r of Wi(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0})(n,e)&&(function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0})(n,e)&&(function(s,i){return!(s.startAt&&!(function(o,l,c){const h=Fd(o,l,c);return o.inclusive?h<=0:h<0})(s.startAt,Wi(s),i)||s.endAt&&!(function(o,l,c){const h=Fd(o,l,c);return o.inclusive?h>=0:h>0})(s.endAt,Wi(s),i))})(n,e)}function GA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sm(n){return(e,t)=>{let s=!1;for(const i of Wi(n)){const r=KA(i,e,t);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function KA(n,e,t){const s=n.field.isKeyField()?F.comparator(e.key,t.key):(function(r,o,l){const c=o.data.field(r),h=l.data.field(r);return c!==null&&h!==null?Fs(c,h):H(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return H(19790,{direction:n.dir})}}class os{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[t]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){yr(this.inner,((t,s)=>{for(const[i,r]of s)e(i,r)}))}isEmpty(){return CA(this.inner)}size(){return this.innerSize}}const QA=new Ce(F.comparator);function An(){return QA}const im=new Ce(F.comparator);function Ni(...n){let e=im;for(const t of n)e=e.insert(t.key,t);return e}function YA(n){let e=im;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function zn(){return ji()}function rm(){return ji()}function ji(){return new os((n=>n.toString()),((n,e)=>n.isEqual(e)))}const JA=new De(F.comparator);function ee(...n){let e=JA;for(const t of n)e=e.add(t);return e}const XA=new De(J);function ZA(){return XA}function eS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ol(e)?"-0":e}}function tS(n){return{integerValue:""+n}}class fa{constructor(){this._=void 0}}function nS(n,e,t){return n instanceof Bl?(function(i,r){const o={fields:{[Gg]:{stringValue:zg},[Qg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&Kc(r)&&(r=ca(r)),r&&(o.fields[Kg]=r),{mapValue:o}})(t,e):n instanceof Uo?om(n,e):n instanceof Bo?am(n,e):(function(i,r){const o=iS(i,r),l=Wd(o)+Wd(i.Ae);return Ml(o)&&Ml(i.Ae)?tS(l):eS(i.serializer,l)})(n,e)}function sS(n,e,t){return n instanceof Uo?om(n,e):n instanceof Bo?am(n,e):t}function iS(n,e){return n instanceof ql?(function(s){return Ml(s)||(function(r){return!!r&&"doubleValue"in r})(s)})(e)?e:{integerValue:0}:null}class Bl extends fa{}class Uo extends fa{constructor(e){super(),this.elements=e}}function om(n,e){const t=lm(e);for(const s of n.elements)t.some((i=>kt(i,s)))||t.push(s);return{arrayValue:{values:t}}}class Bo extends fa{constructor(e){super(),this.elements=e}}function am(n,e){let t=lm(e);for(const s of n.elements)t=t.filter((i=>!kt(i,s)));return{arrayValue:{values:t}}}class ql extends fa{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Wd(n){return we(n.integerValue||n.doubleValue)}function lm(n){return Qc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function rS(n,e){return n.field.isEqual(e.field)&&(function(s,i){return s instanceof Uo&&i instanceof Uo||s instanceof Bo&&i instanceof Bo?Vs(s.elements,i.elements,kt):s instanceof ql&&i instanceof ql?kt(s.Ae,i.Ae):s instanceof Bl&&i instanceof Bl})(n.transform,e.transform)}class Kn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kn}static exists(e){return new Kn(void 0,e)}static updateTime(e){return new Kn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function co(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Zc{}function cm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new aS(n.key,Kn.none()):new eu(n.key,n.data,Kn.none());{const t=n.data,s=wt.empty();let i=new De(Ye.comparator);for(let r of e.fields)if(!i.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?s.delete(r):s.set(r,o),i=i.add(r)}return new pa(n.key,s,new ln(i.toArray()),Kn.none())}}function oS(n,e,t){n instanceof eu?(function(i,r,o){const l=i.value.clone(),c=Hd(i.fieldTransforms,r,o.transformResults);l.setAll(c),r.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):n instanceof pa?(function(i,r,o){if(!co(i.precondition,r))return void r.convertToUnknownDocument(o.version);const l=Hd(i.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(um(i)),c.setAll(l),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(i,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Hi(n,e,t,s){return n instanceof eu?(function(r,o,l,c){if(!co(r.precondition,o))return l;const h=r.value.clone(),f=$d(r.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,s):n instanceof pa?(function(r,o,l,c){if(!co(r.precondition,o))return l;const h=$d(r.fieldTransforms,c,o),f=o.data;return f.setAll(um(r)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((p=>p.field)))})(n,e,t,s):(function(r,o,l){return co(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l})(n,e,t)}function jd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Vs(s,i,((r,o)=>rS(r,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class eu extends Zc{constructor(e,t,s,i=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pa extends Zc{constructor(e,t,s,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function um(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Hd(n,e,t){const s=new Map;ye(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){const r=n[i],o=r.transform,l=e.data.field(r.field);s.set(r.field,sS(o,l,t[i]))}return s}function $d(n,e,t){const s=new Map;for(const i of n){const r=i.transform,o=t.data.field(i.field);s.set(i.field,nS(r,o,e))}return s}class aS extends Zc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lS{constructor(e,t,s,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&oS(r,e,s[i])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Hi(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Hi(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=rm();return this.mutations.forEach((i=>{const r=e.get(i.key),o=r.overlayedDocument;let l=this.applyToLocalView(o,r.mutatedFields);l=t.has(i.key)?null:l;const c=cm(o,l);c!==null&&s.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(j.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ee())}isEqual(e){return this.batchId===e.batchId&&Vs(this.mutations,e.mutations,((t,s)=>jd(t,s)))&&Vs(this.baseMutations,e.baseMutations,((t,s)=>jd(t,s)))}}class cS{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class uS{constructor(e,t){this.count=e,this.unchangedNames=t}}var Se,X;function hm(n){if(n===void 0)return jt("GRPC error has no .code"),N.UNKNOWN;switch(n){case Se.OK:return N.OK;case Se.CANCELLED:return N.CANCELLED;case Se.UNKNOWN:return N.UNKNOWN;case Se.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case Se.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case Se.INTERNAL:return N.INTERNAL;case Se.UNAVAILABLE:return N.UNAVAILABLE;case Se.UNAUTHENTICATED:return N.UNAUTHENTICATED;case Se.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case Se.NOT_FOUND:return N.NOT_FOUND;case Se.ALREADY_EXISTS:return N.ALREADY_EXISTS;case Se.PERMISSION_DENIED:return N.PERMISSION_DENIED;case Se.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case Se.ABORTED:return N.ABORTED;case Se.OUT_OF_RANGE:return N.OUT_OF_RANGE;case Se.UNIMPLEMENTED:return N.UNIMPLEMENTED;case Se.DATA_LOSS:return N.DATA_LOSS;default:return H(39323,{code:n})}}(X=Se||(Se={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function hS(){return new TextEncoder}const dS=new pn([4294967295,4294967295],0);function zd(n){const e=hS().encode(n),t=new Mg;return t.update(e),new Uint8Array(t.digest())}function Gd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new pn([t,s],0),new pn([i,r],0)]}class tu{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Di(`Invalid padding: ${t}`);if(s<0)throw new Di(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Di(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Di(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=pn.fromNumber(this.ge)}ye(e,t,s){let i=e.add(t.multiply(pn.fromNumber(s)));return i.compare(dS)===1&&(i=new pn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=zd(e),[s,i]=Gd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);if(!this.we(o))return!1}return!0}static create(e,t,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new tu(r,i,t);return s.forEach((l=>o.insert(l))),o}insert(e){if(this.ge===0)return;const t=zd(e),[s,i]=Gd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);this.be(o)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Di extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ga{constructor(e,t,s,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const i=new Map;return i.set(e,vr.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new ga(j.min(),i,new Ce(J),An(),ee())}}class vr{constructor(e,t,s,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new vr(s,t,ee(),ee(),ee())}}class uo{constructor(e,t,s,i){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=i}}class dm{constructor(e,t){this.targetId=e,this.Ce=t}}class fm{constructor(e,t,s=qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=i}}class Kd{constructor(){this.ve=0,this.Fe=Qd(),this.Me=qe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ee(),t=ee(),s=ee();return this.Fe.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:s=s.add(i);break;default:H(38017,{changeType:r})}})),new vr(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=Qd()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ye(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class fS{constructor(e){this.Ge=e,this.ze=new Map,this.je=An(),this.He=Xr(),this.Je=Xr(),this.Ze=new Ce(J)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:H(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,s=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(Fl(r))if(s===0){const o=new F(r.path);this.et(t,o,$e.newNoDocument(o,j.min()))}else ye(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=t;let o,l;try{o=wn(s).toUint8Array()}catch(c){if(c instanceof $g)return Ms("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new tu(o,i,r)}catch(c){return Ms(c instanceof Di?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let i=0;return s.forEach((r=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(l)||(this.et(t,r,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((r,o)=>{const l=this.ot(o);if(l){if(r.current&&Fl(l.target)){const c=new F(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,$e.newNoDocument(c,e))}r.Be&&(t.set(o,r.ke()),r.Ke())}}));let s=ee();this.Je.forEach(((r,o)=>{let l=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(s=s.add(r))})),this.je.forEach(((r,o)=>o.setReadTime(e)));const i=new ga(e,t,this.Ze,this.je,s);return this.je=An(),this.He=Xr(),this.Je=Xr(),this.Ze=new Ce(J),i}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Kd,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new De(J),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new De(J),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Kd),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Xr(){return new Ce(F.comparator)}function Qd(){return new Ce(F.comparator)}const pS={asc:"ASCENDING",desc:"DESCENDING"},gS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mS={and:"AND",or:"OR"};class _S{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wl(n,e){return n.useProto3Json||la(e)?e:{value:e}}function yS(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function bs(n){return ye(!!n,49232),j.fromTimestamp((function(t){const s=Tn(t);return new Re(s.seconds,s.nanos)})(n))}function ES(n,e){return jl(n,e).canonicalString()}function jl(n,e){const t=(function(i){return new _e(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function pm(n){const e=_e.fromString(n);return ye(vm(e),10190,{key:e.toString()}),e}function nl(n,e){const t=pm(e);if(t.get(1)!==n.databaseId.projectId)throw new M(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new M(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(mm(t))}function gm(n,e){return ES(n.databaseId,e)}function IS(n){const e=pm(n);return e.length===4?_e.emptyPath():mm(e)}function Yd(n){return new _e(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mm(n){return ye(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function TS(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:H(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=(function(h,f){return h.useProto3Json?(ye(f===void 0||typeof f=="string",58123),qe.fromBase64String(f||"")):(ye(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),qe.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&(function(h){const f=h.code===void 0?N.UNKNOWN:hm(h.code);return new M(f,h.message||"")})(o);t=new fm(s,i,r,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=nl(n,s.document.name),r=bs(s.document.updateTime),o=s.document.createTime?bs(s.document.createTime):j.min(),l=new wt({mapValue:{fields:s.document.fields}}),c=$e.newFoundDocument(i,r,o,l),h=s.targetIds||[],f=s.removedTargetIds||[];t=new uo(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=nl(n,s.document),r=s.readTime?bs(s.readTime):j.min(),o=$e.newNoDocument(i,r),l=s.removedTargetIds||[];t=new uo([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=nl(n,s.document),r=s.removedTargetIds||[];t=new uo([],r,i,null)}else{if(!("filter"in e))return H(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,o=new uS(i,r),l=s.targetId;t=new dm(l,o)}}return t}function wS(n,e){return{documents:[gm(n,e.path)]}}function CS(n,e){const t={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=gm(n,i);const r=(function(h){if(h.length!==0)return ym(Nt.create(h,"and"))})(e.filters);r&&(t.structuredQuery.where=r);const o=(function(h){if(h.length!==0)return h.map((f=>(function(m){return{field:ys(m.field),direction:RS(m.dir)}})(f)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=Wl(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function AS(n){let e=IS(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let i=null;if(s>0){ye(s===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let r=[];t.where&&(r=(function(p){const m=_m(p);return m instanceof Nt&&Xg(m)?m.getFilters():[m]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map((m=>(function(S){return new Fo(vs(S.field),(function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(m)))})(t.orderBy));let l=null;t.limit&&(l=(function(p){let m;return m=typeof p=="object"?p.value:p,la(m)?null:m})(t.limit));let c=null;t.startAt&&(c=(function(p){const m=!!p.before,A=p.values||[];return new Vo(A,m)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const m=!p.before,A=p.values||[];return new Vo(A,m)})(t.endAt)),jA(e,i,o,r,l,"F",c,h)}function SS(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return H(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _m(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=vs(t.unaryFilter.field);return Ne.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=vs(t.unaryFilter.field);return Ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=vs(t.unaryFilter.field);return Ne.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=vs(t.unaryFilter.field);return Ne.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return H(61313);default:return H(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ne.create(vs(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return H(58110);default:return H(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Nt.create(t.compositeFilter.filters.map((s=>_m(s))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return H(1026)}})(t.compositeFilter.op))})(n):H(30097,{filter:n})}function RS(n){return pS[n]}function bS(n){return gS[n]}function PS(n){return mS[n]}function ys(n){return{fieldPath:n.canonicalString()}}function vs(n){return Ye.fromServerFormat(n.fieldPath)}function ym(n){return n instanceof Ne?(function(t){if(t.op==="=="){if(Vd(t.value))return{unaryFilter:{field:ys(t.field),op:"IS_NAN"}};if(Md(t.value))return{unaryFilter:{field:ys(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Vd(t.value))return{unaryFilter:{field:ys(t.field),op:"IS_NOT_NAN"}};if(Md(t.value))return{unaryFilter:{field:ys(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ys(t.field),op:bS(t.op),value:t.value}}})(n):n instanceof Nt?(function(t){const s=t.getFilters().map((i=>ym(i)));return s.length===1?s[0]:{compositeFilter:{op:PS(t.op),filters:s}}})(n):H(54877,{filter:n})}function vm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class cn{constructor(e,t,s,i,r=j.min(),o=j.min(),l=qe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new cn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class kS{constructor(e){this.yt=e}}function NS(n){const e=AS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ul(e,e.limit,"L"):e}class DS{constructor(){this.Sn=new OS}addToCollectionParentIndex(e,t){return this.Sn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(In.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(In.min())}updateCollectionGroup(e,t,s){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class OS{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t]||new De(_e.comparator),r=!i.has(s);return this.index[t]=i.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t];return i&&i.has(s)}getEntries(e){return(this.index[e]||new De(_e.comparator)).toArray()}}const Jd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Em=41943040;class Ze{static withCacheSize(e){return new Ze(e,Ze.DEFAULT_COLLECTION_PERCENTILE,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}Ze.DEFAULT_COLLECTION_PERCENTILE=10,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ze.DEFAULT=new Ze(Em,Ze.DEFAULT_COLLECTION_PERCENTILE,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ze.DISABLED=new Ze(-1,0,0);class Bs{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Bs(0)}static ar(){return new Bs(-1)}}const Xd="LruGarbageCollector",LS=1048576;function Zd([n,e],[t,s]){const i=J(n,t);return i===0?J(e,s):i}class xS{constructor(e){this.Pr=e,this.buffer=new De(Zd),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();Zd(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class MS{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){L(Xd,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Js(t)?L(Xd,"Ignoring IndexedDB error during garbage collection: ",t):await oa(t)}await this.Ar(3e5)}))}}class VS{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(aa.ce);const s=new xS(t);return this.Vr.forEachTarget(e,(i=>s.Er(i.sequenceNumber))).next((()=>this.Vr.mr(e,(i=>s.Er(i))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Jd)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Jd):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,i,r,o,l,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i)))).next((p=>(s=p,l=Date.now(),this.removeTargets(e,s,t)))).next((p=>(r=p,c=Date.now(),this.removeOrphanedDocuments(e,s)))).next((p=>(h=Date.now(),ms()<=Q.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${r} targets in `+(c-l)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p}))))}}function FS(n,e){return new VS(n,e)}class US{constructor(){this.changes=new os((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?b.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class BS{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class qS{constructor(e,t,s,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(s=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(s!==null&&Hi(s.mutation,i,ln.empty(),Re.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,ee()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=ee()){const i=zn();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,s).next((r=>{let o=Ni();return r.forEach(((l,c)=>{o=o.insert(l,c.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=zn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,ee())))}populateOverlays(e,t,s){const i=[];return s.forEach((r=>{t.has(r)||i.push(r)})),this.documentOverlayCache.getOverlays(e,i).next((r=>{r.forEach(((o,l)=>{t.set(o,l)}))}))}computeViews(e,t,s,i){let r=An();const o=ji(),l=(function(){return ji()})();return t.forEach(((c,h)=>{const f=s.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof pa)?r=r.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Hi(f.mutation,h,f.mutation.getFieldMask(),Re.now())):o.set(h.key,ln.empty())})),this.recalculateAndSaveOverlays(e,r).next((c=>(c.forEach(((h,f)=>o.set(h,f))),t.forEach(((h,f)=>l.set(h,new BS(f,o.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const s=ji();let i=new Ce(((o,l)=>o-l)),r=ee();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const l of o)l.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let f=s.get(c)||ln.empty();f=l.applyToLocalView(h,f),s.set(c,f);const p=(i.get(l.batchId)||ee()).add(c);i=i.insert(l.batchId,p)}))})).next((()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),h=c.key,f=c.value,p=rm();f.forEach((m=>{if(!r.has(m)){const A=cm(t.get(m),s.get(m));A!==null&&p.set(m,A),r=r.add(m)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return b.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,i){return HA(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):$A(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,i):this.getDocumentsMatchingCollectionQuery(e,t,s,i)}getNextDocuments(e,t,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,i).next((r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,i-r.size):b.resolve(zn());let l=sr,c=r;return o.next((h=>b.forEach(h,((f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),r.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next((m=>{c=c.insert(f,m)}))))).next((()=>this.populateOverlays(e,h,r))).next((()=>this.computeViews(e,c,h,ee()))).next((f=>({batchId:l,changes:YA(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next((s=>{let i=Ni();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,i){const r=t.collectionGroup;let o=Ni();return this.indexManager.getCollectionParents(e,r).next((l=>b.forEach(l,(c=>{const h=(function(p,m){return new ua(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next((f=>{f.forEach(((p,m)=>{o=o.insert(p,m)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,i)))).next((o=>{r.forEach(((c,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,$e.newInvalidDocument(f)))}));let l=Ni();return o.forEach(((c,h)=>{const f=r.get(c);f!==void 0&&Hi(f.mutation,h,ln.empty(),Re.now()),da(t,h)&&(l=l.insert(c,h))})),l}))}}class WS{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return b.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:bs(i.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:NS(i.bundledQuery),readTime:bs(i.readTime)}})(t)),b.resolve()}}class jS{constructor(){this.overlays=new Ce(F.comparator),this.Lr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const s=zn();return b.forEach(t,(i=>this.getOverlay(e,i).next((r=>{r!==null&&s.set(i,r)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((i,r)=>{this.bt(e,t,r)})),b.resolve()}removeOverlaysForBatchId(e,t,s){const i=this.Lr.get(s);return i!==void 0&&(i.forEach((r=>this.overlays=this.overlays.remove(r))),this.Lr.delete(s)),b.resolve()}getOverlaysForCollection(e,t,s){const i=zn(),r=t.length+1,o=new F(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===r&&c.largestBatchId>s&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,s,i){let r=new Ce(((h,f)=>h-f));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=r.get(h.largestBatchId);f===null&&(f=zn(),r=r.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=zn(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=i)););return b.resolve(l)}bt(e,t,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.Lr.get(i.largestBatchId).delete(s.key);this.Lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new cS(t,s));let r=this.Lr.get(t);r===void 0&&(r=ee(),this.Lr.set(t,r)),this.Lr.set(t,r.add(s.key))}}class HS{constructor(){this.sessionToken=qe.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class nu{constructor(){this.kr=new De(Me.Kr),this.qr=new De(Me.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new Me(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new Me(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new F(new _e([])),s=new Me(t,e),i=new Me(t,e+1),r=[];return this.qr.forEachInRange([s,i],(o=>{this.Wr(o),r.push(o.key)})),r}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new F(new _e([])),s=new Me(t,e),i=new Me(t,e+1);let r=ee();return this.qr.forEachInRange([s,i],(o=>{r=r.add(o.key)})),r}containsKey(e){const t=new Me(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Me{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return F.comparator(e.key,t.key)||J(e.Hr,t.Hr)}static Ur(e,t){return J(e.Hr,t.Hr)||F.comparator(e.key,t.key)}}class $S{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new De(Me.Kr)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,i){const r=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new lS(r,t,s,i);this.mutationQueue.push(o);for(const l of i)this.Jr=this.Jr.add(new Me(l.key,r)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=this.Xr(s),r=i<0?0:i;return b.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?IA:this.Yn-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Me(t,0),i=new Me(t,Number.POSITIVE_INFINITY),r=[];return this.Jr.forEachInRange([s,i],(o=>{const l=this.Zr(o.Hr);r.push(l)})),b.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new De(J);return t.forEach((i=>{const r=new Me(i,0),o=new Me(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([r,o],(l=>{s=s.add(l.Hr)}))})),b.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1;let r=s;F.isDocumentKey(r)||(r=r.child(""));const o=new Me(new F(r),0);let l=new De(J);return this.Jr.forEachWhile((c=>{const h=c.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(l=l.add(c.Hr)),!0)}),o),b.resolve(this.Yr(l))}Yr(e){const t=[];return e.forEach((s=>{const i=this.Zr(s);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){ye(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return b.forEach(t.mutations,(i=>{const r=new Me(i.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new Me(t,0),i=this.Jr.firstAfterOrEqual(s);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class zS{constructor(e){this.ti=e,this.docs=(function(){return new Ce(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,i=this.docs.get(s),r=i?i.size:0,o=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return b.resolve(s?s.document.mutableCopy():$e.newInvalidDocument(t))}getEntries(e,t){let s=An();return t.forEach((i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():$e.newInvalidDocument(i))})),b.resolve(s)}getDocumentsMatchingQuery(e,t,s,i){let r=An();const o=t.path,l=new F(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||_A(mA(f),s)<=0||(i.has(f.key)||da(t,f))&&(r=r.insert(f.key,f.mutableCopy()))}return b.resolve(r)}getAllFromCollectionGroup(e,t,s,i){H(9500)}ni(e,t){return b.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new GS(this)}getSize(e){return b.resolve(this.size)}}class GS extends US{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(s)})),b.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class KS{constructor(e){this.persistence=e,this.ri=new os((t=>Yc(t)),Jc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.ii=0,this.si=new nu,this.targetCount=0,this.oi=Bs._r()}forEachTarget(e,t){return this.ri.forEach(((s,i)=>t(i))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),b.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Bs(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.lr(t),b.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,s){let i=0;const r=[];return this.ri.forEach(((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.ri.delete(o),r.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),b.waitFor(r).next((()=>i))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return b.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),b.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((o=>{r.push(i.markPotentiallyOrphaned(e,o))})),b.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return b.resolve(s)}containsKey(e,t){return b.resolve(this.si.containsKey(t))}}class Im{constructor(e,t){this._i={},this.overlays={},this.ai=new aa(0),this.ui=!1,this.ui=!0,this.ci=new HS,this.referenceDelegate=e(this),this.li=new KS(this),this.indexManager=new DS,this.remoteDocumentCache=(function(i){return new zS(i)})((s=>this.referenceDelegate.hi(s))),this.serializer=new kS(t),this.Pi=new WS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new jS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new $S(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){L("MemoryPersistence","Starting transaction:",e);const i=new QS(this.ai.next());return this.referenceDelegate.Ti(),s(i).next((r=>this.referenceDelegate.Ii(i).next((()=>r)))).toPromise().then((r=>(i.raiseOnCommittedEvent(),r)))}Ei(e,t){return b.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class QS extends vA{constructor(e){super(),this.currentSequenceNumber=e}}class su{constructor(e){this.persistence=e,this.Ri=new nu,this.Ai=null}static Vi(e){return new su(e)}get di(){if(this.Ai)return this.Ai;throw H(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),b.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((i=>this.di.add(i.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((r=>this.di.add(r.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.di,(s=>{const i=F.fromPath(s);return this.mi(e,i).next((r=>{r||t.removeEntry(i,j.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class qo{constructor(e,t){this.persistence=e,this.fi=new os((s=>TA(s.path)),((s,i)=>s.isEqual(i))),this.garbageCollector=FS(this,t)}static Vi(e,t){return new qo(e,t)}Ti(){}Ii(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((i=>s+i))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return b.forEach(this.fi,((s,i)=>this.wr(e,s,i).next((r=>r?b.resolve():t(i)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ni(e,(o=>this.wr(e,o,t).next((l=>{l||(s++,r.removeEntry(o,j.min()))})))).next((()=>r.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=lo(e.data.value)),t}wr(e,t,s){return b.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.fi.get(t);return b.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class iu{constructor(e,t,s,i){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=i}static Es(e,t){let s=ee(),i=ee();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new iu(e,t.fromCache,s,i)}}class YS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class JS{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return ly()?8:EA(ze())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,i){const r={result:null};return this.gs(e,t).next((o=>{r.result=o})).next((()=>{if(!r.result)return this.ps(e,t,i,s).next((o=>{r.result=o}))})).next((()=>{if(r.result)return;const o=new YS;return this.ys(e,t,o).next((l=>{if(r.result=l,this.As)return this.ws(e,t,o,l.size)}))})).next((()=>r.result))}ws(e,t,s,i){return s.documentReadCount<this.Vs?(ms()<=Q.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",_s(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(ms()<=Q.DEBUG&&L("QueryEngine","Query:",_s(t),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.ds*i?(ms()<=Q.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",_s(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pt(t))):b.resolve())}gs(e,t){if(qd(t))return b.resolve(null);let s=Pt(t);return this.indexManager.getIndexType(e,s).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Ul(t,null,"F"),s=Pt(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((r=>{const o=ee(...r);return this.fs.getDocuments(e,o).next((l=>this.indexManager.getMinOffset(e,s).next((c=>{const h=this.bs(t,l);return this.Ss(t,h,o,c.readTime)?this.gs(e,Ul(t,null,"F")):this.Ds(e,h,t,c)}))))})))))}ps(e,t,s,i){return qd(t)||i.isEqual(j.min())?b.resolve(null):this.fs.getDocuments(e,s).next((r=>{const o=this.bs(t,r);return this.Ss(t,o,s,i)?b.resolve(null):(ms()<=Q.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),_s(t)),this.Ds(e,o,t,gA(i,sr)).next((l=>l)))}))}bs(e,t){let s=new De(sm(e));return t.forEach(((i,r)=>{da(e,r)&&(s=s.add(r))})),s}Ss(e,t,s,i){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}ys(e,t,s){return ms()<=Q.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",_s(t)),this.fs.getDocumentsMatchingQuery(e,t,In.min(),s)}Ds(e,t,s,i){return this.fs.getDocumentsMatchingQuery(e,s,i).next((r=>(t.forEach((o=>{r=r.insert(o.key,o)})),r)))}}const ru="LocalStore",XS=3e8;class ZS{constructor(e,t,s,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new Ce(J),this.Fs=new os((r=>Yc(r)),Jc),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new qS(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function eR(n,e,t,s){return new ZS(n,e,t,s)}async function Tm(n,e){const t=Z(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let i;return t.mutationQueue.getAllMutationBatches(s).next((r=>(i=r,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((r=>{const o=[],l=[];let c=ee();for(const h of i){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of r){l.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(s,c).next((h=>({Ns:h,removedBatchIds:o,addedBatchIds:l})))}))}))}function wm(n){const e=Z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function tR(n,e){const t=Z(n),s=e.snapshotVersion;let i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const o=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;const l=[];e.targetChanges.forEach(((f,p)=>{const m=i.get(p);if(!m)return;l.push(t.li.removeMatchingKeys(r,f.removedDocuments,p).next((()=>t.li.addMatchingKeys(r,f.addedDocuments,p))));let A=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken(qe.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,s)),i=i.insert(p,A),(function(P,O,B){return P.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=XS?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0})(m,A,f)&&l.push(t.li.updateTargetData(r,A))}));let c=An(),h=ee();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(r,f))})),l.push(nR(r,o,e.documentUpdates).next((f=>{c=f.Bs,h=f.Ls}))),!s.isEqual(j.min())){const f=t.li.getLastRemoteSnapshotVersion(r).next((p=>t.li.setTargetsMetadata(r,r.currentSequenceNumber,s)));l.push(f)}return b.waitFor(l).next((()=>o.apply(r))).next((()=>t.localDocuments.getLocalViewOfDocuments(r,c,h))).next((()=>c))})).then((r=>(t.vs=i,r)))}function nR(n,e,t){let s=ee(),i=ee();return t.forEach((r=>s=s.add(r))),e.getEntries(n,s).next((r=>{let o=An();return t.forEach(((l,c)=>{const h=r.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),c.isNoDocument()&&c.version.isEqual(j.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):L(ru,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)})),{Bs:o,Ls:i}}))}function sR(n,e){const t=Z(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let i;return t.li.getTargetData(s,e).next((r=>r?(i=r,b.resolve(i)):t.li.allocateTargetId(s).next((o=>(i=new cn(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,i).next((()=>i)))))))})).then((s=>{const i=t.vs.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function Hl(n,e,t){const s=Z(n),i=s.vs.get(e),r=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",r,(o=>s.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Js(o))throw o;L(ru,`Failed to update sequence numbers for target ${e}: ${o}`)}s.vs=s.vs.remove(e),s.Fs.delete(i.target)}function ef(n,e,t){const s=Z(n);let i=j.min(),r=ee();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,f){const p=Z(c),m=p.Fs.get(f);return m!==void 0?b.resolve(p.vs.get(m)):p.li.getTargetData(h,f)})(s,o,Pt(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(o,l.targetId).next((c=>{r=c}))})).next((()=>s.Cs.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?r:ee()))).next((l=>(iR(s,GA(e),l),{documents:l,ks:r})))))}function iR(n,e,t){let s=n.Ms.get(e)||j.min();t.forEach(((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)})),n.Ms.set(e,s)}class tf{constructor(){this.activeTargetIds=ZA()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rR{constructor(){this.vo=new tf,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new tf,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oR{Mo(e){}shutdown(){}}const nf="ConnectivityMonitor";class sf{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){L(nf,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){L(nf,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Zr=null;function $l(){return Zr===null?Zr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Zr++,"0x"+Zr.toString(16)}const sl="RestConnection",aR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class lR{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${i}`,this.$o=this.databaseId.database===Mo?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Wo(e,t,s,i,r){const o=$l(),l=this.Qo(e,t.toUriEncodedString());L(sl,`Sending RPC '${e}' ${o}:`,l,s);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(c,i,r);const{host:h}=new URL(l),f=Rn(h);return this.zo(e,l,c,s,f).then((p=>(L(sl,`Received RPC '${e}' ${o}: `,p),p)),(p=>{throw Ms(sl,`RPC '${e}' ${o} failed with error: `,p,"url: ",l,"request:",s),p}))}jo(e,t,s,i,r,o){return this.Wo(e,t,s,i,r)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ys})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,r)=>e[r]=i)),s&&s.headers.forEach(((i,r)=>e[r]=i))}Qo(e,t){const s=aR[e];let i=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class cR{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const We="WebChannelConnection",Ai=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(i){setTimeout((()=>{throw i}),0)}}))};class Ps extends lR{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Ps.c_){const e=Bg();Ai(e,Ug.STAT_EVENT,(t=>{t.stat===kl.PROXY?L(We,"STAT_EVENT: detected buffering proxy"):t.stat===kl.NOPROXY&&L(We,"STAT_EVENT: detected no buffering proxy")})),Ps.c_=!0}}zo(e,t,s,i,r){const o=$l();return new Promise(((l,c)=>{const h=new Vg;h.setWithCredentials(!0),h.listenOnce(Fg.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case ao.NO_ERROR:const p=h.getResponseJson();L(We,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),l(p);break;case ao.TIMEOUT:L(We,`RPC '${e}' ${o} timed out`),c(new M(N.DEADLINE_EXCEEDED,"Request time out"));break;case ao.HTTP_ERROR:const m=h.getStatus();if(L(We,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);const S=A?.error;if(S&&S.status&&S.message){const P=(function(B){const W=B.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(W)>=0?W:N.UNKNOWN})(S.status);c(new M(P,S.message))}else c(new M(N.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new M(N.UNAVAILABLE,"Connection failed."));break;default:H(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{L(We,`RPC '${e}' ${o} completed.`)}}));const f=JSON.stringify(i);L(We,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,s,15)}))}T_(e,t,s){const i=$l(),r=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=r.join("");L(We,`Creating RPC '${e}' stream ${i}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,m=!1;const A=new cR({Ho:S=>{m?L(We,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(p||(L(We,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),L(We,`RPC '${e}' stream ${i} sending:`,S),f.send(S))},Jo:()=>f.close()});return Ai(f,ki.EventType.OPEN,(()=>{m||(L(We,`RPC '${e}' stream ${i} transport opened.`),A.i_())})),Ai(f,ki.EventType.CLOSE,(()=>{m||(m=!0,L(We,`RPC '${e}' stream ${i} transport closed`),A.o_(),this.E_(f))})),Ai(f,ki.EventType.ERROR,(S=>{m||(m=!0,Ms(We,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),A.o_(new M(N.UNAVAILABLE,"The operation could not be completed")))})),Ai(f,ki.EventType.MESSAGE,(S=>{if(!m){const P=S.data[0];ye(!!P,16349);const O=P,B=O?.error||O[0]?.error;if(B){L(We,`RPC '${e}' stream ${i} received error:`,B);const W=B.status;let K=(function(he){const I=Se[he];if(I!==void 0)return hm(I)})(W),ge=B.message;K===void 0&&(K=N.INTERNAL,ge="Unknown error status: "+W+" with message "+B.message),m=!0,A.o_(new M(K,ge)),f.close()}else L(We,`RPC '${e}' stream ${i} received:`,P),A.__(P)}})),Ps.u_(),setTimeout((()=>{A.s_()}),0),A}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return qg()}}function uR(n){return new Ps(n)}function il(){return typeof document<"u"?document:null}function Cm(n){return new _S(n,!0)}Ps.c_=!1;class Am{constructor(e,t,s=1e3,i=1.5,r=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=i,this.V_=r,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-s);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const rf="PersistentStream";class hR{constructor(e,t,s,i,r,o,l,c){this.Ci=e,this.b_=s,this.S_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Am(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(jt(t.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,i])=>{this.D_===t&&this.G_(s,i)}),(s=>{e((()=>{const i=new M(N.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(i)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((i=>{s((()=>this.z_(i)))})),this.stream.onMessage((i=>{s((()=>++this.F_==1?this.H_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(rf,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(L(rf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dR extends hR{constructor(e,t,s,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,i,o),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=TS(this.serializer,e),s=(function(r){if(!("targetChange"in r))return j.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?j.min():o.readTime?bs(o.readTime):j.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=Yd(this.serializer),t.addTarget=(function(r,o){let l;const c=o.target;if(l=Fl(c)?{documents:wS(r,c)}:{query:CS(r,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=vS(r,o.resumeToken);const h=Wl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(j.min())>0){l.readTime=yS(r,o.snapshotVersion.toTimestamp());const h=Wl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const s=SS(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=Yd(this.serializer),t.removeTarget=e,this.K_(t)}}class fR{}class pR extends fR{constructor(e,t,s,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new M(N.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Wo(e,jl(t,s),i,r,o))).catch((r=>{throw r.name==="FirebaseError"?(r.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new M(N.UNKNOWN,r.toString())}))}jo(e,t,s,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.jo(e,jl(t,s),i,o,l,r))).catch((o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new M(N.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function gR(n,e,t,s){return new pR(n,e,t,s)}class mR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(jt(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const qs="RemoteStore";class _R{constructor(e,t,s,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=r,this.Aa.Mo((o=>{s.enqueueAndForget((async()=>{Ir(this)&&(L(qs,"Restarting streams for network reachability change."),await(async function(c){const h=Z(c);h.Ea.add(4),await Er(h),h.Va.set("Unknown"),h.Ea.delete(4),await ma(h)})(this))}))})),this.Va=new mR(s,i)}}async function ma(n){if(Ir(n))for(const e of n.Ra)await e(!0)}async function Er(n){for(const e of n.Ra)await e(!1)}function Sm(n,e){const t=Z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),cu(t)?lu(t):Xs(t).O_()&&au(t,e))}function ou(n,e){const t=Z(n),s=Xs(t);t.Ia.delete(e),s.O_()&&Rm(t,e),t.Ia.size===0&&(s.O_()?s.L_():Ir(t)&&t.Va.set("Unknown"))}function au(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Xs(n).Z_(e)}function Rm(n,e){n.da.$e(e),Xs(n).X_(e)}function lu(n){n.da=new fS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Xs(n).start(),n.Va.ua()}function cu(n){return Ir(n)&&!Xs(n).x_()&&n.Ia.size>0}function Ir(n){return Z(n).Ea.size===0}function bm(n){n.da=void 0}async function yR(n){n.Va.set("Online")}async function vR(n){n.Ia.forEach(((e,t)=>{au(n,e)}))}async function ER(n,e){bm(n),cu(n)?(n.Va.ha(e),lu(n)):n.Va.set("Unknown")}async function IR(n,e,t){if(n.Va.set("Online"),e instanceof fm&&e.state===2&&e.cause)try{await(async function(i,r){const o=r.cause;for(const l of r.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.da.removeTarget(l))})(n,e)}catch(s){L(qs,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await of(n,s)}else if(e instanceof uo?n.da.Xe(e):e instanceof dm?n.da.st(e):n.da.tt(e),!t.isEqual(j.min()))try{const s=await wm(n.localStore);t.compareTo(s)>=0&&await(function(r,o){const l=r.da.Tt(o);return l.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=r.Ia.get(h);f&&r.Ia.set(h,f.withResumeToken(c.resumeToken,o))}})),l.targetMismatches.forEach(((c,h)=>{const f=r.Ia.get(c);if(!f)return;r.Ia.set(c,f.withResumeToken(qe.EMPTY_BYTE_STRING,f.snapshotVersion)),Rm(r,c);const p=new cn(f.target,c,h,f.sequenceNumber);au(r,p)})),r.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(s){L(qs,"Failed to raise snapshot:",s),await of(n,s)}}async function of(n,e,t){if(!Js(e))throw e;n.Ea.add(1),await Er(n),n.Va.set("Offline"),t||(t=()=>wm(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{L(qs,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ma(n)}))}async function af(n,e){const t=Z(n);t.asyncQueue.verifyOperationInProgress(),L(qs,"RemoteStore received new credentials");const s=Ir(t);t.Ea.add(3),await Er(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ma(t)}async function TR(n,e){const t=Z(n);e?(t.Ea.delete(2),await ma(t)):e||(t.Ea.add(2),await Er(t),t.Va.set("Unknown"))}function Xs(n){return n.ma||(n.ma=(function(t,s,i){const r=Z(t);return r.sa(),new dR(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)})(n.datastore,n.asyncQueue,{Zo:yR.bind(null,n),Yo:vR.bind(null,n),t_:ER.bind(null,n),J_:IR.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),cu(n)?lu(n):n.Va.set("Unknown")):(await n.ma.stop(),bm(n))}))),n.ma}class uu{constructor(e,t,s,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new Gn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,i,r){const o=Date.now()+s,l=new uu(e,t,o,i,r);return l.start(s),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pm(n,e){if(jt("AsyncQueue",`${e}: ${n}`),Js(n))return new M(N.UNAVAILABLE,`${e}: ${n}`);throw n}class ks{static emptySet(e){return new ks(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||F.comparator(t.key,s.key):(t,s)=>F.comparator(t.key,s.key),this.keyedMap=Ni(),this.sortedSet=new Ce(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ks)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new ks;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class lf{constructor(){this.ga=new Ce(F.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):H(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Ws{constructor(e,t,s,i,r,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,i,r){const o=[];return t.forEach((l=>{o.push({type:0,doc:l})})),new Ws(e,t,ks.emptySet(t),o,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ha(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==s[i].type||!t[i].doc.isEqual(s[i].doc))return!1;return!0}}class wR{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class CR{constructor(){this.queries=cf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const i=Z(t),r=i.queries;i.queries=cf(),r.forEach(((o,l)=>{for(const c of l.ba)c.onError(s)}))})(this,new M(N.ABORTED,"Firestore shutting down"))}}function cf(){return new os((n=>nm(n)),ha)}async function AR(n,e){const t=Z(n);let s=3;const i=e.query;let r=t.queries.get(i);r?!r.Sa()&&e.Da()&&(s=2):(r=new wR,s=e.Da()?0:1);try{switch(s){case 0:r.wa=await t.onListen(i,!0);break;case 1:r.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const l=Pm(o,`Initialization of query '${_s(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,r),r.ba.push(e),e.va(t.onlineState),r.wa&&e.Fa(r.wa)&&hu(t)}async function SR(n,e){const t=Z(n),s=e.query;let i=3;const r=t.queries.get(s);if(r){const o=r.ba.indexOf(e);o>=0&&(r.ba.splice(o,1),r.ba.length===0?i=e.Da()?0:1:!r.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function RR(n,e){const t=Z(n);let s=!1;for(const i of e){const r=i.query,o=t.queries.get(r);if(o){for(const l of o.ba)l.Fa(i)&&(s=!0);o.wa=i}}s&&hu(t)}function bR(n,e,t){const s=Z(n),i=s.queries.get(e);if(i)for(const r of i.ba)r.onError(t);s.queries.delete(e)}function hu(n){n.Ca.forEach((e=>{e.next()}))}var zl,uf;(uf=zl||(zl={})).Ma="default",uf.Cache="cache";class PR{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new Ws(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ws.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==zl.Cache}}class km{constructor(e){this.key=e}}class Nm{constructor(e){this.key=e}}class kR{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ee(),this.mutatedKeys=ee(),this.eu=sm(e),this.tu=new ks(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new lf,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,p)=>{const m=i.get(f),A=da(this.query,p)?p:null,S=!!m&&this.mutatedKeys.has(m.key),P=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let O=!1;m&&A?m.data.isEqual(A.data)?S!==P&&(s.track({type:3,doc:A}),O=!0):this.su(m,A)||(s.track({type:2,doc:A}),O=!0,(c&&this.eu(A,c)>0||h&&this.eu(A,h)<0)&&(l=!0)):!m&&A?(s.track({type:0,doc:A}),O=!0):m&&!A&&(s.track({type:1,doc:m}),O=!0,(c||h)&&(l=!0)),O&&(A?(o=o.add(A),r=P?r.add(f):r.delete(f)):(o=o.delete(f),r=r.delete(f)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),r=r.delete(f.key),s.track({type:1,doc:f})}return{tu:o,iu:s,Ss:l,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((f,p)=>(function(A,S){const P=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return H(20277,{Vt:O})}};return P(A)-P(S)})(f.type,p.type)||this.eu(f.doc,p.doc))),this.ou(s),i=i??!1;const l=t&&!i?this._u():[],c=this.Ya.size===0&&this.current&&!i?1:0,h=c!==this.Xa;return this.Xa=c,o.length!==0||h?{snapshot:new Ws(this.query,e.tu,r,o,e.mutatedKeys,c===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new lf,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ee(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Nm(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new km(s))})),t}cu(e){this.Za=e.ks,this.Ya=ee();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ws.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const du="SyncEngine";class NR{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class DR{constructor(e){this.key=e,this.hu=!1}}class OR{constructor(e,t,s,i,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new os((l=>nm(l)),ha),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ce(F.comparator),this.Au=new Map,this.Vu=new nu,this.du={},this.mu=new Map,this.fu=Bs.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function LR(n,e,t=!0){const s=Mm(n);let i;const r=s.Tu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.lu()):i=await Dm(s,e,t,!0),i}async function xR(n,e){const t=Mm(n);await Dm(t,e,!0,!1)}async function Dm(n,e,t,s){const i=await sR(n.localStore,Pt(e)),r=i.targetId,o=n.sharedClientState.addLocalQueryTarget(r,t);let l;return s&&(l=await MR(n,e,r,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Sm(n.remoteStore,i),l}async function MR(n,e,t,s,i){n.pu=(p,m,A)=>(async function(P,O,B,W){let K=O.view.ru(B);K.Ss&&(K=await ef(P.localStore,O.query,!1).then((({documents:I})=>O.view.ru(I,K))));const ge=W&&W.targetChanges.get(O.targetId),ue=W&&W.targetMismatches.get(O.targetId)!=null,he=O.view.applyChanges(K,P.isPrimaryClient,ge,ue);return df(P,O.targetId,he.au),he.snapshot})(n,p,m,A);const r=await ef(n.localStore,e,!0),o=new kR(e,r.ks),l=o.ru(r.documents),c=vr.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",i),h=o.applyChanges(l,n.isPrimaryClient,c);df(n,t,h.au);const f=new NR(e,t,o);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function VR(n,e,t){const s=Z(n),i=s.Tu.get(e),r=s.Iu.get(i.targetId);if(r.length>1)return s.Iu.set(i.targetId,r.filter((o=>!ha(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Hl(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),t&&ou(s.remoteStore,i.targetId),Gl(s,i.targetId)})).catch(oa)):(Gl(s,i.targetId),await Hl(s.localStore,i.targetId,!0))}async function FR(n,e){const t=Z(n),s=t.Tu.get(e),i=t.Iu.get(s.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),ou(t.remoteStore,s.targetId))}async function Om(n,e){const t=Z(n);try{const s=await tR(t.localStore,e);e.targetChanges.forEach(((i,r)=>{const o=t.Au.get(r);o&&(ye(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?ye(o.hu,14607):i.removedDocuments.size>0&&(ye(o.hu,42227),o.hu=!1))})),await xm(t,s,e)}catch(s){await oa(s)}}function hf(n,e,t){const s=Z(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const i=[];s.Tu.forEach(((r,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(o,l){const c=Z(o);c.onlineState=l;let h=!1;c.queries.forEach(((f,p)=>{for(const m of p.ba)m.va(l)&&(h=!0)})),h&&hu(c)})(s.eventManager,e),i.length&&s.Pu.J_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function UR(n,e,t){const s=Z(n);s.sharedClientState.updateQueryState(e,"rejected",t);const i=s.Au.get(e),r=i&&i.key;if(r){let o=new Ce(F.comparator);o=o.insert(r,$e.newNoDocument(r,j.min()));const l=ee().add(r),c=new ga(j.min(),new Map,new Ce(J),o,l);await Om(s,c),s.Ru=s.Ru.remove(r),s.Au.delete(e),fu(s)}else await Hl(s.localStore,e,!1).then((()=>Gl(s,e,t))).catch(oa)}function Gl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||Lm(n,s)}))}function Lm(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(ou(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),fu(n))}function df(n,e,t){for(const s of t)s instanceof km?(n.Vu.addReference(s.key,e),BR(n,s)):s instanceof Nm?(L(du,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||Lm(n,s.key)):H(19791,{wu:s})}function BR(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||(L(du,"New document in limbo: "+t),n.Eu.add(s),fu(n))}function fu(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new F(_e.fromString(e)),s=n.fu.next();n.Au.set(s,new DR(t)),n.Ru=n.Ru.insert(t,s),Sm(n.remoteStore,new cn(Pt(Xc(t.path)),s,"TargetPurposeLimboResolution",aa.ce))}}async function xm(n,e,t){const s=Z(n),i=[],r=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((l,c)=>{o.push(s.pu(c,e,t).then((h=>{if((h||t)&&s.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;s.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){i.push(h);const f=iu.Es(c.targetId,h);r.push(f)}})))})),await Promise.all(o),s.Pu.J_(i),await(async function(c,h){const f=Z(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>b.forEach(h,(m=>b.forEach(m.Ts,(A=>f.persistence.referenceDelegate.addReference(p,m.targetId,A))).next((()=>b.forEach(m.Is,(A=>f.persistence.referenceDelegate.removeReference(p,m.targetId,A)))))))))}catch(p){if(!Js(p))throw p;L(ru,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const A=f.vs.get(m),S=A.snapshotVersion,P=A.withLastLimboFreeSnapshotVersion(S);f.vs=f.vs.insert(m,P)}}})(s.localStore,r))}async function qR(n,e){const t=Z(n);if(!t.currentUser.isEqual(e)){L(du,"User change. New user:",e.toKey());const s=await Tm(t.localStore,e);t.currentUser=e,(function(r,o){r.mu.forEach((l=>{l.forEach((c=>{c.reject(new M(N.CANCELLED,o))}))})),r.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await xm(t,s.Ns)}}function WR(n,e){const t=Z(n),s=t.Au.get(e);if(s&&s.hu)return ee().add(s.key);{let i=ee();const r=t.Iu.get(e);if(!r)return i;for(const o of r){const l=t.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}function Mm(n){const e=Z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Om.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=WR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=UR.bind(null,e),e.Pu.J_=RR.bind(null,e.eventManager),e.Pu.yu=bR.bind(null,e.eventManager),e}class Wo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Cm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return eR(this.persistence,new JS,e.initialUser,this.serializer)}Cu(e){return new Im(su.Vi,this.serializer)}Du(e){return new rR}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Wo.provider={build:()=>new Wo};class jR extends Wo{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ye(this.persistence.referenceDelegate instanceof qo,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new MS(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ze.withCacheSize(this.cacheSizeBytes):Ze.DEFAULT;return new Im((s=>qo.Vi(s,t)),this.serializer)}}class Kl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>hf(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=qR.bind(null,this.syncEngine),await TR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new CR})()}createDatastore(e){const t=Cm(e.databaseInfo.databaseId),s=uR(e.databaseInfo);return gR(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,i,r,o,l){return new _R(s,i,r,o,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>hf(this.syncEngine,t,0)),(function(){return sf.v()?new sf:new oR})())}createSyncEngine(e,t){return(function(i,r,o,l,c,h,f){const p=new OR(i,r,o,l,c,h);return f&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=Z(t);L(qs,"RemoteStore shutting down."),s.Ea.add(5),await Er(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Kl.provider={build:()=>new Kl};class HR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):jt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Sn="FirestoreClient";class $R{constructor(e,t,s,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=i,this.user=je.UNAUTHENTICATED,this.clientId=Gc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,(async o=>{L(Sn,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(L(Sn,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Pm(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function rl(n,e){n.asyncQueue.verifyOperationInProgress(),L(Sn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async i=>{s.isEqual(i)||(await Tm(e.localStore,i),s=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ff(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zR(n);L(Sn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>af(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,i)=>af(e.remoteStore,i))),n._onlineComponents=e}async function zR(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(Sn,"Using user provided OfflineComponentProvider");try{await rl(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===N.FAILED_PRECONDITION||i.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Ms("Error using user provided cache. Falling back to memory cache: "+t),await rl(n,new Wo)}}else L(Sn,"Using default OfflineComponentProvider"),await rl(n,new jR(void 0));return n._offlineComponents}async function GR(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(Sn,"Using user provided OnlineComponentProvider"),await ff(n,n._uninitializedComponentsProvider._online)):(L(Sn,"Using default OnlineComponentProvider"),await ff(n,new Kl))),n._onlineComponents}async function KR(n){const e=await GR(n),t=e.eventManager;return t.onListen=LR.bind(null,e.syncEngine),t.onUnlisten=VR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=FR.bind(null,e.syncEngine),t}function QR(n,e,t={}){const s=new Gn;return n.asyncQueue.enqueueAndForget((async()=>(function(r,o,l,c,h){const f=new HR({next:m=>{f.Nu(),o.enqueueAndForget((()=>SR(r,p)));const A=m.docs.has(l);!A&&m.fromCache?h.reject(new M(N.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&m.fromCache&&c&&c.source==="server"?h.reject(new M(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new PR(Xc(l.path),f,{includeMetadataChanges:!0,Ka:!0});return AR(r,p)})(await KR(n),n.asyncQueue,e,t,s))),s.promise}function Vm(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const YR="ComponentProvider",pf=new Map;function JR(n,e,t,s,i){return new SA(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Vm(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,s)}const Fm="firestore.googleapis.com",gf=!0;class mf{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new M(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Fm,this.ssl=gf}else this.host=e.host,this.ssl=e.ssl??gf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Em;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LS)throw new M(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vm(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new M(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new M(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new M(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,i){return s.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pu{constructor(e,t,s,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new M(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mf(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new tA;switch(s.type){case"firstParty":return new rA(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new M(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=pf.get(t);s&&(L(YR,"Removing Datastore"),pf.delete(t),s.terminate())})(this),Promise.resolve()}}function XR(n,e,t,s={}){n=Dl(n,pu);const i=Rn(e),r=n._getSettings(),o={...r,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(Xl(`https://${l}`),Zl("Firestore",!0)),r.host!==Fm&&r.host!==l&&Ms("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...r,host:l,ssl:i,emulatorOptions:s};if(!_n(c,o)&&(n._setSettings(c),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=je.MOCK_USER;else{h=Lf(s.mockUserToken,n._app?.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new M(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new je(p)}n._authCredentials=new nA(new jg(h,f))}}class gu{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new gu(this.firestore,e,this._query)}}class Je{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ar(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Je(this.firestore,e,this._key)}toJSON(){return{type:Je._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(_r(t,Je._jsonSchema))return new Je(e,s||null,new F(_e.fromString(t.referencePath)))}}Je._jsonSchemaVersion="firestore/documentReference/1.0",Je._jsonSchema={type:be("string",Je._jsonSchemaVersion),referencePath:be("string")};class ar extends gu{constructor(e,t,s){super(e,t,Xc(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Je(this.firestore,null,new F(e))}withConverter(e){return new ar(this.firestore,e,this._path)}}function ZR(n,e,...t){if(n=Xe(n),arguments.length===1&&(e=Gc.newId()),hA("doc","path",e),n instanceof pu){const s=_e.fromString(e,...t);return bd(s),new Je(n,null,new F(s))}{if(!(n instanceof Je||n instanceof ar))throw new M(N.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(_e.fromString(e,...t));return bd(s),new Je(n.firestore,n instanceof ar?n.converter:null,new F(s))}}const _f="AsyncQueue";class yf{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Am(this,"async_queue_retry"),this._c=()=>{const s=il();s&&L(_f,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=il();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=il();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Gn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Js(e))throw e;L(_f,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,jt("INTERNAL UNHANDLED ERROR: ",vf(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=uu.createAndSchedule(this,e,t,s,(r=>this.hc(r)));return this.tc.push(i),i}uc(){this.nc&&H(47125,{Pc:vf(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function vf(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Um extends pu{constructor(e,t,s,i){super(e,t,s,i),this.type="firestore",this._queue=new yf,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yf(e),this._firestoreClient=void 0,await e}}}function eb(n,e){const t=typeof n=="object"?n:sc(),s=typeof n=="string"?n:Mo,i=Go(t,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=Nf("firestore");r&&XR(i,...r)}return i}function tb(n){if(n._terminated)throw new M(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||nb(n),n._firestoreClient}function nb(n){const e=n._freezeSettings(),t=JR(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new $R(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const r=i?._online.build();return{_offline:i?._offline.build(r),_online:r}})(n._componentsProvider))}class Ct{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ct(qe.fromBase64String(e))}catch(t){throw new M(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ct(qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ct._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(_r(e,Ct._jsonSchema))return Ct.fromBase64String(e.bytes)}}Ct._jsonSchemaVersion="firestore/bytes/1.0",Ct._jsonSchema={type:be("string",Ct._jsonSchemaVersion),bytes:be("string")};class Bm{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:gn._jsonSchemaVersion}}static fromJSON(e){if(_r(e,gn._jsonSchema))return new gn(e.latitude,e.longitude)}}gn._jsonSchemaVersion="firestore/geoPoint/1.0",gn._jsonSchema={type:be("string",gn._jsonSchemaVersion),latitude:be("number"),longitude:be("number")};class mn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:mn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(_r(e,mn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new mn(e.vectorValues);throw new M(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}mn._jsonSchemaVersion="firestore/vectorValue/1.0",mn._jsonSchema={type:be("string",mn._jsonSchemaVersion),vectorValues:be("object")};function qm(n,e,t){if((e=Xe(e))instanceof Bm)return e._internalPath;if(typeof e=="string")return ib(n,e);throw Ql("Field path arguments must be of type string or ",n)}const sb=new RegExp("[~\\*/\\[\\]]");function ib(n,e,t){if(e.search(sb)>=0)throw Ql(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new Bm(...e.split("."))._internalPath}catch{throw Ql(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function Ql(n,e,t,s,i){let r=`Function ${e}() called with invalid data`;r+=". ";let o="";return new M(N.INVALID_ARGUMENT,r+n+o)}class rb{convertValue(e,t="none"){switch(Cn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw H(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return yr(e,((i,r)=>{s[i]=this.convertValue(r,t)})),s}convertVectorValue(e){const t=e.fields?.[Ll].arrayValue?.values?.map((s=>we(s.doubleValue)));return new mn(t)}convertGeoPoint(e){return new gn(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=ca(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(ir(e));default:return null}}convertTimestamp(e){const t=Tn(e);return new Re(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=_e.fromString(e);ye(vm(s),9688,{name:e});const i=new rr(s.get(1),s.get(3)),r=new F(s.popFirst(5));return i.isEqual(t)||jt(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class ob extends rb{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ct(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Je(this.firestore,null,t)}}const Ef="@firebase/firestore",If="4.10.0";class Wm{constructor(e,t,s,i,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ab(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(qm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ab extends Wm{data(){return super.data()}}class Oi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Qn extends Wm{constructor(e,t,s,i,r,o){super(e,t,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ho(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(qm("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new M(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Qn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Qn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Qn._jsonSchema={type:be("string",Qn._jsonSchemaVersion),bundleSource:be("string","DocumentSnapshot"),bundleName:be("string"),bundle:be("string")};class ho extends Qn{data(e={}){return super.data(e)}}class $i{constructor(e,t,s,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Oi(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new ho(this._firestore,this._userDataWriter,s.key,s,new Oi(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,r){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((l=>{const c=new ho(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Oi(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>r||l.type!==3)).map((l=>{const c=new ho(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Oi(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:lb(l.type),doc:c,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new M(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$i._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Gc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],i=[];return this.docs.forEach((r=>{r._document!==null&&(t.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function lb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return H(61501,{type:n})}}$i._jsonSchemaVersion="firestore/querySnapshot/1.0",$i._jsonSchema={type:be("string",$i._jsonSchemaVersion),bundleSource:be("string","QuerySnapshot"),bundleName:be("string"),bundle:be("string")};function cb(n){n=Dl(n,Je);const e=Dl(n.firestore,Um),t=tb(e);return QR(t,n._key).then((s=>ub(e,n,s)))}function ub(n,e,t){const s=t.docs.get(e._key),i=new ob(n);return new Qn(n,i,e._key,s,new Oi(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){eA(ss),Yn(new yn("firestore",((s,{instanceIdentifier:i,options:r})=>{const o=s.getProvider("app").getImmediate(),l=new Um(new sA(s.getProvider("auth-internal")),new oA(o,s.getProvider("app-check-internal")),RA(o,i),o);return r={useFetchStreams:t,...r},l._setSettings(r),l}),"PUBLIC").setMultipleInstances(!0)),St(Ef,If,e),St(Ef,If,"esm2020")})();const hb={apiKey:"AIzaSyBpKsDGhucKO_QbNgjXG3vX1vuduYl8xy4",authDomain:"shopping-list-e939f.firebaseapp.com",databaseURL:"https://shopping-list-e939f-default-rtdb.firebaseio.com/",projectId:"shopping-list-e939f",storageBucket:"shopping-list-e939f.appspot.com"},mu=Uf(hb),eo=UT(mu),Tf=XC(mu),db=eb(mu);var fb=Dt('<link rel="preconnect" href="https://fonts.googleapis.com" class="svelte-1uha8ag"/> <link rel="preconnect" href="https://fonts.gstatic.com" class="svelte-1uha8ag"/> <link href="https://fonts.googleapis.com/css2?family=Playwrite+US+Modern:wght@100&amp;display=swap" rel="stylesheet" class="svelte-1uha8ag"/>',1),pb=Dt('<p class="user-name show svelte-1uha8ag"> </p> <p class="logout-link show svelte-1uha8ag">Logout</p>',1),gb=Dt('<li><span class="item svelte-1uha8ag"> </span> <span class="quantity svelte-1uha8ag"> </span> <span class="user svelte-1uha8ag"> </span></li>'),mb=Dt('<p class="empty-list svelte-1uha8ag">Loading shopping list...</p>'),_b=Dt('<p class="empty-list svelte-1uha8ag">Shopping List is Empty</p>'),yb=Dt('<div class="delete-all-container svelte-1uha8ag"><button class="delete-all-btn svelte-1uha8ag"> </button></div>'),vb=Dt('<div class="row svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="item-input" type="text" placeholder="Item to buy" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="quantity-input" type="text" placeholder="Quantity to buy" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-add-button svelte-1uha8ag"></button></div></div> <ul class="list-container svelte-1uha8ag"><!> <!></ul> <!>',1),Eb=Dt('<div class="confirm-delete-overlay svelte-1uha8ag"><div class="confirm-delete-modal svelte-1uha8ag"><h3 class="svelte-1uha8ag">Delete selected items?</h3> <p class="svelte-1uha8ag"> </p> <div class="confirm-buttons svelte-1uha8ag"><button class="confirm-yes svelte-1uha8ag"> </button> <button class="confirm-no svelte-1uha8ag">Cancel</button></div></div></div>'),Ib=Dt('<div class="error-banner svelte-1uha8ag"> <button class="error-close svelte-1uha8ag">x</button></div>'),Tb=Dt('<!> <div><div class="modal svelte-1uha8ag"><h3 class="login-title svelte-1uha8ag">Login</h3> <div class="modal-input-container svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="email-input" type="email" placeholder="Email Address" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="password-input" type="password" placeholder="Password" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-login-button svelte-1uha8ag">Login</button></div></div></div></div> <div class="container svelte-1uha8ag"><div class="shopping-app svelte-1uha8ag"><div class="user-login-container svelte-1uha8ag"><p>Login</p> <!></div> <h2 class="svelte-1uha8ag">Shopping List <img src="/icons/shopping-list.png" alt="" class="svelte-1uha8ag"/></h2> <!></div></div> <!> <!> <footer class="svelte-1uha8ag"><a href="https://www.flaticon.com/free-icons/checklist" title="checklist icons" class="svelte-1uha8ag">Icons created by Freepik - Flaticon</a></footer>',1);function Db(n,e){O_(e,!1);let t=!1,s=Qe([]),i=Qe(!1),r=null,o=Qe(!1),l=Qe(!1),c=Qe(!1),h=Qe(""),f=Qe({}),p=Qe(!0);f_(()=>{const V=Gr(eo,"items"),ne=NT(V,se=>{const Oe=se.val()||{};le(f,Object.assign({},Oe)),le(p,!1),le(f,x(f))});return()=>ne()});let m=Qe(""),A=Qe(""),S=Qe(""),P=Qe(!1),O=Qe(""),B=Qe("");const W=async V=>{const ne=x(f)[V];if(!ne)return;const se=Gr(eo,`items/${V}`);await Al(se,{...ne,checked:!ne.checked})},K=async()=>{if(!(!x(O)||!x(B)||!r)){t=!0;try{const V=bT(Gr(eo,"items"));await Al(V,{itemId:V.key,item:x(O),quantity:x(B),user:x(S),checked:!1}),le(O,""),le(B,""),document.querySelector('input[type="text"]:first-of-type')?.focus()}catch(V){console.error("Add failed:",V)}finally{t=!1}}},ge=async V=>{const ne=ZR(db,"users",V);try{const se=await cb(ne);if(se.exists())return se.data().user;throw new Error("User document does not exist")}catch(se){throw console.error("Error fetching user document:",se),se}},ue=async()=>{if(!(!x(m)||!x(A))){t=!0;try{const V=await Uw(Tf,x(m),x(A));r={uid:V.user.uid,email:V.user.email,displayName:V.user.displayName},le(S,await ge(V.user.uid)),le(P,!0),le(l,!1)}catch(V){alert("Login failed: "+V.message)}finally{t=!1}}},he=async()=>{await Tf.signOut(),le(P,!1),r=null,le(S,"")},I=async()=>{le(c,!0);try{await Promise.all(x(s).map(V=>PT(Gr(eo,`items/${V}`)))),le(s,[]),le(o,!1)}catch(V){console.error("Delete failed:",V)}finally{le(c,!1)}};function _(V){V.key==="Enter"&&!t&&(V.preventDefault(),K())}Ma(()=>x(f),()=>{le(s,Object.values(x(f)).filter(V=>V.checked).map(V=>V.itemId))}),Ma(()=>x(s),()=>{le(i,x(s).length>0)}),Ma(()=>x(s),()=>{le(i,x(s).length>0)}),L_(),d_();var v=Tb();F_("1uha8ag",V=>{var ne=fb();ch(4),M_(()=>{V_.title="Shopping List"}),ht(V,ne)});var T=Wr(v);H_(T,e,"default",{});var E=Te(T,2);let C;var y=re(E),Fe=Te(re(y),2),lt=re(Fe),Tr=re(lt);jr(Tr),oe(lt);var Zs=Te(lt,2),kn=re(Zs);jr(kn),oe(Zs);var Nn=Te(Zs,2),_a=re(Nn);oe(Nn),oe(Fe),oe(y),oe(E);var as=Te(E,2),ei=re(as),ls=re(ei),zt=re(ls);let cs;var ti=Te(zt,2);{var ni=V=>{var ne=pb(),se=Wr(ne),Oe=re(se,!0);oe(se);var vt=Te(se,2);Bn(()=>Zt(Oe,x(S))),ot("click",vt,he),ht(V,ne)};qn(ti,V=>{x(P)&&V(ni)})}oe(ls);var si=Te(ls,4);{var wr=V=>{var ne=vb(),se=Wr(ne),Oe=re(se),vt=re(Oe);jr(vt),oe(Oe);var me=Te(Oe,2),de=re(me);jr(de),oe(me);var Ot=Te(me,2),Dn=re(Ot);Dn.textContent="Add",oe(Ot),oe(se);var us=Te(se,2),Sr=re(us);q_(Sr,1,()=>(x(f),dt(()=>Object.values(x(f)))),Ae=>Ae.itemId,(Ae,ve)=>{var Ge=gb();let rt;var ct=re(Ge),Ln=re(ct,!0);oe(ct);var ut=Te(ct,2),Pr=re(ut,!0);oe(ut);var xn=Te(ut,2),kr=re(xn,!0);oe(xn),oe(Ge),Bn(()=>{U_(Ge,"data-item-id",(x(ve),dt(()=>x(ve).itemId))),rt=Va(Ge,1,"svelte-1uha8ag",null,rt,{checked:x(ve).checked}),Zt(Ln,(x(ve),dt(()=>x(ve).item))),Zt(Pr,(x(ve),dt(()=>x(ve).quantity))),Zt(kr,(x(ve),dt(()=>x(ve).user)))}),ot("click",Ge,()=>W(x(ve).itemId)),ht(Ae,Ge)});var On=Te(Sr,2);{var Rr=Ae=>{var ve=mb();ht(Ae,ve)},br=Ae=>{var ve=h_(),Ge=Wr(ve);{var rt=ct=>{var Ln=_b();ht(ct,Ln)};qn(Ge,ct=>{x(f),dt(()=>Object.keys(x(f)).length===0)&&ct(rt)},!0)}ht(Ae,ve)};qn(On,Ae=>{x(p)?Ae(Rr):Ae(br,!1)})}oe(us);var ri=Te(us,2);{var va=Ae=>{var ve=yb(),Ge=re(ve),rt=re(Ge);oe(Ge),oe(ve),Bn(()=>Zt(rt,`Delete ${x(s),dt(()=>x(s).length)??""} selected item${x(s),dt(()=>x(s).length===1?"":"s")??""}`)),ot("click",Ge,()=>le(o,!0)),ht(Ae,ve)};qn(ri,Ae=>{x(i)&&!x(p)&&Ae(va)})}Bn(()=>Dn.disabled=!x(O)||!x(B)),Hr(vt,()=>x(O),Ae=>le(O,Ae)),ot("keydown",vt,_),Hr(de,()=>x(B),Ae=>le(B,Ae)),ot("keydown",de,_),ot("click",Dn,K),ht(V,ne)};qn(si,V=>{x(P)&&V(wr)})}oe(ei),oe(as);var Cr=Te(as,2);{var ya=V=>{var ne=Eb(),se=re(ne),Oe=Te(re(se),2),vt=re(Oe);oe(Oe);var me=Te(Oe,2),de=re(me),Ot=re(de,!0);oe(de);var Dn=Te(de,2);oe(me),oe(se),oe(ne),Bn(()=>{Zt(vt,`This will delete ${x(s),dt(()=>x(s).length)??""} item${x(s),dt(()=>x(s).length===1?"":"s")??""}`),de.disabled=x(c),Zt(Ot,x(c)?"Deleting...":"Yes, Delete")}),ot("click",de,I),ot("click",Dn,()=>le(o,!1)),ot("click",ne,()=>le(o,!1)),ht(V,ne)};qn(Cr,V=>{x(o)&&V(ya)})}var Ar=Te(Cr,2);{var ii=V=>{var ne=Ib(),se=re(ne),Oe=Te(se);oe(ne),Bn(()=>Zt(se,`Something went wrong: ${x(h)??""} `)),ot("click",Oe,()=>le(h,"")),ht(V,ne)};qn(Ar,V=>{x(h)&&V(ii)})}ch(2),Bn(()=>{C=Va(E,1,"login-box svelte-1uha8ag",null,C,{show:x(l)}),cs=Va(zt,1,"login-link svelte-1uha8ag",null,cs,{hidden:x(P)})}),Hr(Tr,()=>x(m),V=>le(m,V)),Hr(kn,()=>x(A),V=>le(A,V)),ot("click",_a,ue),ot("click",zt,()=>le(l,!0)),ht(n,v),x_()}export{Db as component};
