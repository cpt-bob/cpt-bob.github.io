import{a as at,f as Pt,c as d_}from"../chunks/Br4E3ShE.js";import{i as f_}from"../chunks/CanCaOBf.js";import{w as p_,o as g_}from"../chunks/En7bii37.js";import{h as Ot,g as wf,f as m_,u as x,i as __,H as y_,j as rh,k as oh,l as Va,e as zr,C as v_,az as E_,ak as ah,c as Es,b as ll,s as I_,aM as T_,aT as w_,ax as Zl,aU as C_,a8 as lh,aV as A_,aW as S_,q as Pe,a as ch,aX as on,r as Cf,p as Af,aY as Fa,aZ as R_,aw as b_,d as P_,x as k_,a_ as N_,aQ as D_,J as lt,a6 as O_,a$ as x_,R as L_,b0 as qn,b1 as M_,S as Gr,T as Wn,U as V_,aB as F_,V as oe,v as Z,al as uh,b2 as U_,X as Ie,W as ae}from"../chunks/DI0brUTC.js";import{e as Xe,s as Dt}from"../chunks/4K3R7E5w.js";import{i as jn,s as B_,a as q_}from"../chunks/QMA1sQw4.js";import{h as W_,r as Kr,s as j_}from"../chunks/B-iSqTxH.js";function H_(n,e,t){for(var s=[],i=e.length,r,o=e.length,l=0;l<i;l++){let p=e[l];Af(p,()=>{if(r){if(r.pending.delete(p),r.done.add(p),r.pending.size===0){var m=n.outrogroups;cl(Zl(r.done)),m.delete(r),m.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=s.length===0&&t!==null;if(c){var h=t,f=h.parentNode;b_(f),f.append(h),n.items.clear()}cl(e,!c)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function cl(n,e=!0){for(var t=0;t<n.length;t++)P_(n[t],e)}var hh;function $_(n,e,t,s,i,r=null){var o=n,l=new Map;Ot&&wf();var c=null,h=T_(()=>{var P=t();return w_(P)?P:P==null?[]:Zl(P)}),f,p=!0;function m(){S.fallback=c,z_(S,f,o,e,s),c!==null&&(f.length===0?(c.f&on)===0?Cf(c):(c.f^=on,ki(c,null,o)):Af(c,()=>{c=null}))}var A=m_(()=>{f=x(h);var P=f.length;let O=!1;if(Ot){var W=__(o)===y_;W!==(P===0)&&(o=rh(),oh(o),Va(!1),O=!0)}for(var B=new Set,z=Es,re=I_(),se=0;se<P;se+=1){Ot&&zr.nodeType===v_&&zr.data===E_&&(o=zr,O=!0,Va(!1));var de=f[se],E=s(de,se),_=p?null:l.get(E);_?(_.v&&ah(_.v,de),_.i&&ah(_.i,se),re&&z.skipped_effects.delete(_.e)):(_=G_(l,p?o:hh??=ch(),de,E,se,i,e,t),p||(_.e.f|=on),l.set(E,_)),B.add(E)}if(P===0&&r&&!c&&(p?c=ll(()=>r(o)):(c=ll(()=>r(hh??=ch())),c.f|=on)),Ot&&P>0&&oh(rh()),!p)if(re){for(const[v,T]of l)B.has(v)||z.skipped_effects.add(T.e);z.oncommit(m),z.ondiscard(()=>{})}else m();O&&Va(!0),x(h)}),S={effect:A,items:l,outrogroups:null,fallback:c};p=!1,Ot&&(o=zr)}function Ci(n){for(;n!==null&&(n.f&R_)===0;)n=n.next;return n}function z_(n,e,t,s,i){var r=e.length,o=n.items,l=Ci(n.effect.first),c,h=null,f=[],p=[],m,A,S,P;for(P=0;P<r;P+=1){if(m=e[P],A=i(m,P),S=o.get(A).e,n.outrogroups!==null)for(const _ of n.outrogroups)_.pending.delete(S),_.done.delete(S);if((S.f&on)!==0)if(S.f^=on,S===l)ki(S,null,t);else{var O=h?h.next:l;S===n.effect.last&&(n.effect.last=S.prev),S.prev&&(S.prev.next=S.next),S.next&&(S.next.prev=S.prev),Zt(n,h,S),Zt(n,S,O),ki(S,O,t),h=S,f=[],p=[],l=Ci(h.next);continue}if((S.f&Fa)!==0&&Cf(S),S!==l){if(c!==void 0&&c.has(S)){if(f.length<p.length){var W=p[0],B;h=W.prev;var z=f[0],re=f[f.length-1];for(B=0;B<f.length;B+=1)ki(f[B],W,t);for(B=0;B<p.length;B+=1)c.delete(p[B]);Zt(n,z.prev,re.next),Zt(n,h,z),Zt(n,re,W),l=W,h=re,P-=1,f=[],p=[]}else c.delete(S),ki(S,l,t),Zt(n,S.prev,S.next),Zt(n,S,h===null?n.effect.first:h.next),Zt(n,h,S),h=S;continue}for(f=[],p=[];l!==null&&l!==S;)(c??=new Set).add(l),p.push(l),l=Ci(l.next);if(l===null)continue}(S.f&on)===0&&f.push(S),h=S,l=Ci(S.next)}if(n.outrogroups!==null){for(const _ of n.outrogroups)_.pending.size===0&&(cl(Zl(_.done)),n.outrogroups?.delete(_));n.outrogroups.size===0&&(n.outrogroups=null)}if(l!==null||c!==void 0){var se=[];if(c!==void 0)for(S of c)(S.f&Fa)===0&&se.push(S);for(;l!==null;)(l.f&Fa)===0&&l!==n.fallback&&se.push(l),l=Ci(l.next);var de=se.length;if(de>0){var E=null;H_(n,se,E)}}}function G_(n,e,t,s,i,r,o,l){var c=(o&A_)!==0?(o&S_)===0?Pe(t,!1,!1):lh(t):null,h=(o&C_)!==0?lh(i):null;return{v:c,i:h,e:ll(()=>(r(e,c??t,h??i,l),()=>{n.delete(s)}))}}function ki(n,e,t){if(n.nodes)for(var s=n.nodes.start,i=n.nodes.end,r=e&&(e.f&on)===0?e.nodes.start:t;s!==null;){var o=k_(s);if(r.before(s),s===i)return;s=o}}function Zt(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function K_(n,e,t,s,i){Ot&&wf();var r=e.$$slots?.[t],o=!1;r===!0&&(r=e.children,o=!0),r===void 0||r(n,o?()=>s:s)}const dh=[...` 	
\r\fÂ \v\uFEFF`];function Q_(n,e,t){var s=n==null?"":""+n;if(t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var r=i.length,o=0;(o=s.indexOf(i,o))>=0;){var l=o+r;(o===0||dh.includes(s[o-1]))&&(l===s.length||dh.includes(s[l]))?s=(o===0?"":s.substring(0,o))+s.substring(l+1):o=l}}return s===""?null:s}function Ua(n,e,t,s,i,r){var o=n.__className;if(Ot||o!==t||o===void 0){var l=Q_(t,s,r);(!Ot||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}else if(r&&i!==r)for(var c in r){var h=!!r[c];(i==null||h!==!!i[c])&&n.classList.toggle(c,h)}return r}function Qr(n,e,t=e){var s=new WeakSet;N_(n,"input",async i=>{var r=i?n.defaultValue:n.value;if(r=Ba(n)?qa(r):r,t(r),Es!==null&&s.add(Es),await D_(),r!==(r=e())){var o=n.selectionStart,l=n.selectionEnd,c=n.value.length;if(n.value=r??"",l!==null){var h=n.value.length;o===l&&l===c&&h>c?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=o,n.selectionEnd=Math.min(l,h))}}}),(Ot&&n.defaultValue!==n.value||lt(e)==null&&n.value)&&(t(Ba(n)?qa(n.value):n.value),Es!==null&&s.add(Es)),O_(()=>{var i=e();if(n===document.activeElement){var r=x_??Es;if(s.has(r))return}Ba(n)&&i===qa(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Ba(n){var e=n.type;return e==="number"||e==="range"}function qa(n){return n===""?null:+n}const Y_=()=>{};var fh={};const Sf={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const k=function(n,e){if(!n)throw Ks(e)},Ks=function(n){return new Error("Firebase Database ("+Sf.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Rf=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},J_=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],l=n[t++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},ec={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,f=r>>2,p=(r&3)<<4|l>>4;let m=(l&15)<<2|h>>6,A=h&63;c||(A=64,o||(m=64)),s.push(t[f],t[p],t[m],t[A])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Rf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):J_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||l==null||h==null||p==null)throw new X_;const m=r<<2|l>>4;if(s.push(m),h!==64){const A=l<<4&240|h>>2;if(s.push(A),p!==64){const S=h<<6&192|p;s.push(S)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class X_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bf=function(n){const e=Rf(n);return ec.encodeByteArray(e,!0)},yo=function(n){return bf(n).replace(/\./g,"")},vo=function(n){try{return ec.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Z_(n){return Pf(void 0,n)}function Pf(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!ey(t)||(n[t]=Pf(n[t],e[t]));return n}function ey(n){return n!=="__proto__"}function ty(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ny=()=>ty().__FIREBASE_DEFAULTS__,sy=()=>{if(typeof process>"u"||typeof fh>"u")return;const n=fh.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},iy=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&vo(n[1]);return e&&JSON.parse(e)},Ko=()=>{try{return Y_()||ny()||sy()||iy()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},kf=n=>Ko()?.emulatorHosts?.[n],Nf=n=>{const e=kf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Df=()=>Ko()?.config,Of=n=>Ko()?.[`_${n}`];class Qo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Sn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tc(n){return(await fetch(n,{credentials:"include"})).ok}function xf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[yo(JSON.stringify(t)),yo(JSON.stringify(o)),""].join(".")}const Fi={};function ry(){const n={prod:[],emulator:[]};for(const e of Object.keys(Fi))Fi[e]?n.emulator.push(e):n.prod.push(e);return n}function oy(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ph=!1;function nc(n,e){if(typeof window>"u"||typeof document>"u"||!Sn(window.location.host)||Fi[n]===e||Fi[n]||ph)return;Fi[n]=e;function t(m){return`__firebase__banner__${m}`}const s="__firebase__banner",r=ry().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,A){m.setAttribute("width","24"),m.setAttribute("id",A),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{ph=!0,o()},m}function f(m,A){m.setAttribute("id",A),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=oy(s),A=t("text"),S=document.getElementById(A)||document.createElement("span"),P=t("learnmore"),O=document.getElementById(P)||document.createElement("a"),W=t("preprendIcon"),B=document.getElementById(W)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const z=m.element;l(z),f(O,P);const re=h();c(B,W),z.append(B,S,O,re),document.body.appendChild(z)}r?(S.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ge())}function ay(){const n=Ko()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ly(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function cy(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Lf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function uy(){const n=Ge();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function hy(){return Sf.NODE_ADMIN===!0}function dy(){return!ay()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fy(){try{return typeof indexedDB=="object"}catch{return!1}}function py(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const gy="FirebaseError";class jt extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=gy,Object.setPrototypeOf(this,jt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dr.prototype.create)}}class dr{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?my(r,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new jt(i,l,s)}}function my(n,e){return n.replace(_y,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const _y=/\{\$([^}]+)}/g;function Yi(n){return JSON.parse(n)}function Me(n){return JSON.stringify(n)}const Mf=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=Yi(vo(r[0])||""),t=Yi(vo(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},yy=function(n){const e=Mf(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},vy=function(n){const e=Mf(n).claims;return typeof e=="object"&&e.admin===!0};function Ht(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ms(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ul(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Eo(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function mn(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(gh(r)&&gh(o)){if(!mn(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function gh(n){return n!==null&&typeof n=="object"}function Qs(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Ni(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function Di(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class Ey{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)s[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)s[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const m=s[p-3]^s[p-8]^s[p-14]^s[p-16];s[p]=(m<<1|m>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],h,f;for(let p=0;p<80;p++){p<40?p<20?(h=l^r&(o^l),f=1518500249):(h=r^o^l,f=1859775393):p<60?(h=r&o|l&(r|o),f=2400959708):(h=r^o^l,f=3395469782);const m=(i<<5|i>>>27)+h+c+f+s[p]&4294967295;c=l,l=o,o=(r<<30|r>>>2)&4294967295,r=i,i=m}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function Iy(n,e){const t=new Ty(n,e);return t.subscribe.bind(t)}class Ty{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");wy(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=Wa),i.error===void 0&&(i.error=Wa),i.complete===void 0&&(i.complete=Wa);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wy(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Wa(){}function ic(n,e){return`${n} failed: ${e} argument `}const Cy=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,k(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Yo=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function Ke(n){return n&&n._delegate?n._delegate:n}class _n{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Hn="[DEFAULT]";class Ay{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Qo;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ry(e))try{this.getOrInitializeService({instanceIdentifier:Hn})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Hn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Hn){return this.instances.has(e)}getOptions(e=Hn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Sy(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Hn){return this.component?this.component.multipleInstances?e:Hn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Sy(n){return n===Hn?void 0:n}function Ry(n){return n.instantiationMode==="EAGER"}class by{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ay(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Y;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Y||(Y={}));const Py={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},ky=Y.INFO,Ny={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Dy=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=Ny[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Jo{constructor(e){this.name=e,this._logLevel=ky,this._logHandler=Dy,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Py[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const Oy=(n,e)=>e.some(t=>n instanceof t);let mh,_h;function xy(){return mh||(mh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ly(){return _h||(_h=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vf=new WeakMap,hl=new WeakMap,Ff=new WeakMap,ja=new WeakMap,rc=new WeakMap;function My(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(cn(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Vf.set(t,n)}).catch(()=>{}),rc.set(e,n),e}function Vy(n){if(hl.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});hl.set(n,e)}let dl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return hl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ff.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return cn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Fy(n){dl=n(dl)}function Uy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Ha(this),e,...t);return Ff.set(s,e.sort?e.sort():[e]),cn(s)}:Ly().includes(n)?function(...e){return n.apply(Ha(this),e),cn(Vf.get(this))}:function(...e){return cn(n.apply(Ha(this),e))}}function By(n){return typeof n=="function"?Uy(n):(n instanceof IDBTransaction&&Vy(n),Oy(n,xy())?new Proxy(n,dl):n)}function cn(n){if(n instanceof IDBRequest)return My(n);if(ja.has(n))return ja.get(n);const e=By(n);return e!==n&&(ja.set(n,e),rc.set(e,n)),e}const Ha=n=>rc.get(n);function qy(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),l=cn(o);return s&&o.addEventListener("upgradeneeded",c=>{s(cn(o.result),c.oldVersion,c.newVersion,cn(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const Wy=["get","getKey","getAll","getAllKeys","count"],jy=["put","add","delete","clear"],$a=new Map;function yh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if($a.get(e))return $a.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=jy.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Wy.includes(t)))return;const r=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let h=c.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&c.done]))[0]};return $a.set(e,r),r}Fy(n=>({...n,get:(e,t,s)=>yh(e,t)||n.get(e,t,s),has:(e,t)=>!!yh(e,t)||n.has(e,t)}));class Hy{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($y(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function $y(n){return n.getComponent()?.type==="VERSION"}const fl="@firebase/app",vh="0.14.7";const Ft=new Jo("@firebase/app"),zy="@firebase/app-compat",Gy="@firebase/analytics-compat",Ky="@firebase/analytics",Qy="@firebase/app-check-compat",Yy="@firebase/app-check",Jy="@firebase/auth",Xy="@firebase/auth-compat",Zy="@firebase/database",ev="@firebase/data-connect",tv="@firebase/database-compat",nv="@firebase/functions",sv="@firebase/functions-compat",iv="@firebase/installations",rv="@firebase/installations-compat",ov="@firebase/messaging",av="@firebase/messaging-compat",lv="@firebase/performance",cv="@firebase/performance-compat",uv="@firebase/remote-config",hv="@firebase/remote-config-compat",dv="@firebase/storage",fv="@firebase/storage-compat",pv="@firebase/firestore",gv="@firebase/ai",mv="@firebase/firestore-compat",_v="firebase",yv="12.8.0";const pl="[DEFAULT]",vv={[fl]:"fire-core",[zy]:"fire-core-compat",[Ky]:"fire-analytics",[Gy]:"fire-analytics-compat",[Yy]:"fire-app-check",[Qy]:"fire-app-check-compat",[Jy]:"fire-auth",[Xy]:"fire-auth-compat",[Zy]:"fire-rtdb",[ev]:"fire-data-connect",[tv]:"fire-rtdb-compat",[nv]:"fire-fn",[sv]:"fire-fn-compat",[iv]:"fire-iid",[rv]:"fire-iid-compat",[ov]:"fire-fcm",[av]:"fire-fcm-compat",[lv]:"fire-perf",[cv]:"fire-perf-compat",[uv]:"fire-rc",[hv]:"fire-rc-compat",[dv]:"fire-gcs",[fv]:"fire-gcs-compat",[pv]:"fire-fst",[mv]:"fire-fst-compat",[gv]:"fire-vertex","fire-js":"fire-js",[_v]:"fire-js-all"};const Io=new Map,Ev=new Map,gl=new Map;function Eh(n,e){try{n.container.addComponent(e)}catch(t){Ft.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Xn(n){const e=n.name;if(gl.has(e))return Ft.debug(`There were multiple attempts to register component ${e}.`),!1;gl.set(e,n);for(const t of Io.values())Eh(t,n);for(const t of Ev.values())Eh(t,n);return!0}function Xo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ot(n){return n==null?!1:n.settings!==void 0}const Iv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},un=new dr("app","Firebase",Iv);class Tv{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new _n("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw un.create("app-deleted",{appName:this._name})}}const rs=yv;function Uf(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:pl,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw un.create("bad-app-name",{appName:String(i)});if(t||(t=Df()),!t)throw un.create("no-options");const r=Io.get(i);if(r){if(mn(t,r.options)&&mn(s,r.config))return r;throw un.create("duplicate-app",{appName:i})}const o=new by(i);for(const c of gl.values())o.addComponent(c);const l=new Tv(t,s,o);return Io.set(i,l),l}function oc(n=pl){const e=Io.get(n);if(!e&&n===pl&&Df())return Uf();if(!e)throw un.create("no-app",{appName:n});return e}function wt(n,e,t){let s=vv[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ft.warn(o.join(" "));return}Xn(new _n(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const wv="firebase-heartbeat-database",Cv=1,Ji="firebase-heartbeat-store";let za=null;function Bf(){return za||(za=qy(wv,Cv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ji)}catch(t){console.warn(t)}}}}).catch(n=>{throw un.create("idb-open",{originalErrorMessage:n.message})})),za}async function Av(n){try{const t=(await Bf()).transaction(Ji),s=await t.objectStore(Ji).get(qf(n));return await t.done,s}catch(e){if(e instanceof jt)Ft.warn(e.message);else{const t=un.create("idb-get",{originalErrorMessage:e?.message});Ft.warn(t.message)}}}async function Ih(n,e){try{const s=(await Bf()).transaction(Ji,"readwrite");await s.objectStore(Ji).put(e,qf(n)),await s.done}catch(t){if(t instanceof jt)Ft.warn(t.message);else{const s=un.create("idb-set",{originalErrorMessage:t?.message});Ft.warn(s.message)}}}function qf(n){return`${n.name}!${n.options.appId}`}const Sv=1024,Rv=30;class bv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new kv(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Th();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Rv){const i=Nv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ft.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Th(),{heartbeatsToSend:t,unsentEntries:s}=Pv(this._heartbeatsCache.heartbeats),i=yo(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ft.warn(e),""}}}function Th(){return new Date().toISOString().substring(0,10)}function Pv(n,e=Sv){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),wh(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),wh(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class kv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fy()?py().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Av(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ih(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ih(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function wh(n){return yo(JSON.stringify({version:2,heartbeats:n})).length}function Nv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Dv(n){Xn(new _n("platform-logger",e=>new Hy(e),"PRIVATE")),Xn(new _n("heartbeat",e=>new bv(e),"PRIVATE")),wt(fl,vh,n),wt(fl,vh,"esm2020"),wt("fire-js","")}Dv("");var Ov="firebase",xv="12.8.0";wt(Ov,xv,"app");var Ch={};const Ah="@firebase/database",Sh="1.1.0";let Wf="";function Lv(n){Wf=n}class Mv{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Me(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Yi(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Vv{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ht(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const jf=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Mv(e)}}catch{}return new Vv},zn=jf("localStorage"),Fv=jf("sessionStorage");const Rs=new Jo("@firebase/database"),Uv=(function(){let n=1;return function(){return n++}})(),Hf=function(n){const e=Cy(n),t=new Ey;t.update(e);const s=t.digest();return ec.encodeByteArray(s)},fr=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=fr.apply(null,s):typeof s=="object"?e+=Me(s):e+=s,e+=" "}return e};let Ui=null,Rh=!0;const Bv=function(n,e){k(!0,"Can't turn on custom loggers persistently."),Rs.logLevel=Y.VERBOSE,Ui=Rs.log.bind(Rs)},$e=function(...n){if(Rh===!0&&(Rh=!1,Ui===null&&Fv.get("logging_enabled")===!0&&Bv()),Ui){const e=fr.apply(null,n);Ui(e)}},pr=function(n){return function(...e){$e(n,...e)}},ml=function(...n){const e="FIREBASE INTERNAL ERROR: "+fr(...n);Rs.error(e)},Ut=function(...n){const e=`FIREBASE FATAL ERROR: ${fr(...n)}`;throw Rs.error(e),new Error(e)},tt=function(...n){const e="FIREBASE WARNING: "+fr(...n);Rs.warn(e)},qv=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$f=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Wv=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Vs="[MIN_NAME]",Zn="[MAX_NAME]",Ys=function(n,e){if(n===e)return 0;if(n===Vs||e===Zn)return-1;if(e===Vs||n===Zn)return 1;{const t=bh(n),s=bh(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},jv=function(n,e){return n===e?0:n<e?-1:1},Ai=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Me(e))},ac=function(n){if(typeof n!="object"||n===null)return Me(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Me(e[s]),t+=":",t+=ac(n[e[s]]);return t+="}",t},zf=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function nt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Gf=function(n){k(!$f(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,l,c;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(i?1:0),h.reverse();const f=h.join("");let p="";for(c=0;c<64;c+=8){let m=parseInt(f.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},Hv=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},$v=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function zv(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const Gv=new RegExp("^-?(0*)\\d{1,10}$"),Kv=-2147483648,Qv=2147483647,bh=function(n){if(Gv.test(n)){const e=Number(n);if(e>=Kv&&e<=Qv)return e}return null},Js=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},Yv=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Bi=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Jv{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ot(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Xv{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?($e("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tt(e)}}class oo{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}oo.OWNER="owner";const lc="5",Kf="v",Qf="s",Yf="r",Jf="f",Xf=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Zf="ls",ep="p",_l="ac",tp="websocket",np="long_polling";class sp{constructor(e,t,s,i,r=!1,o="",l=!1,c=!1,h=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=zn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&zn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Zv(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ip(n,e,t){k(typeof e=="string","typeof type must == string"),k(typeof t=="object","typeof params must == object");let s;if(e===tp)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===np)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Zv(n)&&(t.ns=n.namespace);const i=[];return nt(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class eE{constructor(){this.counters_={}}incrementCounter(e,t=1){Ht(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Z_(this.counters_)}}const Ga={},Ka={};function cc(n){const e=n.toString();return Ga[e]||(Ga[e]=new eE),Ga[e]}function tE(n,e){const t=n.toString();return Ka[t]||(Ka[t]=e()),Ka[t]}class nE{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Js(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ph="start",sE="close",iE="pLPCommand",rE="pRTLPCB",rp="id",op="pw",ap="ser",oE="cb",aE="seg",lE="ts",cE="d",uE="dframe",lp=1870,cp=30,hE=lp-cp,dE=25e3,fE=3e4;class As{constructor(e,t,s,i,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=pr(e),this.stats_=cc(t),this.urlFn=c=>(this.appCheckToken&&(c[_l]=this.appCheckToken),ip(t,np,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nE(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(fE)),Wv(()=>{if(this.isClosed_)return;this.scriptTagHolder=new uc((...r)=>{const[o,l,c,h,f]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ph)this.id=l,this.password=c;else if(o===sE)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[Ph]="t",s[ap]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[oE]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Kf]=lc,this.transportSessionId&&(s[Qf]=this.transportSessionId),this.lastSessionId&&(s[Zf]=this.lastSessionId),this.applicationId&&(s[ep]=this.applicationId),this.appCheckToken&&(s[_l]=this.appCheckToken),typeof location<"u"&&location.hostname&&Xf.test(location.hostname)&&(s[Yf]=Jf);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){As.forceAllow_=!0}static forceDisallow(){As.forceDisallow_=!0}static isAvailable(){return As.forceAllow_?!0:!As.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Hv()&&!$v()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Me(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=bf(t),i=zf(s,hE);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[uE]="t",s[rp]=e,s[op]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Me(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class uc{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Uv(),window[iE+this.uniqueCallbackIdentifier]=e,window[rE+this.uniqueCallbackIdentifier]=t,this.myIFrame=uc.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){$e("frame writing exception"),l.stack&&$e(l.stack),$e(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||$e("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[rp]=this.myID,e[op]=this.myPW,e[ap]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+cp+s.length<=lp;){const o=this.pendingSegs.shift();s=s+"&"+aE+i+"="+o.seg+"&"+lE+i+"="+o.ts+"&"+cE+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(dE)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{$e("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const pE=16384,gE=45e3;let To=null;typeof MozWebSocket<"u"?To=MozWebSocket:typeof WebSocket<"u"&&(To=WebSocket);class ct{constructor(e,t,s,i,r,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=pr(this.connId),this.stats_=cc(t),this.connURL=ct.connectionURL_(t,o,l,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[Kf]=lc,typeof location<"u"&&location.hostname&&Xf.test(location.hostname)&&(o[Yf]=Jf),t&&(o[Qf]=t),s&&(o[Zf]=s),i&&(o[_l]=i),r&&(o[ep]=r),ip(e,tp,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,zn.set("previous_websocket_failure",!0);try{let s;hy(),this.mySock=new To(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){ct.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&To!==null&&!ct.forceDisallow_}static previouslyFailed(){return zn.isInMemoryStorage||zn.get("previous_websocket_failure")===!0}markConnectionHealthy(){zn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=Yi(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(k(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Me(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=zf(t,pE);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(gE))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ct.responsesRequiredToBeHealthy=2;ct.healthyTimeout=3e4;class Xi{static get ALL_TRANSPORTS(){return[As,ct]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ct&&ct.isAvailable();let s=t&&!ct.previouslyFailed();if(e.webSocketOnly&&(t||tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ct];else{const i=this.transports_=[];for(const r of Xi.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Xi.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Xi.globalTransportInitialized_=!1;const mE=6e4,_E=5e3,yE=10*1024,vE=100*1024,Qa="t",kh="d",EE="s",Nh="r",IE="e",Dh="o",Oh="a",xh="n",Lh="p",TE="h";class wE{constructor(e,t,s,i,r,o,l,c,h,f){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=pr("c:"+this.id+":"),this.transportManager_=new Xi(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Bi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>vE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>yE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Qa in e){const t=e[Qa];t===Oh?this.upgradeIfSecondaryHealthy_():t===Nh?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Dh&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ai("t",e),s=Ai("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Lh,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Oh,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:xh,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ai("t",e),s=Ai("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ai(Qa,e);if(kh in e){const s=e[kh];if(t===TE){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===xh){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===EE?this.onConnectionShutdown_(s):t===Nh?this.onReset_(s):t===IE?ml("Server Error: "+s):t===Dh?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ml("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),lc!==s&&tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Bi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(mE))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Bi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(_E))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Lh,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(zn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class up{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class hp{constructor(e){this.allowedEvents_=e,this.listeners_={},k(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){k(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class wo extends hp{static getInstance(){return new wo}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!sc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return k(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Mh=32,Vh=768;class ce{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function ie(){return new ce("")}function K(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function yn(n){return n.pieces_.length-n.pieceNum_}function he(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function dp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function CE(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function fp(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pp(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function ke(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof ce)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new ce(t,0)}function J(n){return n.pieceNum_>=n.pieces_.length}function et(n,e){const t=K(n),s=K(e);if(t===null)return e;if(t===s)return et(he(n),he(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function hc(n,e){if(yn(n)!==yn(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function ut(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(yn(n)>yn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class AE{constructor(e,t){this.errorPrefix_=t,this.parts_=fp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Yo(this.parts_[s]);gp(this)}}function SE(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Yo(e),gp(n)}function RE(n){const e=n.parts_.pop();n.byteLength_-=Yo(e),n.parts_.length>0&&(n.byteLength_-=1)}function gp(n){if(n.byteLength_>Vh)throw new Error(n.errorPrefix_+"has a key path longer than "+Vh+" bytes ("+n.byteLength_+").");if(n.parts_.length>Mh)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Mh+") or object contains a cycle "+$n(n))}function $n(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class dc extends hp{static getInstance(){return new dc}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return k(e==="visible","Unknown event type: "+e),[this.visible_]}}const Si=1e3,bE=300*1e3,Fh=30*1e3,PE=1.3,kE=3e4,NE="server_kill",Uh=3;class Vt extends up{constructor(e,t,s,i,r,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Vt.nextPersistentConnectionId_++,this.log_=pr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Si,this.maxReconnectDelay_=bE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");dc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&wo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Me(r)),k(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new Qo,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),k(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,l=>{const c=l.d,h=l.s;Vt.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ht(e,"w")){const s=Ms(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||vy(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Fh)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=yy(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Me(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ml("Unrecognized action received from server: "+Me(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){k(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>kE&&(this.reconnectDelay_=Si),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*PE)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Vt.nextConnectionId_++,r=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},h=function(p){k(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,m]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);o?$e("getToken() completed but was canceled"):($e("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=m&&m.token,l=new wE(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,A=>{tt(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(NE)},r))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&tt(p),c())}}}interrupt(e){$e("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){$e("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ul(this.interruptReasons_)&&(this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>ac(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new ce(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){$e("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Uh&&(this.reconnectDelay_=Fh,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){$e("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Uh&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Wf.replace(/\./g,"-")]=1,sc()?e["framework.cordova"]=1:Lf()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=wo.getInstance().currentlyOnline();return ul(this.interruptReasons_)&&e}}Vt.nextPersistentConnectionId_=0;Vt.nextConnectionId_=0;class Q{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Q(e,t)}}class Zo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Q(Vs,e),i=new Q(Vs,t);return this.compare(s,i)!==0}minPost(){return Q.MIN}}let Yr;class mp extends Zo{static get __EMPTY_NODE(){return Yr}static set __EMPTY_NODE(e){Yr=e}compare(e,t){return Ys(e.name,t.name)}isDefinedOn(e){throw Ks("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Q.MIN}maxPost(){return new Q(Zn,Yr)}makePost(e,t){return k(typeof e=="string","KeyIndex indexValue must always be a string."),new Q(e,Yr)}toString(){return".key"}}const bs=new mp;let Jr=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},rt=class Oi{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Oi.RED,this.left=i??Tt.EMPTY_NODE,this.right=r??Tt.EMPTY_NODE}copy(e,t,s,i,r){return new Oi(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Tt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return Tt.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Oi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Oi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};rt.RED=!0;rt.BLACK=!1;class DE{copy(e,t,s,i,r){return this}insert(e,t,s){return new rt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Tt=class ao{constructor(e,t=ao.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ao(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,rt.BLACK,null,null))}remove(e){return new ao(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,rt.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Jr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Jr(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Jr(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Jr(this.root_,null,this.comparator_,!0,e)}};Tt.EMPTY_NODE=new DE;function OE(n,e){return Ys(n.name,e.name)}function fc(n,e){return Ys(n,e)}let yl;function xE(n){yl=n}const _p=function(n){return typeof n=="number"?"number:"+Gf(n):"string:"+n},yp=function(n){if(n.isLeafNode()){const e=n.val();k(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ht(e,".sv"),"Priority must be a string or number.")}else k(n===yl||n.isEmpty(),"priority of unexpected type.");k(n===yl||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Bh;class xe{static set __childrenNodeConstructor(e){Bh=e}static get __childrenNodeConstructor(){return Bh}constructor(e,t=xe.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,k(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),yp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xe(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:xe.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return J(e)?this:K(e)===".priority"?this.priorityNode_:xe.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:xe.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=K(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(k(s!==".priority"||yn(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,xe.__childrenNodeConstructor.EMPTY_NODE.updateChild(he(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+_p(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Gf(this.value_):e+=this.value_,this.lazyHash_=Hf(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===xe.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof xe.__childrenNodeConstructor?-1:(k(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=xe.VALUE_TYPE_ORDER.indexOf(t),r=xe.VALUE_TYPE_ORDER.indexOf(s);return k(i>=0,"Unknown leaf type: "+t),k(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}xe.VALUE_TYPE_ORDER=["object","boolean","number","string"];let vp,Ep;function LE(n){vp=n}function ME(n){Ep=n}class VE extends Zo{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Ys(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Q.MIN}maxPost(){return new Q(Zn,new xe("[PRIORITY-POST]",Ep))}makePost(e,t){const s=vp(e);return new Q(t,new xe("[PRIORITY-POST]",s))}toString(){return".priority"}}const Ee=new VE;const FE=Math.log(2);class UE{constructor(e){const t=r=>parseInt(Math.log(r)/FE,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Co=function(n,e,t,s){n.sort(e);const i=function(c,h){const f=h-c;let p,m;if(f===0)return null;if(f===1)return p=n[c],m=t?t(p):p,new rt(m,p.node,rt.BLACK,null,null);{const A=parseInt(f/2,10)+c,S=i(c,A),P=i(A+1,h);return p=n[A],m=t?t(p):p,new rt(m,p.node,rt.BLACK,S,P)}},r=function(c){let h=null,f=null,p=n.length;const m=function(S,P){const O=p-S,W=p;p-=S;const B=i(O+1,W),z=n[O],re=t?t(z):z;A(new rt(re,z.node,P,null,B))},A=function(S){h?(h.left=S,h=S):(f=S,h=S)};for(let S=0;S<c.count;++S){const P=c.nextBitIsOne(),O=Math.pow(2,c.count-(S+1));P?m(O,rt.BLACK):(m(O,rt.BLACK),m(O,rt.RED))}return f},o=new UE(n.length),l=r(o);return new Tt(s||e,l)};let Ya;const vs={};class xt{static get Default(){return k(vs&&Ee,"ChildrenNode.ts has not been loaded"),Ya=Ya||new xt({".priority":vs},{".priority":Ee}),Ya}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ms(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Tt?t:null}hasIndex(e){return Ht(this.indexSet_,e.toString())}addIndex(e,t){k(e!==bs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(Q.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=Co(s,e.getCompare()):l=vs;const c=e.toString(),h={...this.indexSet_};h[c]=e;const f={...this.indexes_};return f[c]=l,new xt(f,h)}addToIndexes(e,t){const s=Eo(this.indexes_,(i,r)=>{const o=Ms(this.indexSet_,r);if(k(o,"Missing index implementation for "+r),i===vs)if(o.isDefinedOn(e.node)){const l=[],c=t.getIterator(Q.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&l.push(h),h=c.getNext();return l.push(e),Co(l,o.getCompare())}else return vs;else{const l=t.get(e.name);let c=i;return l&&(c=c.remove(new Q(e.name,l))),c.insert(e,e.node)}});return new xt(s,this.indexSet_)}removeFromIndexes(e,t){const s=Eo(this.indexes_,i=>{if(i===vs)return i;{const r=t.get(e.name);return r?i.remove(new Q(e.name,r)):i}});return new xt(s,this.indexSet_)}}let Ri;class q{static get EMPTY_NODE(){return Ri||(Ri=new q(new Tt(fc),null,xt.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&yp(this.priorityNode_),this.children_.isEmpty()&&k(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ri}updatePriority(e){return this.children_.isEmpty()?this:new q(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ri:t}}getChild(e){const t=K(e);return t===null?this:this.getImmediateChild(t).getChild(he(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(k(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Q(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Ri:this.priorityNode_;return new q(i,o,r)}}updateChild(e,t){const s=K(e);if(s===null)return t;{k(K(e)!==".priority"||yn(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(he(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(Ee,(o,l)=>{t[o]=l.val(e),s++,r&&q.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const l in t)o[l]=t[l];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+_p(this.getPriority().val())+":"),this.forEachChild(Ee,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Hf(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new Q(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Q(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Q(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Q.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Q.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gr?-1:0}withIndex(e){if(e===bs||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new q(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===bs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Ee),i=t.getIterator(Ee);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===bs?null:this.indexMap_.get(e.toString())}}q.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class BE extends q{constructor(){super(new Tt(fc),q.EMPTY_NODE,xt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return q.EMPTY_NODE}isEmpty(){return!1}}const gr=new BE;Object.defineProperties(Q,{MIN:{value:new Q(Vs,q.EMPTY_NODE)},MAX:{value:new Q(Zn,gr)}});mp.__EMPTY_NODE=q.EMPTY_NODE;xe.__childrenNodeConstructor=q;xE(gr);ME(gr);const qE=!0;function Be(n,e=null){if(n===null)return q.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),k(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new xe(t,Be(e))}if(!(n instanceof Array)&&qE){const t=[];let s=!1;if(nt(n,(o,l)=>{if(o.substring(0,1)!=="."){const c=Be(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new Q(o,c)))}}),t.length===0)return q.EMPTY_NODE;const r=Co(t,OE,o=>o.name,fc);if(s){const o=Co(t,Ee.getCompare());return new q(r,Be(e),new xt({".priority":o},{".priority":Ee}))}else return new q(r,Be(e),xt.Default)}else{let t=q.EMPTY_NODE;return nt(n,(s,i)=>{if(Ht(n,s)&&s.substring(0,1)!=="."){const r=Be(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(Be(e))}}LE(Be);class WE extends Zo{constructor(e){super(),this.indexPath_=e,k(!J(e)&&K(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Ys(e.name,t.name):r}makePost(e,t){const s=Be(e),i=q.EMPTY_NODE.updateChild(this.indexPath_,s);return new Q(t,i)}maxPost(){const e=q.EMPTY_NODE.updateChild(this.indexPath_,gr);return new Q(Zn,e)}toString(){return fp(this.indexPath_,0).join("/")}}class jE extends Zo{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Ys(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Q.MIN}maxPost(){return Q.MAX}makePost(e,t){const s=Be(e);return new Q(t,s)}toString(){return".value"}}const HE=new jE;function Ip(n){return{type:"value",snapshotNode:n}}function Fs(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Zi(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function er(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function $E(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class pc{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){k(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(i).equals(s.getChild(i))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Zi(t,l)):k(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Fs(t,s)):o.trackChildChange(er(t,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Ee,(i,r)=>{t.hasChild(i)||s.trackChildChange(Zi(i,r))}),t.isLeafNode()||t.forEachChild(Ee,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(er(i,r,o))}else s.trackChildChange(Fs(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?q.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class tr{constructor(e){this.indexedFilter_=new pc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=tr.getStartPost_(e),this.endPost_=tr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new Q(t,s))||(s=q.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=q.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(q.EMPTY_NODE);const r=this;return t.forEachChild(Ee,(o,l)=>{r.matches(new Q(o,l))||(i=i.updateImmediateChild(o,q.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class zE{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new tr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new Q(t,s))||(s=q.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=q.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=q.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(q.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,q.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const p=this.index_.getCompare();o=(m,A)=>p(A,m)}else o=this.index_.getCompare();const l=e;k(l.numChildren()===this.limit_,"");const c=new Q(t,s),h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(c);if(l.hasChild(t)){const p=l.getImmediateChild(t);let m=i.getChildAfterChild(this.index_,h,this.reverse_);for(;m!=null&&(m.name===t||l.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);const A=m==null?1:o(m,c);if(f&&!s.isEmpty()&&A>=0)return r?.trackChildChange(er(t,s,p)),l.updateImmediateChild(t,s);{r?.trackChildChange(Zi(t,p));const P=l.updateImmediateChild(t,q.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(r?.trackChildChange(Fs(m.name,m.node)),P.updateImmediateChild(m.name,m.node)):P}}else return s.isEmpty()?e:f&&o(h,c)>=0?(r!=null&&(r.trackChildChange(Zi(h.name,h.node)),r.trackChildChange(Fs(t,s))),l.updateImmediateChild(t,s).updateImmediateChild(h.name,q.EMPTY_NODE)):e}}class gc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ee}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return k(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return k(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vs}hasEnd(){return this.endSet_}getIndexEndValue(){return k(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return k(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Zn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return k(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ee}copy(){const e=new gc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function GE(n){return n.loadsAllData()?new pc(n.getIndex()):n.hasLimit()?new zE(n):new tr(n)}function qh(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ee?t="$priority":n.index_===HE?t="$value":n.index_===bs?t="$key":(k(n.index_ instanceof WE,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Me(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Me(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Me(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Me(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Me(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Wh(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ee&&(e.i=n.index_.toString()),e}class Ao extends up{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(k(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=pr("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Ao.getListenId_(e,s),l={};this.listens_[o]=l;const c=qh(e._queryParams);this.restRequest_(r+".json",c,(h,f)=>{let p=f;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(r,p,!1,s),Ms(this.listens_,o)===l){let m;h?h===401?m="permission_denied":m="rest_error:"+h:m="ok",i(m,null)}})}unlisten(e,t){const s=Ao.getListenId_(e,t);delete this.listens_[s]}get(e){const t=qh(e._queryParams),s=e._path.toString(),i=new Qo;return this.restRequest_(s+".json",t,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Qs(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Yi(l.responseText)}catch{tt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&tt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}class KE{constructor(){this.rootNode_=q.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function So(){return{value:null,children:new Map}}function Tp(n,e,t){if(J(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=K(e);n.children.has(s)||n.children.set(s,So());const i=n.children.get(s);e=he(e),Tp(i,e,t)}}function vl(n,e,t){n.value!==null?t(e,n.value):QE(n,(s,i)=>{const r=new ce(e.toString()+"/"+s);vl(i,r,t)})}function QE(n,e){n.children.forEach((t,s)=>{e(s,t)})}class YE{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&nt(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const jh=10*1e3,JE=30*1e3,XE=300*1e3;class ZE{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new YE(e);const s=jh+(JE-jh)*Math.random();Bi(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;nt(e,(i,r)=>{r>0&&Ht(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Bi(this.reportStats_.bind(this),Math.floor(Math.random()*2*XE))}}var ht;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ht||(ht={}));function wp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function mc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function _c(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Ro{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=ht.ACK_USER_WRITE,this.source=wp()}operationForChild(e){if(J(this.path)){if(this.affectedTree.value!=null)return k(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ce(e));return new Ro(ie(),t,this.revert)}}else return k(K(this.path)===e,"operationForChild called for unrelated child."),new Ro(he(this.path),this.affectedTree,this.revert)}}class nr{constructor(e,t){this.source=e,this.path=t,this.type=ht.LISTEN_COMPLETE}operationForChild(e){return J(this.path)?new nr(this.source,ie()):new nr(this.source,he(this.path))}}class es{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=ht.OVERWRITE}operationForChild(e){return J(this.path)?new es(this.source,ie(),this.snap.getImmediateChild(e)):new es(this.source,he(this.path),this.snap)}}class sr{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=ht.MERGE}operationForChild(e){if(J(this.path)){const t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new es(this.source,ie(),t.value):new sr(this.source,ie(),t)}else return k(K(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new sr(this.source,he(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ts{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(J(e))return this.isFullyInitialized()&&!this.filtered_;const t=K(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class eI{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function tI(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push($E(o.childName,o.snapshotNode))}),bi(n,i,"child_removed",e,s,t),bi(n,i,"child_added",e,s,t),bi(n,i,"child_moved",r,s,t),bi(n,i,"child_changed",e,s,t),bi(n,i,"value",e,s,t),i}function bi(n,e,t,s,i,r){const o=s.filter(l=>l.type===t);o.sort((l,c)=>sI(n,l,c)),o.forEach(l=>{const c=nI(n,l,r);i.forEach(h=>{h.respondsTo(l.type)&&e.push(h.createEvent(c,n.query_))})})}function nI(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function sI(n,e,t){if(e.childName==null||t.childName==null)throw Ks("Should only compare child_ events.");const s=new Q(e.childName,e.snapshotNode),i=new Q(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function ea(n,e){return{eventCache:n,serverCache:e}}function qi(n,e,t,s){return ea(new ts(e,t,s),n.serverCache)}function Cp(n,e,t,s){return ea(n.eventCache,new ts(e,t,s))}function El(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ns(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ja;const iI=()=>(Ja||(Ja=new Tt(jv)),Ja);class ge{static fromObject(e){let t=new ge(null);return nt(e,(s,i)=>{t=t.set(new ce(s),i)}),t}constructor(e,t=iI()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ie(),value:this.value};if(J(e))return null;{const s=K(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(he(e),t);return r!=null?{path:ke(new ce(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(J(e))return this;{const t=K(e),s=this.children.get(t);return s!==null?s.subtree(he(e)):new ge(null)}}set(e,t){if(J(e))return new ge(t,this.children);{const s=K(e),r=(this.children.get(s)||new ge(null)).set(he(e),t),o=this.children.insert(s,r);return new ge(this.value,o)}}remove(e){if(J(e))return this.children.isEmpty()?new ge(null):new ge(null,this.children);{const t=K(e),s=this.children.get(t);if(s){const i=s.remove(he(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new ge(null):new ge(this.value,r)}else return this}}get(e){if(J(e))return this.value;{const t=K(e),s=this.children.get(t);return s?s.get(he(e)):null}}setTree(e,t){if(J(e))return t;{const s=K(e),r=(this.children.get(s)||new ge(null)).setTree(he(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new ge(this.value,o)}}fold(e){return this.fold_(ie(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(ke(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,ie(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(J(e))return null;{const r=K(e),o=this.children.get(r);return o?o.findOnPath_(he(e),ke(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ie(),t)}foreachOnPath_(e,t,s){if(J(e))return this;{this.value&&s(t,this.value);const i=K(e),r=this.children.get(i);return r?r.foreachOnPath_(he(e),ke(t,i),s):new ge(null)}}foreach(e){this.foreach_(ie(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(ke(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class ft{constructor(e){this.writeTree_=e}static empty(){return new ft(new ge(null))}}function Wi(n,e,t){if(J(e))return new ft(new ge(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=et(i,e);return r=r.updateChild(o,t),new ft(n.writeTree_.set(i,r))}else{const i=new ge(t),r=n.writeTree_.setTree(e,i);return new ft(r)}}}function Hh(n,e,t){let s=n;return nt(t,(i,r)=>{s=Wi(s,ke(e,i),r)}),s}function $h(n,e){if(J(e))return ft.empty();{const t=n.writeTree_.setTree(e,new ge(null));return new ft(t)}}function Il(n,e){return os(n,e)!=null}function os(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(et(t.path,e)):null}function zh(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ee,(s,i)=>{e.push(new Q(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new Q(s,i.value))}),e}function hn(n,e){if(J(e))return n;{const t=os(n,e);return t!=null?new ft(new ge(t)):new ft(n.writeTree_.subtree(e))}}function Tl(n){return n.writeTree_.isEmpty()}function Us(n,e){return Ap(ie(),n.writeTree_,e)}function Ap(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(k(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=Ap(ke(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(ke(n,".priority"),s)),t}}function yc(n,e){return Pp(e,n)}function rI(n,e,t,s,i){k(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=Wi(n.visibleWrites,e,t)),n.lastWriteId=s}function oI(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function aI(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);k(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&lI(l,s.path)?i=!1:ut(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return cI(n),!0;if(s.snap)n.visibleWrites=$h(n.visibleWrites,s.path);else{const l=s.children;nt(l,c=>{n.visibleWrites=$h(n.visibleWrites,ke(s.path,c))})}return!0}else return!1}function lI(n,e){if(n.snap)return ut(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ut(ke(n.path,t),e))return!0;return!1}function cI(n){n.visibleWrites=Sp(n.allWrites,uI,ie()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function uI(n){return n.visible}function Sp(n,e,t){let s=ft.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let l;if(r.snap)ut(t,o)?(l=et(t,o),s=Wi(s,l,r.snap)):ut(o,t)&&(l=et(o,t),s=Wi(s,ie(),r.snap.getChild(l)));else if(r.children){if(ut(t,o))l=et(t,o),s=Hh(s,l,r.children);else if(ut(o,t))if(l=et(o,t),J(l))s=Hh(s,ie(),r.children);else{const c=Ms(r.children,K(l));if(c){const h=c.getChild(he(l));s=Wi(s,ie(),h)}}}else throw Ks("WriteRecord should have .snap or .children")}}return s}function Rp(n,e,t,s,i){if(!s&&!i){const r=os(n.visibleWrites,e);if(r!=null)return r;{const o=hn(n.visibleWrites,e);if(Tl(o))return t;if(t==null&&!Il(o,ie()))return null;{const l=t||q.EMPTY_NODE;return Us(o,l)}}}else{const r=hn(n.visibleWrites,e);if(!i&&Tl(r))return t;if(!i&&t==null&&!Il(r,ie()))return null;{const o=function(h){return(h.visible||i)&&(!s||!~s.indexOf(h.writeId))&&(ut(h.path,e)||ut(e,h.path))},l=Sp(n.allWrites,o,e),c=t||q.EMPTY_NODE;return Us(l,c)}}}function hI(n,e,t){let s=q.EMPTY_NODE;const i=os(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Ee,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=hn(n.visibleWrites,e);return t.forEachChild(Ee,(o,l)=>{const c=Us(hn(r,new ce(o)),l);s=s.updateImmediateChild(o,c)}),zh(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=hn(n.visibleWrites,e);return zh(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function dI(n,e,t,s,i){k(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=ke(e,t);if(Il(n.visibleWrites,r))return null;{const o=hn(n.visibleWrites,r);return Tl(o)?i.getChild(t):Us(o,i.getChild(t))}}function fI(n,e,t,s){const i=ke(e,t),r=os(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=hn(n.visibleWrites,i);return Us(o,s.getNode().getImmediateChild(t))}else return null}function pI(n,e){return os(n.visibleWrites,e)}function gI(n,e,t,s,i,r,o){let l;const c=hn(n.visibleWrites,e),h=os(c,ie());if(h!=null)l=h;else if(t!=null)l=Us(c,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const f=[],p=o.getCompare(),m=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let A=m.getNext();for(;A&&f.length<i;)p(A,s)!==0&&f.push(A),A=m.getNext();return f}else return[]}function mI(){return{visibleWrites:ft.empty(),allWrites:[],lastWriteId:-1}}function bo(n,e,t,s){return Rp(n.writeTree,n.treePath,e,t,s)}function vc(n,e){return hI(n.writeTree,n.treePath,e)}function Gh(n,e,t,s){return dI(n.writeTree,n.treePath,e,t,s)}function Po(n,e){return pI(n.writeTree,ke(n.treePath,e))}function _I(n,e,t,s,i,r){return gI(n.writeTree,n.treePath,e,t,s,i,r)}function Ec(n,e,t){return fI(n.writeTree,n.treePath,e,t)}function bp(n,e){return Pp(ke(n.treePath,e),n.writeTree)}function Pp(n,e){return{treePath:n,writeTree:e}}class yI{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;k(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),k(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,er(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Zi(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Fs(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,er(s,e.snapshotNode,i.oldSnap));else throw Ks("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class vI{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const kp=new vI;class Ic{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new ts(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ec(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ns(this.viewCache_),r=_I(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function EI(n){return{filter:n}}function II(n,e){k(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),k(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function TI(n,e,t,s,i){const r=new yI;let o,l;if(t.type===ht.OVERWRITE){const h=t;h.source.fromUser?o=wl(n,e,h.path,h.snap,s,i,r):(k(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered()&&!J(h.path),o=ko(n,e,h.path,h.snap,s,i,l,r))}else if(t.type===ht.MERGE){const h=t;h.source.fromUser?o=CI(n,e,h.path,h.children,s,i,r):(k(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered(),o=Cl(n,e,h.path,h.children,s,i,l,r))}else if(t.type===ht.ACK_USER_WRITE){const h=t;h.revert?o=RI(n,e,h.path,s,i,r):o=AI(n,e,h.path,h.affectedTree,s,i,r)}else if(t.type===ht.LISTEN_COMPLETE)o=SI(n,e,t.path,s,r);else throw Ks("Unknown operation type: "+t.type);const c=r.getChanges();return wI(e,o,c),{viewCache:o,changes:c}}function wI(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=El(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Ip(El(e)))}}function Np(n,e,t,s,i,r){const o=e.eventCache;if(Po(s,t)!=null)return e;{let l,c;if(J(t))if(k(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=ns(e),f=h instanceof q?h:q.EMPTY_NODE,p=vc(s,f);l=n.filter.updateFullNode(e.eventCache.getNode(),p,r)}else{const h=bo(s,ns(e));l=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const h=K(t);if(h===".priority"){k(yn(t)===1,"Can't have a priority with additional path components");const f=o.getNode();c=e.serverCache.getNode();const p=Gh(s,t,f,c);p!=null?l=n.filter.updatePriority(f,p):l=o.getNode()}else{const f=he(t);let p;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const m=Gh(s,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(h).updateChild(f,m):p=o.getNode().getImmediateChild(h)}else p=Ec(s,h,e.serverCache);p!=null?l=n.filter.updateChild(o.getNode(),h,p,f,i,r):l=o.getNode()}}return qi(e,l,o.isFullyInitialized()||J(t),n.filter.filtersNodes())}}function ko(n,e,t,s,i,r,o,l){const c=e.serverCache;let h;const f=o?n.filter:n.filter.getIndexedFilter();if(J(t))h=f.updateFullNode(c.getNode(),s,null);else if(f.filtersNodes()&&!c.isFiltered()){const A=c.getNode().updateChild(t,s);h=f.updateFullNode(c.getNode(),A,null)}else{const A=K(t);if(!c.isCompleteForPath(t)&&yn(t)>1)return e;const S=he(t),O=c.getNode().getImmediateChild(A).updateChild(S,s);A===".priority"?h=f.updatePriority(c.getNode(),O):h=f.updateChild(c.getNode(),A,O,S,kp,null)}const p=Cp(e,h,c.isFullyInitialized()||J(t),f.filtersNodes()),m=new Ic(i,p,r);return Np(n,p,t,i,m,l)}function wl(n,e,t,s,i,r,o){const l=e.eventCache;let c,h;const f=new Ic(i,e,r);if(J(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=qi(e,h,!0,n.filter.filtersNodes());else{const p=K(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),s),c=qi(e,h,l.isFullyInitialized(),l.isFiltered());else{const m=he(t),A=l.getNode().getImmediateChild(p);let S;if(J(m))S=s;else{const P=f.getCompleteChild(p);P!=null?dp(m)===".priority"&&P.getChild(pp(m)).isEmpty()?S=P:S=P.updateChild(m,s):S=q.EMPTY_NODE}if(A.equals(S))c=e;else{const P=n.filter.updateChild(l.getNode(),p,S,m,f,o);c=qi(e,P,l.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Kh(n,e){return n.eventCache.isCompleteForChild(e)}function CI(n,e,t,s,i,r,o){let l=e;return s.foreach((c,h)=>{const f=ke(t,c);Kh(e,K(f))&&(l=wl(n,l,f,h,i,r,o))}),s.foreach((c,h)=>{const f=ke(t,c);Kh(e,K(f))||(l=wl(n,l,f,h,i,r,o))}),l}function Qh(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Cl(n,e,t,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;J(t)?h=s:h=new ge(null).setTree(t,s);const f=e.serverCache.getNode();return h.children.inorderTraversal((p,m)=>{if(f.hasChild(p)){const A=e.serverCache.getNode().getImmediateChild(p),S=Qh(n,A,m);c=ko(n,c,new ce(p),S,i,r,o,l)}}),h.children.inorderTraversal((p,m)=>{const A=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!f.hasChild(p)&&!A){const S=e.serverCache.getNode().getImmediateChild(p),P=Qh(n,S,m);c=ko(n,c,new ce(p),P,i,r,o,l)}}),c}function AI(n,e,t,s,i,r,o){if(Po(i,t)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(J(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return ko(n,e,t,c.getNode().getChild(t),i,r,l,o);if(J(t)){let h=new ge(null);return c.getNode().forEachChild(bs,(f,p)=>{h=h.set(new ce(f),p)}),Cl(n,e,t,h,i,r,l,o)}else return e}else{let h=new ge(null);return s.foreach((f,p)=>{const m=ke(t,f);c.isCompleteForPath(m)&&(h=h.set(f,c.getNode().getChild(m)))}),Cl(n,e,t,h,i,r,l,o)}}function SI(n,e,t,s,i){const r=e.serverCache,o=Cp(e,r.getNode(),r.isFullyInitialized()||J(t),r.isFiltered());return Np(n,o,t,s,kp,i)}function RI(n,e,t,s,i,r){let o;if(Po(s,t)!=null)return e;{const l=new Ic(s,e,i),c=e.eventCache.getNode();let h;if(J(t)||K(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=bo(s,ns(e));else{const p=e.serverCache.getNode();k(p instanceof q,"serverChildren would be complete if leaf node"),f=vc(s,p)}f=f,h=n.filter.updateFullNode(c,f,r)}else{const f=K(t);let p=Ec(s,f,e.serverCache);p==null&&e.serverCache.isCompleteForChild(f)&&(p=c.getImmediateChild(f)),p!=null?h=n.filter.updateChild(c,f,p,he(t),l,r):e.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(c,f,q.EMPTY_NODE,he(t),l,r):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=bo(s,ns(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,r)))}return o=e.serverCache.isFullyInitialized()||Po(s,ie())!=null,qi(e,h,o,n.filter.filtersNodes())}}class bI{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new pc(s.getIndex()),r=GE(s);this.processor_=EI(r);const o=t.serverCache,l=t.eventCache,c=i.updateFullNode(q.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(q.EMPTY_NODE,l.getNode(),null),f=new ts(c,o.isFullyInitialized(),i.filtersNodes()),p=new ts(h,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=ea(p,f),this.eventGenerator_=new eI(this.query_)}get query(){return this.query_}}function PI(n){return n.viewCache_.serverCache.getNode()}function kI(n,e){const t=ns(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!J(e)&&!t.getImmediateChild(K(e)).isEmpty())?t.getChild(e):null}function Yh(n){return n.eventRegistrations_.length===0}function NI(n,e){n.eventRegistrations_.push(e)}function Jh(n,e,t){const s=[];if(t){k(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function Xh(n,e,t,s){e.type===ht.MERGE&&e.source.queryId!==null&&(k(ns(n.viewCache_),"We should always have a full cache before handling merges"),k(El(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=TI(n.processor_,i,e,t,s);return II(n.processor_,r.viewCache),k(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Dp(n,r.changes,r.viewCache.eventCache.getNode(),null)}function DI(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ee,(r,o)=>{s.push(Fs(r,o))}),t.isFullyInitialized()&&s.push(Ip(t.getNode())),Dp(n,s,t.getNode(),e)}function Dp(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return tI(n.eventGenerator_,e,t,i)}let No;class OI{constructor(){this.views=new Map}}function xI(n){k(!No,"__referenceConstructor has already been defined"),No=n}function LI(){return k(No,"Reference.ts has not been loaded"),No}function MI(n){return n.views.size===0}function Tc(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return k(r!=null,"SyncTree gave us an op for an invalid query."),Xh(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(Xh(o,e,t,s));return r}}function VI(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let l=bo(t,i?s:null),c=!1;l?c=!0:s instanceof q?(l=vc(t,s),c=!1):(l=q.EMPTY_NODE,c=!1);const h=ea(new ts(l,c,!1),new ts(s,i,!1));return new bI(e,h)}return o}function FI(n,e,t,s,i,r){const o=VI(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),NI(o,t),DI(o,t)}function UI(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const l=vn(n);if(i==="default")for(const[c,h]of n.views.entries())o=o.concat(Jh(h,t,s)),Yh(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||r.push(h.query));else{const c=n.views.get(i);c&&(o=o.concat(Jh(c,t,s)),Yh(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!vn(n)&&r.push(new(LI())(e._repo,e._path)),{removed:r,events:o}}function Op(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ps(n,e){let t=null;for(const s of n.views.values())t=t||kI(s,e);return t}function xp(n,e){if(e._queryParams.loadsAllData())return ta(n);{const s=e._queryIdentifier;return n.views.get(s)}}function Lp(n,e){return xp(n,e)!=null}function vn(n){return ta(n)!=null}function ta(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Do;function BI(n){k(!Do,"__referenceConstructor has already been defined"),Do=n}function qI(){return k(Do,"Reference.ts has not been loaded"),Do}let WI=1;class Zh{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ge(null),this.pendingWriteTree_=mI(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Mp(n,e,t,s,i){return rI(n.pendingWriteTree_,e,t,s,i),i?mr(n,new es(wp(),e,t)):[]}function Gn(n,e,t=!1){const s=oI(n.pendingWriteTree_,e);if(aI(n.pendingWriteTree_,e)){let r=new ge(null);return s.snap!=null?r=r.set(ie(),!0):nt(s.children,o=>{r=r.set(new ce(o),!0)}),mr(n,new Ro(s.path,r,t))}else return[]}function na(n,e,t){return mr(n,new es(mc(),e,t))}function jI(n,e,t){const s=ge.fromObject(t);return mr(n,new sr(mc(),e,s))}function HI(n,e){return mr(n,new nr(mc(),e))}function $I(n,e,t){const s=Cc(n,t);if(s){const i=Ac(s),r=i.path,o=i.queryId,l=et(r,e),c=new nr(_c(o),l);return Sc(n,r,c)}else return[]}function Al(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let l=[];if(o&&(e._queryIdentifier==="default"||Lp(o,e))){const c=UI(o,e,t,s);MI(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const h=c.removed;if(l=c.events,!i){const f=h.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(r,(m,A)=>vn(A));if(f&&!p){const m=n.syncPointTree_.subtree(r);if(!m.isEmpty()){const A=KI(m);for(let S=0;S<A.length;++S){const P=A[S],O=P.query,W=Up(n,P);n.listenProvider_.startListening(ji(O),Oo(n,O),W.hashFn,W.onComplete)}}}!p&&h.length>0&&!s&&(f?n.listenProvider_.stopListening(ji(e),null):h.forEach(m=>{const A=n.queryToTagMap.get(sa(m));n.listenProvider_.stopListening(ji(m),A)}))}QI(n,h)}return l}function zI(n,e,t,s){const i=Cc(n,s);if(i!=null){const r=Ac(i),o=r.path,l=r.queryId,c=et(o,e),h=new es(_c(l),c,t);return Sc(n,o,h)}else return[]}function GI(n,e,t,s){const i=Cc(n,s);if(i){const r=Ac(i),o=r.path,l=r.queryId,c=et(o,e),h=ge.fromObject(t),f=new sr(_c(l),c,h);return Sc(n,o,f)}else return[]}function ed(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(m,A)=>{const S=et(m,i);r=r||Ps(A,S),o=o||vn(A)});let l=n.syncPointTree_.get(i);l?(o=o||vn(l),r=r||Ps(l,ie())):(l=new OI,n.syncPointTree_=n.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=q.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((A,S)=>{const P=Ps(S,ie());P&&(r=r.updateImmediateChild(A,P))}));const h=Lp(l,e);if(!h&&!e._queryParams.loadsAllData()){const m=sa(e);k(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const A=YI();n.queryToTagMap.set(m,A),n.tagToQueryMap.set(A,m)}const f=yc(n.pendingWriteTree_,i);let p=FI(l,e,t,f,r,c);if(!h&&!o&&!s){const m=xp(l,e);p=p.concat(JI(n,e,m))}return p}function wc(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=et(o,e),h=Ps(l,c);if(h)return h});return Rp(i,e,r,t,!0)}function mr(n,e){return Vp(e,n.syncPointTree_,null,yc(n.pendingWriteTree_,ie()))}function Vp(n,e,t,s){if(J(n.path))return Fp(n,e,t,s);{const i=e.get(ie());t==null&&i!=null&&(t=Ps(i,ie()));let r=[];const o=K(n.path),l=n.operationForChild(o),c=e.children.get(o);if(c&&l){const h=t?t.getImmediateChild(o):null,f=bp(s,o);r=r.concat(Vp(l,c,h,f))}return i&&(r=r.concat(Tc(i,n,s,t))),r}}function Fp(n,e,t,s){const i=e.get(ie());t==null&&i!=null&&(t=Ps(i,ie()));let r=[];return e.children.inorderTraversal((o,l)=>{const c=t?t.getImmediateChild(o):null,h=bp(s,o),f=n.operationForChild(o);f&&(r=r.concat(Fp(f,l,c,h)))}),i&&(r=r.concat(Tc(i,n,s,t))),r}function Up(n,e){const t=e.query,s=Oo(n,t);return{hashFn:()=>(PI(e)||q.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?$I(n,t._path,s):HI(n,t._path);{const r=zv(i,t);return Al(n,t,null,r)}}}}function Oo(n,e){const t=sa(e);return n.queryToTagMap.get(t)}function sa(n){return n._path.toString()+"$"+n._queryIdentifier}function Cc(n,e){return n.tagToQueryMap.get(e)}function Ac(n){const e=n.indexOf("$");return k(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function Sc(n,e,t){const s=n.syncPointTree_.get(e);k(s,"Missing sync point for query tag that we're tracking");const i=yc(n.pendingWriteTree_,e);return Tc(s,t,i,null)}function KI(n){return n.fold((e,t,s)=>{if(t&&vn(t))return[ta(t)];{let i=[];return t&&(i=Op(t)),nt(s,(r,o)=>{i=i.concat(o)}),i}})}function ji(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(qI())(n._repo,n._path):n}function QI(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=sa(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function YI(){return WI++}function JI(n,e,t){const s=e._path,i=Oo(n,e),r=Up(n,t),o=n.listenProvider_.startListening(ji(e),i,r.hashFn,r.onComplete),l=n.syncPointTree_.subtree(s);if(i)k(!vn(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((h,f,p)=>{if(!J(h)&&f&&vn(f))return[ta(f).query];{let m=[];return f&&(m=m.concat(Op(f).map(A=>A.query))),nt(p,(A,S)=>{m=m.concat(S)}),m}});for(let h=0;h<c.length;++h){const f=c[h];n.listenProvider_.stopListening(ji(f),Oo(n,f))}}return o}class Rc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Rc(t)}node(){return this.node_}}class bc{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ke(this.path_,e);return new bc(this.syncTree_,t)}node(){return wc(this.syncTree_,this.path_)}}const XI=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},td=function(n,e,t){if(!n||typeof n!="object")return n;if(k(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return ZI(n[".sv"],e,t);if(typeof n[".sv"]=="object")return eT(n[".sv"],e);k(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},ZI=function(n,e,t){if(n==="timestamp")return t.timestamp;k(!1,"Unexpected server value: "+n)},eT=function(n,e,t){n.hasOwnProperty("increment")||k(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&k(!1,"Unexpected increment value: "+s);const i=e.node();if(k(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},tT=function(n,e,t,s){return Pc(e,new bc(t,n),s)},Bp=function(n,e,t){return Pc(n,new Rc(e),t)};function Pc(n,e,t){const s=n.getPriority().val(),i=td(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,l=td(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new xe(l,Be(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new xe(i))),o.forEachChild(Ee,(l,c)=>{const h=Pc(c,e.getImmediateChild(l),t);h!==c&&(r=r.updateImmediateChild(l,h))}),r}}class kc{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function Nc(n,e){let t=e instanceof ce?e:new ce(e),s=n,i=K(t);for(;i!==null;){const r=Ms(s.node.children,i)||{children:{},childCount:0};s=new kc(i,s,r),t=he(t),i=K(t)}return s}function Xs(n){return n.node.value}function qp(n,e){n.node.value=e,Sl(n)}function Wp(n){return n.node.childCount>0}function nT(n){return Xs(n)===void 0&&!Wp(n)}function ia(n,e){nt(n.node.children,(t,s)=>{e(new kc(t,n,s))})}function jp(n,e,t,s){t&&e(n),ia(n,i=>{jp(i,e,!0)})}function sT(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function _r(n){return new ce(n.parent===null?n.name:_r(n.parent)+"/"+n.name)}function Sl(n){n.parent!==null&&iT(n.parent,n.name,n)}function iT(n,e,t){const s=nT(t),i=Ht(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Sl(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Sl(n))}const rT=/[\[\].#$\/\u0000-\u001F\u007F]/,oT=/[\[\].#$\u0000-\u001F\u007F]/,Xa=10*1024*1024,Hp=function(n){return typeof n=="string"&&n.length!==0&&!rT.test(n)},$p=function(n){return typeof n=="string"&&n.length!==0&&!oT.test(n)},aT=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),$p(n)},zp=function(n,e,t,s){s&&e===void 0||Dc(ic(n,"value"),e,t)},Dc=function(n,e,t){const s=t instanceof ce?new AE(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+$n(s));if(typeof e=="function")throw new Error(n+"contains a function "+$n(s)+" with contents = "+e.toString());if($f(e))throw new Error(n+"contains "+e.toString()+" "+$n(s));if(typeof e=="string"&&e.length>Xa/3&&Yo(e)>Xa)throw new Error(n+"contains a string greater than "+Xa+" utf8 bytes "+$n(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(nt(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Hp(o)))throw new Error(n+" contains an invalid key ("+o+") "+$n(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);SE(s,o),Dc(n,l,s),RE(s)}),i&&r)throw new Error(n+' contains ".value" child '+$n(s)+" in addition to actual children.")}},Gp=function(n,e,t,s){if(!$p(t))throw new Error(ic(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},lT=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gp(n,e,t)},Oc=function(n,e){if(K(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},cT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!aT(t))throw new Error(ic(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class uT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function xc(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!hc(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Kp(n,e,t){xc(n,t),Qp(n,s=>hc(s,e))}function Bt(n,e,t){xc(n,t),Qp(n,s=>ut(s,e)||ut(e,s))}function Qp(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(hT(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function hT(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Ui&&$e("event: "+t.toString()),Js(s)}}}const dT="repo_interrupt",fT=25;class pT{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new uT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=So(),this.transactionQueueTree_=new kc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function gT(n,e,t){if(n.stats_=cc(n.repoInfo_),n.forceRestClient_||Yv())n.server_=new Ao(n.repoInfo_,(s,i,r,o)=>{nd(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>sd(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Me(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Vt(n.repoInfo_,e,(s,i,r,o)=>{nd(n,s,i,r,o)},s=>{sd(n,s)},s=>{mT(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=tE(n.repoInfo_,()=>new ZE(n.stats_,n.server_)),n.infoData_=new KE,n.infoSyncTree_=new Zh({startListening:(s,i,r,o)=>{let l=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(l=na(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Mc(n,"connected",!1),n.serverSyncTree_=new Zh({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(l,c)=>{const h=o(l,c);Bt(n.eventQueue_,s._path,h)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Yp(n){const t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Lc(n){return XI({timestamp:Yp(n)})}function nd(n,e,t,s,i){n.dataUpdateCount++;const r=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const c=Eo(t,h=>Be(h));o=GI(n.serverSyncTree_,r,c,i)}else{const c=Be(t);o=zI(n.serverSyncTree_,r,c,i)}else if(s){const c=Eo(t,h=>Be(h));o=jI(n.serverSyncTree_,r,c)}else{const c=Be(t);o=na(n.serverSyncTree_,r,c)}let l=r;o.length>0&&(l=ra(n,r)),Bt(n.eventQueue_,l,o)}function sd(n,e){Mc(n,"connected",e),e===!1&&yT(n)}function mT(n,e){nt(e,(t,s)=>{Mc(n,t,s)})}function Mc(n,e,t){const s=new ce("/.info/"+e),i=Be(t);n.infoData_.updateSnapshot(s,i);const r=na(n.infoSyncTree_,s,i);Bt(n.eventQueue_,s,r)}function Jp(n){return n.nextWriteId_++}function _T(n,e,t,s,i){Vc(n,"set",{path:e.toString(),value:t,priority:s});const r=Lc(n),o=Be(t,s),l=wc(n.serverSyncTree_,e),c=Bp(o,l,r),h=Jp(n),f=Mp(n.serverSyncTree_,e,c,h,!0);xc(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(m,A)=>{const S=m==="ok";S||tt("set at "+e+" failed: "+m);const P=Gn(n.serverSyncTree_,h,!S);Bt(n.eventQueue_,e,P),TT(n,i,m,A)});const p=ng(n,e);ra(n,p),Bt(n.eventQueue_,p,[])}function yT(n){Vc(n,"onDisconnectEvents");const e=Lc(n),t=So();vl(n.onDisconnect_,ie(),(i,r)=>{const o=tT(i,r,n.serverSyncTree_,e);Tp(t,i,o)});let s=[];vl(t,ie(),(i,r)=>{s=s.concat(na(n.serverSyncTree_,i,r));const o=ng(n,i);ra(n,o)}),n.onDisconnect_=So(),Bt(n.eventQueue_,ie(),s)}function vT(n,e,t){let s;K(e._path)===".info"?s=ed(n.infoSyncTree_,e,t):s=ed(n.serverSyncTree_,e,t),Kp(n.eventQueue_,e._path,s)}function ET(n,e,t){let s;K(e._path)===".info"?s=Al(n.infoSyncTree_,e,t):s=Al(n.serverSyncTree_,e,t),Kp(n.eventQueue_,e._path,s)}function IT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(dT)}function Vc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),$e(t,...e)}function TT(n,e,t,s){e&&Js(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Xp(n,e,t){return wc(n.serverSyncTree_,e,t)||q.EMPTY_NODE}function Fc(n,e=n.transactionQueueTree_){if(e||oa(n,e),Xs(e)){const t=eg(n,e);k(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&wT(n,_r(e),t)}else Wp(e)&&ia(e,t=>{Fc(n,t)})}function wT(n,e,t){const s=t.map(h=>h.currentWriteId),i=Xp(n,e,s);let r=i;const o=i.hash();for(let h=0;h<t.length;h++){const f=t[h];k(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const p=et(e,f.path);r=r.updateChild(p,f.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;n.server_.put(c.toString(),l,h=>{Vc(n,"transaction put response",{path:c.toString(),status:h});let f=[];if(h==="ok"){const p=[];for(let m=0;m<t.length;m++)t[m].status=2,f=f.concat(Gn(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();oa(n,Nc(n.transactionQueueTree_,e)),Fc(n,n.transactionQueueTree_),Bt(n.eventQueue_,e,f);for(let m=0;m<p.length;m++)Js(p[m])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{tt("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}ra(n,e)}},o)}function ra(n,e){const t=Zp(n,e),s=_r(t),i=eg(n,t);return CT(n,i,s),s}function CT(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],h=et(t,c.path);let f=!1,p;if(k(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)f=!0,p=c.abortReason,i=i.concat(Gn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=fT)f=!0,p="maxretry",i=i.concat(Gn(n.serverSyncTree_,c.currentWriteId,!0));else{const m=Xp(n,c.path,o);c.currentInputSnapshot=m;const A=e[l].update(m.val());if(A!==void 0){Dc("transaction failed: Data returned ",A,c.path);let S=Be(A);typeof A=="object"&&A!=null&&Ht(A,".priority")||(S=S.updatePriority(m.getPriority()));const O=c.currentWriteId,W=Lc(n),B=Bp(S,m,W);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=B,c.currentWriteId=Jp(n),o.splice(o.indexOf(O),1),i=i.concat(Mp(n.serverSyncTree_,c.path,B,c.currentWriteId,c.applyLocally)),i=i.concat(Gn(n.serverSyncTree_,O,!0))}else f=!0,p="nodata",i=i.concat(Gn(n.serverSyncTree_,c.currentWriteId,!0))}Bt(n.eventQueue_,t,i),i=[],f&&(e[l].status=2,(function(m){setTimeout(m,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(p),!1,null))))}oa(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)Js(s[l]);Fc(n,n.transactionQueueTree_)}function Zp(n,e){let t,s=n.transactionQueueTree_;for(t=K(e);t!==null&&Xs(s)===void 0;)s=Nc(s,t),e=he(e),t=K(e);return s}function eg(n,e){const t=[];return tg(n,e,t),t.sort((s,i)=>s.order-i.order),t}function tg(n,e,t){const s=Xs(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);ia(e,i=>{tg(n,i,t)})}function oa(n,e){const t=Xs(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,qp(e,t.length>0?t:void 0)}ia(e,s=>{oa(n,s)})}function ng(n,e){const t=_r(Zp(n,e)),s=Nc(n.transactionQueueTree_,e);return sT(s,i=>{Za(n,i)}),Za(n,s),jp(s,i=>{Za(n,i)}),t}function Za(n,e){const t=Xs(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(k(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(k(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Gn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?qp(e,void 0):t.length=r+1,Bt(n.eventQueue_,_r(e),i);for(let o=0;o<s.length;o++)Js(s[o])}}function AT(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function ST(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):tt(`Invalid query segment '${t}' in query '${n}'`)}return e}const id=function(n,e){const t=RT(n),s=t.namespace;t.domain==="firebase.com"&&Ut(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Ut("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||qv();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new sp(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new ce(t.pathString)}},RT=function(n){let e="",t="",s="",i="",r="",o=!0,l="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(f,p)),f<p&&(i=AT(n.substring(f,p)));const m=ST(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const A=e.slice(0,h);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const S=e.indexOf(".");s=e.substring(0,S).toLowerCase(),t=e.substring(S+1),r=s}"ns"in m&&(r=m.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};const rd="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",bT=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=rd.charAt(t%64),t=Math.floor(t/64);k(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=rd.charAt(e[i]);return k(o.length===20,"nextPushId: Length should be 20."),o}})();class PT{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Me(this.snapshot.exportVal())}}class kT{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class NT{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return k(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Uc{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return J(this._path)?null:dp(this._path)}get ref(){return new Rn(this._repo,this._path)}get _queryIdentifier(){const e=Wh(this._queryParams),t=ac(e);return t==="{}"?"default":t}get _queryObject(){return Wh(this._queryParams)}isEqual(e){if(e=Ke(e),!(e instanceof Uc))return!1;const t=this._repo===e._repo,s=hc(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+CE(this._path)}}class Rn extends Uc{constructor(e,t){super(e,t,new gc,!1)}get parent(){const e=pp(this._path);return e===null?null:new Rn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class xo{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ce(e),s=ir(this.ref,e);return new xo(this._node.getChild(t),s,Ee)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new xo(i,ir(this.ref,s),Ee)))}hasChild(e){const t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Xr(n,e){return n=Ke(n),n._checkNotDeleted("ref"),e!==void 0?ir(n._root,e):n._root}function ir(n,e){return n=Ke(n),K(n._path)===null?lT("child","path",e):Gp("child","path",e),new Rn(n._repo,ke(n._path,e))}function DT(n,e){n=Ke(n),Oc("push",n._path),zp("push",e,n._path,!0);const t=Yp(n._repo),s=bT(t),i=ir(n,s),r=ir(n,s);let o;return o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function OT(n){return Oc("remove",n._path),Rl(n,null)}function Rl(n,e){n=Ke(n),Oc("set",n._path),zp("set",e,n._path,!1);const t=new Qo;return _T(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Bc{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new PT("value",this,new xo(e.snapshotNode,new Rn(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new kT(this,e,t):null}matches(e){return e instanceof Bc?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function xT(n,e,t,s,i){const r=new NT(t,void 0),o=new Bc(r);return vT(n._repo,n,o),()=>ET(n._repo,n,o)}function LT(n,e,t,s){return xT(n,"value",e)}xI(Rn);BI(Rn);const MT="FIREBASE_DATABASE_EMULATOR_HOST",bl={};let VT=!1;function FT(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=Sn(r);n.repoInfo_=new sp(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function UT(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Ut("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),$e("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=id(r,i),l=o.repoInfo,c;typeof process<"u"&&Ch&&(c=Ch[MT]),c?(r=`http://${c}?ns=${l.namespace}`,o=id(r,i),l=o.repoInfo):o.repoInfo.secure;const h=new Xv(n.name,n.options,e);cT("Invalid Firebase Database URL",o),J(o.path)||Ut("Database URL must point to the root of a Firebase Database (not including a child path).");const f=qT(l,n,h,new Jv(n,t));return new WT(f,n)}function BT(n,e){const t=bl[e];(!t||t[n.key]!==n)&&Ut(`Database ${e}(${n.repoInfo_}) has already been deleted.`),IT(n),delete t[n.key]}function qT(n,e,t,s){let i=bl[e.name];i||(i={},bl[e.name]=i);let r=i[n.toURLString()];return r&&Ut("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new pT(n,VT,t,s),i[n.toURLString()]=r,r}class WT{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(gT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rn(this._repo,ie())),this._rootInternal}_delete(){return this._rootInternal!==null&&(BT(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ut("Cannot call "+e+" on a deleted database.")}}function jT(n=oc(),e){const t=Xo(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Nf("database");s&&HT(t,...s)}return t}function HT(n,e,t,s={}){n=Ke(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&mn(s,r.repoInfo_.emulatorOptions))return;Ut("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&Ut('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new oo(oo.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:xf(s.mockUserToken,n.app.options.projectId);o=new oo(l)}Sn(e)&&(tc(e),nc("Database",!0)),FT(r,i,s,o)}function $T(n){Lv(rs),Xn(new _n("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return UT(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),wt(Ah,Sh,n),wt(Ah,Sh,"esm2020")}Vt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Vt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};$T();function sg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const zT=sg,ig=new dr("auth","Firebase",sg());const Lo=new Jo("@firebase/auth");function GT(n,...e){Lo.logLevel<=Y.WARN&&Lo.warn(`Auth (${rs}): ${n}`,...e)}function lo(n,...e){Lo.logLevel<=Y.ERROR&&Lo.error(`Auth (${rs}): ${n}`,...e)}function pt(n,...e){throw qc(n,...e)}function Ct(n,...e){return qc(n,...e)}function rg(n,e,t){const s={...zT(),[e]:t};return new dr("auth","Firebase",s).create(e,{appName:n.name})}function dn(n){return rg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qc(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return ig.create(n,...e)}function U(n,e,...t){if(!n)throw qc(e,...t)}function Lt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw lo(e),new Error(e)}function qt(n,e){n||Lt(e)}function Pl(){return typeof self<"u"&&self.location?.href||""}function KT(){return od()==="http:"||od()==="https:"}function od(){return typeof self<"u"&&self.location?.protocol||null}function QT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(KT()||cy()||"connection"in navigator)?navigator.onLine:!0}function YT(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class yr{constructor(e,t){this.shortDelay=e,this.longDelay=t,qt(t>e,"Short delay should be less than long delay!"),this.isMobile=sc()||Lf()}get(){return QT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Wc(n,e){qt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class og{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const JT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const XT=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ZT=new yr(3e4,6e4);function as(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function bn(n,e,t,s,i={}){return ag(n,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const l=Qs({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:c,...r};return ly()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Sn(n.emulatorConfig.host)&&(h.credentials="include"),og.fetch()(await lg(n,n.config.apiHost,t,l),h)})}async function ag(n,e,t){n._canInitEmulator=!1;const s={...JT,...e};try{const i=new tw(n),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Zr(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const l=r.ok?o.errorMessage:o.error.message,[c,h]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Zr(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Zr(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Zr(n,"user-disabled",o);const f=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw rg(n,f,h);pt(n,f)}}catch(i){if(i instanceof jt)throw i;pt(n,"network-request-failed",{message:String(i)})}}async function aa(n,e,t,s,i={}){const r=await bn(n,e,t,s,i);return"mfaPendingCredential"in r&&pt(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function lg(n,e,t,s){const i=`${e}${t}?${s}`,r=n,o=r.config.emulator?Wc(n.config,i):`${n.config.apiScheme}://${i}`;return XT.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function ew(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class tw{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Ct(this.auth,"network-request-failed")),ZT.get())})}}function Zr(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const i=Ct(n,e,s);return i.customData._tokenResponse=t,i}function ad(n){return n!==void 0&&n.enterprise!==void 0}class nw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ew(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function sw(n,e){return bn(n,"GET","/v2/recaptchaConfig",as(n,e))}async function iw(n,e){return bn(n,"POST","/v1/accounts:delete",e)}async function Mo(n,e){return bn(n,"POST","/v1/accounts:lookup",e)}function Hi(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function rw(n,e=!1){const t=Ke(n),s=await t.getIdToken(e),i=jc(s);U(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r?.sign_in_provider;return{claims:i,token:s,authTime:Hi(el(i.auth_time)),issuedAtTime:Hi(el(i.iat)),expirationTime:Hi(el(i.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}}function el(n){return Number(n)*1e3}function jc(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return lo("JWT malformed, contained fewer than 3 sections"),null;try{const i=vo(t);return i?JSON.parse(i):(lo("Failed to decode base64 JWT payload"),null)}catch(i){return lo("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ld(n){const e=jc(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function rr(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof jt&&ow(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function ow({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class aw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class kl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hi(this.lastLoginAt),this.creationTime=Hi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Vo(n){const e=n.auth,t=await n.getIdToken(),s=await rr(n,Mo(e,{idToken:t}));U(s?.users.length,e,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const r=i.providerUserInfo?.length?cg(i.providerUserInfo):[],o=cw(n.providerData,r),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!o?.length,h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new kl(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function lw(n){const e=Ke(n);await Vo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function cw(n,e){return[...n.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function cg(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function uw(n,e){const t=await ag(n,{},async()=>{const s=Qs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=n.config,o=await lg(n,i,"/v1/token",`key=${r}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:s};return n.emulatorConfig&&Sn(n.emulatorConfig.host)&&(c.credentials="include"),og.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function hw(n,e){return bn(n,"POST","/v2/accounts:revokeToken",as(n,e))}class ks{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ld(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");const t=ld(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:i,expiresIn:r}=await uw(e,t);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:i,expirationTime:r}=t,o=new ks;return s&&(U(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(U(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(U(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ks,this.toJSON())}_performRefresh(){return Lt("not implemented")}}function en(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class dt{constructor({uid:e,auth:t,stsTokenManager:s,...i}){this.providerId="firebase",this.proactiveRefresh=new aw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new kl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await rr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return rw(this,e)}reload(){return lw(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new dt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Vo(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ot(this.auth.app))return Promise.reject(dn(this.auth));const e=await this.getIdToken();return await rr(this,iw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,o=t.photoURL??void 0,l=t.tenantId??void 0,c=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:A,providerData:S,stsTokenManager:P}=t;U(p&&P,e,"internal-error");const O=ks.fromJSON(this.name,P);U(typeof p=="string",e,"internal-error"),en(s,e.name),en(i,e.name),U(typeof m=="boolean",e,"internal-error"),U(typeof A=="boolean",e,"internal-error"),en(r,e.name),en(o,e.name),en(l,e.name),en(c,e.name),en(h,e.name),en(f,e.name);const W=new dt({uid:p,auth:e,email:i,emailVerified:m,displayName:s,isAnonymous:A,photoURL:o,phoneNumber:r,tenantId:l,stsTokenManager:O,createdAt:h,lastLoginAt:f});return S&&Array.isArray(S)&&(W.providerData=S.map(B=>({...B}))),c&&(W._redirectEventId=c),W}static async _fromIdTokenResponse(e,t,s=!1){const i=new ks;i.updateFromServerResponse(t);const r=new dt({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Vo(r),r}static async _fromGetAccountInfoResponse(e,t,s){const i=t.users[0];U(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?cg(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!r?.length,l=new ks;l.updateFromIdToken(s);const c=new dt({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new kl(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length};return Object.assign(c,h),c}}const cd=new Map;function Mt(n){qt(n instanceof Function,"Expected a class definition");let e=cd.get(n);return e?(qt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,cd.set(n,e),e)}class ug{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ug.type="NONE";const ud=ug;function co(n,e,t){return`firebase:${n}:${e}:${t}`}class Ns{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=co(this.userKey,i.apiKey,r),this.fullPersistenceKey=co("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Mo(this.auth,{idToken:e}).catch(()=>{});return t?dt._fromGetAccountInfoResponse(this.auth,t,e):null}return dt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Ns(Mt(ud),e,s);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=i[0]||Mt(ud);const o=co(s,e.config.apiKey,e.name);let l=null;for(const h of t)try{const f=await h._get(o);if(f){let p;if(typeof f=="string"){const m=await Mo(e,{idToken:f}).catch(()=>{});if(!m)break;p=await dt._fromGetAccountInfoResponse(e,m,f)}else p=dt._fromJSON(e,f);h!==r&&(l=p),r=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Ns(r,e,s):(r=c[0],l&&await r._set(o,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==r)try{await h._remove(o)}catch{}})),new Ns(r,e,s))}}function hd(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mg(e))return"Blackberry";if(_g(e))return"Webos";if(dg(e))return"Safari";if((e.includes("chrome/")||fg(e))&&!e.includes("edge/"))return"Chrome";if(gg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function hg(n=Ge()){return/firefox\//i.test(n)}function dg(n=Ge()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fg(n=Ge()){return/crios\//i.test(n)}function pg(n=Ge()){return/iemobile/i.test(n)}function gg(n=Ge()){return/android/i.test(n)}function mg(n=Ge()){return/blackberry/i.test(n)}function _g(n=Ge()){return/webos/i.test(n)}function Hc(n=Ge()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function dw(n=Ge()){return Hc(n)&&!!window.navigator?.standalone}function fw(){return uy()&&document.documentMode===10}function yg(n=Ge()){return Hc(n)||gg(n)||_g(n)||mg(n)||/windows phone/i.test(n)||pg(n)}function vg(n,e=[]){let t;switch(n){case"Browser":t=hd(Ge());break;case"Worker":t=`${hd(Ge())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${rs}/${s}`}class pw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=r=>new Promise((o,l)=>{try{const c=e(r);o(c)}catch(c){l(c)}});s.onAbort=t,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function gw(n,e={}){return bn(n,"GET","/v2/passwordPolicy",as(n,e))}const mw=6;class _w{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??mw,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class yw{constructor(e,t,s,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dd(this),this.idTokenSubscription=new dd(this),this.beforeStateQueue=new pw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ig,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Mt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ns.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Mo(this,{idToken:e}),s=await dt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ot(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,o=s?._redirectEventId,l=await this.tryRedirectSignIn(e);(!r||r===o)&&l?.user&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vo(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=YT()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ot(this.app))return Promise.reject(dn(this));const t=e?Ke(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ot(this.app)?Promise.reject(dn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ot(this.app)?Promise.reject(dn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gw(this),t=new _w(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dr("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await hw(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Mt(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await Ns.create(this,[Mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(l,this,"internal-error"),l.then(()=>{o||r(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(ot(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&GT(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Zs(n){return Ke(n)}class dd{constructor(e){this.auth=e,this.observer=null,this.addObserver=Iy(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let la={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function vw(n){la=n}function Eg(n){return la.loadJS(n)}function Ew(){return la.recaptchaEnterpriseScript}function Iw(){return la.gapiScript}function Tw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ww{constructor(){this.enterprise=new Cw}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Cw{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Aw="recaptcha-enterprise",Ig="NO_RECAPTCHA";class Sw{constructor(e){this.type=Aw,this.auth=Zs(e)}async verify(e="verify",t=!1){async function s(r){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,l)=>{sw(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new nw(c);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,o(h.siteKey)}}).catch(c=>{l(c)})})}function i(r,o,l){const c=window.grecaptcha;ad(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(h=>{o(h)}).catch(()=>{o(Ig)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ww().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(l=>{if(!t&&ad(window.grecaptcha))i(l,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Ew();c.length!==0&&(c+=l),Eg(c).then(()=>{i(l,r,o)}).catch(h=>{o(h)})}}).catch(l=>{o(l)})})}}async function fd(n,e,t,s=!1,i=!1){const r=new Sw(n);let o;if(i)o=Ig;else try{o=await r.verify(t)}catch{o=await r.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return s?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function pd(n,e,t,s,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await fd(n,e,t,t==="getOobCode");return s(n,r)}else return s(n,e).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await fd(n,e,t,t==="getOobCode");return s(n,o)}else return Promise.reject(r)})}function Rw(n,e){const t=Xo(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),r=t.getOptions();if(mn(r,e??{}))return i;pt(i,"already-initialized")}return t.initialize({options:e})}function bw(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Mt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Pw(n,e,t){const s=Zs(n);U(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=Tg(e),{host:o,port:l}=kw(e),c=l===null?"":`:${l}`,h={url:`${r}//${o}${c}/`},f=Object.freeze({host:o,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){U(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),U(mn(h,s.config.emulator)&&mn(f,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=h,s.emulatorConfig=f,s.settings.appVerificationDisabledForTesting=!0,Sn(o)?(tc(`${r}//${o}${c}`),nc("Auth",!0)):Nw()}function Tg(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function kw(n){const e=Tg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:gd(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:gd(o)}}}function gd(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Nw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class $c{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Lt("not implemented")}_getIdTokenResponse(e){return Lt("not implemented")}_linkToIdToken(e,t){return Lt("not implemented")}_getReauthenticationResolver(e){return Lt("not implemented")}}async function Dw(n,e){return bn(n,"POST","/v1/accounts:signUp",e)}async function Ow(n,e){return aa(n,"POST","/v1/accounts:signInWithPassword",as(n,e))}async function xw(n,e){return aa(n,"POST","/v1/accounts:signInWithEmailLink",as(n,e))}async function Lw(n,e){return aa(n,"POST","/v1/accounts:signInWithEmailLink",as(n,e))}class or extends $c{constructor(e,t,s,i=null){super("password",s),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new or(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new or(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pd(e,t,"signInWithPassword",Ow);case"emailLink":return xw(e,{email:this._email,oobCode:this._password});default:pt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pd(e,s,"signUpPassword",Dw);case"emailLink":return Lw(e,{idToken:t,email:this._email,oobCode:this._password});default:pt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ds(n,e){return aa(n,"POST","/v1/accounts:signInWithIdp",as(n,e))}const Mw="http://localhost";class ss extends $c{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ss(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):pt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i,...r}=t;if(!s||!i)return null;const o=new ss(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ds(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Ds(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ds(e,t)}buildRequest(){const e={requestUri:Mw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qs(t)}return e}}function Vw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Fw(n){const e=Ni(Di(n)).link,t=e?Ni(Di(e)).deep_link_id:null,s=Ni(Di(n)).deep_link_id;return(s?Ni(Di(s)).link:null)||s||t||e||n}class zc{constructor(e){const t=Ni(Di(e)),s=t.apiKey??null,i=t.oobCode??null,r=Vw(t.mode??null);U(s&&i&&r,"argument-error"),this.apiKey=s,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Fw(e);try{return new zc(t)}catch{return null}}}class ei{constructor(){this.providerId=ei.PROVIDER_ID}static credential(e,t){return or._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=zc.parseLink(t);return U(s,"argument-error"),or._fromEmailAndCode(e,s.code,s.tenantId)}}ei.PROVIDER_ID="password";ei.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ei.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vr extends wg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tn extends vr{constructor(){super("facebook.com")}static credential(e){return ss._fromParams({providerId:tn.PROVIDER_ID,signInMethod:tn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tn.credentialFromTaggedObject(e)}static credentialFromError(e){return tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tn.credential(e.oauthAccessToken)}catch{return null}}}tn.FACEBOOK_SIGN_IN_METHOD="facebook.com";tn.PROVIDER_ID="facebook.com";class nn extends vr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ss._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return nn.credential(t,s)}catch{return null}}}nn.GOOGLE_SIGN_IN_METHOD="google.com";nn.PROVIDER_ID="google.com";class sn extends vr{constructor(){super("github.com")}static credential(e){return ss._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sn.credentialFromTaggedObject(e)}static credentialFromError(e){return sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sn.credential(e.oauthAccessToken)}catch{return null}}}sn.GITHUB_SIGN_IN_METHOD="github.com";sn.PROVIDER_ID="github.com";class rn extends vr{constructor(){super("twitter.com")}static credential(e,t){return ss._fromParams({providerId:rn.PROVIDER_ID,signInMethod:rn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rn.credentialFromTaggedObject(e)}static credentialFromError(e){return rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return rn.credential(t,s)}catch{return null}}}rn.TWITTER_SIGN_IN_METHOD="twitter.com";rn.PROVIDER_ID="twitter.com";class Bs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,i=!1){const r=await dt._fromIdTokenResponse(e,s,i),o=md(s);return new Bs({user:r,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const i=md(s);return new Bs({user:e,providerId:i,_tokenResponse:s,operationType:t})}}function md(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Fo extends jt{constructor(e,t,s,i){super(t.code,t.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Fo.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,i){return new Fo(e,t,s,i)}}function Cg(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Fo._fromErrorAndOperation(n,r,e,s):r})}async function Uw(n,e,t=!1){const s=await rr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Bs._forOperation(n,"link",s)}async function Bw(n,e,t=!1){const{auth:s}=n;if(ot(s.app))return Promise.reject(dn(s));const i="reauthenticate";try{const r=await rr(n,Cg(s,i,e,n),t);U(r.idToken,s,"internal-error");const o=jc(r.idToken);U(o,s,"internal-error");const{sub:l}=o;return U(n.uid===l,s,"user-mismatch"),Bs._forOperation(n,i,r)}catch(r){throw r?.code==="auth/user-not-found"&&pt(s,"user-mismatch"),r}}async function Ag(n,e,t=!1){if(ot(n.app))return Promise.reject(dn(n));const s="signIn",i=await Cg(n,s,e),r=await Bs._fromIdTokenResponse(n,s,i);return t||await n._updateCurrentUser(r.user),r}async function qw(n,e){return Ag(Zs(n),e)}async function Ww(n){const e=Zs(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function jw(n,e,t){return ot(n.app)?Promise.reject(dn(n)):qw(Ke(n),ei.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&Ww(n),s})}function Hw(n,e,t,s){return Ke(n).onIdTokenChanged(e,t,s)}function $w(n,e,t){return Ke(n).beforeAuthStateChanged(e,t)}function zw(n,e,t,s){return Ke(n).onAuthStateChanged(e,t,s)}const Uo="__sak";class Sg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Uo,"1"),this.storage.removeItem(Uo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Gw=1e3,Kw=10;class Rg extends Sg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),i=this.localCache[t];s!==i&&e(t,i,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);fw()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Kw):i()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},Gw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rg.type="LOCAL";const Qw=Rg;class bg extends Sg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bg.type="SESSION";const Pg=bg;function Yw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ca{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const s=new ca(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:i,data:r}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async h=>h(t.origin,r)),c=await Yw(l);t.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ca.receivers=[];function Gc(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class Jw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((l,c)=>{const h=Gc("",20);i.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(f),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(m.data.response);break;default:clearTimeout(f),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function At(){return window}function Xw(n){At().location.href=n}function kg(){return typeof At().WorkerGlobalScope<"u"&&typeof At().importScripts=="function"}async function Zw(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function eC(){return navigator?.serviceWorker?.controller||null}function tC(){return kg()?self:null}const Ng="firebaseLocalStorageDb",nC=1,Bo="firebaseLocalStorage",Dg="fbase_key";class Er{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ua(n,e){return n.transaction([Bo],e?"readwrite":"readonly").objectStore(Bo)}function sC(){const n=indexedDB.deleteDatabase(Ng);return new Er(n).toPromise()}function Nl(){const n=indexedDB.open(Ng,nC);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Bo,{keyPath:Dg})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Bo)?e(s):(s.close(),await sC(),e(await Nl()))})})}async function _d(n,e,t){const s=ua(n,!0).put({[Dg]:e,value:t});return new Er(s).toPromise()}async function iC(n,e){const t=ua(n,!1).get(e),s=await new Er(t).toPromise();return s===void 0?null:s.value}function yd(n,e){const t=ua(n,!0).delete(e);return new Er(t).toPromise()}const rC=800,oC=3;class Og{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Nl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>oC)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ca._getInstance(tC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Zw(),!this.activeServiceWorker)return;this.sender=new Jw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||eC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Nl();return await _d(e,Uo,"1"),await yd(e,Uo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>_d(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>iC(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>yd(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=ua(i,!1).getAll();return new Er(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),rC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Og.type="LOCAL";const aC=Og;new yr(3e4,6e4);function lC(n,e){return e?Mt(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Kc extends $c{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ds(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ds(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ds(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cC(n){return Ag(n.auth,new Kc(n),n.bypassAuthState)}function uC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),Bw(t,new Kc(n),n.bypassAuthState)}async function hC(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),Uw(t,new Kc(n),n.bypassAuthState)}class xg{constructor(e,t,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:i,tenantId:r,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cC;case"linkViaPopup":case"linkViaRedirect":return hC;case"reauthViaPopup":case"reauthViaRedirect":return uC;default:pt(this.auth,"internal-error")}}resolve(e){qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const dC=new yr(2e3,1e4);class Ss extends xg{constructor(e,t,s,i,r){super(e,t,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Ss.currentPopupAction&&Ss.currentPopupAction.cancel(),Ss.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){qt(this.filter.length===1,"Popup operations only handle one event");const e=Gc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ct(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ct(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ss.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ct(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dC.get())};e()}}Ss.currentPopupAction=null;const fC="pendingRedirect",uo=new Map;class pC extends xg{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=uo.get(this.auth._key());if(!e){try{const s=await gC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}uo.set(this.auth._key(),e)}return this.bypassAuthState||uo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gC(n,e){const t=yC(e),s=_C(n);if(!await s._isAvailable())return!1;const i=await s._get(t)==="true";return await s._remove(t),i}function mC(n,e){uo.set(n._key(),e)}function _C(n){return Mt(n._redirectPersistence)}function yC(n){return co(fC,n.config.apiKey,n.name)}async function vC(n,e,t=!1){if(ot(n.app))return Promise.reject(dn(n));const s=Zs(n),i=lC(s,e),o=await new pC(s,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const EC=600*1e3;class IC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!TC(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Lg(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ct(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EC&&this.cachedEventUids.clear(),this.cachedEventUids.has(vd(e))}saveEventToCache(e){this.cachedEventUids.add(vd(e)),this.lastProcessedEventTime=Date.now()}}function vd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Lg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function TC(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Lg(n);default:return!1}}async function wC(n,e={}){return bn(n,"GET","/v1/projects",e)}const CC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,AC=/^https?/;async function SC(n){if(n.config.emulator)return;const{authorizedDomains:e}=await wC(n);for(const t of e)try{if(RC(t))return}catch{}pt(n,"unauthorized-domain")}function RC(n){const e=Pl(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!AC.test(t))return!1;if(CC.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}const bC=new yr(3e4,6e4);function Ed(){const n=At().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function PC(n){return new Promise((e,t)=>{function s(){Ed(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ed(),t(Ct(n,"network-request-failed"))},timeout:bC.get()})}if(At().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(At().gapi?.load)s();else{const i=Tw("iframefcb");return At()[i]=()=>{gapi.load?s():t(Ct(n,"network-request-failed"))},Eg(`${Iw()}?onload=${i}`).catch(r=>t(r))}}).catch(e=>{throw ho=null,e})}let ho=null;function kC(n){return ho=ho||PC(n),ho}const NC=new yr(5e3,15e3),DC="__/auth/iframe",OC="emulator/auth/iframe",xC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MC(n){const e=n.config;U(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Wc(e,OC):`https://${n.config.authDomain}/${DC}`,s={apiKey:e.apiKey,appName:n.name,v:rs},i=LC.get(n.config.apiHost);i&&(s.eid=i);const r=n._getFrameworks();return r.length&&(s.fw=r.join(",")),`${t}?${Qs(s).slice(1)}`}async function VC(n){const e=await kC(n),t=At().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:MC(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xC,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=Ct(n,"network-request-failed"),l=At().setTimeout(()=>{r(o)},NC.get());function c(){At().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{r(o)})}))}const FC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},UC=500,BC=600,qC="_blank",WC="http://localhost";class Id{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jC(n,e,t,s=UC,i=BC){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c={...FC,width:s.toString(),height:i.toString(),top:r,left:o},h=Ge().toLowerCase();t&&(l=fg(h)?qC:t),hg(h)&&(e=e||WC,c.scrollbars="yes");const f=Object.entries(c).reduce((m,[A,S])=>`${m}${A}=${S},`,"");if(dw(h)&&l!=="_self")return HC(e||"",l),new Id(null);const p=window.open(e||"",l,f);U(p,n,"popup-blocked");try{p.focus()}catch{}return new Id(p)}function HC(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const $C="__/auth/handler",zC="emulator/auth/handler",GC=encodeURIComponent("fac");async function Td(n,e,t,s,i,r){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:rs,eventId:i};if(e instanceof wg){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ul(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))o[f]=p}if(e instanceof vr){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await n._getAppCheckToken(),h=c?`#${GC}=${encodeURIComponent(c)}`:"";return`${KC(n)}?${Qs(l).slice(1)}${h}`}function KC({config:n}){return n.emulator?Wc(n,zC):`https://${n.authDomain}/${$C}`}const tl="webStorageSupport";class QC{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pg,this._completeRedirectFn=vC,this._overrideRedirectResult=mC}async _openPopup(e,t,s,i){qt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const r=await Td(e,t,s,Pl(),i);return jC(e,r,Gc())}async _openRedirect(e,t,s,i){await this._originValidation(e);const r=await Td(e,t,s,Pl(),i);return Xw(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:r}=this.eventManagers[t];return i?Promise.resolve(i):(qt(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await VC(e),s=new IC(e);return t.register("authEvent",i=>(U(i?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tl,{type:tl},i=>{const r=i?.[0]?.[tl];r!==void 0&&t(!!r),pt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=SC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return yg()||dg()||Hc()}}const YC=QC;var wd="@firebase/auth",Cd="1.12.0";class JC{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function XC(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ZC(n){Xn(new _n("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;U(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vg(n)},h=new yw(s,i,r,c);return bw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Xn(new _n("auth-internal",e=>{const t=Zs(e.getProvider("auth").getImmediate());return(s=>new JC(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),wt(wd,Cd,XC(n)),wt(wd,Cd,"esm2020")}const eA=300,tA=Of("authIdTokenMaxAge")||eA;let Ad=null;const nA=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>tA)return;const i=t?.token;Ad!==i&&(Ad=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function sA(n=oc()){const e=Xo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Rw(n,{popupRedirectResolver:YC,persistence:[aC,Qw,Pg]}),s=Of("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=nA(r.toString());$w(t,o,()=>o(t.currentUser)),Hw(t,l=>o(l))}}const i=kf("auth");return i&&Pw(t,`http://${i}`),t}function iA(){return document.getElementsByTagName("head")?.[0]??document}vw({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=i=>{const r=Ct("internal-error");r.customData=i,t(r)},s.type="text/javascript",s.charset="UTF-8",iA().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ZC("Browser");var Sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,Mg;(function(){var n;function e(E,_){function v(){}v.prototype=_.prototype,E.F=_.prototype,E.prototype=new v,E.prototype.constructor=E,E.D=function(T,I,C){for(var y=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)y[Ve-2]=arguments[Ve];return _.prototype[I].apply(T,y)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,v){v||(v=0);const T=Array(16);if(typeof _=="string")for(var I=0;I<16;++I)T[I]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(I=0;I<16;++I)T[I]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=E.g[0],v=E.g[1],I=E.g[2];let C=E.g[3],y;y=_+(C^v&(I^C))+T[0]+3614090360&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[1]+3905402710&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[2]+606105819&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[3]+3250441966&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[4]+4118548399&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[5]+1200080426&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[6]+2821735955&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[7]+4249261313&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[8]+1770035416&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[9]+2336552879&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[10]+4294925233&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[11]+2304563134&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(C^v&(I^C))+T[12]+1804603682&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(I^_&(v^I))+T[13]+4254626195&4294967295,C=_+(y<<12&4294967295|y>>>20),y=I+(v^C&(_^v))+T[14]+2792965006&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(_^I&(C^_))+T[15]+1236535329&4294967295,v=I+(y<<22&4294967295|y>>>10),y=_+(I^C&(v^I))+T[1]+4129170786&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[6]+3225465664&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[11]+643717713&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[0]+3921069994&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[5]+3593408605&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[10]+38016083&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[15]+3634488961&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[4]+3889429448&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[9]+568446438&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[14]+3275163606&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[3]+4107603335&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[8]+1163531501&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(I^C&(v^I))+T[13]+2850285829&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(_^v))+T[2]+4243563512&4294967295,C=_+(y<<9&4294967295|y>>>23),y=I+(_^v&(C^_))+T[7]+1735328473&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(I^C))+T[12]+2368359562&4294967295,v=I+(y<<20&4294967295|y>>>12),y=_+(v^I^C)+T[5]+4294588738&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[8]+2272392833&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[11]+1839030562&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[14]+4259657740&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[1]+2763975236&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[4]+1272893353&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[7]+4139469664&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[10]+3200236656&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[13]+681279174&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[0]+3936430074&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[3]+3572445317&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[6]+76029189&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(v^I^C)+T[9]+3654602809&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^I)+T[12]+3873151461&4294967295,C=_+(y<<11&4294967295|y>>>21),y=I+(C^_^v)+T[15]+530742520&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^_)+T[2]+3299628645&4294967295,v=I+(y<<23&4294967295|y>>>9),y=_+(I^(v|~C))+T[0]+4096336452&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[7]+1126891415&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[14]+2878612391&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[5]+4237533241&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[12]+1700485571&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[3]+2399980690&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[10]+4293915773&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[1]+2240044497&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[8]+1873313359&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[15]+4264355552&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[6]+2734768916&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[13]+1309151649&4294967295,v=I+(y<<21&4294967295|y>>>11),y=_+(I^(v|~C))+T[4]+4149444226&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~I))+T[11]+3174756917&4294967295,C=_+(y<<10&4294967295|y>>>22),y=I+(_^(C|~v))+T[2]+718787259&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+C&4294967295}s.prototype.v=function(E,_){_===void 0&&(_=E.length);const v=_-this.blockSize,T=this.C;let I=this.h,C=0;for(;C<_;){if(I==0)for(;C<=v;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(T[I++]=E.charCodeAt(C++),I==this.blockSize){i(this,T),I=0;break}}else for(;C<_;)if(T[I++]=E[C++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=_},s.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;_=this.o*8;for(var v=E.length-8;v<E.length;++v)E[v]=_&255,_/=256;for(this.v(E),E=Array(16),_=0,v=0;v<4;++v)for(let T=0;T<32;T+=8)E[_++]=this.g[v]>>>T&255;return E};function r(E,_){var v=l;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=_(E)}function o(E,_){this.h=_;const v=[];let T=!0;for(let I=E.length-1;I>=0;I--){const C=E[I]|0;T&&C==_||(v[I]=C,T=!1)}this.g=v}var l={};function c(E){return-128<=E&&E<128?r(E,function(_){return new o([_|0],_<0?-1:0)}):new o([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return O(h(-E));const _=[];let v=1;for(let T=0;E>=v;T++)_[T]=E/v|0,v*=4294967296;return new o(_,0)}function f(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return O(f(E.substring(1),_));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=h(Math.pow(_,8));let T=p;for(let C=0;C<E.length;C+=8){var I=Math.min(8,E.length-C);const y=parseInt(E.substring(C,C+I),_);I<8?(I=h(Math.pow(_,I)),T=T.j(I).add(h(y))):(T=T.j(v),T=T.add(h(y)))}return T}var p=c(0),m=c(1),A=c(16777216);n=o.prototype,n.m=function(){if(P(this))return-O(this).m();let E=0,_=1;for(let v=0;v<this.g.length;v++){const T=this.i(v);E+=(T>=0?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(P(this))return"-"+O(this).toString(E);const _=h(Math.pow(E,6));var v=this;let T="";for(;;){const I=re(v,_).g;v=W(v,I.j(_));let C=((v.g.length>0?v.g[0]:v.h)>>>0).toString(E);if(v=I,S(v))return C+T;for(;C.length<6;)C="0"+C;T=C+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(let _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function P(E){return E.h==-1}n.l=function(E){return E=W(this,E),P(E)?-1:S(E)?0:1};function O(E){const _=E.g.length,v=[];for(let T=0;T<_;T++)v[T]=~E.g[T];return new o(v,~E.h).add(m)}n.abs=function(){return P(this)?O(this):this},n.add=function(E){const _=Math.max(this.g.length,E.g.length),v=[];let T=0;for(let I=0;I<=_;I++){let C=T+(this.i(I)&65535)+(E.i(I)&65535),y=(C>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=y>>>16,C&=65535,y&=65535,v[I]=y<<16|C}return new o(v,v[v.length-1]&-2147483648?-1:0)};function W(E,_){return E.add(O(_))}n.j=function(E){if(S(this)||S(E))return p;if(P(this))return P(E)?O(this).j(O(E)):O(O(this).j(E));if(P(E))return O(this.j(O(E)));if(this.l(A)<0&&E.l(A)<0)return h(this.m()*E.m());const _=this.g.length+E.g.length,v=[];for(var T=0;T<2*_;T++)v[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<E.g.length;I++){const C=this.i(T)>>>16,y=this.i(T)&65535,Ve=E.i(I)>>>16,gt=E.i(I)&65535;v[2*T+2*I]+=y*gt,B(v,2*T+2*I),v[2*T+2*I+1]+=C*gt,B(v,2*T+2*I+1),v[2*T+2*I+1]+=y*Ve,B(v,2*T+2*I+1),v[2*T+2*I+2]+=C*Ve,B(v,2*T+2*I+2)}for(E=0;E<_;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=_;E<2*_;E++)v[E]=0;return new o(v,0)};function B(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function z(E,_){this.g=E,this.h=_}function re(E,_){if(S(_))throw Error("division by zero");if(S(E))return new z(p,p);if(P(E))return _=re(O(E),_),new z(O(_.g),O(_.h));if(P(_))return _=re(E,O(_)),new z(O(_.g),_.h);if(E.g.length>30){if(P(E)||P(_))throw Error("slowDivide_ only works with positive integers.");for(var v=m,T=_;T.l(E)<=0;)v=se(v),T=se(T);var I=de(v,1),C=de(T,1);for(T=de(T,2),v=de(v,2);!S(T);){var y=C.add(T);y.l(E)<=0&&(I=I.add(v),C=y),T=de(T,1),v=de(v,1)}return _=W(E,I.j(_)),new z(I,_)}for(I=p;E.l(_)>=0;){for(v=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(v)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),C=h(v),y=C.j(_);P(y)||y.l(E)>0;)v-=T,C=h(v),y=C.j(_);S(C)&&(C=m),I=I.add(C),E=W(E,y)}return new z(I,E)}n.B=function(E){return re(this,E).h},n.and=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)&E.i(T);return new o(v,this.h&E.h)},n.or=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)|E.i(T);return new o(v,this.h|E.h)},n.xor=function(E){const _=Math.max(this.g.length,E.g.length),v=[];for(let T=0;T<_;T++)v[T]=this.i(T)^E.i(T);return new o(v,this.h^E.h)};function se(E){const _=E.g.length+1,v=[];for(let T=0;T<_;T++)v[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(v,E.h)}function de(E,_){const v=_>>5;_%=32;const T=E.g.length-v,I=[];for(let C=0;C<T;C++)I[C]=_>0?E.i(C+v)>>>_|E.i(C+v+1)<<32-_:E.i(C+v);return new o(I,E.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Mg=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,fn=o}).apply(typeof Sd<"u"?Sd:typeof self<"u"?self:typeof window<"u"?window:{});var eo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vg,xi,Fg,fo,Dl,Ug,Bg,qg;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof eo=="object"&&eo];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function i(a,u){if(u)e:{var d=s;a=a.split(".");for(var g=0;g<a.length-1;g++){var w=a[g];if(!(w in d))break e;d=d[w]}a=a[a.length-1],g=d[a],u=u(g),u!=g&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(u){var d=[],g;for(g in u)Object.prototype.hasOwnProperty.call(u,g)&&d.push([g,u[g]]);return d}});var r=r||{},o=this||self;function l(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function c(a,u,d){return a.call.apply(a.bind,arguments)}function h(a,u,d){return h=c,h.apply(null,arguments)}function f(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function p(a,u){function d(){}d.prototype=u.prototype,a.Z=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(g,w,R){for(var D=Array(arguments.length-2),G=2;G<arguments.length;G++)D[G-2]=arguments[G];return u.prototype[w].apply(g,D)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function A(a){const u=a.length;if(u>0){const d=Array(u);for(let g=0;g<u;g++)d[g]=a[g];return d}return[]}function S(a,u){for(let g=1;g<arguments.length;g++){const w=arguments[g];var d=typeof w;if(d=d!="object"?d:w?Array.isArray(w)?"array":d:"null",d=="array"||d=="object"&&typeof w.length=="number"){d=a.length||0;const R=w.length||0;a.length=d+R;for(let D=0;D<R;D++)a[d+D]=w[D]}else a.push(w)}}class P{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function O(a){o.setTimeout(()=>{throw a},0)}function W(){var a=E;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class B{constructor(){this.h=this.g=null}add(u,d){const g=z.get();g.set(u,d),this.h?this.h.next=g:this.g=g,this.h=g}}var z=new P(()=>new re,a=>a.reset());class re{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let se,de=!1,E=new B,_=()=>{const a=Promise.resolve(void 0);se=()=>{a.then(v)}};function v(){for(var a;a=W();){try{a.h.call(a.g)}catch(d){O(d)}var u=z;u.j(a),u.h<100&&(u.h++,a.next=u.g,u.g=a)}de=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var C=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,u),o.removeEventListener("test",d,u)}catch{}return a})();function y(a){return/^[\s\xa0]*$/.test(a)}function Ve(a,u){I.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,u)}p(Ve,I),Ve.prototype.init=function(a,u){const d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget,u||(d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement)),this.relatedTarget=u,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&Ve.Z.h.call(this)},Ve.prototype.h=function(){Ve.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var gt="closure_listenable_"+(Math.random()*1e6|0),cs=0;function Sr(a,u,d,g,w){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!g,this.ha=w,this.key=++cs,this.da=this.fa=!1}function Pn(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function kn(a,u,d){for(const g in a)u.call(d,a[g],g,a)}function ii(a,u){for(const d in a)u.call(void 0,a[d],d,a)}function us(a){const u={};for(const d in a)u[d]=a[d];return u}const hs="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ds(a,u){let d,g;for(let w=1;w<arguments.length;w++){g=arguments[w];for(d in g)a[d]=g[d];for(let R=0;R<hs.length;R++)d=hs[R],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function Nn(a){this.src=a,this.g={},this.h=0}Nn.prototype.add=function(a,u,d,g,w){const R=a.toString();a=this.g[R],a||(a=this.g[R]=[],this.h++);const D=Dn(a,u,g,w);return D>-1?(u=a[D],d||(u.fa=!1)):(u=new Sr(u,this.src,R,!!g,w),u.fa=d,a.push(u)),u};function ri(a,u){const d=u.type;if(d in a.g){var g=a.g[d],w=Array.prototype.indexOf.call(g,u,void 0),R;(R=w>=0)&&Array.prototype.splice.call(g,w,1),R&&(Pn(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Dn(a,u,d,g){for(let w=0;w<a.length;++w){const R=a[w];if(!R.da&&R.listener==u&&R.capture==!!d&&R.ha==g)return w}return-1}var fs="closure_lm_"+(Math.random()*1e6|0),On={};function ps(a,u,d,g,w){if(Array.isArray(u)){for(let R=0;R<u.length;R++)ps(a,u[R],d,g,w);return null}return d=Nr(d),a&&a[gt]?a.J(u,d,l(g)?!!g.capture:!1,w):Rr(a,u,d,!1,g,w)}function Rr(a,u,d,g,w,R){if(!u)throw Error("Invalid event type");const D=l(w)?!!w.capture:!!w;let G=ai(a);if(G||(a[fs]=G=new Nn(a)),d=G.add(u,d,g,D,R),d.proxy)return d;if(g=Ta(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)C||(w=D),w===void 0&&(w=!1),a.addEventListener(u.toString(),g,w);else if(a.attachEvent)a.attachEvent(Pr(u.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Ta(){function a(d){return u.call(a.src,a.listener,d)}const u=kr;return a}function br(a,u,d,g,w){if(Array.isArray(u))for(var R=0;R<u.length;R++)br(a,u[R],d,g,w);else g=l(g)?!!g.capture:!!g,d=Nr(d),a&&a[gt]?(a=a.i,R=String(u).toString(),R in a.g&&(u=a.g[R],d=Dn(u,d,g,w),d>-1&&(Pn(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete a.g[R],a.h--)))):a&&(a=ai(a))&&(u=a.g[u.toString()],a=-1,u&&(a=Dn(u,d,g,w)),(d=a>-1?u[a]:null)&&oi(d))}function oi(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[gt])ri(u.i,a);else{var d=a.type,g=a.proxy;u.removeEventListener?u.removeEventListener(d,g,a.capture):u.detachEvent?u.detachEvent(Pr(d),g):u.addListener&&u.removeListener&&u.removeListener(g),(d=ai(u))?(ri(d,a),d.h==0&&(d.src=null,u[fs]=null)):Pn(a)}}}function Pr(a){return a in On?On[a]:On[a]="on"+a}function kr(a,u){if(a.da)a=!0;else{u=new Ve(u,this);const d=a.listener,g=a.ha||a.src;a.fa&&oi(a),a=d.call(g,u)}return a}function ai(a){return a=a[fs],a instanceof Nn?a:null}var li="__closure_events_fn_"+(Math.random()*1e9>>>0);function Nr(a){return typeof a=="function"?a:(a[li]||(a[li]=function(u){return a.handleEvent(u)}),a[li])}function L(){T.call(this),this.i=new Nn(this),this.M=this,this.G=null}p(L,T),L.prototype[gt]=!0,L.prototype.removeEventListener=function(a,u,d,g){br(this,a,u,d,g)};function j(a,u){var d,g=a.G;if(g)for(d=[];g;g=g.G)d.push(g);if(a=a.M,g=u.type||u,typeof u=="string")u=new I(u,a);else if(u instanceof I)u.target=u.target||a;else{var w=u;u=new I(g,a),ds(u,w)}w=!0;let R,D;if(d)for(D=d.length-1;D>=0;D--)R=u.g=d[D],w=fe(R,g,!0,u)&&w;if(R=u.g=a,w=fe(R,g,!0,u)&&w,w=fe(R,g,!1,u)&&w,d)for(D=0;D<d.length;D++)R=u.g=d[D],w=fe(R,g,!1,u)&&w}L.prototype.N=function(){if(L.Z.N.call(this),this.i){var a=this.i;for(const u in a.g){const d=a.g[u];for(let g=0;g<d.length;g++)Pn(d[g]);delete a.g[u],a.h--}}this.G=null},L.prototype.J=function(a,u,d,g){return this.i.add(String(a),u,!1,d,g)},L.prototype.K=function(a,u,d,g){return this.i.add(String(a),u,!0,d,g)};function fe(a,u,d,g){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();let w=!0;for(let R=0;R<u.length;++R){const D=u[R];if(D&&!D.da&&D.capture==d){const G=D.listener,be=D.ha||D.src;D.fa&&ri(a.i,D),w=G.call(be,g)!==!1&&w}}return w&&!g.defaultPrevented}function We(a,u){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:o.setTimeout(a,u||0)}function mt(a){a.g=We(()=>{a.g=null,a.i&&(a.i=!1,mt(a))},a.l);const u=a.h;a.h=null,a.m.apply(null,u)}class $t extends T{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:mt(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qe(a){T.call(this),this.h=a,this.g={}}p(Qe,T);var xn=[];function kt(a){kn(a.g,function(u,d){this.g.hasOwnProperty(d)&&oi(u)},a),a.g={}}Qe.prototype.N=function(){Qe.Z.N.call(this),kt(this)},Qe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ci=o.JSON.stringify,ui=o.JSON.parse,Dr=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Or(){}function xr(){}var Ln={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function hi(){I.call(this,"d")}p(hi,I);function di(){I.call(this,"c")}p(di,I);var ue={},ye=null;function Fe(){return ye=ye||new L}ue.Ia="serverreachability";function Nt(a){I.call(this,ue.Ia,a)}p(Nt,I);function st(a){const u=Fe();j(u,new Nt(u))}ue.STAT_EVENT="statevent";function gs(a,u){I.call(this,ue.STAT_EVENT,a),this.stat=u}p(gs,I);function Re(a){const u=Fe();j(u,new gs(u,a))}ue.Ja="timingevent";function Lr(a,u){I.call(this,ue.Ja,a),this.size=u}p(Lr,I);function zt(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},u)}function Mn(){this.g=!0}Mn.prototype.ua=function(){this.g=!1};function Hm(a,u,d,g,w,R){a.info(function(){if(a.g)if(R){var D="",G=R.split("&");for(let le=0;le<G.length;le++){var be=G[le].split("=");if(be.length>1){const Oe=be[0];be=be[1];const yt=Oe.split("_");D=yt.length>=2&&yt[1]=="type"?D+(Oe+"="+be+"&"):D+(Oe+"=redacted&")}}}else D=null;else D=R;return"XMLHTTP REQ ("+g+") [attempt "+w+"]: "+u+`
`+d+`
`+D})}function $m(a,u,d,g,w,R,D){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+w+"]: "+u+`
`+d+`
`+R+" "+D})}function ms(a,u,d,g){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+Gm(a,d)+(g?" "+g:"")})}function zm(a,u){a.info(function(){return"TIMEOUT: "+u})}Mn.prototype.info=function(){};function Gm(a,u){if(!a.g)return u;if(!u)return null;try{const R=JSON.parse(u);if(R){for(a=0;a<R.length;a++)if(Array.isArray(R[a])){var d=R[a];if(!(d.length<2)){var g=d[1];if(Array.isArray(g)&&!(g.length<1)){var w=g[0];if(w!="noop"&&w!="stop"&&w!="close")for(let D=1;D<g.length;D++)g[D]=""}}}}return ci(R)}catch{return u}}var Mr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Eu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Iu;function wa(){}p(wa,Or),wa.prototype.g=function(){return new XMLHttpRequest},Iu=new wa;function fi(a){return encodeURIComponent(String(a))}function Km(a){var u=1;a=a.split(":");const d=[];for(;u>0&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function Gt(a,u,d,g){this.j=a,this.i=u,this.l=d,this.S=g||1,this.V=new Qe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Tu}function Tu(){this.i=null,this.g="",this.h=!1}var wu={},Ca={};function Aa(a,u,d){a.M=1,a.A=Fr(_t(u)),a.u=d,a.R=!0,Cu(a,null)}function Cu(a,u){a.F=Date.now(),Vr(a),a.B=_t(a.A);var d=a.B,g=a.S;Array.isArray(g)||(g=[String(g)]),Vu(d.i,"t",g),a.C=0,d=a.j.L,a.h=new Tu,a.g=th(a.j,d?u:null,!a.u),a.P>0&&(a.O=new $t(h(a.Y,a,a.g),a.P)),u=a.V,d=a.g,g=a.ba;var w="readystatechange";Array.isArray(w)||(w&&(xn[0]=w.toString()),w=xn);for(let R=0;R<w.length;R++){const D=ps(d,w[R],g||u.handleEvent,!1,u.h||u);if(!D)break;u.g[D.key]=D}u=a.J?us(a.J):{},a.u?(a.v||(a.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,u)):(a.v="GET",a.g.ea(a.B,a.v,null,u)),st(),Hm(a.i,a.v,a.B,a.l,a.S,a.u)}Gt.prototype.ba=function(a){a=a.target;const u=this.O;u&&Yt(a)==3?u.j():this.Y(a)},Gt.prototype.Y=function(a){try{if(a==this.g)e:{const G=Yt(this.g),be=this.g.ya(),le=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||Hu(this.g)))){this.K||G!=4||be==7||(be==8||le<=0?st(3):st(2)),Sa(this);var u=this.g.ca();this.X=u;var d=Qm(this);if(this.o=u==200,$m(this.i,this.v,this.B,this.l,this.S,G,u),this.o){if(this.U&&!this.L){t:{if(this.g){var g,w=this.g;if((g=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(g)){var R=g;break t}}R=null}if(a=R)ms(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ra(this,a);else{this.o=!1,this.m=3,Re(12),Vn(this),pi(this);break e}}if(this.R){a=!0;let Oe;for(;!this.K&&this.C<d.length;)if(Oe=Ym(this,d),Oe==Ca){G==4&&(this.m=4,Re(14),a=!1),ms(this.i,this.l,null,"[Incomplete Response]");break}else if(Oe==wu){this.m=4,Re(15),ms(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else ms(this.i,this.l,Oe,null),Ra(this,Oe);if(Au(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||d.length!=0||this.h.h||(this.m=1,Re(16),a=!1),this.o=this.o&&a,!a)ms(this.i,this.l,d,"[Invalid Chunked Response]"),Vn(this),pi(this);else if(d.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),La(D),D.P=!0,Re(11))}}else ms(this.i,this.l,d,null),Ra(this,d);G==4&&Vn(this),this.o&&!this.K&&(G==4?Ju(this.j,this):(this.o=!1,Vr(this)))}else u_(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,Re(12)):(this.m=0,Re(13)),Vn(this),pi(this)}}}catch{}};function Qm(a){if(!Au(a))return a.g.la();const u=Hu(a.g);if(u==="")return"";let d="";const g=u.length,w=Yt(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return Vn(a),pi(a),"";a.h.i=new o.TextDecoder}for(let R=0;R<g;R++)a.h.h=!0,d+=a.h.i.decode(u[R],{stream:!(w&&R==g-1)});return u.length=0,a.h.g+=d,a.C=0,a.h.g}function Au(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function Ym(a,u){var d=a.C,g=u.indexOf(`
`,d);return g==-1?Ca:(d=Number(u.substring(d,g)),isNaN(d)?wu:(g+=1,g+d>u.length?Ca:(u=u.slice(g,g+d),a.C=g+d,u)))}Gt.prototype.cancel=function(){this.K=!0,Vn(this)};function Vr(a){a.T=Date.now()+a.H,Su(a,a.H)}function Su(a,u){if(a.D!=null)throw Error("WatchDog timer not null");a.D=zt(h(a.aa,a),u)}function Sa(a){a.D&&(o.clearTimeout(a.D),a.D=null)}Gt.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(zm(this.i,this.B),this.M!=2&&(st(),Re(17)),Vn(this),this.m=2,pi(this)):Su(this,this.T-a)};function pi(a){a.j.I==0||a.K||Ju(a.j,a)}function Vn(a){Sa(a);var u=a.O;u&&typeof u.dispose=="function"&&u.dispose(),a.O=null,kt(a.V),a.g&&(u=a.g,a.g=null,u.abort(),u.dispose())}function Ra(a,u){try{var d=a.j;if(d.I!=0&&(d.g==a||ba(d.h,a))){if(!a.L&&ba(d.h,a)&&d.I==3){try{var g=d.Ba.g.parse(u)}catch{g=null}if(Array.isArray(g)&&g.length==3){var w=g;if(w[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)jr(d),qr(d);else break e;xa(d),Re(18)}}else d.xa=w[1],0<d.xa-d.K&&w[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=zt(h(d.Va,d),6e3));Pu(d.h)<=1&&d.ta&&(d.ta=void 0)}else Un(d,11)}else if((a.L||d.g==a)&&jr(d),!y(u))for(w=d.Ba.g.parse(u),u=0;u<w.length;u++){let le=w[u];const Oe=le[0];if(!(Oe<=d.K))if(d.K=Oe,le=le[1],d.I==2)if(le[0]=="c"){d.M=le[1],d.ba=le[2];const yt=le[3];yt!=null&&(d.ka=yt,d.j.info("VER="+d.ka));const Bn=le[4];Bn!=null&&(d.za=Bn,d.j.info("SVER="+d.za));const Jt=le[5];Jt!=null&&typeof Jt=="number"&&Jt>0&&(g=1.5*Jt,d.O=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const Xt=a.g;if(Xt){const $r=Xt.g?Xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($r){var R=g.h;R.g||$r.indexOf("spdy")==-1&&$r.indexOf("quic")==-1&&$r.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Pa(R,R.h),R.h=null))}if(g.G){const Ma=Xt.g?Xt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ma&&(g.wa=Ma,pe(g.J,g.G,Ma))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),g=d;var D=a;if(g.na=eh(g,g.L?g.ba:null,g.W),D.L){ku(g.h,D);var G=D,be=g.O;be&&(G.H=be),G.D&&(Sa(G),Vr(G)),g.g=D}else Qu(g);d.i.length>0&&Wr(d)}else le[0]!="stop"&&le[0]!="close"||Un(d,7);else d.I==3&&(le[0]=="stop"||le[0]=="close"?le[0]=="stop"?Un(d,7):Oa(d):le[0]!="noop"&&d.l&&d.l.qa(le),d.A=0)}}st(4)}catch{}}var Jm=class{constructor(a,u){this.g=a,this.map=u}};function Ru(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function bu(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Pu(a){return a.h?1:a.g?a.g.size:0}function ba(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function Pa(a,u){a.g?a.g.add(u):a.h=u}function ku(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}Ru.prototype.cancel=function(){if(this.i=Nu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Nu(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let u=a.i;for(const d of a.g.values())u=u.concat(d.G);return u}return A(a.i)}var Du=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xm(a,u){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const g=a[d].indexOf("=");let w,R=null;g>=0?(w=a[d].substring(0,g),R=a[d].substring(g+1)):w=a[d],u(w,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Kt(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;a instanceof Kt?(this.l=a.l,gi(this,a.j),this.o=a.o,this.g=a.g,mi(this,a.u),this.h=a.h,ka(this,Fu(a.i)),this.m=a.m):a&&(u=String(a).match(Du))?(this.l=!1,gi(this,u[1]||"",!0),this.o=_i(u[2]||""),this.g=_i(u[3]||"",!0),mi(this,u[4]),this.h=_i(u[5]||"",!0),ka(this,u[6]||"",!0),this.m=_i(u[7]||"")):(this.l=!1,this.i=new vi(null,this.l))}Kt.prototype.toString=function(){const a=[];var u=this.j;u&&a.push(yi(u,Ou,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(yi(u,Ou,!0),"@"),a.push(fi(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(yi(d,d.charAt(0)=="/"?t_:e_,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",yi(d,s_)),a.join("")},Kt.prototype.resolve=function(a){const u=_t(this);let d=!!a.j;d?gi(u,a.j):d=!!a.o,d?u.o=a.o:d=!!a.g,d?u.g=a.g:d=a.u!=null;var g=a.h;if(d)mi(u,a.u);else if(d=!!a.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var w=u.h.lastIndexOf("/");w!=-1&&(g=u.h.slice(0,w+1)+g)}if(w=g,w==".."||w==".")g="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){g=w.lastIndexOf("/",0)==0,w=w.split("/");const R=[];for(let D=0;D<w.length;){const G=w[D++];G=="."?g&&D==w.length&&R.push(""):G==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),g&&D==w.length&&R.push("")):(R.push(G),g=!0)}g=R.join("/")}else g=w}return d?u.h=g:d=a.i.toString()!=="",d?ka(u,Fu(a.i)):d=!!a.m,d&&(u.m=a.m),u};function _t(a){return new Kt(a)}function gi(a,u,d){a.j=d?_i(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function mi(a,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);a.u=u}else a.u=null}function ka(a,u,d){u instanceof vi?(a.i=u,i_(a.i,a.l)):(d||(u=yi(u,n_)),a.i=new vi(u,a.l))}function pe(a,u,d){a.i.set(u,d)}function Fr(a){return pe(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function _i(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function yi(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,Zm),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Zm(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Ou=/[#\/\?@]/g,e_=/[#\?:]/g,t_=/[#\?]/g,n_=/[#\?@]/g,s_=/#/g;function vi(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function Fn(a){a.g||(a.g=new Map,a.h=0,a.i&&Xm(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=vi.prototype,n.add=function(a,u){Fn(this),this.i=null,a=_s(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function xu(a,u){Fn(a),u=_s(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function Lu(a,u){return Fn(a),u=_s(a,u),a.g.has(u)}n.forEach=function(a,u){Fn(this),this.g.forEach(function(d,g){d.forEach(function(w){a.call(u,w,g,this)},this)},this)};function Mu(a,u){Fn(a);let d=[];if(typeof u=="string")Lu(a,u)&&(d=d.concat(a.g.get(_s(a,u))));else for(a=Array.from(a.g.values()),u=0;u<a.length;u++)d=d.concat(a[u]);return d}n.set=function(a,u){return Fn(this),this.i=null,a=_s(this,a),Lu(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},n.get=function(a,u){return a?(a=Mu(this,a),a.length>0?String(a[0]):u):u};function Vu(a,u,d){xu(a,u),d.length>0&&(a.i=null,a.g.set(_s(a,u),A(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],u=Array.from(this.g.keys());for(let g=0;g<u.length;g++){var d=u[g];const w=fi(d);d=Mu(this,d);for(let R=0;R<d.length;R++){let D=w;d[R]!==""&&(D+="="+fi(d[R])),a.push(D)}}return this.i=a.join("&")};function Fu(a){const u=new vi;return u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),u}function _s(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function i_(a,u){u&&!a.j&&(Fn(a),a.i=null,a.g.forEach(function(d,g){const w=g.toLowerCase();g!=w&&(xu(this,g),Vu(this,w,d))},a)),a.j=u}function r_(a,u){const d=new Mn;if(o.Image){const g=new Image;g.onload=f(Qt,d,"TestLoadImage: loaded",!0,u,g),g.onerror=f(Qt,d,"TestLoadImage: error",!1,u,g),g.onabort=f(Qt,d,"TestLoadImage: abort",!1,u,g),g.ontimeout=f(Qt,d,"TestLoadImage: timeout",!1,u,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else u(!1)}function o_(a,u){const d=new Mn,g=new AbortController,w=setTimeout(()=>{g.abort(),Qt(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:g.signal}).then(R=>{clearTimeout(w),R.ok?Qt(d,"TestPingServer: ok",!0,u):Qt(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(w),Qt(d,"TestPingServer: error",!1,u)})}function Qt(a,u,d,g,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),g(d)}catch{}}function a_(){this.g=new Dr}function Na(a){this.i=a.Sb||null,this.h=a.ab||!1}p(Na,Or),Na.prototype.g=function(){return new Ur(this.i,this.h)};function Ur(a,u){L.call(this),this.H=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Ur,L),n=Ur.prototype,n.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=u,this.readyState=1,Ii(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(u.body=a),(this.H||o).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ei(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Ii(this)),this.g&&(this.readyState=3,Ii(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Uu(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function Uu(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?Ei(this):Ii(this),this.readyState==3&&Uu(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,Ei(this))},n.Na=function(a){this.g&&(this.response=a,Ei(this))},n.ga=function(){this.g&&Ei(this)};function Ei(a){a.readyState=4,a.l=null,a.j=null,a.B=null,Ii(a)}n.setRequestHeader=function(a,u){this.A.append(a,u)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function Ii(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Ur.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Bu(a){let u="";return kn(a,function(d,g){u+=g,u+=":",u+=d,u+=`\r
`}),u}function Da(a,u,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Bu(d),typeof a=="string"?d!=null&&fi(d):pe(a,u,d))}function ve(a){L.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(ve,L);var l_=/^https?$/i,c_=["POST","PUT"];n=ve.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,u,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Iu.g(),this.g.onreadystatechange=m(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(R){qu(this,R);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var w in g)d.set(w,g[w]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const R of g.keys())d.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),w=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(c_,u,void 0)>=0)||g||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,D]of d)this.g.setRequestHeader(R,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(R){qu(this,R)}};function qu(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.o=5,Wu(a),Br(a)}function Wu(a){a.A||(a.A=!0,j(a,"complete"),j(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,j(this,"complete"),j(this,"abort"),Br(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Br(this,!0)),ve.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ju(this):this.Xa())},n.Xa=function(){ju(this)};function ju(a){if(a.h&&typeof r<"u"){if(a.v&&Yt(a)==4)setTimeout(a.Ca.bind(a),0);else if(j(a,"readystatechange"),Yt(a)==4){a.h=!1;try{const R=a.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var g;if(g=R===0){let D=String(a.D).match(Du)[1]||null;!D&&o.self&&o.self.location&&(D=o.self.location.protocol.slice(0,-1)),g=!l_.test(D?D.toLowerCase():"")}d=g}if(d)j(a,"complete"),j(a,"success");else{a.o=6;try{var w=Yt(a)>2?a.g.statusText:""}catch{w=""}a.l=w+" ["+a.ca()+"]",Wu(a)}}finally{Br(a)}}}}function Br(a,u){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,u||j(a,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yt(a){return a.g?a.g.readyState:0}n.ca=function(){try{return Yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),ui(u)}};function Hu(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function u_(a){const u={};a=(a.g&&Yt(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(y(a[g]))continue;var d=Km(a[g]);const w=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=u[w]||[];u[w]=R,R.push(d)}ii(u,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ti(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function $u(a){this.za=0,this.i=[],this.j=new Mn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ti("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ti("baseRetryDelayMs",5e3,a),this.Za=Ti("retryDelaySeedMs",1e4,a),this.Ta=Ti("forwardChannelMaxRetries",2,a),this.va=Ti("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Ru(a&&a.concurrentRequestLimit),this.Ba=new a_,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=$u.prototype,n.ka=8,n.I=1,n.connect=function(a,u,d,g){Re(0),this.W=a,this.H=u||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.J=eh(this,null,this.W),Wr(this)};function Oa(a){if(zu(a),a.I==3){var u=a.V++,d=_t(a.J);if(pe(d,"SID",a.M),pe(d,"RID",u),pe(d,"TYPE","terminate"),wi(a,d),u=new Gt(a,a.j,u),u.M=2,u.A=Fr(_t(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=u.A,d=!0),d||(u.g=th(u.j,null),u.g.ea(u.A)),u.F=Date.now(),Vr(u)}Zu(a)}function qr(a){a.g&&(La(a),a.g.cancel(),a.g=null)}function zu(a){qr(a),a.v&&(o.clearTimeout(a.v),a.v=null),jr(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function Wr(a){if(!bu(a.h)&&!a.m){a.m=!0;var u=a.Ea;se||_(),de||(se(),de=!0),E.add(u,a),a.D=0}}function h_(a,u){return Pu(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=u.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=zt(h(a.Ea,a,u),Xu(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const w=new Gt(this,this.j,a);let R=this.o;if(this.U&&(R?(R=us(R),ds(R,this.U)):R=this.U),this.u!==null||this.R||(w.J=R,R=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(u+=g,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Ku(this,w,u),d=_t(this.J),pe(d,"RID",a),pe(d,"CVER",22),this.G&&pe(d,"X-HTTP-Session-Id",this.G),wi(this,d),R&&(this.R?u="headers="+fi(Bu(R))+"&"+u:this.u&&Da(d,this.u,R)),Pa(this.h,w),this.Ra&&pe(d,"TYPE","init"),this.S?(pe(d,"$req",u),pe(d,"SID","null"),w.U=!0,Aa(w,d,null)):Aa(w,d,u),this.I=2}}else this.I==3&&(a?Gu(this,a):this.i.length==0||bu(this.h)||Gu(this))};function Gu(a,u){var d;u?d=u.l:d=a.V++;const g=_t(a.J);pe(g,"SID",a.M),pe(g,"RID",d),pe(g,"AID",a.K),wi(a,g),a.u&&a.o&&Da(g,a.u,a.o),d=new Gt(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),u&&(a.i=u.G.concat(a.i)),u=Ku(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),Pa(a.h,d),Aa(d,g,u)}function wi(a,u){a.H&&kn(a.H,function(d,g){pe(u,g,d)}),a.l&&kn({},function(d,g){pe(u,g,d)})}function Ku(a,u,d){d=Math.min(a.i.length,d);const g=a.l?h(a.l.Ka,a.l,a):null;e:{var w=a.i;let G=-1;for(;;){const be=["count="+d];G==-1?d>0?(G=w[0].g,be.push("ofs="+G)):G=0:be.push("ofs="+G);let le=!0;for(let Oe=0;Oe<d;Oe++){var R=w[Oe].g;const yt=w[Oe].map;if(R-=G,R<0)G=Math.max(0,w[Oe].g-100),le=!1;else try{R="req"+R+"_"||"";try{var D=yt instanceof Map?yt:Object.entries(yt);for(const[Bn,Jt]of D){let Xt=Jt;l(Jt)&&(Xt=ci(Jt)),be.push(R+Bn+"="+encodeURIComponent(Xt))}}catch(Bn){throw be.push(R+"type="+encodeURIComponent("_badmap")),Bn}}catch{g&&g(yt)}}if(le){D=be.join("&");break e}}D=void 0}return a=a.i.splice(0,d),u.G=a,D}function Qu(a){if(!a.g&&!a.v){a.Y=1;var u=a.Da;se||_(),de||(se(),de=!0),E.add(u,a),a.A=0}}function xa(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=zt(h(a.Da,a),Xu(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,Yu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=zt(h(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Re(10),qr(this),Yu(this))};function La(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function Yu(a){a.g=new Gt(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var u=_t(a.na);pe(u,"RID","rpc"),pe(u,"SID",a.M),pe(u,"AID",a.K),pe(u,"CI",a.F?"0":"1"),!a.F&&a.ia&&pe(u,"TO",a.ia),pe(u,"TYPE","xmlhttp"),wi(a,u),a.u&&a.o&&Da(u,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=Fr(_t(u)),d.u=null,d.R=!0,Cu(d,a)}n.Va=function(){this.C!=null&&(this.C=null,qr(this),xa(this),Re(19))};function jr(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function Ju(a,u){var d=null;if(a.g==u){jr(a),La(a),a.g=null;var g=2}else if(ba(a.h,u))d=u.G,ku(a.h,u),g=1;else return;if(a.I!=0){if(u.o)if(g==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var w=a.D;g=Fe(),j(g,new Lr(g,d)),Wr(a)}else Qu(a);else if(w=u.m,w==3||w==0&&u.X>0||!(g==1&&h_(a,u)||g==2&&xa(a)))switch(d&&d.length>0&&(u=a.h,u.i=u.i.concat(d)),w){case 1:Un(a,5);break;case 4:Un(a,10);break;case 3:Un(a,6);break;default:Un(a,2)}}}function Xu(a,u){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*u}function Un(a,u){if(a.j.info("Error code "+u),u==2){var d=h(a.bb,a),g=a.Ua;const w=!g;g=new Kt(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||gi(g,"https"),Fr(g),w?r_(g.toString(),d):o_(g.toString(),d)}else Re(2);a.I=0,a.l&&a.l.pa(u),Zu(a),zu(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function Zu(a){if(a.I=0,a.ja=[],a.l){const u=Nu(a.h);(u.length!=0||a.i.length!=0)&&(S(a.ja,u),S(a.ja,a.i),a.h.i.length=0,A(a.i),a.i.length=0),a.l.oa()}}function eh(a,u,d){var g=d instanceof Kt?_t(d):new Kt(d);if(g.g!="")u&&(g.g=u+"."+g.g),mi(g,g.u);else{var w=o.location;g=w.protocol,u=u?u+"."+w.hostname:w.hostname,w=+w.port;const R=new Kt(null);g&&gi(R,g),u&&(R.g=u),w&&mi(R,w),d&&(R.h=d),g=R}return d=a.G,u=a.wa,d&&u&&pe(g,d,u),pe(g,"VER",a.ka),wi(a,g),g}function th(a,u,d){if(u&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Aa&&!a.ma?new ve(new Na({ab:d})):new ve(a.ma),u.Fa(a.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function nh(){}n=nh.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Hr(){}Hr.prototype.g=function(a,u){return new it(a,u)};function it(a,u){L.call(this),this.g=new $u(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(a?a["X-WebChannel-Client-Profile"]=u.sa:a={"X-WebChannel-Client-Profile":u.sa}),this.g.U=a,(a=u&&u.Qb)&&!y(a)&&(this.g.u=a),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new ys(this)}p(it,L),it.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},it.prototype.close=function(){Oa(this.g)},it.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=ci(a),a=d);u.i.push(new Jm(u.Ya++,a)),u.I==3&&Wr(u)},it.prototype.N=function(){this.g.l=null,delete this.j,Oa(this.g),delete this.g,it.Z.N.call(this)};function sh(a){hi.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(const d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}p(sh,hi);function ih(){di.call(this),this.status=1}p(ih,di);function ys(a){this.g=a}p(ys,nh),ys.prototype.ra=function(){j(this.g,"a")},ys.prototype.qa=function(a){j(this.g,new sh(a))},ys.prototype.pa=function(a){j(this.g,new ih)},ys.prototype.oa=function(){j(this.g,"b")},Hr.prototype.createWebChannel=Hr.prototype.g,it.prototype.send=it.prototype.o,it.prototype.open=it.prototype.m,it.prototype.close=it.prototype.close,qg=function(){return new Hr},Bg=function(){return Fe()},Ug=ue,Dl={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Mr.NO_ERROR=0,Mr.TIMEOUT=8,Mr.HTTP_ERROR=6,fo=Mr,Eu.COMPLETE="complete",Fg=Eu,xr.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",L.prototype.listen=L.prototype.J,xi=xr,ve.prototype.listenOnce=ve.prototype.K,ve.prototype.getLastError=ve.prototype.Ha,ve.prototype.getLastErrorCode=ve.prototype.ya,ve.prototype.getStatus=ve.prototype.ca,ve.prototype.getResponseJson=ve.prototype.La,ve.prototype.getResponseText=ve.prototype.la,ve.prototype.send=ve.prototype.ea,ve.prototype.setWithCredentials=ve.prototype.Fa,Vg=ve}).apply(typeof eo<"u"?eo:typeof self<"u"?self:typeof window<"u"?window:{});class He{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}He.UNAUTHENTICATED=new He(null),He.GOOGLE_CREDENTIALS=new He("google-credentials-uid"),He.FIRST_PARTY=new He("first-party-uid"),He.MOCK_USER=new He("mock-user");let ti="12.8.0";function rA(n){ti=n}const is=new Jo("@firebase/firestore");function Is(){return is.logLevel}function M(n,...e){if(is.logLevel<=Y.DEBUG){const t=e.map(Qc);is.debug(`Firestore (${ti}): ${n}`,...t)}}function Wt(n,...e){if(is.logLevel<=Y.ERROR){const t=e.map(Qc);is.error(`Firestore (${ti}): ${n}`,...t)}}function qs(n,...e){if(is.logLevel<=Y.WARN){const t=e.map(Qc);is.warn(`Firestore (${ti}): ${n}`,...t)}}function Qc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Wg(n,s,t)}function Wg(n,e,t){let s=`FIRESTORE (${ti}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw Wt(s),new Error(s)}function _e(n,e,t,s){let i="Unexpected state";typeof t=="string"?i=t:s=t,n||Wg(e,i,s)}function te(n,e){return n}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends jt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Qn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class jg{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(He.UNAUTHENTICATED)))}shutdown(){}}class aA{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class lA{constructor(e){this.t=e,this.currentUser=He.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_e(this.o===void 0,42304);let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let r=new Qn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Qn,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const c=r;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},l=c=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>l(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Qn)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(_e(typeof s.accessToken=="string",31837,{l:s}),new jg(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _e(e===null||typeof e=="string",2055,{h:e}),new He(e)}}class cA{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=He.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class uA{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new cA(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(He.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Rd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class hA{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ot(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){_e(this.o===void 0,3512);const s=r=>{r.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable((()=>s(r)))};const i=r=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>i(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Rd(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(_e(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Rd(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function dA(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Yc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=dA(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<t&&(s+=e.charAt(i[r]%62))}return s}}function X(n,e){return n<e?-1:n>e?1:0}function Ol(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const i=n.charAt(s),r=e.charAt(s);if(i!==r)return nl(i)===nl(r)?X(i,r):nl(i)?1:-1}return X(n.length,e.length)}const fA=55296,pA=57343;function nl(n){const e=n.charCodeAt(0);return e>=fA&&e<=pA}function Ws(n,e,t){return n.length===e.length&&n.every(((s,i)=>t(s,e[i])))}const bd="__name__";class vt{constructor(e,t,s){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&$(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return vt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof vt?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let i=0;i<s;i++){const r=vt.compareSegments(e.get(i),t.get(i));if(r!==0)return r}return X(e.length,t.length)}static compareSegments(e,t){const s=vt.isNumericId(e),i=vt.isNumericId(t);return s&&!i?-1:!s&&i?1:s&&i?vt.extractNumericId(e).compare(vt.extractNumericId(t)):Ol(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fn.fromString(e.substring(4,e.length-2))}}class me extends vt{construct(e,t,s){return new me(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new V(N.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((i=>i.length>0)))}return new me(t)}static emptyPath(){return new me([])}}const gA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ye extends vt{construct(e,t,s){return new Ye(e,t,s)}static isValidIdentifier(e){return gA.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===bd}static keyField(){return new Ye([bd])}static fromServerFormat(e){const t=[];let s="",i=0;const r=()=>{if(s.length===0)throw new V(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new V(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=c,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(s+=l,i++):(r(),i++)}if(r(),o)throw new V(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ye(t)}static emptyPath(){return new Ye([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(me.fromString(e))}static fromName(e){return new F(me.fromString(e).popFirst(5))}static empty(){return new F(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&me.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new me(e.slice()))}}function mA(n,e,t){if(!t)throw new V(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function _A(n,e,t,s){if(e===!0&&s===!0)throw new V(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Pd(n){if(!F.isDocumentKey(n))throw new V(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function yA(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function vA(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function xl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=vA(n);throw new V(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Se(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ir(n,e){if(!yA(n))throw new V(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(i&&typeof o!==i){t=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&o!==r.value){t=`Expected '${s}' field to equal '${r.value}'`;break}}if(t)throw new V(N.INVALID_ARGUMENT,t);return!0}const kd=-62135596800,Nd=1e6;class Ae{static now(){return Ae.fromMillis(Date.now())}static fromDate(e){return Ae.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Nd);return new Ae(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kd)throw new V(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Nd}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ae._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ir(e,Ae._jsonSchema))return new Ae(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kd;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ae._jsonSchemaVersion="firestore/timestamp/1.0",Ae._jsonSchema={type:Se("string",Ae._jsonSchemaVersion),seconds:Se("number"),nanoseconds:Se("number")};class H{static fromTimestamp(e){return new H(e)}static min(){return new H(new Ae(0,0))}static max(){return new H(new Ae(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ar=-1;function EA(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,i=H.fromTimestamp(s===1e9?new Ae(t+1,0):new Ae(t,s));return new En(i,F.empty(),e)}function IA(n){return new En(n.readTime,n.key,ar)}class En{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new En(H.min(),F.empty(),ar)}static max(){return new En(H.max(),F.empty(),ar)}}function TA(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const wA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class CA{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ha(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==wA)throw n;M("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(t,r).next(s,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,s)=>{t(e)}))}static reject(e){return new b(((t,s)=>{s(e)}))}static waitFor(e){return new b(((t,s)=>{let i=0,r=0,o=!1;e.forEach((l=>{++i,l.next((()=>{++r,o&&r===i&&t()}),(c=>s(c)))})),o=!0,r===i&&t()}))}static or(e){let t=b.resolve(!1);for(const s of e)t=t.next((i=>i?b.resolve(i):s()));return t}static forEach(e,t){const s=[];return e.forEach(((i,r)=>{s.push(t.call(this,i,r))})),this.waitFor(s)}static mapArray(e,t){return new b(((s,i)=>{const r=e.length,o=new Array(r);let l=0;for(let c=0;c<r;c++){const h=c;t(e[h]).next((f=>{o[h]=f,++l,l===r&&s(o)}),(f=>i(f)))}}))}static doWhile(e,t){return new b(((s,i)=>{const r=()=>{e()===!0?t().next((()=>{r()}),i):s()};r()}))}}function AA(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ni(n){return n.name==="IndexedDbTransactionError"}class da{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}da.ce=-1;const SA=-1;function fa(n){return n==null}function Ll(n){return n===0&&1/n==-1/0}const Hg="";function RA(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dd(e)),e=bA(n.get(t),e);return Dd(e)}function bA(n,e){let t=e;const s=n.length;for(let i=0;i<s;i++){const r=n.charAt(i);switch(r){case"\0":t+="";break;case Hg:t+="";break;default:t+=r}}return t}function Dd(n){return n+Hg+""}function Od(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Tr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function PA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class we{constructor(e,t){this.comparator=e,this.root=t||Ue.EMPTY}insert(e,t){return new we(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ue.BLACK,null,null))}remove(e){return new we(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ue.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return t+s.left.size;i<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new to(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new to(this.root,e,this.comparator,!1)}getReverseIterator(){return new to(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new to(this.root,e,this.comparator,!0)}}class to{constructor(e,t,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ue{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??Ue.RED,this.left=i??Ue.EMPTY,this.right=r??Ue.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,i,r){return new Ue(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ue.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ue.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Ue.EMPTY=null,Ue.RED=!0,Ue.BLACK=!1;Ue.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,s,i,r){return this}insert(e,t,s){return new Ue(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class De{constructor(e){this.comparator=e,this.data=new we(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xd(this.data.getIterator())}getIteratorFrom(e){return new xd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof De)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new De(this.comparator);return t.data=e,t}}class xd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class an{constructor(e){this.fields=e,e.sort(Ye.comparator)}static empty(){return new an([])}unionWith(e){let t=new De(Ye.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new an(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ws(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class $g extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new $g("Invalid base64 string: "+r):r}})(e);return new qe(t)}static fromUint8Array(e){const t=(function(i){let r="";for(let o=0;o<i.length;++o)r+=String.fromCharCode(i[o]);return r})(e);return new qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qe.EMPTY_BYTE_STRING=new qe("");const kA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function In(n){if(_e(!!n,39018),typeof n=="string"){let e=0;const t=kA.exec(n);if(_e(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Te(n.seconds),nanos:Te(n.nanos)}}function Te(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Tn(n){return typeof n=="string"?qe.fromBase64String(n):qe.fromUint8Array(n)}const zg="server_timestamp",Gg="__type__",Kg="__previous_value__",Qg="__local_write_time__";function Jc(n){return(n?.mapValue?.fields||{})[Gg]?.stringValue===zg}function pa(n){const e=n.mapValue.fields[Kg];return Jc(e)?pa(e):e}function lr(n){const e=In(n.mapValue.fields[Qg].timestampValue);return new Ae(e.seconds,e.nanos)}class NA{constructor(e,t,s,i,r,o,l,c,h,f,p){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f,this.apiKey=p}}const qo="(default)";class cr{constructor(e,t){this.projectId=e,this.database=t||qo}static empty(){return new cr("","")}get isDefaultDatabase(){return this.database===qo}isEqual(e){return e instanceof cr&&e.projectId===this.projectId&&e.database===this.database}}function DA(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new V(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cr(n.options.projectId,e)}const OA="__type__",xA="__max__",no={mapValue:{}},LA="__vector__",Ml="value";function wn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jc(n)?4:VA(n)?9007199254740991:MA(n)?10:11:$(28295,{value:n})}function Rt(n,e){if(n===e)return!0;const t=wn(n);if(t!==wn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return lr(n).isEqual(lr(e));case 3:return(function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const o=In(i.timestampValue),l=In(r.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,r){return Tn(i.bytesValue).isEqual(Tn(r.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,r){return Te(i.geoPointValue.latitude)===Te(r.geoPointValue.latitude)&&Te(i.geoPointValue.longitude)===Te(r.geoPointValue.longitude)})(n,e);case 2:return(function(i,r){if("integerValue"in i&&"integerValue"in r)return Te(i.integerValue)===Te(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const o=Te(i.doubleValue),l=Te(r.doubleValue);return o===l?Ll(o)===Ll(l):isNaN(o)&&isNaN(l)}return!1})(n,e);case 9:return Ws(n.arrayValue.values||[],e.arrayValue.values||[],Rt);case 10:case 11:return(function(i,r){const o=i.mapValue.fields||{},l=r.mapValue.fields||{};if(Od(o)!==Od(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Rt(o[c],l[c])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function ur(n,e){return(n.values||[]).find((t=>Rt(t,e)))!==void 0}function js(n,e){if(n===e)return 0;const t=wn(n),s=wn(e);if(t!==s)return X(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(r,o){const l=Te(r.integerValue||r.doubleValue),c=Te(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1})(n,e);case 3:return Ld(n.timestampValue,e.timestampValue);case 4:return Ld(lr(n),lr(e));case 5:return Ol(n.stringValue,e.stringValue);case 6:return(function(r,o){const l=Tn(r),c=Tn(o);return l.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(r,o){const l=r.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){const f=X(l[h],c[h]);if(f!==0)return f}return X(l.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(r,o){const l=X(Te(r.latitude),Te(o.latitude));return l!==0?l:X(Te(r.longitude),Te(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Md(n.arrayValue,e.arrayValue);case 10:return(function(r,o){const l=r.fields||{},c=o.fields||{},h=l[Ml]?.arrayValue,f=c[Ml]?.arrayValue,p=X(h?.values?.length||0,f?.values?.length||0);return p!==0?p:Md(h,f)})(n.mapValue,e.mapValue);case 11:return(function(r,o){if(r===no.mapValue&&o===no.mapValue)return 0;if(r===no.mapValue)return 1;if(o===no.mapValue)return-1;const l=r.fields||{},c=Object.keys(l),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const m=Ol(c[p],f[p]);if(m!==0)return m;const A=js(l[c[p]],h[f[p]]);if(A!==0)return A}return X(c.length,f.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function Ld(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=In(n),s=In(e),i=X(t.seconds,s.seconds);return i!==0?i:X(t.nanos,s.nanos)}function Md(n,e){const t=n.values||[],s=e.values||[];for(let i=0;i<t.length&&i<s.length;++i){const r=js(t[i],s[i]);if(r)return r}return X(t.length,s.length)}function Hs(n){return Vl(n)}function Vl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=In(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Tn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",i=!0;for(const r of t.values||[])i?i=!1:s+=",",s+=Vl(r);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const o of s)r?r=!1:i+=",",i+=`${o}:${Vl(t.fields[o])}`;return i+"}"})(n.mapValue):$(61005,{value:n})}function po(n){switch(wn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=pa(n);return e?16+po(e):16;case 5:return 2*n.stringValue.length;case 6:return Tn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((i,r)=>i+po(r)),0)})(n.arrayValue);case 10:case 11:return(function(s){let i=0;return Tr(s.fields,((r,o)=>{i+=r.length+po(o)})),i})(n.mapValue);default:throw $(13486,{value:n})}}function Fl(n){return!!n&&"integerValue"in n}function Xc(n){return!!n&&"arrayValue"in n}function Vd(n){return!!n&&"nullValue"in n}function Fd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function sl(n){return!!n&&"mapValue"in n}function MA(n){return(n?.mapValue?.fields||{})[OA]?.stringValue===LA}function $i(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Tr(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=$i(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$i(n.arrayValue.values[t]);return e}return{...n}}function VA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===xA}class Et{constructor(e){this.value=e}static empty(){return new Et({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!sl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$i(t)}setAll(e){let t=Ye.emptyPath(),s={},i=[];e.forEach(((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,s,i),s={},i=[],t=l.popLast()}o?s[l.lastSegment()]=$i(o):i.push(l.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,s,i)}delete(e){const t=this.field(e.popLast());sl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=t.mapValue.fields[e.get(s)];sl(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,s){Tr(t,((i,r)=>e[i]=r));for(const i of s)delete e[i]}clone(){return new Et($i(this.value))}}class ze{constructor(e,t,s,i,r,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=i,this.createTime=r,this.data=o,this.documentState=l}static newInvalidDocument(e){return new ze(e,0,H.min(),H.min(),H.min(),Et.empty(),0)}static newFoundDocument(e,t,s,i){return new ze(e,1,t,H.min(),s,i,0)}static newNoDocument(e,t){return new ze(e,2,t,H.min(),H.min(),Et.empty(),0)}static newUnknownDocument(e,t){return new ze(e,3,t,H.min(),H.min(),Et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(H.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=H.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ze&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ze(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Wo{constructor(e,t){this.position=e,this.inclusive=t}}function Ud(n,e,t){let s=0;for(let i=0;i<n.position.length;i++){const r=e[i],o=n.position[i];if(r.field.isKeyField()?s=F.comparator(F.fromName(o.referenceValue),t.key):s=js(o,t.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function Bd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Rt(n.position[t],e.position[t]))return!1;return!0}class jo{constructor(e,t="asc"){this.field=e,this.dir=t}}function FA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Yg{}class Ne extends Yg{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new BA(e,t,s):t==="array-contains"?new jA(e,s):t==="in"?new HA(e,s):t==="not-in"?new $A(e,s):t==="array-contains-any"?new zA(e,s):new Ne(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new qA(e,s):new WA(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(js(t,this.value)):t!==null&&wn(this.value)===wn(t)&&this.matchesComparison(js(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bt extends Yg{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new bt(e,t)}matches(e){return Jg(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Jg(n){return n.op==="and"}function Xg(n){return UA(n)&&Jg(n)}function UA(n){for(const e of n.filters)if(e instanceof bt)return!1;return!0}function Ul(n){if(n instanceof Ne)return n.field.canonicalString()+n.op.toString()+Hs(n.value);if(Xg(n))return n.filters.map((e=>Ul(e))).join(",");{const e=n.filters.map((t=>Ul(t))).join(",");return`${n.op}(${e})`}}function Zg(n,e){return n instanceof Ne?(function(s,i){return i instanceof Ne&&s.op===i.op&&s.field.isEqual(i.field)&&Rt(s.value,i.value)})(n,e):n instanceof bt?(function(s,i){return i instanceof bt&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce(((r,o,l)=>r&&Zg(o,i.filters[l])),!0):!1})(n,e):void $(19439)}function em(n){return n instanceof Ne?(function(t){return`${t.field.canonicalString()} ${t.op} ${Hs(t.value)}`})(n):n instanceof bt?(function(t){return t.op.toString()+" {"+t.getFilters().map(em).join(" ,")+"}"})(n):"Filter"}class BA extends Ne{constructor(e,t,s){super(e,t,s),this.key=F.fromName(s.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class qA extends Ne{constructor(e,t){super(e,"in",t),this.keys=tm("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class WA extends Ne{constructor(e,t){super(e,"not-in",t),this.keys=tm("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function tm(n,e){return(e.arrayValue?.values||[]).map((t=>F.fromName(t.referenceValue)))}class jA extends Ne{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xc(t)&&ur(t.arrayValue,this.value)}}class HA extends Ne{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ur(this.value.arrayValue,t)}}class $A extends Ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(ur(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ur(this.value.arrayValue,t)}}class zA extends Ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>ur(this.value.arrayValue,s)))}}class GA{constructor(e,t=null,s=[],i=[],r=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=l,this.Te=null}}function qd(n,e=null,t=[],s=[],i=null,r=null,o=null){return new GA(n,e,t,s,i,r,o)}function Zc(n){const e=te(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Ul(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(r){return r.field.canonicalString()+r.dir})(s))).join(","),fa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Hs(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Hs(s))).join(",")),e.Te=t}return e.Te}function eu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!FA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Zg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Bd(n.startAt,e.startAt)&&Bd(n.endAt,e.endAt)}function Bl(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ga{constructor(e,t=null,s=[],i=[],r=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function KA(n,e,t,s,i,r,o,l){return new ga(n,e,t,s,i,r,o,l)}function tu(n){return new ga(n)}function Wd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function QA(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function YA(n){return n.collectionGroup!==null}function zi(n){const e=te(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new De(Ye.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new jo(r,s))})),t.has(Ye.keyField().canonicalString())||e.Ie.push(new jo(Ye.keyField(),s))}return e.Ie}function St(n){const e=te(n);return e.Ee||(e.Ee=JA(e,zi(n))),e.Ee}function JA(n,e){if(n.limitType==="F")return qd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const r=i.dir==="desc"?"asc":"desc";return new jo(i.field,r)}));const t=n.endAt?new Wo(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Wo(n.startAt.position,n.startAt.inclusive):null;return qd(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function ql(n,e,t){return new ga(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ma(n,e){return eu(St(n),St(e))&&n.limitType===e.limitType}function nm(n){return`${Zc(St(n))}|lt:${n.limitType}`}function Ts(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((i=>em(i))).join(", ")}]`),fa(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((i=>Hs(i))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((i=>Hs(i))).join(",")),`Target(${s})`})(St(n))}; limitType=${n.limitType})`}function _a(n,e){return e.isFoundDocument()&&(function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):F.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)})(n,e)&&(function(s,i){for(const r of zi(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0})(n,e)&&(function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0})(n,e)&&(function(s,i){return!(s.startAt&&!(function(o,l,c){const h=Ud(o,l,c);return o.inclusive?h<=0:h<0})(s.startAt,zi(s),i)||s.endAt&&!(function(o,l,c){const h=Ud(o,l,c);return o.inclusive?h>=0:h>0})(s.endAt,zi(s),i))})(n,e)}function XA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sm(n){return(e,t)=>{let s=!1;for(const i of zi(n)){const r=ZA(i,e,t);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function ZA(n,e,t){const s=n.field.isKeyField()?F.comparator(e.key,t.key):(function(r,o,l){const c=o.data.field(r),h=l.data.field(r);return c!==null&&h!==null?js(c,h):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return $(19790,{direction:n.dir})}}class ls{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[t]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Tr(this.inner,((t,s)=>{for(const[i,r]of s)e(i,r)}))}isEmpty(){return PA(this.inner)}size(){return this.innerSize}}const eS=new we(F.comparator);function Cn(){return eS}const im=new we(F.comparator);function Li(...n){let e=im;for(const t of n)e=e.insert(t.key,t);return e}function tS(n){let e=im;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Kn(){return Gi()}function rm(){return Gi()}function Gi(){return new ls((n=>n.toString()),((n,e)=>n.isEqual(e)))}const nS=new De(F.comparator);function ne(...n){let e=nS;for(const t of n)e=e.add(t);return e}const sS=new De(X);function iS(){return sS}function rS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ll(e)?"-0":e}}function oS(n){return{integerValue:""+n}}class ya{constructor(){this._=void 0}}function aS(n,e,t){return n instanceof Wl?(function(i,r){const o={fields:{[Gg]:{stringValue:zg},[Qg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&Jc(r)&&(r=pa(r)),r&&(o.fields[Kg]=r),{mapValue:o}})(t,e):n instanceof Ho?om(n,e):n instanceof $o?am(n,e):(function(i,r){const o=cS(i,r),l=jd(o)+jd(i.Ae);return Fl(o)&&Fl(i.Ae)?oS(l):rS(i.serializer,l)})(n,e)}function lS(n,e,t){return n instanceof Ho?om(n,e):n instanceof $o?am(n,e):t}function cS(n,e){return n instanceof jl?(function(s){return Fl(s)||(function(r){return!!r&&"doubleValue"in r})(s)})(e)?e:{integerValue:0}:null}class Wl extends ya{}class Ho extends ya{constructor(e){super(),this.elements=e}}function om(n,e){const t=lm(e);for(const s of n.elements)t.some((i=>Rt(i,s)))||t.push(s);return{arrayValue:{values:t}}}class $o extends ya{constructor(e){super(),this.elements=e}}function am(n,e){let t=lm(e);for(const s of n.elements)t=t.filter((i=>!Rt(i,s)));return{arrayValue:{values:t}}}class jl extends ya{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function jd(n){return Te(n.integerValue||n.doubleValue)}function lm(n){return Xc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function uS(n,e){return n.field.isEqual(e.field)&&(function(s,i){return s instanceof Ho&&i instanceof Ho||s instanceof $o&&i instanceof $o?Ws(s.elements,i.elements,Rt):s instanceof jl&&i instanceof jl?Rt(s.Ae,i.Ae):s instanceof Wl&&i instanceof Wl})(n.transform,e.transform)}class Yn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Yn}static exists(e){return new Yn(void 0,e)}static updateTime(e){return new Yn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function go(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class nu{}function cm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new dS(n.key,Yn.none()):new su(n.key,n.data,Yn.none());{const t=n.data,s=Et.empty();let i=new De(Ye.comparator);for(let r of e.fields)if(!i.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?s.delete(r):s.set(r,o),i=i.add(r)}return new va(n.key,s,new an(i.toArray()),Yn.none())}}function hS(n,e,t){n instanceof su?(function(i,r,o){const l=i.value.clone(),c=$d(i.fieldTransforms,r,o.transformResults);l.setAll(c),r.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):n instanceof va?(function(i,r,o){if(!go(i.precondition,r))return void r.convertToUnknownDocument(o.version);const l=$d(i.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(um(i)),c.setAll(l),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(i,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Ki(n,e,t,s){return n instanceof su?(function(r,o,l,c){if(!go(r.precondition,o))return l;const h=r.value.clone(),f=zd(r.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,s):n instanceof va?(function(r,o,l,c){if(!go(r.precondition,o))return l;const h=zd(r.fieldTransforms,c,o),f=o.data;return f.setAll(um(r)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((p=>p.field)))})(n,e,t,s):(function(r,o,l){return go(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l})(n,e,t)}function Hd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Ws(s,i,((r,o)=>uS(r,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class su extends nu{constructor(e,t,s,i=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class va extends nu{constructor(e,t,s,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function um(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function $d(n,e,t){const s=new Map;_e(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){const r=n[i],o=r.transform,l=e.data.field(r.field);s.set(r.field,lS(o,l,t[i]))}return s}function zd(n,e,t){const s=new Map;for(const i of n){const r=i.transform,o=t.data.field(i.field);s.set(i.field,aS(r,o,e))}return s}class dS extends nu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fS{constructor(e,t,s,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&hS(r,e,s[i])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Ki(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Ki(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=rm();return this.mutations.forEach((i=>{const r=e.get(i.key),o=r.overlayedDocument;let l=this.applyToLocalView(o,r.mutatedFields);l=t.has(i.key)?null:l;const c=cm(o,l);c!==null&&s.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(H.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ne())}isEqual(e){return this.batchId===e.batchId&&Ws(this.mutations,e.mutations,((t,s)=>Hd(t,s)))&&Ws(this.baseMutations,e.baseMutations,((t,s)=>Hd(t,s)))}}class pS{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gS{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ce,ee;function hm(n){if(n===void 0)return Wt("GRPC error has no .code"),N.UNKNOWN;switch(n){case Ce.OK:return N.OK;case Ce.CANCELLED:return N.CANCELLED;case Ce.UNKNOWN:return N.UNKNOWN;case Ce.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case Ce.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case Ce.INTERNAL:return N.INTERNAL;case Ce.UNAVAILABLE:return N.UNAVAILABLE;case Ce.UNAUTHENTICATED:return N.UNAUTHENTICATED;case Ce.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case Ce.NOT_FOUND:return N.NOT_FOUND;case Ce.ALREADY_EXISTS:return N.ALREADY_EXISTS;case Ce.PERMISSION_DENIED:return N.PERMISSION_DENIED;case Ce.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case Ce.ABORTED:return N.ABORTED;case Ce.OUT_OF_RANGE:return N.OUT_OF_RANGE;case Ce.UNIMPLEMENTED:return N.UNIMPLEMENTED;case Ce.DATA_LOSS:return N.DATA_LOSS;default:return $(39323,{code:n})}}(ee=Ce||(Ce={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";function mS(){return new TextEncoder}const _S=new fn([4294967295,4294967295],0);function Gd(n){const e=mS().encode(n),t=new Mg;return t.update(e),new Uint8Array(t.digest())}function Kd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new fn([t,s],0),new fn([i,r],0)]}class iu{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Mi(`Invalid padding: ${t}`);if(s<0)throw new Mi(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Mi(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Mi(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=fn.fromNumber(this.ge)}ye(e,t,s){let i=e.add(t.multiply(fn.fromNumber(s)));return i.compare(_S)===1&&(i=new fn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Gd(e),[s,i]=Kd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);if(!this.we(o))return!1}return!0}static create(e,t,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new iu(r,i,t);return s.forEach((l=>o.insert(l))),o}insert(e){if(this.ge===0)return;const t=Gd(e),[s,i]=Kd(t);for(let r=0;r<this.hashCount;r++){const o=this.ye(s,i,r);this.be(o)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Mi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ea{constructor(e,t,s,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const i=new Map;return i.set(e,wr.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ea(H.min(),i,new we(X),Cn(),ne())}}class wr{constructor(e,t,s,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new wr(s,t,ne(),ne(),ne())}}class mo{constructor(e,t,s,i){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=i}}class dm{constructor(e,t){this.targetId=e,this.Ce=t}}class fm{constructor(e,t,s=qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=i}}class Qd{constructor(){this.ve=0,this.Fe=Yd(),this.Me=qe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ne(),t=ne(),s=ne();return this.Fe.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:s=s.add(i);break;default:$(38017,{changeType:r})}})),new wr(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=Yd()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,_e(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class yS{constructor(e){this.Ge=e,this.ze=new Map,this.je=Cn(),this.He=so(),this.Je=so(),this.Ze=new we(X)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,s=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(Bl(r))if(s===0){const o=new F(r.path);this.et(t,o,ze.newNoDocument(o,H.min()))}else _e(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=t;let o,l;try{o=Tn(s).toUint8Array()}catch(c){if(c instanceof $g)return qs("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new iu(o,i,r)}catch(c){return qs(c instanceof Mi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let i=0;return s.forEach((r=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(l)||(this.et(t,r,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((r,o)=>{const l=this.ot(o);if(l){if(r.current&&Bl(l.target)){const c=new F(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,ze.newNoDocument(c,e))}r.Be&&(t.set(o,r.ke()),r.Ke())}}));let s=ne();this.Je.forEach(((r,o)=>{let l=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(s=s.add(r))})),this.je.forEach(((r,o)=>o.setReadTime(e)));const i=new Ea(e,t,this.Ze,this.je,s);return this.je=Cn(),this.He=so(),this.Je=so(),this.Ze=new we(X),i}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Qd,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new De(X),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new De(X),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Qd),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function so(){return new we(F.comparator)}function Yd(){return new we(F.comparator)}const vS={asc:"ASCENDING",desc:"DESCENDING"},ES={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},IS={and:"AND",or:"OR"};class TS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Hl(n,e){return n.useProto3Json||fa(e)?e:{value:e}}function wS(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function CS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Os(n){return _e(!!n,49232),H.fromTimestamp((function(t){const s=In(t);return new Ae(s.seconds,s.nanos)})(n))}function AS(n,e){return $l(n,e).canonicalString()}function $l(n,e){const t=(function(i){return new me(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function pm(n){const e=me.fromString(n);return _e(vm(e),10190,{key:e.toString()}),e}function il(n,e){const t=pm(e);if(t.get(1)!==n.databaseId.projectId)throw new V(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(mm(t))}function gm(n,e){return AS(n.databaseId,e)}function SS(n){const e=pm(n);return e.length===4?me.emptyPath():mm(e)}function Jd(n){return new me(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mm(n){return _e(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function RS(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=(function(h,f){return h.useProto3Json?(_e(f===void 0||typeof f=="string",58123),qe.fromBase64String(f||"")):(_e(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),qe.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&(function(h){const f=h.code===void 0?N.UNKNOWN:hm(h.code);return new V(f,h.message||"")})(o);t=new fm(s,i,r,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=il(n,s.document.name),r=Os(s.document.updateTime),o=s.document.createTime?Os(s.document.createTime):H.min(),l=new Et({mapValue:{fields:s.document.fields}}),c=ze.newFoundDocument(i,r,o,l),h=s.targetIds||[],f=s.removedTargetIds||[];t=new mo(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=il(n,s.document),r=s.readTime?Os(s.readTime):H.min(),o=ze.newNoDocument(i,r),l=s.removedTargetIds||[];t=new mo([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=il(n,s.document),r=s.removedTargetIds||[];t=new mo([],r,i,null)}else{if(!("filter"in e))return $(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,o=new gS(i,r),l=s.targetId;t=new dm(l,o)}}return t}function bS(n,e){return{documents:[gm(n,e.path)]}}function PS(n,e){const t={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=gm(n,i);const r=(function(h){if(h.length!==0)return ym(bt.create(h,"and"))})(e.filters);r&&(t.structuredQuery.where=r);const o=(function(h){if(h.length!==0)return h.map((f=>(function(m){return{field:ws(m.field),direction:DS(m.dir)}})(f)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=Hl(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function kS(n){let e=SS(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let i=null;if(s>0){_e(s===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let r=[];t.where&&(r=(function(p){const m=_m(p);return m instanceof bt&&Xg(m)?m.getFilters():[m]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map((m=>(function(S){return new jo(Cs(S.field),(function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(m)))})(t.orderBy));let l=null;t.limit&&(l=(function(p){let m;return m=typeof p=="object"?p.value:p,fa(m)?null:m})(t.limit));let c=null;t.startAt&&(c=(function(p){const m=!!p.before,A=p.values||[];return new Wo(A,m)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const m=!p.before,A=p.values||[];return new Wo(A,m)})(t.endAt)),KA(e,i,o,r,l,"F",c,h)}function NS(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _m(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Cs(t.unaryFilter.field);return Ne.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=Cs(t.unaryFilter.field);return Ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Cs(t.unaryFilter.field);return Ne.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Cs(t.unaryFilter.field);return Ne.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ne.create(Cs(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return bt.create(t.compositeFilter.filters.map((s=>_m(s))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function DS(n){return vS[n]}function OS(n){return ES[n]}function xS(n){return IS[n]}function ws(n){return{fieldPath:n.canonicalString()}}function Cs(n){return Ye.fromServerFormat(n.fieldPath)}function ym(n){return n instanceof Ne?(function(t){if(t.op==="=="){if(Fd(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NAN"}};if(Vd(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fd(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NAN"}};if(Vd(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ws(t.field),op:OS(t.op),value:t.value}}})(n):n instanceof bt?(function(t){const s=t.getFilters().map((i=>ym(i)));return s.length===1?s[0]:{compositeFilter:{op:xS(t.op),filters:s}}})(n):$(54877,{filter:n})}function vm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ln{constructor(e,t,s,i,r=H.min(),o=H.min(),l=qe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class LS{constructor(e){this.yt=e}}function MS(n){const e=kS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ql(e,e.limit,"L"):e}class VS{constructor(){this.Sn=new FS}addToCollectionParentIndex(e,t){return this.Sn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(En.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(En.min())}updateCollectionGroup(e,t,s){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class FS{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t]||new De(me.comparator),r=!i.has(s);return this.index[t]=i.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t];return i&&i.has(s)}getEntries(e){return(this.index[e]||new De(me.comparator)).toArray()}}const Xd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Em=41943040;class Ze{static withCacheSize(e){return new Ze(e,Ze.DEFAULT_COLLECTION_PERCENTILE,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}Ze.DEFAULT_COLLECTION_PERCENTILE=10,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ze.DEFAULT=new Ze(Em,Ze.DEFAULT_COLLECTION_PERCENTILE,Ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ze.DISABLED=new Ze(-1,0,0);class $s{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new $s(0)}static ar(){return new $s(-1)}}const Zd="LruGarbageCollector",US=1048576;function ef([n,e],[t,s]){const i=X(n,t);return i===0?X(e,s):i}class BS{constructor(e){this.Pr=e,this.buffer=new De(ef),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();ef(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class qS{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){M(Zd,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ni(t)?M(Zd,"Ignoring IndexedDB error during garbage collection: ",t):await ha(t)}await this.Ar(3e5)}))}}class WS{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(da.ce);const s=new BS(t);return this.Vr.forEachTarget(e,(i=>s.Er(i.sequenceNumber))).next((()=>this.Vr.mr(e,(i=>s.Er(i))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Xd)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Xd):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,i,r,o,l,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i)))).next((p=>(s=p,l=Date.now(),this.removeTargets(e,s,t)))).next((p=>(r=p,c=Date.now(),this.removeOrphanedDocuments(e,s)))).next((p=>(h=Date.now(),Is()<=Y.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${r} targets in `+(c-l)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p}))))}}function jS(n,e){return new WS(n,e)}class HS{constructor(){this.changes=new ls((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?b.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class $S{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class zS{constructor(e,t,s,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(s=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(s!==null&&Ki(s.mutation,i,an.empty(),Ae.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,ne()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=ne()){const i=Kn();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,s).next((r=>{let o=Li();return r.forEach(((l,c)=>{o=o.insert(l,c.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=Kn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,ne())))}populateOverlays(e,t,s){const i=[];return s.forEach((r=>{t.has(r)||i.push(r)})),this.documentOverlayCache.getOverlays(e,i).next((r=>{r.forEach(((o,l)=>{t.set(o,l)}))}))}computeViews(e,t,s,i){let r=Cn();const o=Gi(),l=(function(){return Gi()})();return t.forEach(((c,h)=>{const f=s.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof va)?r=r.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Ki(f.mutation,h,f.mutation.getFieldMask(),Ae.now())):o.set(h.key,an.empty())})),this.recalculateAndSaveOverlays(e,r).next((c=>(c.forEach(((h,f)=>o.set(h,f))),t.forEach(((h,f)=>l.set(h,new $S(f,o.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const s=Gi();let i=new we(((o,l)=>o-l)),r=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const l of o)l.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let f=s.get(c)||an.empty();f=l.applyToLocalView(h,f),s.set(c,f);const p=(i.get(l.batchId)||ne()).add(c);i=i.insert(l.batchId,p)}))})).next((()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),h=c.key,f=c.value,p=rm();f.forEach((m=>{if(!r.has(m)){const A=cm(t.get(m),s.get(m));A!==null&&p.set(m,A),r=r.add(m)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return b.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,i){return QA(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):YA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,i):this.getDocumentsMatchingCollectionQuery(e,t,s,i)}getNextDocuments(e,t,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,i).next((r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,i-r.size):b.resolve(Kn());let l=ar,c=r;return o.next((h=>b.forEach(h,((f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),r.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next((m=>{c=c.insert(f,m)}))))).next((()=>this.populateOverlays(e,h,r))).next((()=>this.computeViews(e,c,h,ne()))).next((f=>({batchId:l,changes:tS(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next((s=>{let i=Li();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,i){const r=t.collectionGroup;let o=Li();return this.indexManager.getCollectionParents(e,r).next((l=>b.forEach(l,(c=>{const h=(function(p,m){return new ga(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next((f=>{f.forEach(((p,m)=>{o=o.insert(p,m)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,i)))).next((o=>{r.forEach(((c,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,ze.newInvalidDocument(f)))}));let l=Li();return o.forEach(((c,h)=>{const f=r.get(c);f!==void 0&&Ki(f.mutation,h,an.empty(),Ae.now()),_a(t,h)&&(l=l.insert(c,h))})),l}))}}class GS{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return b.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Os(i.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:MS(i.bundledQuery),readTime:Os(i.readTime)}})(t)),b.resolve()}}class KS{constructor(){this.overlays=new we(F.comparator),this.Lr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Kn();return b.forEach(t,(i=>this.getOverlay(e,i).next((r=>{r!==null&&s.set(i,r)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((i,r)=>{this.bt(e,t,r)})),b.resolve()}removeOverlaysForBatchId(e,t,s){const i=this.Lr.get(s);return i!==void 0&&(i.forEach((r=>this.overlays=this.overlays.remove(r))),this.Lr.delete(s)),b.resolve()}getOverlaysForCollection(e,t,s){const i=Kn(),r=t.length+1,o=new F(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===r&&c.largestBatchId>s&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,s,i){let r=new we(((h,f)=>h-f));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=r.get(h.largestBatchId);f===null&&(f=Kn(),r=r.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=Kn(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=i)););return b.resolve(l)}bt(e,t,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.Lr.get(i.largestBatchId).delete(s.key);this.Lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new pS(t,s));let r=this.Lr.get(t);r===void 0&&(r=ne(),this.Lr.set(t,r)),this.Lr.set(t,r.add(s.key))}}class QS{constructor(){this.sessionToken=qe.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class ru{constructor(){this.kr=new De(Le.Kr),this.qr=new De(Le.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new Le(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new Le(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new F(new me([])),s=new Le(t,e),i=new Le(t,e+1),r=[];return this.qr.forEachInRange([s,i],(o=>{this.Wr(o),r.push(o.key)})),r}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new F(new me([])),s=new Le(t,e),i=new Le(t,e+1);let r=ne();return this.qr.forEachInRange([s,i],(o=>{r=r.add(o.key)})),r}containsKey(e){const t=new Le(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Le{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return F.comparator(e.key,t.key)||X(e.Hr,t.Hr)}static Ur(e,t){return X(e.Hr,t.Hr)||F.comparator(e.key,t.key)}}class YS{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new De(Le.Kr)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,i){const r=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new fS(r,t,s,i);this.mutationQueue.push(o);for(const l of i)this.Jr=this.Jr.add(new Le(l.key,r)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=this.Xr(s),r=i<0?0:i;return b.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?SA:this.Yn-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Le(t,0),i=new Le(t,Number.POSITIVE_INFINITY),r=[];return this.Jr.forEachInRange([s,i],(o=>{const l=this.Zr(o.Hr);r.push(l)})),b.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new De(X);return t.forEach((i=>{const r=new Le(i,0),o=new Le(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([r,o],(l=>{s=s.add(l.Hr)}))})),b.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1;let r=s;F.isDocumentKey(r)||(r=r.child(""));const o=new Le(new F(r),0);let l=new De(X);return this.Jr.forEachWhile((c=>{const h=c.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(l=l.add(c.Hr)),!0)}),o),b.resolve(this.Yr(l))}Yr(e){const t=[];return e.forEach((s=>{const i=this.Zr(s);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){_e(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return b.forEach(t.mutations,(i=>{const r=new Le(i.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new Le(t,0),i=this.Jr.firstAfterOrEqual(s);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class JS{constructor(e){this.ti=e,this.docs=(function(){return new we(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,i=this.docs.get(s),r=i?i.size:0,o=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return b.resolve(s?s.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let s=Cn();return t.forEach((i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():ze.newInvalidDocument(i))})),b.resolve(s)}getDocumentsMatchingQuery(e,t,s,i){let r=Cn();const o=t.path,l=new F(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||TA(IA(f),s)<=0||(i.has(f.key)||_a(t,f))&&(r=r.insert(f.key,f.mutableCopy()))}return b.resolve(r)}getAllFromCollectionGroup(e,t,s,i){$(9500)}ni(e,t){return b.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new XS(this)}getSize(e){return b.resolve(this.size)}}class XS extends HS{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(s)})),b.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class ZS{constructor(e){this.persistence=e,this.ri=new ls((t=>Zc(t)),eu),this.lastRemoteSnapshotVersion=H.min(),this.highestTargetId=0,this.ii=0,this.si=new ru,this.targetCount=0,this.oi=$s._r()}forEachTarget(e,t){return this.ri.forEach(((s,i)=>t(i))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),b.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new $s(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.lr(t),b.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,s){let i=0;const r=[];return this.ri.forEach(((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.ri.delete(o),r.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),b.waitFor(r).next((()=>i))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return b.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),b.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((o=>{r.push(i.markPotentiallyOrphaned(e,o))})),b.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return b.resolve(s)}containsKey(e,t){return b.resolve(this.si.containsKey(t))}}class Im{constructor(e,t){this._i={},this.overlays={},this.ai=new da(0),this.ui=!1,this.ui=!0,this.ci=new QS,this.referenceDelegate=e(this),this.li=new ZS(this),this.indexManager=new VS,this.remoteDocumentCache=(function(i){return new JS(i)})((s=>this.referenceDelegate.hi(s))),this.serializer=new LS(t),this.Pi=new GS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new KS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new YS(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){M("MemoryPersistence","Starting transaction:",e);const i=new eR(this.ai.next());return this.referenceDelegate.Ti(),s(i).next((r=>this.referenceDelegate.Ii(i).next((()=>r)))).toPromise().then((r=>(i.raiseOnCommittedEvent(),r)))}Ei(e,t){return b.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class eR extends CA{constructor(e){super(),this.currentSequenceNumber=e}}class ou{constructor(e){this.persistence=e,this.Ri=new ru,this.Ai=null}static Vi(e){return new ou(e)}get di(){if(this.Ai)return this.Ai;throw $(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),b.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((i=>this.di.add(i.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((r=>this.di.add(r.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.di,(s=>{const i=F.fromPath(s);return this.mi(e,i).next((r=>{r||t.removeEntry(i,H.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class zo{constructor(e,t){this.persistence=e,this.fi=new ls((s=>RA(s.path)),((s,i)=>s.isEqual(i))),this.garbageCollector=jS(this,t)}static Vi(e,t){return new zo(e,t)}Ti(){}Ii(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((i=>s+i))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return b.forEach(this.fi,((s,i)=>this.wr(e,s,i).next((r=>r?b.resolve():t(i)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ni(e,(o=>this.wr(e,o,t).next((l=>{l||(s++,r.removeEntry(o,H.min()))})))).next((()=>r.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),b.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=po(e.data.value)),t}wr(e,t,s){return b.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.fi.get(t);return b.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class au{constructor(e,t,s,i){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=i}static Es(e,t){let s=ne(),i=ne();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new au(e,t.fromCache,s,i)}}class tR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class nR{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return dy()?8:AA(Ge())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,i){const r={result:null};return this.gs(e,t).next((o=>{r.result=o})).next((()=>{if(!r.result)return this.ps(e,t,i,s).next((o=>{r.result=o}))})).next((()=>{if(r.result)return;const o=new tR;return this.ys(e,t,o).next((l=>{if(r.result=l,this.As)return this.ws(e,t,o,l.size)}))})).next((()=>r.result))}ws(e,t,s,i){return s.documentReadCount<this.Vs?(Is()<=Y.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Ts(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(Is()<=Y.DEBUG&&M("QueryEngine","Query:",Ts(t),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.ds*i?(Is()<=Y.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Ts(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,St(t))):b.resolve())}gs(e,t){if(Wd(t))return b.resolve(null);let s=St(t);return this.indexManager.getIndexType(e,s).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=ql(t,null,"F"),s=St(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((r=>{const o=ne(...r);return this.fs.getDocuments(e,o).next((l=>this.indexManager.getMinOffset(e,s).next((c=>{const h=this.bs(t,l);return this.Ss(t,h,o,c.readTime)?this.gs(e,ql(t,null,"F")):this.Ds(e,h,t,c)}))))})))))}ps(e,t,s,i){return Wd(t)||i.isEqual(H.min())?b.resolve(null):this.fs.getDocuments(e,s).next((r=>{const o=this.bs(t,r);return this.Ss(t,o,s,i)?b.resolve(null):(Is()<=Y.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ts(t)),this.Ds(e,o,t,EA(i,ar)).next((l=>l)))}))}bs(e,t){let s=new De(sm(e));return t.forEach(((i,r)=>{_a(e,r)&&(s=s.add(r))})),s}Ss(e,t,s,i){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}ys(e,t,s){return Is()<=Y.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Ts(t)),this.fs.getDocumentsMatchingQuery(e,t,En.min(),s)}Ds(e,t,s,i){return this.fs.getDocumentsMatchingQuery(e,s,i).next((r=>(t.forEach((o=>{r=r.insert(o.key,o)})),r)))}}const lu="LocalStore",sR=3e8;class iR{constructor(e,t,s,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new we(X),this.Fs=new ls((r=>Zc(r)),eu),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zS(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function rR(n,e,t,s){return new iR(n,e,t,s)}async function Tm(n,e){const t=te(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let i;return t.mutationQueue.getAllMutationBatches(s).next((r=>(i=r,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((r=>{const o=[],l=[];let c=ne();for(const h of i){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of r){l.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(s,c).next((h=>({Ns:h,removedBatchIds:o,addedBatchIds:l})))}))}))}function wm(n){const e=te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function oR(n,e){const t=te(n),s=e.snapshotVersion;let i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const o=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;const l=[];e.targetChanges.forEach(((f,p)=>{const m=i.get(p);if(!m)return;l.push(t.li.removeMatchingKeys(r,f.removedDocuments,p).next((()=>t.li.addMatchingKeys(r,f.addedDocuments,p))));let A=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken(qe.EMPTY_BYTE_STRING,H.min()).withLastLimboFreeSnapshotVersion(H.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,s)),i=i.insert(p,A),(function(P,O,W){return P.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=sR?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0})(m,A,f)&&l.push(t.li.updateTargetData(r,A))}));let c=Cn(),h=ne();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(r,f))})),l.push(aR(r,o,e.documentUpdates).next((f=>{c=f.Bs,h=f.Ls}))),!s.isEqual(H.min())){const f=t.li.getLastRemoteSnapshotVersion(r).next((p=>t.li.setTargetsMetadata(r,r.currentSequenceNumber,s)));l.push(f)}return b.waitFor(l).next((()=>o.apply(r))).next((()=>t.localDocuments.getLocalViewOfDocuments(r,c,h))).next((()=>c))})).then((r=>(t.vs=i,r)))}function aR(n,e,t){let s=ne(),i=ne();return t.forEach((r=>s=s.add(r))),e.getEntries(n,s).next((r=>{let o=Cn();return t.forEach(((l,c)=>{const h=r.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),c.isNoDocument()&&c.version.isEqual(H.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):M(lu,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)})),{Bs:o,Ls:i}}))}function lR(n,e){const t=te(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let i;return t.li.getTargetData(s,e).next((r=>r?(i=r,b.resolve(i)):t.li.allocateTargetId(s).next((o=>(i=new ln(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,i).next((()=>i)))))))})).then((s=>{const i=t.vs.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function zl(n,e,t){const s=te(n),i=s.vs.get(e),r=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",r,(o=>s.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ni(o))throw o;M(lu,`Failed to update sequence numbers for target ${e}: ${o}`)}s.vs=s.vs.remove(e),s.Fs.delete(i.target)}function tf(n,e,t){const s=te(n);let i=H.min(),r=ne();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,f){const p=te(c),m=p.Fs.get(f);return m!==void 0?b.resolve(p.vs.get(m)):p.li.getTargetData(h,f)})(s,o,St(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(o,l.targetId).next((c=>{r=c}))})).next((()=>s.Cs.getDocumentsMatchingQuery(o,e,t?i:H.min(),t?r:ne()))).next((l=>(cR(s,XA(e),l),{documents:l,ks:r})))))}function cR(n,e,t){let s=n.Ms.get(e)||H.min();t.forEach(((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)})),n.Ms.set(e,s)}class nf{constructor(){this.activeTargetIds=iS()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uR{constructor(){this.vo=new nf,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new nf,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hR{Mo(e){}shutdown(){}}const sf="ConnectivityMonitor";class rf{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){M(sf,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){M(sf,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let io=null;function Gl(){return io===null?io=(function(){return 268435456+Math.round(2147483648*Math.random())})():io++,"0x"+io.toString(16)}const rl="RestConnection",dR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class fR{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${i}`,this.$o=this.databaseId.database===qo?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Wo(e,t,s,i,r){const o=Gl(),l=this.Qo(e,t.toUriEncodedString());M(rl,`Sending RPC '${e}' ${o}:`,l,s);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(c,i,r);const{host:h}=new URL(l),f=Sn(h);return this.zo(e,l,c,s,f).then((p=>(M(rl,`Received RPC '${e}' ${o}: `,p),p)),(p=>{throw qs(rl,`RPC '${e}' ${o} failed with error: `,p,"url: ",l,"request:",s),p}))}jo(e,t,s,i,r,o){return this.Wo(e,t,s,i,r)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ti})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,r)=>e[r]=i)),s&&s.headers.forEach(((i,r)=>e[r]=i))}Qo(e,t){const s=dR[e];let i=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}class pR{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const je="WebChannelConnection",Pi=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(i){setTimeout((()=>{throw i}),0)}}))};class xs extends fR{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!xs.c_){const e=Bg();Pi(e,Ug.STAT_EVENT,(t=>{t.stat===Dl.PROXY?M(je,"STAT_EVENT: detected buffering proxy"):t.stat===Dl.NOPROXY&&M(je,"STAT_EVENT: detected no buffering proxy")})),xs.c_=!0}}zo(e,t,s,i,r){const o=Gl();return new Promise(((l,c)=>{const h=new Vg;h.setWithCredentials(!0),h.listenOnce(Fg.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case fo.NO_ERROR:const p=h.getResponseJson();M(je,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),l(p);break;case fo.TIMEOUT:M(je,`RPC '${e}' ${o} timed out`),c(new V(N.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:const m=h.getStatus();if(M(je,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);const S=A?.error;if(S&&S.status&&S.message){const P=(function(W){const B=W.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(B)>=0?B:N.UNKNOWN})(S.status);c(new V(P,S.message))}else c(new V(N.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new V(N.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{M(je,`RPC '${e}' ${o} completed.`)}}));const f=JSON.stringify(i);M(je,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,s,15)}))}T_(e,t,s){const i=Gl(),r=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=r.join("");M(je,`Creating RPC '${e}' stream ${i}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,m=!1;const A=new pR({Ho:S=>{m?M(je,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(p||(M(je,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),M(je,`RPC '${e}' stream ${i} sending:`,S),f.send(S))},Jo:()=>f.close()});return Pi(f,xi.EventType.OPEN,(()=>{m||(M(je,`RPC '${e}' stream ${i} transport opened.`),A.i_())})),Pi(f,xi.EventType.CLOSE,(()=>{m||(m=!0,M(je,`RPC '${e}' stream ${i} transport closed`),A.o_(),this.E_(f))})),Pi(f,xi.EventType.ERROR,(S=>{m||(m=!0,qs(je,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),A.o_(new V(N.UNAVAILABLE,"The operation could not be completed")))})),Pi(f,xi.EventType.MESSAGE,(S=>{if(!m){const P=S.data[0];_e(!!P,16349);const O=P,W=O?.error||O[0]?.error;if(W){M(je,`RPC '${e}' stream ${i} received error:`,W);const B=W.status;let z=(function(de){const E=Ce[de];if(E!==void 0)return hm(E)})(B),re=W.message;z===void 0&&(z=N.INTERNAL,re="Unknown error status: "+B+" with message "+W.message),m=!0,A.o_(new V(z,re)),f.close()}else M(je,`RPC '${e}' stream ${i} received:`,P),A.__(P)}})),xs.u_(),setTimeout((()=>{A.s_()}),0),A}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return qg()}}function gR(n){return new xs(n)}function ol(){return typeof document<"u"?document:null}function Cm(n){return new TS(n,!0)}xs.c_=!1;class Am{constructor(e,t,s=1e3,i=1.5,r=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=i,this.V_=r,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-s);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const of="PersistentStream";class mR{constructor(e,t,s,i,r,o,l,c){this.Ci=e,this.b_=s,this.S_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Am(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(Wt(t.toString()),Wt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,i])=>{this.D_===t&&this.G_(s,i)}),(s=>{e((()=>{const i=new V(N.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(i)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((i=>{s((()=>this.z_(i)))})),this.stream.onMessage((i=>{s((()=>++this.F_==1?this.H_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(of,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(M(of,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _R extends mR{constructor(e,t,s,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,i,o),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=RS(this.serializer,e),s=(function(r){if(!("targetChange"in r))return H.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?H.min():o.readTime?Os(o.readTime):H.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=Jd(this.serializer),t.addTarget=(function(r,o){let l;const c=o.target;if(l=Bl(c)?{documents:bS(r,c)}:{query:PS(r,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=CS(r,o.resumeToken);const h=Hl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(H.min())>0){l.readTime=wS(r,o.snapshotVersion.toTimestamp());const h=Hl(r,o.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const s=NS(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=Jd(this.serializer),t.removeTarget=e,this.K_(t)}}class yR{}class vR extends yR{constructor(e,t,s,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(N.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Wo(e,$l(t,s),i,r,o))).catch((r=>{throw r.name==="FirebaseError"?(r.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new V(N.UNKNOWN,r.toString())}))}jo(e,t,s,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.jo(e,$l(t,s),i,o,l,r))).catch((o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(N.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function ER(n,e,t,s){return new vR(n,e,t,s)}class IR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Wt(t),this.aa=!1):M("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const zs="RemoteStore";class TR{constructor(e,t,s,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=r,this.Aa.Mo((o=>{s.enqueueAndForget((async()=>{Ar(this)&&(M(zs,"Restarting streams for network reachability change."),await(async function(c){const h=te(c);h.Ea.add(4),await Cr(h),h.Va.set("Unknown"),h.Ea.delete(4),await Ia(h)})(this))}))})),this.Va=new IR(s,i)}}async function Ia(n){if(Ar(n))for(const e of n.Ra)await e(!0)}async function Cr(n){for(const e of n.Ra)await e(!1)}function Sm(n,e){const t=te(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),du(t)?hu(t):si(t).O_()&&uu(t,e))}function cu(n,e){const t=te(n),s=si(t);t.Ia.delete(e),s.O_()&&Rm(t,e),t.Ia.size===0&&(s.O_()?s.L_():Ar(t)&&t.Va.set("Unknown"))}function uu(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(H.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}si(n).Z_(e)}function Rm(n,e){n.da.$e(e),si(n).X_(e)}function hu(n){n.da=new yS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),si(n).start(),n.Va.ua()}function du(n){return Ar(n)&&!si(n).x_()&&n.Ia.size>0}function Ar(n){return te(n).Ea.size===0}function bm(n){n.da=void 0}async function wR(n){n.Va.set("Online")}async function CR(n){n.Ia.forEach(((e,t)=>{uu(n,e)}))}async function AR(n,e){bm(n),du(n)?(n.Va.ha(e),hu(n)):n.Va.set("Unknown")}async function SR(n,e,t){if(n.Va.set("Online"),e instanceof fm&&e.state===2&&e.cause)try{await(async function(i,r){const o=r.cause;for(const l of r.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.da.removeTarget(l))})(n,e)}catch(s){M(zs,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await af(n,s)}else if(e instanceof mo?n.da.Xe(e):e instanceof dm?n.da.st(e):n.da.tt(e),!t.isEqual(H.min()))try{const s=await wm(n.localStore);t.compareTo(s)>=0&&await(function(r,o){const l=r.da.Tt(o);return l.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=r.Ia.get(h);f&&r.Ia.set(h,f.withResumeToken(c.resumeToken,o))}})),l.targetMismatches.forEach(((c,h)=>{const f=r.Ia.get(c);if(!f)return;r.Ia.set(c,f.withResumeToken(qe.EMPTY_BYTE_STRING,f.snapshotVersion)),Rm(r,c);const p=new ln(f.target,c,h,f.sequenceNumber);uu(r,p)})),r.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(s){M(zs,"Failed to raise snapshot:",s),await af(n,s)}}async function af(n,e,t){if(!ni(e))throw e;n.Ea.add(1),await Cr(n),n.Va.set("Offline"),t||(t=()=>wm(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(zs,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ia(n)}))}async function lf(n,e){const t=te(n);t.asyncQueue.verifyOperationInProgress(),M(zs,"RemoteStore received new credentials");const s=Ar(t);t.Ea.add(3),await Cr(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ia(t)}async function RR(n,e){const t=te(n);e?(t.Ea.delete(2),await Ia(t)):e||(t.Ea.add(2),await Cr(t),t.Va.set("Unknown"))}function si(n){return n.ma||(n.ma=(function(t,s,i){const r=te(t);return r.sa(),new _R(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)})(n.datastore,n.asyncQueue,{Zo:wR.bind(null,n),Yo:CR.bind(null,n),t_:AR.bind(null,n),J_:SR.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),du(n)?hu(n):n.Va.set("Unknown")):(await n.ma.stop(),bm(n))}))),n.ma}class fu{constructor(e,t,s,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new Qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,i,r){const o=Date.now()+s,l=new fu(e,t,o,i,r);return l.start(s),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pm(n,e){if(Wt("AsyncQueue",`${e}: ${n}`),ni(n))return new V(N.UNAVAILABLE,`${e}: ${n}`);throw n}class Ls{static emptySet(e){return new Ls(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||F.comparator(t.key,s.key):(t,s)=>F.comparator(t.key,s.key),this.keyedMap=Li(),this.sortedSet=new we(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ls)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Ls;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class cf{constructor(){this.ga=new we(F.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Gs{constructor(e,t,s,i,r,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,i,r){const o=[];return t.forEach((l=>{o.push({type:0,doc:l})})),new Gs(e,t,Ls.emptySet(t),o,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ma(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==s[i].type||!t[i].doc.isEqual(s[i].doc))return!1;return!0}}class bR{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class PR{constructor(){this.queries=uf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const i=te(t),r=i.queries;i.queries=uf(),r.forEach(((o,l)=>{for(const c of l.ba)c.onError(s)}))})(this,new V(N.ABORTED,"Firestore shutting down"))}}function uf(){return new ls((n=>nm(n)),ma)}async function kR(n,e){const t=te(n);let s=3;const i=e.query;let r=t.queries.get(i);r?!r.Sa()&&e.Da()&&(s=2):(r=new bR,s=e.Da()?0:1);try{switch(s){case 0:r.wa=await t.onListen(i,!0);break;case 1:r.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const l=Pm(o,`Initialization of query '${Ts(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,r),r.ba.push(e),e.va(t.onlineState),r.wa&&e.Fa(r.wa)&&pu(t)}async function NR(n,e){const t=te(n),s=e.query;let i=3;const r=t.queries.get(s);if(r){const o=r.ba.indexOf(e);o>=0&&(r.ba.splice(o,1),r.ba.length===0?i=e.Da()?0:1:!r.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function DR(n,e){const t=te(n);let s=!1;for(const i of e){const r=i.query,o=t.queries.get(r);if(o){for(const l of o.ba)l.Fa(i)&&(s=!0);o.wa=i}}s&&pu(t)}function OR(n,e,t){const s=te(n),i=s.queries.get(e);if(i)for(const r of i.ba)r.onError(t);s.queries.delete(e)}function pu(n){n.Ca.forEach((e=>{e.next()}))}var Kl,hf;(hf=Kl||(Kl={})).Ma="default",hf.Cache="cache";class xR{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new Gs(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Gs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Kl.Cache}}class km{constructor(e){this.key=e}}class Nm{constructor(e){this.key=e}}class LR{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ne(),this.mutatedKeys=ne(),this.eu=sm(e),this.tu=new Ls(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new cf,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,p)=>{const m=i.get(f),A=_a(this.query,p)?p:null,S=!!m&&this.mutatedKeys.has(m.key),P=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let O=!1;m&&A?m.data.isEqual(A.data)?S!==P&&(s.track({type:3,doc:A}),O=!0):this.su(m,A)||(s.track({type:2,doc:A}),O=!0,(c&&this.eu(A,c)>0||h&&this.eu(A,h)<0)&&(l=!0)):!m&&A?(s.track({type:0,doc:A}),O=!0):m&&!A&&(s.track({type:1,doc:m}),O=!0,(c||h)&&(l=!0)),O&&(A?(o=o.add(A),r=P?r.add(f):r.delete(f)):(o=o.delete(f),r=r.delete(f)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),r=r.delete(f.key),s.track({type:1,doc:f})}return{tu:o,iu:s,Ss:l,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((f,p)=>(function(A,S){const P=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Vt:O})}};return P(A)-P(S)})(f.type,p.type)||this.eu(f.doc,p.doc))),this.ou(s),i=i??!1;const l=t&&!i?this._u():[],c=this.Ya.size===0&&this.current&&!i?1:0,h=c!==this.Xa;return this.Xa=c,o.length!==0||h?{snapshot:new Gs(this.query,e.tu,r,o,e.mutatedKeys,c===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cf,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ne(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Nm(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new km(s))})),t}cu(e){this.Za=e.ks,this.Ya=ne();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Gs.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const gu="SyncEngine";class MR{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class VR{constructor(e){this.key=e,this.hu=!1}}class FR{constructor(e,t,s,i,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ls((l=>nm(l)),ma),this.Iu=new Map,this.Eu=new Set,this.Ru=new we(F.comparator),this.Au=new Map,this.Vu=new ru,this.du={},this.mu=new Map,this.fu=$s.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function UR(n,e,t=!0){const s=Mm(n);let i;const r=s.Tu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.lu()):i=await Dm(s,e,t,!0),i}async function BR(n,e){const t=Mm(n);await Dm(t,e,!0,!1)}async function Dm(n,e,t,s){const i=await lR(n.localStore,St(e)),r=i.targetId,o=n.sharedClientState.addLocalQueryTarget(r,t);let l;return s&&(l=await qR(n,e,r,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Sm(n.remoteStore,i),l}async function qR(n,e,t,s,i){n.pu=(p,m,A)=>(async function(P,O,W,B){let z=O.view.ru(W);z.Ss&&(z=await tf(P.localStore,O.query,!1).then((({documents:E})=>O.view.ru(E,z))));const re=B&&B.targetChanges.get(O.targetId),se=B&&B.targetMismatches.get(O.targetId)!=null,de=O.view.applyChanges(z,P.isPrimaryClient,re,se);return ff(P,O.targetId,de.au),de.snapshot})(n,p,m,A);const r=await tf(n.localStore,e,!0),o=new LR(e,r.ks),l=o.ru(r.documents),c=wr.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",i),h=o.applyChanges(l,n.isPrimaryClient,c);ff(n,t,h.au);const f=new MR(e,t,o);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function WR(n,e,t){const s=te(n),i=s.Tu.get(e),r=s.Iu.get(i.targetId);if(r.length>1)return s.Iu.set(i.targetId,r.filter((o=>!ma(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await zl(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),t&&cu(s.remoteStore,i.targetId),Ql(s,i.targetId)})).catch(ha)):(Ql(s,i.targetId),await zl(s.localStore,i.targetId,!0))}async function jR(n,e){const t=te(n),s=t.Tu.get(e),i=t.Iu.get(s.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),cu(t.remoteStore,s.targetId))}async function Om(n,e){const t=te(n);try{const s=await oR(t.localStore,e);e.targetChanges.forEach(((i,r)=>{const o=t.Au.get(r);o&&(_e(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?_e(o.hu,14607):i.removedDocuments.size>0&&(_e(o.hu,42227),o.hu=!1))})),await Lm(t,s,e)}catch(s){await ha(s)}}function df(n,e,t){const s=te(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const i=[];s.Tu.forEach(((r,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(o,l){const c=te(o);c.onlineState=l;let h=!1;c.queries.forEach(((f,p)=>{for(const m of p.ba)m.va(l)&&(h=!0)})),h&&pu(c)})(s.eventManager,e),i.length&&s.Pu.J_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function HR(n,e,t){const s=te(n);s.sharedClientState.updateQueryState(e,"rejected",t);const i=s.Au.get(e),r=i&&i.key;if(r){let o=new we(F.comparator);o=o.insert(r,ze.newNoDocument(r,H.min()));const l=ne().add(r),c=new Ea(H.min(),new Map,new we(X),o,l);await Om(s,c),s.Ru=s.Ru.remove(r),s.Au.delete(e),mu(s)}else await zl(s.localStore,e,!1).then((()=>Ql(s,e,t))).catch(ha)}function Ql(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||xm(n,s)}))}function xm(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(cu(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),mu(n))}function ff(n,e,t){for(const s of t)s instanceof km?(n.Vu.addReference(s.key,e),$R(n,s)):s instanceof Nm?(M(gu,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||xm(n,s.key)):$(19791,{wu:s})}function $R(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||(M(gu,"New document in limbo: "+t),n.Eu.add(s),mu(n))}function mu(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new F(me.fromString(e)),s=n.fu.next();n.Au.set(s,new VR(t)),n.Ru=n.Ru.insert(t,s),Sm(n.remoteStore,new ln(St(tu(t.path)),s,"TargetPurposeLimboResolution",da.ce))}}async function Lm(n,e,t){const s=te(n),i=[],r=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((l,c)=>{o.push(s.pu(c,e,t).then((h=>{if((h||t)&&s.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;s.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){i.push(h);const f=au.Es(c.targetId,h);r.push(f)}})))})),await Promise.all(o),s.Pu.J_(i),await(async function(c,h){const f=te(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>b.forEach(h,(m=>b.forEach(m.Ts,(A=>f.persistence.referenceDelegate.addReference(p,m.targetId,A))).next((()=>b.forEach(m.Is,(A=>f.persistence.referenceDelegate.removeReference(p,m.targetId,A)))))))))}catch(p){if(!ni(p))throw p;M(lu,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const A=f.vs.get(m),S=A.snapshotVersion,P=A.withLastLimboFreeSnapshotVersion(S);f.vs=f.vs.insert(m,P)}}})(s.localStore,r))}async function zR(n,e){const t=te(n);if(!t.currentUser.isEqual(e)){M(gu,"User change. New user:",e.toKey());const s=await Tm(t.localStore,e);t.currentUser=e,(function(r,o){r.mu.forEach((l=>{l.forEach((c=>{c.reject(new V(N.CANCELLED,o))}))})),r.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Lm(t,s.Ns)}}function GR(n,e){const t=te(n),s=t.Au.get(e);if(s&&s.hu)return ne().add(s.key);{let i=ne();const r=t.Iu.get(e);if(!r)return i;for(const o of r){const l=t.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}function Mm(n){const e=te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Om.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=GR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=HR.bind(null,e),e.Pu.J_=DR.bind(null,e.eventManager),e.Pu.yu=OR.bind(null,e.eventManager),e}class Go{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Cm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return rR(this.persistence,new nR,e.initialUser,this.serializer)}Cu(e){return new Im(ou.Vi,this.serializer)}Du(e){return new uR}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Go.provider={build:()=>new Go};class KR extends Go{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){_e(this.persistence.referenceDelegate instanceof zo,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new qS(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ze.withCacheSize(this.cacheSizeBytes):Ze.DEFAULT;return new Im((s=>zo.Vi(s,t)),this.serializer)}}class Yl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>df(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=zR.bind(null,this.syncEngine),await RR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PR})()}createDatastore(e){const t=Cm(e.databaseInfo.databaseId),s=gR(e.databaseInfo);return ER(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,i,r,o,l){return new TR(s,i,r,o,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>df(this.syncEngine,t,0)),(function(){return rf.v()?new rf:new hR})())}createSyncEngine(e,t){return(function(i,r,o,l,c,h,f){const p=new FR(i,r,o,l,c,h);return f&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=te(t);M(zs,"RemoteStore shutting down."),s.Ea.add(5),await Cr(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Yl.provider={build:()=>new Yl};class QR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Wt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const An="FirestoreClient";class YR{constructor(e,t,s,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=i,this.user=He.UNAUTHENTICATED,this.clientId=Yc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,(async o=>{M(An,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(M(An,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Pm(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function al(n,e){n.asyncQueue.verifyOperationInProgress(),M(An,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async i=>{s.isEqual(i)||(await Tm(e.localStore,i),s=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function pf(n,e){n.asyncQueue.verifyOperationInProgress();const t=await JR(n);M(An,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>lf(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,i)=>lf(e.remoteStore,i))),n._onlineComponents=e}async function JR(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(An,"Using user provided OfflineComponentProvider");try{await al(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===N.FAILED_PRECONDITION||i.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;qs("Error using user provided cache. Falling back to memory cache: "+t),await al(n,new Go)}}else M(An,"Using default OfflineComponentProvider"),await al(n,new KR(void 0));return n._offlineComponents}async function XR(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(An,"Using user provided OnlineComponentProvider"),await pf(n,n._uninitializedComponentsProvider._online)):(M(An,"Using default OnlineComponentProvider"),await pf(n,new Yl))),n._onlineComponents}async function ZR(n){const e=await XR(n),t=e.eventManager;return t.onListen=UR.bind(null,e.syncEngine),t.onUnlisten=WR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=BR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=jR.bind(null,e.syncEngine),t}function eb(n,e,t={}){const s=new Qn;return n.asyncQueue.enqueueAndForget((async()=>(function(r,o,l,c,h){const f=new QR({next:m=>{f.Nu(),o.enqueueAndForget((()=>NR(r,p)));const A=m.docs.has(l);!A&&m.fromCache?h.reject(new V(N.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&m.fromCache&&c&&c.source==="server"?h.reject(new V(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new xR(tu(l.path),f,{includeMetadataChanges:!0,Ka:!0});return kR(r,p)})(await ZR(n),n.asyncQueue,e,t,s))),s.promise}function Vm(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const tb="ComponentProvider",gf=new Map;function nb(n,e,t,s,i){return new NA(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Vm(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,s)}const Fm="firestore.googleapis.com",mf=!0;class _f{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Fm,this.ssl=mf}else this.host=e.host,this.ssl=e.ssl??mf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Em;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<US)throw new V(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_A("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vm(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,i){return s.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class _u{constructor(e,t,s,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _f({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _f(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new oA;switch(s.type){case"firstParty":return new uA(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new V(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=gf.get(t);s&&(M(tb,"Removing Datastore"),gf.delete(t),s.terminate())})(this),Promise.resolve()}}function sb(n,e,t,s={}){n=xl(n,_u);const i=Sn(e),r=n._getSettings(),o={...r,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(tc(`https://${l}`),nc("Firestore",!0)),r.host!==Fm&&r.host!==l&&qs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...r,host:l,ssl:i,emulatorOptions:s};if(!mn(c,o)&&(n._setSettings(c),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=He.MOCK_USER;else{h=xf(s.mockUserToken,n._app?.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new V(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new He(p)}n._authCredentials=new aA(new jg(h,f))}}class yu{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new yu(this.firestore,e,this._query)}}class Je{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Je(this.firestore,e,this._key)}toJSON(){return{type:Je._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Ir(t,Je._jsonSchema))return new Je(e,s||null,new F(me.fromString(t.referencePath)))}}Je._jsonSchemaVersion="firestore/documentReference/1.0",Je._jsonSchema={type:Se("string",Je._jsonSchemaVersion),referencePath:Se("string")};class hr extends yu{constructor(e,t,s){super(e,t,tu(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Je(this.firestore,null,new F(e))}withConverter(e){return new hr(this.firestore,e,this._path)}}function ib(n,e,...t){if(n=Ke(n),arguments.length===1&&(e=Yc.newId()),mA("doc","path",e),n instanceof _u){const s=me.fromString(e,...t);return Pd(s),new Je(n,null,new F(s))}{if(!(n instanceof Je||n instanceof hr))throw new V(N.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(me.fromString(e,...t));return Pd(s),new Je(n.firestore,n instanceof hr?n.converter:null,new F(s))}}const yf="AsyncQueue";class vf{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Am(this,"async_queue_retry"),this._c=()=>{const s=ol();s&&M(yf,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=ol();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ol();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Qn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!ni(e))throw e;M(yf,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,Wt("INTERNAL UNHANDLED ERROR: ",Ef(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=fu.createAndSchedule(this,e,t,s,(r=>this.hc(r)));return this.tc.push(i),i}uc(){this.nc&&$(47125,{Pc:Ef(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ef(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Um extends _u{constructor(e,t,s,i){super(e,t,s,i),this.type="firestore",this._queue=new vf,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vf(e),this._firestoreClient=void 0,await e}}}function rb(n,e){const t=typeof n=="object"?n:oc(),s=typeof n=="string"?n:qo,i=Xo(t,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=Nf("firestore");r&&sb(i,...r)}return i}function ob(n){if(n._terminated)throw new V(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ab(n),n._firestoreClient}function ab(n){const e=n._freezeSettings(),t=nb(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new YR(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const r=i?._online.build();return{_offline:i?._offline.build(r),_online:r}})(n._componentsProvider))}class It{constructor(e){this._byteString=e}static fromBase64String(e){try{return new It(qe.fromBase64String(e))}catch(t){throw new V(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new It(qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:It._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ir(e,It._jsonSchema))return It.fromBase64String(e.bytes)}}It._jsonSchemaVersion="firestore/bytes/1.0",It._jsonSchema={type:Se("string",It._jsonSchemaVersion),bytes:Se("string")};class Bm{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:pn._jsonSchemaVersion}}static fromJSON(e){if(Ir(e,pn._jsonSchema))return new pn(e.latitude,e.longitude)}}pn._jsonSchemaVersion="firestore/geoPoint/1.0",pn._jsonSchema={type:Se("string",pn._jsonSchemaVersion),latitude:Se("number"),longitude:Se("number")};class gn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:gn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ir(e,gn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new gn(e.vectorValues);throw new V(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}gn._jsonSchemaVersion="firestore/vectorValue/1.0",gn._jsonSchema={type:Se("string",gn._jsonSchemaVersion),vectorValues:Se("object")};function qm(n,e,t){if((e=Ke(e))instanceof Bm)return e._internalPath;if(typeof e=="string")return cb(n,e);throw Jl("Field path arguments must be of type string or ",n)}const lb=new RegExp("[~\\*/\\[\\]]");function cb(n,e,t){if(e.search(lb)>=0)throw Jl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new Bm(...e.split("."))._internalPath}catch{throw Jl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function Jl(n,e,t,s,i){let r=`Function ${e}() called with invalid data`;r+=". ";let o="";return new V(N.INVALID_ARGUMENT,r+n+o)}class ub{convertValue(e,t="none"){switch(wn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Tr(e,((i,r)=>{s[i]=this.convertValue(r,t)})),s}convertVectorValue(e){const t=e.fields?.[Ml].arrayValue?.values?.map((s=>Te(s.doubleValue)));return new gn(t)}convertGeoPoint(e){return new pn(Te(e.latitude),Te(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=pa(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(lr(e));default:return null}}convertTimestamp(e){const t=In(e);return new Ae(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=me.fromString(e);_e(vm(s),9688,{name:e});const i=new cr(s.get(1),s.get(3)),r=new F(s.popFirst(5));return i.isEqual(t)||Wt(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class hb extends ub{constructor(e){super(),this.firestore=e}convertBytes(e){return new It(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Je(this.firestore,null,t)}}const If="@firebase/firestore",Tf="4.10.0";class Wm{constructor(e,t,s,i,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new db(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(qm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class db extends Wm{data(){return super.data()}}class Vi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Jn extends Wm{constructor(e,t,s,i,r,o){super(e,t,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _o(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(qm("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Jn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Jn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Jn._jsonSchema={type:Se("string",Jn._jsonSchemaVersion),bundleSource:Se("string","DocumentSnapshot"),bundleName:Se("string"),bundle:Se("string")};class _o extends Jn{data(e={}){return super.data(e)}}class Qi{constructor(e,t,s,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vi(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new _o(this._firestore,this._userDataWriter,s.key,s,new Vi(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,r){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((l=>{const c=new _o(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Vi(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>r||l.type!==3)).map((l=>{const c=new _o(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Vi(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:fb(l.type),doc:c,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Qi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Yc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],i=[];return this.docs.forEach((r=>{r._document!==null&&(t.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function fb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}Qi._jsonSchemaVersion="firestore/querySnapshot/1.0",Qi._jsonSchema={type:Se("string",Qi._jsonSchemaVersion),bundleSource:Se("string","QuerySnapshot"),bundleName:Se("string"),bundle:Se("string")};function pb(n){n=xl(n,Je);const e=xl(n.firestore,Um),t=ob(e);return eb(t,n._key).then((s=>gb(e,n,s)))}function gb(n,e,t){const s=t.docs.get(e._key),i=new hb(n);return new Jn(n,i,e._key,s,new Vi(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){rA(rs),Xn(new _n("firestore",((s,{instanceIdentifier:i,options:r})=>{const o=s.getProvider("app").getImmediate(),l=new Um(new lA(s.getProvider("auth-internal")),new hA(o,s.getProvider("app-check-internal")),DA(o,i),o);return r={useFetchStreams:t,...r},l._setSettings(r),l}),"PUBLIC").setMultipleInstances(!0)),wt(If,Tf,e),wt(If,Tf,"esm2020")})();const mb={apiKey:"AIzaSyBpKsDGhucKO_QbNgjXG3vX1vuduYl8xy4",authDomain:"shopping-list-e939f.firebaseapp.com",databaseURL:"https://shopping-list-e939f-default-rtdb.firebaseio.com/",projectId:"shopping-list-e939f",storageBucket:"shopping-list-e939f.appspot.com"},vu=Uf(mb),ro=jT(vu),Xl=sA(vu),_b=rb(vu),jm=p_(void 0);zw(Xl,n=>{jm.set(n)});var yb=Pt('<link rel="preconnect" href="https://fonts.googleapis.com" class="svelte-1uha8ag"/> <link rel="preconnect" href="https://fonts.gstatic.com" class="svelte-1uha8ag"/> <link href="https://fonts.googleapis.com/css2?family=Playwrite+US+Modern:wght@100&amp;display=swap" rel="stylesheet" class="svelte-1uha8ag"/>',1),vb=Pt('<p class="user-name show svelte-1uha8ag"> </p> <p class="logout-link show svelte-1uha8ag">Logout</p>',1),Eb=Pt('<li><span class="item svelte-1uha8ag"> </span> <span class="quantity svelte-1uha8ag"> </span> <span class="user svelte-1uha8ag"> </span></li>'),Ib=Pt('<p class="empty-list svelte-1uha8ag">Loading shopping list...</p>'),Tb=Pt('<p class="empty-list svelte-1uha8ag">Shopping List is Empty</p>'),wb=Pt('<div class="delete-all-container svelte-1uha8ag"><button class="delete-all-btn svelte-1uha8ag"> </button></div>'),Cb=Pt('<div class="row svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="item-input" type="text" placeholder="Item to buy" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="quantity-input" type="text" placeholder="Quantity to buy" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-add-button svelte-1uha8ag"> </button></div></div> <ul class="list-container svelte-1uha8ag"><!> <!></ul> <!>',1),Ab=Pt('<div class="confirm-delete-overlay svelte-1uha8ag"><div class="confirm-delete-modal svelte-1uha8ag"><h3 class="svelte-1uha8ag">Delete selected items?</h3> <p class="svelte-1uha8ag"> </p> <div class="confirm-buttons svelte-1uha8ag"><button class="confirm-yes svelte-1uha8ag"> </button> <button class="confirm-no svelte-1uha8ag">Cancel</button></div></div></div>'),Sb=Pt('<div class="error-banner svelte-1uha8ag"> <button class="error-close svelte-1uha8ag">x</button></div>'),Rb=Pt('<!> <div><div class="modal svelte-1uha8ag"><h3 class="login-title svelte-1uha8ag">Login</h3> <div class="modal-input-container svelte-1uha8ag"><div class="input-container svelte-1uha8ag"><input id="email-input" type="email" placeholder="Email Address" class="svelte-1uha8ag"/></div> <div class="input-container svelte-1uha8ag"><input id="password-input" type="password" placeholder="Password" class="svelte-1uha8ag"/></div> <div class="button-container svelte-1uha8ag"><button class="js-login-button svelte-1uha8ag">Login</button></div></div></div></div> <div class="container svelte-1uha8ag"><div class="shopping-app svelte-1uha8ag"><div class="user-login-container svelte-1uha8ag"><p>Login</p> <!></div> <h2 class="svelte-1uha8ag">Shopping List <img src="/icons/shopping-list.png" alt="" class="svelte-1uha8ag"/></h2> <!></div></div> <!> <!> <footer class="svelte-1uha8ag"><a href="https://www.flaticon.com/free-icons/checklist" title="checklist icons" class="svelte-1uha8ag">Icons created by Freepik - Flaticon</a></footer>',1);function Vb(n,e){L_(e,!1);const t=()=>q_(jm,"$authUser",s),[s,i]=B_(),r=Pe();let o=Pe(!1),l=Pe({}),c=Pe([]),h=Pe(!1),f=Pe(!1),p=Pe(!1),m=Pe(!1),A=Pe(!0),S=Pe(""),P=Pe(null),O=Pe(!1);g_(()=>{const L=Xr(ro,"items"),j=LT(L,fe=>{Z(l,{...fe.val()||{}}),Z(A,!1)});return()=>j()});let W=Pe(""),B=Pe(""),z=Pe(""),re=Pe(""),se=Pe(""),de=Pe("");const E=async L=>{const j=x(l)[L];if(!j)return;const fe=Xr(ro,`items/${L}`);await Rl(fe,{...j,checked:!j.checked})},_=async()=>{if(!(!x(re)||!x(se))){Z(o,!0);try{const L=DT(Xr(ro,"items"));await Rl(L,{itemId:L.key,item:x(re),quantity:x(se),user:x(z),checked:!1}),Z(re,""),Z(se,""),document.querySelector('input[type="text"]:first-of-type')?.focus()}catch(L){console.error("Add failed:",L)}finally{Z(o,!1)}}},v=async L=>{const j=ib(_b,"users",L),fe=await pb(j);if(!fe.exists())throw new Error("User document does not exist");const We=fe.data();if(!We.user)throw new Error("User name missing in user document");return We.user},T=async()=>{if(!(!x(W)||!x(B))){Z(o,!0);try{const L=await jw(Xl,x(W),x(B));Z(p,!1)}catch(L){alert("Login failed: "+L.message)}finally{Z(o,!1)}}},I=async()=>{await Xl.signOut(),Z(z,"")},C=async()=>{Z(m,!0);try{await Promise.all(x(c).map(L=>OT(Xr(ro,`items/${L}`)))),Z(c,[]),Z(f,!1)}catch(L){console.error("Delete failed:",L)}finally{Z(m,!1)}};function y(L){const j=L.currentTarget;!x(r)&&j.id==="email-input"&&L.key==="Enter"&&(L.preventDefault(),document.getElementById("password-input")?.focus()),!x(r)&&j.id==="password-input"&&x(W)&&x(B)&&L.key==="Enter"&&(L.preventDefault(),T()),x(r)&&j.id==="item-input"&&L.key==="Enter"&&(L.preventDefault(),document.getElementById("quantity-input")?.focus()),x(r)&&j.id==="quantity-input"&&x(re)&&x(se)&&L.key==="Enter"&&!x(o)&&(L.preventDefault(),_())}qn(()=>t(),()=>{Z(r,!!t())}),qn(()=>t(),()=>{Z(de,t()?t().displayName||t().email||"User":"")}),qn(()=>t(),()=>{t()!==void 0&&Z(O,!0)}),qn(()=>(x(O),t(),x(P)),()=>{x(O)&&t()?(t().uid!==x(P)&&Z(P,t().uid),v(t().uid).then(L=>{Z(z,L)}).catch(()=>{Z(z,t().displayName||t().email||"User")})):Z(z,"")}),qn(()=>(x(O),t()),()=>{x(O)&&t()===null&&(Z(P,null),Z(z,""))}),qn(()=>x(l),()=>{Z(c,Object.values(x(l)).filter(L=>L.checked).map(L=>L.itemId))}),qn(()=>x(c),()=>{Z(h,x(c).length>0)}),M_(),f_();var Ve=Rb();W_("1uha8ag",L=>{var j=yb();uh(4),F_(()=>{U_.title="Shopping List"}),at(L,j)});var gt=Gr(Ve);K_(gt,e,"default",{});var cs=Ie(gt,2);let Sr;var Pn=oe(cs),kn=Ie(oe(Pn),2),ii=oe(kn),us=oe(ii);Kr(us),ae(ii);var hs=Ie(ii,2),ds=oe(hs);Kr(ds),ae(hs);var Nn=Ie(hs,2),ri=oe(Nn);ae(Nn),ae(kn),ae(Pn),ae(cs);var Dn=Ie(cs,2),fs=oe(Dn),On=oe(fs),ps=oe(On);let Rr;var Ta=Ie(ps,2);{var br=L=>{var j=vb(),fe=Gr(j),We=oe(fe,!0);ae(fe);var mt=Ie(fe,2);Wn(()=>Dt(We,x(z))),Xe("click",mt,I),at(L,j)};jn(Ta,L=>{x(r)&&L(br)})}ae(On);var oi=Ie(On,4);{var Pr=L=>{var j=Cb(),fe=Gr(j),We=oe(fe),mt=oe(We);Kr(mt),ae(We);var $t=Ie(We,2),Qe=oe($t);Kr(Qe),ae($t);var xn=Ie($t,2),kt=oe(xn),ci=oe(kt,!0);ae(kt),ae(xn),ae(fe);var ui=Ie(fe,2),Dr=oe(ui);$_(Dr,1,()=>(x(l),lt(()=>Object.values(x(l)))),ue=>ue.itemId,(ue,ye)=>{var Fe=Eb();let Nt;var st=oe(Fe),gs=oe(st,!0);ae(st);var Re=Ie(st,2),Lr=oe(Re,!0);ae(Re);var zt=Ie(Re,2),Mn=oe(zt,!0);ae(zt),ae(Fe),Wn(()=>{j_(Fe,"data-item-id",(x(ye),lt(()=>x(ye).itemId))),Nt=Ua(Fe,1,"svelte-1uha8ag",null,Nt,{checked:x(ye).checked}),Dt(gs,(x(ye),lt(()=>x(ye).item))),Dt(Lr,(x(ye),lt(()=>x(ye).quantity))),Dt(Mn,(x(ye),lt(()=>x(ye).user)))}),Xe("click",Fe,()=>E(x(ye).itemId)),at(ue,Fe)});var Or=Ie(Dr,2);{var xr=ue=>{var ye=Ib();at(ue,ye)},Ln=ue=>{var ye=d_(),Fe=Gr(ye);{var Nt=st=>{var gs=Tb();at(st,gs)};jn(Fe,st=>{x(l),lt(()=>Object.keys(x(l)).length===0)&&st(Nt)},!0)}at(ue,ye)};jn(Or,ue=>{x(A)?ue(xr):ue(Ln,!1)})}ae(ui);var hi=Ie(ui,2);{var di=ue=>{var ye=wb(),Fe=oe(ye),Nt=oe(Fe);ae(Fe),ae(ye),Wn(()=>Dt(Nt,`Delete ${x(c),lt(()=>x(c).length)??""} selected item${x(c),lt(()=>x(c).length===1?"":"s")??""}`)),Xe("click",Fe,()=>Z(f,!0)),at(ue,ye)};jn(hi,ue=>{x(h)&&!x(A)&&ue(di)})}Wn(()=>{kt.disabled=x(o)||!x(re)||!x(se),Dt(ci,x(o)?"Adding...":"Add")}),Qr(mt,()=>x(re),ue=>Z(re,ue)),Xe("keydown",mt,y),Qr(Qe,()=>x(se),ue=>Z(se,ue)),Xe("keydown",Qe,y),Xe("click",kt,_),at(L,j)};jn(oi,L=>{x(r)&&L(Pr)})}ae(fs),ae(Dn);var kr=Ie(Dn,2);{var ai=L=>{var j=Ab(),fe=oe(j),We=Ie(oe(fe),2),mt=oe(We);ae(We);var $t=Ie(We,2),Qe=oe($t),xn=oe(Qe,!0);ae(Qe);var kt=Ie(Qe,2);ae($t),ae(fe),ae(j),Wn(()=>{Dt(mt,`This will delete ${x(c),lt(()=>x(c).length)??""} item${x(c),lt(()=>x(c).length===1?"":"s")??""}`),Qe.disabled=x(m),Dt(xn,x(m)?"Deleting...":"Yes, Delete")}),Xe("click",Qe,C),Xe("click",kt,()=>Z(f,!1)),Xe("click",j,()=>Z(f,!1)),at(L,j)};jn(kr,L=>{x(f)&&L(ai)})}var li=Ie(kr,2);{var Nr=L=>{var j=Sb(),fe=oe(j),We=Ie(fe);ae(j),Wn(()=>Dt(fe,`Something went wrong: ${x(S)??""} `)),Xe("click",We,()=>Z(S,"")),at(L,j)};jn(li,L=>{x(S)&&L(Nr)})}uh(2),Wn(()=>{Sr=Ua(cs,1,"login-box svelte-1uha8ag",null,Sr,{show:x(p)}),Rr=Ua(ps,1,"login-link svelte-1uha8ag",null,Rr,{hidden:x(r)})}),Qr(us,()=>x(W),L=>Z(W,L)),Xe("keydown",us,y),Qr(ds,()=>x(B),L=>Z(B,L)),Xe("keydown",ds,y),Xe("click",ri,T),Xe("click",ps,()=>Z(p,!0)),at(n,Ve),V_(),i()}export{Vb as component};
